<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigator - Memory Image Explorer</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg
    viewBox='0 0 48 48' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='24'
    cy='24' r='22' fill='%236366f1'/%3E%3Cline x1='24' y1='14' x2='16' y2='24'
    stroke='%23fbbf24' stroke-width='2' stroke-linecap='round'/%3E%3Cline
    x1='24' y1='14' x2='32' y2='24' stroke='%23fbbf24' stroke-width='2'
    stroke-linecap='round'/%3E%3Cline x1='16' y1='24' x2='24' y2='34'
    stroke='%2310b981' stroke-width='2' stroke-linecap='round'/%3E%3Cline
    x1='32' y1='24' x2='24' y2='34' stroke='%2310b981' stroke-width='2'
    stroke-linecap='round'/%3E%3Cline x1='16' y1='24' x2='32' y2='24'
    stroke='%23ec4899' stroke-width='2' stroke-linecap='round'/%3E%3Ccircle
    cx='24' cy='14' r='4' fill='%23fef3c7'/%3E%3Ccircle cx='16' cy='24' r='4'
    fill='%23fde68a'/%3E%3Ccircle cx='32' cy='24' r='4'
    fill='%23fde68a'/%3E%3Ccircle cx='24' cy='34' r='4'
    fill='%23fef3c7'/%3E%3Ccircle cx='24' cy='24' r='3'
    fill='%23ffffff'/%3E%3Ctext x='24' y='43' font-family='Arial, sans-serif'
    font-size='5.5' font-weight='bold' fill='%23ffffff' text-anchor='middle'
    letter-spacing='1.5'%3ENavigator%3C/text%3E%3C/svg%3E">
    <style rel="stylesheet">:root,[data-theme=dark]{--bg-primary: #1e1e1e;--bg-secondary: #252526;--bg-tertiary: #2d2d30;--bg-hover: #2a2d2e;--bg-active: #094771;--bg-input: #1e1e1e;--border-primary: #3e3e42;--border-hover: #555;--text-primary: #d4d4d4;--text-secondary: #cccccc;--text-muted: #858585;--text-disabled: #666;--accent-primary: #0e639c;--accent-hover: #1177bb;--accent-active: #0d5a8f;--error-bg: #5a1d1d;--error-text: #f48771;--error-border: #f48771;--success-text: #89d185;--code-property: #9cdcfe;--code-value: #ce9178;--code-type: #4ec9b0;--scrollbar-track: #1e1e1e;--scrollbar-thumb: #424242;--scrollbar-thumb-hover: #4e4e4e;--shadow-color: rgba(0, 0, 0, .3);--overlay-bg: rgba(0, 0, 0, .7)}[data-theme=light]{--bg-primary: #ffffff;--bg-secondary: #f3f3f3;--bg-tertiary: #e8e8e8;--bg-hover: #e0e0e0;--bg-active: #0078d4;--bg-input: #ffffff;--border-primary: #d4d4d4;--border-hover: #a0a0a0;--text-primary: #333333;--text-secondary: #1e1e1e;--text-muted: #666666;--text-disabled: #a0a0a0;--accent-primary: #0078d4;--accent-hover: #106ebe;--accent-active: #005a9e;--error-bg: #fde7e9;--error-text: #d13438;--error-border: #d13438;--success-text: #107c10;--code-property: #0070c1;--code-value: #a31515;--code-type: #008080;--scrollbar-track: #f3f3f3;--scrollbar-thumb: #c0c0c0;--scrollbar-thumb-hover: #a8a8a8;--shadow-color: rgba(0, 0, 0, .15);--overlay-bg: rgba(0, 0, 0, .4)}*{box-sizing:border-box;margin:0;padding:0}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;height:100vh;display:flex;flex-direction:column;background:var(--bg-primary);color:var(--text-primary);overflow:hidden}#app{display:flex;flex-direction:column;height:100vh}.app-title{background:var(--bg-tertiary);color:var(--text-secondary);text-align:center;padding:8px 16px;font-size:14px;font-weight:600;letter-spacing:.5px;border-bottom:1px solid var(--border-primary);flex-shrink:0}header{background:var(--bg-secondary);border-bottom:1px solid var(--border-primary);flex-shrink:0}.logo{display:flex;align-items:center;gap:12px;padding:10px 16px}.logo img{width:32px;height:32px}.logo h1{font-size:20px;font-weight:600;color:var(--text-secondary);margin:0}.logo .subtitle{font-size:12px;color:var(--text-muted);font-weight:400}.controls{display:flex;gap:8px;padding:8px 16px;align-items:center;border-top:1px solid var(--border-primary);justify-content:space-between}.controls-left,.controls-right{display:flex;gap:8px;align-items:center}.status-bar{padding:6px 16px;font-size:12px;color:var(--text-muted);border-top:1px solid var(--border-primary);min-height:28px}.status-bar.error{color:var(--error-text);background:var(--error-bg)}.status-bar.success{color:var(--success-text)}.dirty-indicator{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;margin-right:4px;background:var(--error-bg);border:1px solid var(--error-border);border-radius:3px;color:var(--error-text);font-size:11px;font-weight:600;letter-spacing:.5px;animation:pulse 2s ease-in-out infinite}@keyframes pulse{0%,to{box-shadow:0 0 #f48771b3}50%{box-shadow:0 0 0 3px #f4877100}}button{background:var(--accent-primary);color:#fff;border:none;padding:6px 14px;border-radius:2px;cursor:pointer;font-size:13px;transition:background .2s}button:hover{background:var(--accent-hover)}button:active{background:var(--accent-active)}button:disabled{background:var(--border-hover);cursor:not-allowed;opacity:.5}#bottom-panels{flex:1;display:flex;flex-direction:row;overflow:hidden;min-height:150px}.panel{display:flex;flex-direction:column;overflow:hidden}#tree-panel{flex:1;border-right:1px solid var(--border-primary)}#inspector-panel{flex:1}.panel-header{background:var(--bg-tertiary);padding:10px 16px;font-size:13px;font-weight:600;color:var(--text-secondary);border-bottom:1px solid var(--border-primary);display:flex;align-items:center;justify-content:space-between;flex-shrink:0}.panel-header h2{font-size:13px;font-weight:600;margin:0}.nav-buttons{display:flex;gap:4px}.nav-buttons button{background:var(--border-primary);color:var(--text-secondary);border:none;padding:4px 10px;border-radius:2px;cursor:pointer;font-size:12px;transition:background .2s;min-width:32px}.nav-buttons button:hover:not(:disabled){background:var(--border-hover)}.nav-buttons button:active:not(:disabled){background:var(--bg-tertiary)}.nav-buttons button:disabled{background:var(--bg-tertiary);color:var(--text-disabled);cursor:not-allowed;opacity:.5}.panel-content{flex:1;overflow:auto;padding:12px;background:var(--bg-primary)}.path-display{font-size:11px;color:var(--text-muted);font-family:Consolas,Monaco,monospace}.tree-node{-webkit-user-select:none;user-select:none;margin:2px 0}.tree-node-header{display:flex;align-items:center;padding:3px 6px;cursor:pointer;border-radius:3px}.tree-node-header:hover{background:var(--bg-hover)}.tree-node-header.selected{background:var(--bg-active)}.tree-toggle{width:16px;height:16px;display:inline-flex;align-items:center;justify-content:center;font-size:10px;margin-right:4px;color:var(--text-secondary);flex-shrink:0}.tree-toggle.collapsed:before{content:"▶"}.tree-toggle.expanded:before{content:"▼"}.tree-toggle.leaf{visibility:hidden}.tree-icon{margin-right:6px;font-size:14px;flex-shrink:0}.tree-label{font-size:13px;color:var(--text-secondary)}.tree-children{margin-left:20px;display:none}.tree-children.expanded{display:block}.property-table{width:100%;border-collapse:collapse;font-size:13px}.property-table th{text-align:left;padding:10px 12px;background:var(--bg-tertiary);border-bottom:1px solid var(--border-primary);font-weight:600;color:var(--text-secondary)}.property-table td{padding:8px 12px;border-bottom:1px solid var(--border-primary);vertical-align:top}.property-name{color:var(--code-property);font-family:Consolas,Monaco,monospace}.property-value{color:var(--code-value);font-family:Consolas,Monaco,monospace;word-break:break-word}.property-value.clickable{cursor:pointer;text-decoration:underline}.property-value.clickable:hover{color:var(--code-value);opacity:.8}.property-type{color:var(--code-type);font-size:11px;font-style:italic;margin-left:8px}.empty-state{color:var(--text-muted);font-size:13px;padding:24px;text-align:center}#editor-panel{border-bottom:1px solid var(--border-primary);flex:1;min-height:150px;display:flex;flex-direction:column}.editor-wrapper{flex:1;display:flex;position:relative;overflow:hidden;background:var(--bg-primary);min-height:0}.line-numbers{background:var(--bg-primary);color:var(--text-muted);padding:16px 8px;text-align:right;font-family:Consolas,Monaco,Courier New,monospace;font-size:14px;line-height:1.5;-webkit-user-select:none;user-select:none;border-right:1px solid var(--border-primary);overflow-y:auto;overflow-x:hidden;white-space:pre;flex-shrink:0}.code-editor{flex:1;font-family:Consolas,Monaco,Courier New,monospace;font-size:14px;padding:16px;background:var(--bg-primary);color:var(--text-primary);border:none;outline:none;-moz-tab-size:2;tab-size:2;line-height:1.5;overflow-y:auto;overflow-x:auto;white-space:pre;overflow-wrap:normal}.code-editor>div{min-height:100%;outline:none}.code-editor .token.comment,.code-editor .token.prolog,.code-editor .token.doctype,.code-editor .token.cdata{color:#6a9955}.code-editor .token.punctuation{color:var(--text-primary)}.code-editor .token.property,.code-editor .token.tag,.code-editor .token.boolean,.code-editor .token.number,.code-editor .token.constant,.code-editor .token.symbol{color:#b5cea8}.code-editor .token.selector,.code-editor .token.attr-name,.code-editor .token.string,.code-editor .token.char,.code-editor .token.builtin{color:#ce9178}.code-editor .token.operator,.code-editor .token.entity,.code-editor .token.url,.code-editor .token.variable{color:var(--text-primary)}.code-editor .token.atrule,.code-editor .token.attr-value,.code-editor .token.keyword{color:#569cd6}.code-editor .token.function,.code-editor .token.class-name{color:#dcdcaa}.code-editor .token.regex,.code-editor .token.important{color:#d16969}.error-panel{background:var(--error-bg);border-top:2px solid var(--error-border);padding:12px 16px;font-family:Consolas,Monaco,Courier New,monospace;font-size:12px;color:var(--error-text);line-height:1.6;white-space:pre-wrap;word-wrap:break-word;max-height:120px;overflow-y:auto}::-webkit-scrollbar{width:12px;height:12px}::-webkit-scrollbar-track{background:var(--scrollbar-track)}::-webkit-scrollbar-thumb{background:var(--scrollbar-thumb);border-radius:6px}::-webkit-scrollbar-thumb:hover{background:var(--scrollbar-thumb-hover)}.view-container{display:flex;flex-direction:column;height:100vh;width:100%}#explorer-view{display:flex;flex-direction:column;overflow:hidden}.list-header{background:var(--bg-secondary);border-bottom:1px solid var(--border-primary);padding:16px 24px;flex-shrink:0}.list-header .logo{display:flex;align-items:center;gap:12px;margin-bottom:16px}.list-header .controls{display:flex;gap:8px;justify-content:flex-end}.list-content{flex:1;overflow-y:auto;padding:32px;background:var(--bg-primary)}.memimg-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:24px;max-width:1400px;margin:0 auto}.memimg-card{background:var(--bg-secondary);border:1px solid var(--border-primary);border-radius:6px;padding:20px;cursor:pointer;transition:all .2s ease;display:flex;flex-direction:column;gap:12px}.memimg-card:hover{border-color:var(--accent-primary);transform:translateY(-2px);box-shadow:0 4px 12px var(--shadow-color)}.card-header{display:flex;justify-content:space-between;align-items:flex-start;gap:12px}.card-title{font-size:18px;font-weight:600;color:var(--text-secondary);margin:0;flex:1;word-break:break-word}.card-actions{display:flex;gap:4px;flex-shrink:0}.icon-btn{background:transparent;border:1px solid var(--border-primary);padding:4px 8px;border-radius:3px;cursor:pointer;font-size:14px;transition:all .2s;min-width:unset}.icon-btn:hover{background:var(--border-primary);border-color:var(--border-hover)}.icon-btn:active{background:var(--bg-tertiary)}.card-body{flex:1;display:flex;flex-direction:column;gap:12px}.card-description{color:var(--text-muted);font-size:14px;line-height:1.5;margin:0;min-height:42px}.card-description em{opacity:.6}.card-meta{display:flex;flex-direction:column;gap:6px;font-size:12px;color:var(--text-disabled)}.meta-item{display:flex;align-items:center;gap:6px}.card-footer{display:flex;justify-content:flex-end;padding-top:12px;border-top:1px solid var(--border-primary)}.open-btn{background:var(--accent-primary);color:#fff;border:none;padding:8px 16px;border-radius:3px;cursor:pointer;font-size:14px;font-weight:600;transition:background .2s}.open-btn:hover{background:var(--accent-hover)}.empty-state{text-align:center;padding:80px 24px;color:var(--text-muted)}.empty-icon{font-size:64px;margin-bottom:24px}.empty-state h2{font-size:24px;color:var(--text-secondary);margin:0 0 12px}.empty-state p{font-size:16px;margin:0 0 24px}.primary-button{background:var(--accent-primary);color:#fff;border:none;padding:10px 20px;border-radius:3px;cursor:pointer;font-size:14px;font-weight:600;transition:background .2s}.primary-button:hover{background:var(--accent-hover)}.error-state{text-align:center;padding:80px 24px;color:var(--error-text)}.error-state h2{font-size:24px;margin:0 0 12px}.error-state p{font-size:16px;margin:0}.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--overlay-bg);display:flex;align-items:center;justify-content:center;z-index:1000;animation:fadeIn .2s ease}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.modal-dialog{background:var(--bg-secondary);border:1px solid var(--border-primary);border-radius:6px;width:90%;max-width:500px;max-height:90vh;overflow:hidden;display:flex;flex-direction:column;animation:slideIn .2s ease}@keyframes slideIn{0%{transform:translateY(-20px);opacity:0}to{transform:translateY(0);opacity:1}}.modal-header{padding:20px 24px;border-bottom:1px solid var(--border-primary);display:flex;justify-content:space-between;align-items:center}.modal-header h2{font-size:18px;font-weight:600;color:var(--text-secondary);margin:0}.modal-close{background:transparent;border:none;color:var(--text-muted);font-size:28px;line-height:1;cursor:pointer;padding:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:3px;transition:all .2s}.modal-close:hover{background:var(--border-primary);color:var(--text-secondary)}.modal-body{padding:24px;overflow-y:auto;flex:1}.form-group{margin-bottom:20px}.form-group:last-child{margin-bottom:0}.form-group label{display:block;margin-bottom:8px;color:var(--text-secondary);font-size:14px;font-weight:600}.form-input,.form-textarea{width:100%;background:var(--bg-input);border:1px solid var(--border-primary);border-radius:3px;padding:10px 12px;color:var(--text-primary);font-size:14px;font-family:inherit;transition:border-color .2s}.form-input:focus,.form-textarea:focus{outline:none;border-color:var(--accent-primary)}.form-textarea{resize:vertical;font-family:inherit}.modal-footer{padding:16px 24px;border-top:1px solid var(--border-primary);display:flex;justify-content:flex-end;gap:12px}.cancel-btn{background:transparent;border:1px solid var(--border-primary);color:var(--text-secondary);padding:8px 16px;border-radius:3px;cursor:pointer;font-size:14px;transition:all .2s}.cancel-btn:hover{background:var(--border-primary);border-color:var(--border-hover)}.save-btn,.create-btn{background:var(--accent-primary);color:#fff;border:none;padding:8px 16px;border-radius:3px;cursor:pointer;font-size:14px;font-weight:600;transition:background .2s}.save-btn:hover,.create-btn:hover{background:var(--accent-hover)}.header-info{display:flex;flex-direction:column;gap:8px}.back-button{background:transparent;border:1px solid var(--border-primary);color:var(--text-muted);padding:4px 12px;border-radius:3px;cursor:pointer;font-size:13px;align-self:flex-start;transition:all .2s}.back-button:hover{background:var(--border-primary);color:var(--text-secondary);border-color:var(--border-hover)}#current-memimg-name{font-size:16px;margin:0;color:var(--text-secondary)}.resize-handle{background:var(--border-primary);flex-shrink:0;position:relative;z-index:10;transition:background .2s}.resize-handle:hover{background:var(--accent-primary)}.resize-handle:active{background:var(--accent-hover)}.resize-handle-horizontal{height:4px;cursor:ns-resize;width:100%}.resize-handle-vertical{width:4px;cursor:ew-resize;height:100%}.sidebar{position:fixed;left:0;top:0;bottom:0;width:400px;background:var(--bg-secondary);border-right:1px solid var(--border-primary);transform:translate(0);transition:transform .3s ease;z-index:1000;display:flex;flex-direction:column;box-shadow:2px 0 8px var(--shadow-color)}.sidebar.collapsed{transform:translate(-400px)}.sidebar-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid var(--border-primary);background:var(--bg-tertiary)}.sidebar-header h3{font-size:15px;font-weight:600;color:var(--text-secondary);margin:0}.sidebar-controls{display:flex;gap:8px;padding:12px 16px;border-bottom:1px solid var(--border-primary);background:var(--bg-secondary)}#history-search{flex:1;background:var(--bg-primary);border:1px solid var(--border-primary);border-radius:3px;padding:6px 10px;color:var(--text-primary);font-size:13px;outline:none}#history-search:focus{border-color:var(--accent-primary)}.sidebar-stats{padding:8px 16px;font-size:11px;color:var(--text-muted);border-bottom:1px solid var(--border-primary);background:var(--bg-secondary)}.sidebar-content{flex:1;overflow-y:auto;background:var(--bg-primary)}.history-entry{padding:12px 16px;border-bottom:1px solid var(--border-primary);transition:background .2s}.history-entry:hover{background:var(--bg-hover)}.history-entry-header{display:flex;align-items:center;gap:8px;margin-bottom:8px}.history-status{color:var(--success-text);font-size:8px;line-height:1}.history-timestamp{font-size:11px;color:var(--text-muted);flex:1}.history-size{font-size:11px;color:var(--text-disabled)}.history-code{margin-bottom:8px}.history-code pre{font-family:Consolas,Monaco,monospace;font-size:12px;color:var(--text-primary);background:var(--bg-primary);padding:8px 10px;border-radius:3px;border:1px solid var(--border-primary);margin:0;overflow-x:auto;white-space:pre-wrap;word-wrap:break-word;line-height:1.4}.history-code.expandable pre{cursor:pointer}.history-actions{display:flex;gap:6px;flex-wrap:wrap}.history-btn{background:transparent;border:1px solid var(--border-primary);color:var(--text-secondary);padding:4px 10px;border-radius:3px;cursor:pointer;font-size:11px;transition:all .2s;white-space:nowrap}.history-btn:hover{background:var(--border-primary);border-color:var(--border-hover)}.history-btn:active{background:var(--bg-tertiary)}.history-empty,.history-error{padding:40px 24px;text-align:center;color:var(--text-muted);font-size:13px}.history-error{color:var(--error-text)}.editor-controls{display:flex;gap:8px;align-items:center}#toggle-history-btn{background:transparent;border:1px solid var(--border-primary);color:var(--text-secondary);padding:6px 12px}#toggle-history-btn:hover{background:var(--border-primary);border-color:var(--border-hover)}#theme-toggle-list,#theme-toggle-explorer{min-width:36px;font-size:18px;padding:6px 10px}#toggle-line-numbers-btn{color:var(--text-secondary);font-weight:700;font-size:16px}.value-navigable{cursor:pointer}.value-navigable:hover{opacity:.8}.value-null,.value-undefined{color:var(--text-muted);font-style:italic}.value-string{color:var(--code-value)}.value-number{color:#b5cea8}.value-boolean{color:#569cd6}.value-bigint{color:#b5cea8}.value-symbol{color:#ce9178}.value-date{color:#4fc1ff}.value-function,.value-array,.value-map,.value-set,.value-object{color:var(--code-type)}[data-theme=light] .value-number,[data-theme=light] .value-bigint{color:#098658}[data-theme=light] .value-boolean{color:#00f}[data-theme=light] .value-symbol{color:#a31515}[data-theme=light] .value-date{color:#0078d4}.inspector-tabs{display:flex;flex-direction:column;height:100%}.tab-headers{display:flex;border-bottom:1px solid var(--border-primary);background:var(--bg-secondary);flex-shrink:0}.tab-header{background:transparent;border:none;border-bottom:2px solid transparent;padding:10px 20px;cursor:pointer;font-size:13px;font-weight:500;color:var(--text-muted);transition:all .2s;position:relative}.tab-header:hover:not(:disabled){color:var(--text-secondary);background:var(--bg-hover)}.tab-header.active{color:var(--accent-primary);border-bottom-color:var(--accent-primary);font-weight:600}.tab-header:disabled{color:var(--text-disabled);cursor:not-allowed;opacity:.5}.tab-content{flex:1;overflow:auto;background:var(--bg-primary)}.tab-panel{display:none;padding:12px}.tab-panel.active{display:block}.collections-panel{display:flex;flex-direction:column;gap:16px}.collection-section{border:1px solid var(--border-primary);border-radius:4px;background:var(--bg-secondary);padding:12px}.collection-header{color:var(--code-property);font-family:Consolas,Monaco,monospace;font-size:14px;font-weight:600;margin:0 0 12px;padding-bottom:8px;border-bottom:1px solid var(--border-primary)}.collection-items{list-style:none;padding:0;margin:0}.collection-item{padding:6px 8px;border-radius:3px;font-family:Consolas,Monaco,monospace;font-size:13px;transition:background .2s}.collection-item:hover{background:var(--bg-hover)}.item-label{color:var(--text-muted);margin-right:4px}.item-value{color:var(--code-value)}.value-nested{color:var(--code-type);cursor:pointer;display:inline-flex;align-items:center;font-family:Consolas,Monaco,monospace}.value-nested-toggle{display:inline-block;width:14px;height:14px;margin-right:4px;font-size:10px;color:var(--text-muted)}.value-nested-toggle.collapsed:before{content:"▶"}.value-nested-toggle.expanded:before{content:"▼"}.value-nested-summary{color:var(--code-type);text-decoration:underline}.value-nested:hover .value-nested-summary{opacity:.8}.nested-properties{display:none;margin-top:8px;padding-left:24px;border-left:2px solid var(--border-primary)}.nested-properties.expanded{display:block}.nested-prop{padding:4px 0;font-size:12px}.nested-prop-key{color:var(--code-property);margin-right:6px}.nested-prop-value{color:var(--code-value)}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.comment,.token.prolog,.token.doctype,.token.cdata{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.property,.token.tag,.token.constant,.token.symbol,.token.deleted{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.selector,.token.attr-name,.token.string,.token.char,.token.builtin,.token.inserted{color:#a6e22e}.token.operator,.token.entity,.token.url,.language-css .token.string,.style .token.string,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.function,.token.class-name{color:#e6db74}.token.keyword{color:#66d9ef}.token.regex,.token.important{color:#fd971f}.token.important,.token.bold{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style>
    <!-- JavaScript Type System - Inlined for file:// protocol compatibility -->
    <script>
(function(global) {
  'use strict';

  function Type(name) {
    this.typeName = name;
  }

  Type.prototype.check = function(value) {
    throw new Error(`${this.typeName}.check() not implemented`);
  };

  function PrimitiveType(name) {
    Type.call(this, name);
  }

  PrimitiveType.prototype = Object.create(Type.prototype);
  PrimitiveType.prototype.constructor = PrimitiveType;

  PrimitiveType.prototype.check = function(value) {
    switch(this.typeName) {
      case 'number': return typeof value === 'number';
      case 'string': return typeof value === 'string';
      case 'boolean': return typeof value === 'boolean';
      case 'bigint': return typeof value === 'bigint';
      case 'symbol': return typeof value === 'symbol';
      case 'undefined': return value === undefined;
      case 'null': return value === null;
      default: return false;
    }
  };

  const NumberType = new PrimitiveType('number');
  const StringType = new PrimitiveType('string');
  const BooleanType = new PrimitiveType('boolean');
  const BigIntType = new PrimitiveType('bigint');
  const SymbolType = new PrimitiveType('symbol');
  const UndefinedType = new PrimitiveType('undefined');
  const NullType = new PrimitiveType('null');

  function ObjectType({name, properties = {}, prototype = null}) {
    const factory = function(props = {}) {
      const instance = Object.create(factory.prototype);

      Object.keys(properties).forEach(propName => {
        if (propName in props) {
          instance[propName] = props[propName];
        }
      });

      Object.defineProperty(instance, '__type__', {
        value: factory,
        writable: false,
        enumerable: false,
        configurable: false
      });

      return instance;
    };

    if (prototype) {
      factory.prototype = Object.create(prototype);
    } else {
      factory.prototype = {};
    }

    factory.typeName = name;
    factory.properties = properties;

    Object.setPrototypeOf(factory, ObjectType.prototype);
    Type.call(factory, name);

    return factory;
  }

  Type.call(ObjectType, 'ObjectType');
  ObjectType.prototype = Object.create(Type.prototype);
  ObjectType.prototype.constructor = ObjectType;

  ObjectType.prototype.check = function(value) {
    return typeof value === 'object' && value !== null && value.__type__ === this;
  };

  function FunctionType({name, signature = null}) {
    Type.call(this, name);
    this.signature = signature;
  }

  FunctionType.prototype = Object.create(Type.prototype);
  FunctionType.prototype.constructor = FunctionType;

  FunctionType.prototype.check = function(value) {
    return typeof value === 'function';
  };

  function ArrayType(elementType = null) {
    Type.call(this, elementType ? `Array<${elementType.typeName}>` : 'Array');
    this.elementType = elementType;
  }

  ArrayType.prototype = Object.create(Type.prototype);
  ArrayType.prototype.constructor = ArrayType;

  ArrayType.prototype.check = function(value) {
    return Array.isArray(value);
  };

  const ArrayTypeInstance = new ArrayType();

  function SetType(elementType = null) {
    Type.call(this, elementType ? `Set<${elementType.typeName}>` : 'Set');
    this.elementType = elementType;
  }

  SetType.prototype = Object.create(Type.prototype);
  SetType.prototype.constructor = SetType;

  SetType.prototype.check = function(value) {
    return value instanceof Set;
  };

  const SetTypeInstance = new SetType();

  function MapType(keyType = null, valueType = null) {
    const keyPart = keyType ? keyType.typeName : '*';
    const valuePart = valueType ? valueType.typeName : '*';
    Type.call(this, `Map<${keyPart}, ${valuePart}>`);
    this.keyType = keyType;
    this.valueType = valueType;
  }

  MapType.prototype = Object.create(Type.prototype);
  MapType.prototype.constructor = MapType;

  MapType.prototype.check = function(value) {
    return value instanceof Map;
  };

  const MapTypeInstance = new MapType();

  function DateType() {
    Type.call(this, 'Date');
  }

  DateType.prototype = Object.create(Type.prototype);
  DateType.prototype.constructor = DateType;

  DateType.prototype.check = function(value) {
    return value instanceof Date;
  };

  const DateTypeInstance = new DateType();

  const JSTypes = {
    Type,
    PrimitiveType,
    NumberType,
    StringType,
    BooleanType,
    BigIntType,
    SymbolType,
    UndefinedType,
    NullType,
    ObjectType,
    FunctionType,
    ArrayType,
    ArrayTypeInstance,
    SetType,
    SetTypeInstance,
    MapType,
    MapTypeInstance,
    DateType,
    DateTypeInstance
  };

  global.JSTypes = JSTypes;
  global.Type = Type;
  global.PrimitiveType = PrimitiveType;
  global.NumberType = NumberType;
  global.StringType = StringType;
  global.BooleanType = BooleanType;
  global.BigIntType = BigIntType;
  global.SymbolType = SymbolType;
  global.UndefinedType = UndefinedType;
  global.NullType = NullType;
  global.ObjectType = ObjectType;
  global.FunctionType = FunctionType;
  global.ArrayType = ArrayType;
  global.SetType = SetType;
  global.MapType = MapType;
  global.DateType = DateType;
  global.DateTypeInstance = DateTypeInstance;

})(typeof window !== 'undefined' ? window : global);
    </script>
  <script type="module" crossorigin>(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();function jt(e){return Array.isArray(e)||e instanceof Map||e instanceof Set}var W=(e=>(e[e.NULL=0]="NULL",e[e.UNDEFINED=1]="UNDEFINED",e[e.PRIMITIVE=2]="PRIMITIVE",e[e.BIGINT=3]="BIGINT",e[e.SYMBOL=4]="SYMBOL",e[e.DATE=5]="DATE",e[e.FUNCTION=6]="FUNCTION",e[e.ARRAY=7]="ARRAY",e[e.MAP=8]="MAP",e[e.SET=9]="SET",e[e.OBJECT=10]="OBJECT",e))(W||{});function Yt(e){if(e===null)return{category:0,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!1};if(e===void 0)return{category:1,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!1};const t=typeof e;return t==="string"||t==="number"||t==="boolean"?{category:2,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!1}:t==="bigint"?{category:3,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!0}:t==="symbol"?{category:4,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!0}:e instanceof Date?{category:5,isPrimitive:!1,isObject:!0,isCollection:!1,needsSpecialSerialization:!0}:t==="function"?{category:6,isPrimitive:!1,isObject:!0,isCollection:!1,needsSpecialSerialization:!0}:Array.isArray(e)?{category:7,isPrimitive:!1,isObject:!0,isCollection:!0,needsSpecialSerialization:!1}:e instanceof Map?{category:8,isPrimitive:!1,isObject:!0,isCollection:!0,needsSpecialSerialization:!0}:e instanceof Set?{category:9,isPrimitive:!1,isObject:!0,isCollection:!0,needsSpecialSerialization:!0}:{category:10,isPrimitive:!1,isObject:!0,isCollection:!1,needsSpecialSerialization:!1}}const L={SET:"SET",DELETE:"DELETE",ARRAY_PUSH:"ARRAY_PUSH",ARRAY_POP:"ARRAY_POP",ARRAY_SHIFT:"ARRAY_SHIFT",ARRAY_UNSHIFT:"ARRAY_UNSHIFT",ARRAY_SPLICE:"ARRAY_SPLICE",ARRAY_SORT:"ARRAY_SORT",ARRAY_REVERSE:"ARRAY_REVERSE",ARRAY_FILL:"ARRAY_FILL",ARRAY_COPYWITHIN:"ARRAY_COPYWITHIN",MAP_SET:"MAP_SET",MAP_DELETE:"MAP_DELETE",MAP_CLEAR:"MAP_CLEAR",SET_ADD:"SET_ADD",SET_DELETE:"SET_DELETE",SET_CLEAR:"SET_CLEAR",SCRIPT:"SCRIPT"},he={TYPE:"__type__",DATE_VALUE:"__dateValue__"};class qt{constructor(){this.seen=new Map}hasSeen(t){return this.seen.has(t)}markSeen(t,n){this.seen.set(t,n)}getReference(t){return this.seen.has(t)?{__type__:"ref",path:this.seen.get(t)||[]}:null}}class zt{constructor(t,n){this.targetToPath=t,this.currentPath=n,this.seen=new Map}hasSeen(t){return this.seen.has(t)}markSeen(t,n){this.seen.set(t,n)}getReference(t){const n=this.targetToPath.get(t);return n&&n.length>0&&!(n.length>=this.currentPath.length&&this.currentPath.every((s,a)=>s===n[a]))?{__type__:"ref",path:n}:this.hasSeen(t)?{__type__:"ref",path:this.seen.get(t).slice(this.currentPath.length)}:null}}function pe(e,t,n,r){const s=typeof e=="object"&&e!==null&&r.get(e)||e,a=Yt(s);switch(a.category){case W.NULL:case W.UNDEFINED:return e;case W.PRIMITIVE:return e;case W.BIGINT:return{[he.TYPE]:"bigint",value:e.toString()};case W.SYMBOL:return{[he.TYPE]:"symbol",description:e.description};case W.DATE:{const o=r.get(e)||e,i=n.getReference(o);if(i)return i;n.markSeen(o,t);const c=o,d=c.getTime(),l=isNaN(d)?null:c.toISOString(),u={[he.TYPE]:"date",[he.DATE_VALUE]:l},g=Object.entries(c);for(const[y,v]of g)u[y]=pe(v,[...t,y],n,r);return u}case W.FUNCTION:{const o=e;return o.__type__==="function"?{[he.TYPE]:"function",sourceCode:o.sourceCode||e.toString()}:void 0}case W.MAP:case W.SET:case W.ARRAY:case W.OBJECT:{const o=r.get(e)||e,i=n.getReference(o);if(i)return i;if(n.markSeen(o,t),a.category===W.MAP)return{[he.TYPE]:"map",entries:Array.from(o.entries()).map(([l,u],g)=>[pe(l,[...t,"key",String(g)],n,r),pe(u,[...t,"value",String(g)],n,r)])};if(a.category===W.SET)return{[he.TYPE]:"set",values:Array.from(o.values()).map((l,u)=>pe(l,[...t,String(u)],n,r))};if(a.category===W.ARRAY)return e.map((l,u)=>pe(l,[...t,String(u)],n,r));const c={},d=e;for(const l in d)Object.prototype.hasOwnProperty.call(d,l)&&(c[l]=pe(d[l],[...t,l],n,r));return c}default:return}}const yt=(e,t)=>{const n=new qt,r=pe(e,[],n,t);return JSON.stringify(r,null,2)},re=(e,t,n,r)=>{const s=new zt(n,r);return pe(e,r,s,t)},Wt=(e="memimg",t="events")=>{let n,r=!1;const s=new Promise((o,i)=>{if(typeof indexedDB>"u"){i(new Error("IndexedDB not available (browser only)"));return}const c=indexedDB.open(e);c.onerror=()=>i(c.error),c.onsuccess=()=>{const d=c.result,l=d.objectStoreNames.contains(t),u=d.version;if(d.close(),l){const g=indexedDB.open(e,u);g.onerror=()=>i(g.error),g.onsuccess=()=>{n=g.result,o()}}else{const g=indexedDB.open(e,u+1);g.onerror=()=>i(g.error),g.onsuccess=()=>{n=g.result,o()},g.onupgradeneeded=y=>{const v=y.target.result;v.objectStoreNames.contains(t)||v.createObjectStore(t,{autoIncrement:!0})}}},c.onupgradeneeded=d=>{const l=d.target.result;l.objectStoreNames.contains(t)||l.createObjectStore(t,{autoIncrement:!0})}}),a=()=>{if(r)throw new Error(`EventLog (${t}) has been closed and cannot be used. This usually happens when switching between memory images.`)};return{append:async o=>(a(),await s,new Promise((i,c)=>{const u=n.transaction([t],"readwrite").objectStore(t).add(o);u.onsuccess=()=>i(),u.onerror=()=>c(u.error)})),getAll:async()=>(a(),await s,new Promise((o,i)=>{const l=n.transaction([t],"readonly").objectStore(t).getAll();l.onsuccess=()=>o(l.result),l.onerror=()=>i(l.error)})),clear:async()=>(a(),await s,new Promise((o,i)=>{const l=n.transaction([t],"readwrite").objectStore(t).clear();l.onsuccess=()=>o(),l.onerror=()=>i(l.error)})),close:async()=>{if(!r){r=!0;try{await s,n&&(n.close(),await new Promise(o=>setTimeout(o,50)))}catch(o){console.warn(`EventLog close(): Database was never initialized (${t})`,o)}}}}};class Vt{constructor(){this.delta=new Map,this.DELETED=Symbol("deleted")}getDeletedSymbol(){return this.DELETED}isDirty(){return this.delta.size>0}size(){return this.delta.size}has(t){return this.delta.has(t)}get(t){return this.delta.get(t)}set(t,n){this.delta.set(t,n)}delete(t){this.delta.set(t,this.DELETED)}isDeleted(t){return this.delta.get(t)===this.DELETED}clear(){this.delta.clear()}entries(){return Array.from(this.delta.entries()).sort((t,n)=>{const r=t[0].split(".").length,s=n[0].split(".").length;return r-s})}createCheckpoint(){return new Map(this.delta)}restoreCheckpoint(t){this.delta.clear();for(const[n,r]of t)this.delta.set(n,r)}}function Gt(e){return e!==null&&typeof e=="object"}function ye(e,t,n=new WeakMap){if(!Gt(e))return e;if(n.has(e))return n.get(e);const r=t.has(e)?t.get(e):e;if(r!==e&&n.has(r)){const i=n.get(r);return n.set(e,i),i}if(r instanceof Map){const i=new Map;n.set(e,i),r!==e&&n.set(r,i);let c=!1;for(const[l,u]of r.entries()){const g=ye(l,t,n),y=ye(u,t,n);i.set(g,y),(g!==l||y!==u)&&(c=!0)}const d=c?i:r;return n.set(e,d),r!==e&&n.set(r,d),d}if(r instanceof Set){const i=new Set;n.set(e,i),r!==e&&n.set(r,i);let c=!1;for(const l of r.values()){const u=ye(l,t,n);i.add(u),u!==l&&(c=!0)}const d=c?i:r;return n.set(e,d),r!==e&&n.set(r,d),d}if(Array.isArray(r)){const i=[];n.set(e,i),r!==e&&n.set(r,i);let c=!1;for(const l of r){const u=ye(l,t,n);i.push(u),u!==l&&(c=!0)}const d=c?i:r;return n.set(e,d),r!==e&&n.set(r,d),d}const s={};n.set(e,s),r!==e&&n.set(r,s);let a=!1;for(const[i,c]of Object.entries(r)){const d=ye(c,t,n);s[i]=d,d!==c&&(a=!0)}const o=a?s:r;return n.set(e,o),r!==e&&n.set(r,o),o}function ct(e){return e!==null&&typeof e=="object"}function ze(e,t,n,r,s){if(r.has(e))return r.get(e);const a=t.getDeletedSymbol(),o=new Proxy(e,{get(i,c){if(typeof c=="symbol")return i[c];const d=[...n,String(c)],l=d.join(".");if(t.has(l)){const g=t.get(l);return g===a?void 0:ct(g)?s.has(g)?g:ze(g,t,d,r,s):g}const u=i[c];if(typeof u=="function"&&Array.isArray(i)){const g=String(c);return["push","pop","shift","unshift","splice","sort","reverse"].includes(g)?function(...v){const A=n.join(".");let S;return t.has(A)?S=t.get(A):(S=[...i],t.set(A,S)),u.apply(S,v)}:u.bind(i)}return ct(u)?s.has(u)?u:ze(u,t,d,r,s):u},set(i,c,d){const u=[...n,String(c)].join(".");return t.set(u,d),!0},has(i,c){const l=[...n,String(c)].join(".");return t.has(l)?t.get(l)!==a:c in i},deleteProperty(i,c){const l=[...n,String(c)].join(".");return t.delete(l),!0},ownKeys(i){const c=Reflect.ownKeys(i),d=n.length>0?n.join(".")+".":"",l=new Set;for(const[g,y]of t.entries())if(g.startsWith(d)){const v=g.slice(d.length),A=v.indexOf("."),S=A===-1?v:v.slice(0,A);y!==a&&l.add(S)}const u=new Set(c);for(const[g,y]of t.entries())if(g.startsWith(d)){const v=g.slice(d.length);if(v.indexOf(".")===-1){const S=v;y===a?u.delete(S):u.add(S)}}return Array.from(u)},getOwnPropertyDescriptor(i,c){const l=[...n,String(c)].join(".");if(t.has(l)){const u=t.get(l);return u===a?void 0:{value:u,writable:!0,enumerable:!0,configurable:!0}}return Reflect.getOwnPropertyDescriptor(i,c)}});return r.set(e,o),s.set(o,e),o}const Kt=e=>typeof e=="object"&&e!==null&&"__type__"in e&&typeof e.__type__=="string",Et=e=>{const n=new Function(`return (${e.sourceCode})`)();return n.__type__="function",n.sourceCode=e.sourceCode,n},wt=(e,t,n)=>{if(!("__dateValue__"in e))throw new Error("Invalid Date serialization format: missing __dateValue__ field");const r=e.__dateValue__,s=r===null?new Date("invalid"):new Date(r);for(const[a,o]of Object.entries(e))a==="__type__"||a==="__dateValue__"||(s[a]=t(o,n));return s},bt=e=>BigInt(e.value),vt=e=>Symbol(e.description),Ce=e=>typeof e=="object"&&e!==null&&"__unresolved_ref__"in e,Jt=(e,t)=>{var r,s;const n=new Map;for(const[a,o]of e.entries){const i=typeof a=="object"&&a!==null&&a.__type__&&((r=K[a.__type__])==null?void 0:r.call(K,a,t))||a,c=typeof o=="object"&&o!==null&&o.__type__&&((s=K[o.__type__])==null?void 0:s.call(K,o,t))||o;n.set(i,c)}return n},Xt=(e,t)=>{var r;const n=new Set;for(const s of e.values){const a=typeof s=="object"&&s!==null&&s.__type__&&((r=K[s.__type__])==null?void 0:r.call(K,s,t))||s;n.add(a)}return n},K={function:e=>Et(e),date:(e,t)=>wt(e,(r,s)=>{if(r&&typeof r=="object"&&"__type__"in r){const a=K[r.__type__];return a?a(r,t):r}return r},t),bigint:e=>bt(e),symbol:e=>vt(e),ref:e=>({__unresolved_ref__:e.path}),map:(e,t)=>Jt(e,t),set:(e,t)=>Xt(e,t)};function Zt(e,t){const n=[];function r(a,o=[]){if(a===null||typeof a!="object")return a;if(a.__type__&&K[a.__type__]){const i=K[a.__type__];if(!i)return a;const c=i(a,e);if(c&&Ce(c))return n.push({parent:null,key:null,path:c.__unresolved_ref__}),c;if(c instanceof Date){for(const d in c)if(Object.prototype.hasOwnProperty.call(c,d)){const l=c[d];l&&Ce(l)&&n.push({parent:c,key:d,path:l.__unresolved_ref__})}}return c}for(const i in a)if(Object.prototype.hasOwnProperty.call(a,i)){const c=a[i];if(c&&typeof c=="object")if(c.__type__&&K[c.__type__]){const d=K[c.__type__];if(!d)continue;const l=d(c,e);if(l&&Ce(l))n.push({parent:a,key:i,path:l.__unresolved_ref__});else if(a[i]=l,l instanceof Date){for(const u in l)if(Object.prototype.hasOwnProperty.call(l,u)){const g=l[u];g&&Ce(g)&&n.push({parent:l,key:u,path:g.__unresolved_ref__})}}}else r(c,[...o,i])}return a}let s=r(e);for(const a of n){const{parent:o,key:i,path:c}=a,d=t(c,s);o&&i!==null?o[i]=d:o===null&&i===null&&(s=d)}return s}function Qt(e,t){return Zt(e,(s,a)=>{let o=a,i=!0;for(const c of s){const d=o==null?void 0:o[c];if(d===void 0){i=!1;break}o=d}if(i)return o;o=t;for(const c of s){const d=o==null?void 0:o[c];if(d===void 0)throw new Error(`Cannot resolve event value ref path: ${s.join(".")} (not found in value scope or memory scope)`);o=d}return o})}const V=(e,t,n=new WeakMap)=>{if(e==null||typeof e!="object")return e;if(n.has(e))return n.get(e);if(Kt(e)){const s=e;switch(s.__type__){case"function":return Et(s);case"date":return wt(s,(i,c)=>V(i,t,n),t);case"bigint":return bt(s);case"symbol":return vt(s);case"ref":{const a=s;let o=t;for(const i of a.path)if(o=o[i],o===void 0)throw new Error(`Cannot resolve ref path: ${a.path.join(".")}`);return o}case"map":{const a=s,o=new Map;n.set(e,o);for(const[i,c]of a.entries){const d=V(i,t,n),l=V(c,t,n);o.set(d,l)}return o}case"set":{const a=s,o=new Set;n.set(e,o);for(const i of a.values)o.add(V(i,t,n));return o}case"circular":throw new Error("Encountered explicit circular marker - this indicates a serialization issue")}}if(Array.isArray(e)){const s=[];n.set(e,s);for(const a of e)s.push(V(a,t,n));return s}const r={};n.set(e,r);for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(r[s]=V(e[s],t,n));return r};class en{createEvent(t,n,r){const[s]=n;return{type:L.SET,path:t,value:re(s,r.proxyToTarget,r.targetToPath,t),timestamp:Date.now()}}applyEvent(t,n,r,s){const a=t;n[r]=Qt(a.value,s)}}class tn{createEvent(t){return{type:L.DELETE,path:t,timestamp:Date.now()}}applyEvent(t,n,r){delete n[r]}}class nn{createEvent(t,n,r){return{type:L.ARRAY_PUSH,path:t,items:n.map(s=>re(s,r.proxyToTarget,r.targetToPath,t)),timestamp:Date.now()}}applyEvent(t,n,r,s){const a=t,o=n[r];for(const i of a.items)o.push(V(i,s))}}class rn{createEvent(t){return{type:L.ARRAY_POP,path:t,timestamp:Date.now()}}applyEvent(t,n,r){n[r].pop()}}class sn{createEvent(t){return{type:L.ARRAY_SHIFT,path:t,timestamp:Date.now()}}applyEvent(t,n,r){n[r].shift()}}class on{createEvent(t,n,r){return{type:L.ARRAY_UNSHIFT,path:t,items:n.map(s=>re(s,r.proxyToTarget,r.targetToPath,t)),timestamp:Date.now()}}applyEvent(t,n,r,s){const a=t,o=n[r],i=a.items.map(c=>V(c,s));o.unshift(...i)}}class an{createEvent(t,n,r){return{type:L.ARRAY_SPLICE,path:t,start:n[0],deleteCount:n[1]||0,items:n.slice(2).map(s=>re(s,r.proxyToTarget,r.targetToPath,t)),timestamp:Date.now()}}applyEvent(t,n,r,s){const a=t,o=n[r],i=a.items.map(c=>V(c,s));o.splice(a.start,a.deleteCount,...i)}}class cn{createEvent(t){return{type:L.ARRAY_SORT,path:t,timestamp:Date.now()}}applyEvent(t,n,r){n[r].sort()}}class ln{createEvent(t){return{type:L.ARRAY_REVERSE,path:t,timestamp:Date.now()}}applyEvent(t,n,r){n[r].reverse()}}class dn{createEvent(t,n,r){return{type:L.ARRAY_FILL,path:t,value:re(n[0],r.proxyToTarget,r.targetToPath,t),start:n[1],end:n[2],timestamp:Date.now()}}applyEvent(t,n,r,s){const a=t,o=n[r],i=V(a.value,s);o.fill(i,a.start,a.end)}}class un{createEvent(t,n){return{type:L.ARRAY_COPYWITHIN,path:t,target:n[0],start:n[1],end:n[2],timestamp:Date.now()}}applyEvent(t,n,r){const s=t;n[r].copyWithin(s.target,s.start,s.end)}}class fn{createEvent(t,n,r){return{type:L.MAP_SET,path:t,key:re(n[0],r.proxyToTarget,r.targetToPath,t),value:re(n[1],r.proxyToTarget,r.targetToPath,t),timestamp:Date.now()}}applyEvent(t,n,r,s){const a=t,o=n[r],i=V(a.key,s),c=V(a.value,s);o.set(i,c)}}class pn{createEvent(t,n,r){return{type:L.MAP_DELETE,path:t,key:re(n[0],r.proxyToTarget,r.targetToPath,t),timestamp:Date.now()}}applyEvent(t,n,r,s){const a=t,o=n[r],i=V(a.key,s);o.delete(i)}}class mn{createEvent(t){return{type:L.MAP_CLEAR,path:t,timestamp:Date.now()}}applyEvent(t,n,r){n[r].clear()}}class gn{createEvent(t,n,r){return{type:L.SET_ADD,path:t,value:re(n[0],r.proxyToTarget,r.targetToPath,t),timestamp:Date.now()}}applyEvent(t,n,r,s){const a=t,o=n[r],i=V(a.value,s);o.add(i)}}class hn{createEvent(t,n,r){return{type:L.SET_DELETE,path:t,value:re(n[0],r.proxyToTarget,r.targetToPath,t),timestamp:Date.now()}}applyEvent(t,n,r,s){const a=t,o=n[r],i=V(a.value,s);o.delete(i)}}class yn{createEvent(t){return{type:L.SET_CLEAR,path:t,timestamp:Date.now()}}applyEvent(t,n,r){n[r].clear()}}class En{createEvent(t,n){return{type:L.SCRIPT,path:t,source:n[0],timestamp:Date.now()}}applyEvent(){}}class wn{constructor(){this.handlers=new Map}register(t,n){this.handlers.set(t,n)}createEvent(t,n,r,s){const a=this.handlers.get(t);if(!a)throw new Error(`No handler registered for event type: ${t}`);return a.createEvent(n,r,s)}applyEvent(t,n,r,s){const a=this.handlers.get(t.type);if(!a)throw new Error(`No handler registered for event type: ${t.type}`);a.applyEvent(t,n,r,s)}hasHandler(t){return this.handlers.has(t)}}const q=new wn;q.register(L.SET,new en);q.register(L.DELETE,new tn);q.register(L.ARRAY_PUSH,new nn);q.register(L.ARRAY_POP,new rn);q.register(L.ARRAY_SHIFT,new sn);q.register(L.ARRAY_UNSHIFT,new on);q.register(L.ARRAY_SPLICE,new an);q.register(L.ARRAY_SORT,new cn);q.register(L.ARRAY_REVERSE,new ln);q.register(L.ARRAY_FILL,new dn);q.register(L.ARRAY_COPYWITHIN,new un);q.register(L.MAP_SET,new fn);q.register(L.MAP_DELETE,new pn);q.register(L.MAP_CLEAR,new mn);q.register(L.SET_ADD,new gn);q.register(L.SET_DELETE,new hn);q.register(L.SET_CLEAR,new yn);q.register(L.SCRIPT,new En);const lt=(e,t)=>{let n=e;for(let s=0;s<t.path.length-1;s++){const a=t.path[s];if(a){if(!(a in n)){const o=t.path[s+1];n[a]=o&&/^\d+$/.test(o)?[]:{}}n=n[a]}}const r=t.path[t.path.length-1];r&&q.applyEvent(t,n,r,e)},dt=async(e,t,n)=>{if(n.isReplaying=!0,Array.isArray(t))for(const r of t)lt(e,r);else for await(const r of t)lt(e,r);n.isReplaying=!1},bn=async(e,t,n)=>{if(t.stream)await dt(e,t.stream(),n);else{const r=await t.getAll();await dt(e,r,n)}};async function Xe(e){const t=new Vt,n=t.getDeletedSymbol(),r=new WeakMap,s=new WeakMap,a={};return await bn(a,e,{isReplaying:!0}),{root:ze(a,t,[],r,s),isDirty(){return t.isDirty()},getUncommittedCount(){return t.size()},async save(){const i=t.entries(),c=new WeakMap,d=(l,u,g=[])=>{if(!(u===null||typeof u!="object")&&!l.has(u))if(l.set(u,g),Array.isArray(u))u.forEach((y,v)=>d(l,y,[...g,String(v)]));else if(u instanceof Map){let y=0;u.forEach(v=>d(l,v,[...g,`map:${y++}`]))}else if(u instanceof Set){let y=0;u.forEach(v=>d(l,v,[...g,`set:${y++}`]))}else u instanceof Date||Object.entries(u).forEach(([y,v])=>d(l,v,[...g,y]))};for(const[l,u]of i){const g=new WeakMap;d(g,a);const y=l.split(".");let v=a;for(let S=0;S<y.length-1;S++)v=v[y[S]];const A=y[y.length-1];if(u===n)delete v[A],await e.append({type:"DELETE",path:y,timestamp:Date.now()});else{const S=ye(u,s,c),N=re(S,new WeakMap,g,y);v[A]=S,await e.append({type:"SET",path:y,value:N,timestamp:Date.now()})}}t.clear()},discard(){t.clear()},createCheckpoint(){return t.createCheckpoint()},restoreCheckpoint(i){t.restoreCheckpoint(i)},unwrap(i){return ye(i,s)}}}class vn{constructor(){this._history=[["root"]],this._currentIndex=0,this._selectedPath=["root"],this._expandedPaths=new Set(["root"]),this._expandedNestedObjects=new Set,this.onNavigate=null}get selectedPath(){return[...this._selectedPath]}get currentIndex(){return this._currentIndex}get history(){return this._history.map(t=>[...t])}expandAncestors(t){for(let n=1;n<=t.length;n++){const r=t.slice(0,n).join(".");this._expandedPaths.add(r)}}reset(){this._selectedPath=["root"],this._expandedPaths=new Set(["root"]),this._expandedNestedObjects=new Set,this._history=[["root"]],this._currentIndex=0}navigateTo(t,n=!0){n&&(this._history=this._history.slice(0,this._currentIndex+1),this._history.push([...t]),this._currentIndex=this._history.length-1),this.expandAncestors(t),this._selectedPath=[...t],this.onNavigate&&this.onNavigate()}goBack(){this.canGoBack()&&(this._currentIndex--,this._selectedPath=[...this._history[this._currentIndex]],this.expandAncestors(this._selectedPath),this.onNavigate&&this.onNavigate())}goForward(){this.canGoForward()&&(this._currentIndex++,this._selectedPath=[...this._history[this._currentIndex]],this.expandAncestors(this._selectedPath),this.onNavigate&&this.onNavigate())}canGoBack(){return this._currentIndex>0}canGoForward(){return this._currentIndex<this._history.length-1}toggleExpanded(t){this._expandedPaths.has(t)?this._expandedPaths.delete(t):this._expandedPaths.add(t)}isExpanded(t){return this._expandedPaths.has(t)}toggleNestedExpanded(t){this._expandedNestedObjects.has(t)?this._expandedNestedObjects.delete(t):this._expandedNestedObjects.add(t)}isNestedExpanded(t){return this._expandedNestedObjects.has(t)}}const Sn=new WeakMap,An=e=>Sn.get(e)||null;function xn(e,t){if(e===t)return["root"];if(!e||typeof e!="object")return null;const n=[[e,["root"]]],r=new Set;for(r.add(e);n.length>0;){const[s,a]=n.shift(),o=s instanceof Map?Array.from(s.entries()):s instanceof Set?Array.from(s.values()).map((i,c)=>[`[${c}]`,i]):Object.entries(s);for(const[i,c]of o)if(!(typeof i=="string"&&i.startsWith("__"))){if(c===t)return[...a,String(i)];c&&typeof c=="object"&&!r.has(c)&&(r.add(c),n.push([c,[...a,String(i)]]))}}return null}function Ze(e,t){const n=An(e);if(n){const{targetToPath:r,proxyToTarget:s}=n,a=s.get(t)||t,o=r.get(a);if(o)return["root",...o]}return xn(e,t)}class Tn{getChildren(t){return t.map((r,s)=>[`[${s}]`,r])}createChildPath(t,n){return[...t,n.toString()]}}class _n{getChildren(t){const n=t;return Array.from(n.entries()).map(([r,s])=>[String(r),s])}createChildPath(t,n){return[...t,`map:${n}`]}}class Pn{getChildren(t){const n=t;return Array.from(n.values()).map((r,s)=>[`[${s}]`,r])}createChildPath(t,n){return[...t,`set:${n}`]}}function Qe(e){return Array.isArray(e)?new Tn:e instanceof Map?new _n:e instanceof Set?new Pn:null}function ut(e){if(e==null)return!1;const t=typeof e;return t==="object"||t==="function"}function Nn(e){return e==null?"○":Array.isArray(e)?"[]":typeof e=="object"?"{}":typeof e=="function"?"ƒ":"•"}function In(e,t,n){if(!ut(e))return[];const r=Qe(e);return r?r.getChildren(e):Object.entries(e).filter(([o,i])=>{if(o.startsWith("__")||!ut(i))return!1;if(typeof i=="object"&&i!==null){const c=Ze(n,i);if(c){const d=t.join("."),l=c.join(".");if(!l.startsWith(d+".")&&l!==d)return!1}}return!0})}function Ln(e,t,n,r,s,a){const o=document.createElement("div");o.className="tree-node-header",a&&o.classList.add("selected");const i=document.createElement("span");i.className=r?s?"tree-toggle expanded":"tree-toggle collapsed":"tree-toggle leaf";const c=document.createElement("span");c.className="tree-icon",c.textContent=Nn(t);const d=document.createElement("span");return d.className="tree-label",d.textContent=e,o.appendChild(i),o.appendChild(c),o.appendChild(d),o}function Cn(e,t,n,r,s,a,o){const i=n.join(".");e.querySelector(".tree-toggle").addEventListener("click",d=>{d.stopPropagation(),s&&(a.toggleExpanded(i),o&&o())}),e.addEventListener("click",d=>{d.stopPropagation();let l=n;if(t!=null&&(typeof t=="object"||typeof t=="function")){const u=Ze(r,t);u&&(l=[...u])}a.navigateTo(l,!0),o&&o()})}function Rn(e,t,n,r,s,a){const o=document.createElement("div");o.className="tree-children expanded";const i=Qe(e);return i?kn(o,n,t,i,r,s,a):Dn(o,n,t,r,s,a),o}function kn(e,t,n,r,s,a,o){if(!r)return;let i=0;for(const[c,d]of t){const l=r.createChildPath(n,i);e.appendChild(et(c,d,l,s,a,o)),i++}}function Dn(e,t,n,r,s,a){for(const[o,i]of t){const c=[...n,o];e.appendChild(et(o,i,c,r,s,a))}}function et(e,t,n,r,s,a){const o=document.createElement("div");o.className="tree-node";const i=n.join("."),c=i===s.selectedPath.join("."),d=In(t,n,r),l=d.length>0,u=s.isExpanded(i),g=Ln(e,t,n,l,u,c);if(Cn(g,t,n,r,l,s,a),o.appendChild(g),l&&u){const y=Rn(t,n,d,r,s,a);o.appendChild(y)}return o}function On(e,t,n,r){n.innerHTML="";const s=et("this",e,["root"],e,t,r);n.appendChild(s)}const ke="__",D={PROPERTY_TABLE:"property-table",PROPERTY_NAME:"property-name",PROPERTY_VALUE:"property-value",EMPTY_STATE:"empty-state",VALUE_NAVIGABLE:"value-navigable",VALUE_NULL:"value-null",VALUE_UNDEFINED:"value-undefined",VALUE_STRING:"value-string",VALUE_NUMBER:"value-number",VALUE_BOOLEAN:"value-boolean",VALUE_BIGINT:"value-bigint",VALUE_SYMBOL:"value-symbol",VALUE_DATE:"value-date",VALUE_FUNCTION:"value-function",VALUE_ARRAY:"value-array",VALUE_MAP:"value-map",VALUE_SET:"value-set",VALUE_OBJECT:"value-object"},Ae={MAX_PREVIEW_LENGTH:80,MAX_OBJECT_PROPERTIES_PREVIEW:5},Fn=/name|desc(ription)?$/i,Z={NULL:"∅",UNDEFINED:"∅",STRING:'"',NUMBER:"#",BOOLEAN:"✓",BIGINT:"#n",SYMBOL:"Σ",DATE:"📅",FUNCTION:"ƒ",ARRAY:"[]",MAP:"M{}",SET:"S{}",OBJECT:"{}"};let We=null;function tt(e){We=e}function Te(e){return We?We(e):e}var J=(e=>(e[e.NULL=1]="NULL",e[e.UNDEFINED=2]="UNDEFINED",e[e.STRING=3]="STRING",e[e.NUMBER=4]="NUMBER",e[e.BOOLEAN=5]="BOOLEAN",e[e.BIGINT=6]="BIGINT",e[e.SYMBOL=7]="SYMBOL",e[e.DATE=8]="DATE",e[e.FUNCTION=9]="FUNCTION",e[e.ARRAY=10]="ARRAY",e[e.MAP=11]="MAP",e[e.SET=12]="SET",e[e.OBJECT=13]="OBJECT",e))(J||{});function nt(e){if(e===null)return{category:1,typeName:"null",isNavigable:!1,isCollection:!1,displayIcon:Z.NULL,cssClass:D.VALUE_NULL};if(e===void 0)return{category:2,typeName:"undefined",isNavigable:!1,isCollection:!1,displayIcon:Z.UNDEFINED,cssClass:D.VALUE_UNDEFINED};const t=typeof e;return t==="string"?{category:3,typeName:"string",isNavigable:!1,isCollection:!1,displayIcon:Z.STRING,cssClass:D.VALUE_STRING}:t==="number"?{category:4,typeName:"number",isNavigable:!1,isCollection:!1,displayIcon:Z.NUMBER,cssClass:D.VALUE_NUMBER}:t==="boolean"?{category:5,typeName:"boolean",isNavigable:!1,isCollection:!1,displayIcon:Z.BOOLEAN,cssClass:D.VALUE_BOOLEAN}:t==="bigint"?{category:6,typeName:"bigint",isNavigable:!1,isCollection:!1,displayIcon:Z.BIGINT,cssClass:D.VALUE_BIGINT}:t==="symbol"?{category:7,typeName:"symbol",isNavigable:!1,isCollection:!1,displayIcon:Z.SYMBOL,cssClass:D.VALUE_SYMBOL}:_e(e)?{category:8,typeName:"Date",isNavigable:!0,isCollection:!1,displayIcon:Z.DATE,cssClass:D.VALUE_DATE}:t==="function"?{category:9,typeName:"Function",isNavigable:!0,isCollection:!1,displayIcon:Z.FUNCTION,cssClass:D.VALUE_FUNCTION}:Array.isArray(e)?{category:10,typeName:"Array",isNavigable:!0,isCollection:!0,displayIcon:Z.ARRAY,cssClass:D.VALUE_ARRAY}:e instanceof Map?{category:11,typeName:"Map",isNavigable:!0,isCollection:!0,displayIcon:Z.MAP,cssClass:D.VALUE_MAP}:e instanceof Set?{category:12,typeName:"Set",isNavigable:!0,isCollection:!0,displayIcon:Z.SET,cssClass:D.VALUE_SET}:{category:13,typeName:"Object",isNavigable:!0,isCollection:!1,displayIcon:Z.OBJECT,cssClass:D.VALUE_OBJECT}}const Mn=jt;function _e(e){if(e==null||typeof e!="object")return!1;if(e instanceof Date)return!0;let t=e;for(let n=0;n<5;n++){const r=Te(t);if(r===t)break;if(r instanceof Date)return!0;if(typeof r!="object"||r===null)break;t=r}try{let n=Object.getPrototypeOf(e);for(;n!==null;){if(n===Date.prototype)return!0;n=Object.getPrototypeOf(n)}}catch{}return typeof e.getTime=="function"&&typeof e.toISOString=="function"}function Bn(e){if(e==null||typeof e!="object"||Mn(e))return!1;const t=Object.entries(e).filter(([n])=>!n.startsWith("__"));if(_e(e)){if(t.length===0||t.length>5)return!1}else if(t.length>5)return!1;return t.every(([n,r])=>{if(r==null)return!0;const s=typeof r;return!!(s==="string"||s==="number"||s==="boolean"||s==="bigint"||_e(r))})}class $n{canFormat(t){return t.category===J.NULL}formatPreview(t){return""}formatFull(t){return""}}class Hn{canFormat(t){return t.category===J.UNDEFINED}formatPreview(t){return"undefined"}formatFull(t){return"undefined"}}class Un{canFormat(t){return t.category===J.STRING}formatPreview(t,n=Ae.MAX_PREVIEW_LENGTH){const r=String(t);return r.length>n?r.substring(0,n)+"...":r}formatFull(t){return String(t)}}class jn{canFormat(t){return t.category===J.NUMBER}formatPreview(t){return String(t)}formatFull(t){return String(t)}}class Yn{canFormat(t){return t.category===J.BOOLEAN}formatPreview(t){return String(t)}formatFull(t){return String(t)}}class qn{canFormat(t){return t.category===J.BIGINT}formatPreview(t){return t.toString()+"n"}formatFull(t){return t.toString()+"n"}}class zn{canFormat(t){return t.category===J.SYMBOL}formatPreview(t){return t.toString()}formatFull(t){return t.toString()}}class Wn{canFormat(t){return t.category===J.DATE}formatPreview(t){const n=Te(t),r=isNaN(n.getTime())?"Invalid Date":n.toISOString(),s=Object.keys(t).filter(a=>!a.startsWith("__")).length;return s>0?`${r} {${s}}`:r}formatFull(t){const n=Te(t),r=isNaN(n.getTime())?"Invalid Date":n.toISOString(),s=Object.keys(t).filter(a=>!a.startsWith("__")).length;return s>0?`Date(${r}) {${s}}`:r}}class Vn{canFormat(t){return t.category===J.FUNCTION}formatPreview(t){return"ƒ "+(t.name||"(anonymous)")}formatFull(t){return"ƒ "+(t.name||"(anonymous)")}}class Gn{canFormat(t){return t.category===J.ARRAY}formatPreview(t,n=Ae.MAX_PREVIEW_LENGTH){const r=t;try{const s=JSON.stringify(r,null,0);return s.length>n?s.substring(0,n)+"...":s}catch{return`[Array(${r.length})]`}}formatFull(t){return`Array(${t.length})`}}class Kn{canFormat(t){return t.category===J.MAP}formatPreview(t){return`Map{${t.size}}`}formatFull(t){return`Map{${t.size}}`}}class Jn{canFormat(t){return t.category===J.SET}formatPreview(t){return`Set{${t.size}}`}formatFull(t){return`Set{${t.size}}`}}function De(e){if(e==null)return"";const t=typeof e;if(t!=="object"&&t!=="function")return String(e);if(_e(e))return Te(e).toISOString();if(Array.isArray(e))return`[${e.length} items]`;if(e instanceof Map)return`Map{${e.size}}`;if(e instanceof Set)return`Set{${e.size}}`;const n=[],r=Object.entries(e).filter(([a])=>!a.startsWith(ke));for(const[a,o]of r)if(Fn.test(a)){if(typeof o=="string")n.push(o);else if(o!==null&&typeof o=="object"&&!_e(o)&&!Array.isArray(o)&&!(o instanceof Map)&&!(o instanceof Set)){const i=De(o);i&&!i.startsWith("Object{")&&n.push(i)}}return n.length>0?n.join(" "):`Object{${r.length}}`}class Xn{canFormat(t){return t.category===J.OBJECT}formatPreview(t,n=Ae.MAX_PREVIEW_LENGTH){const r=t,s=Te(t);if(s instanceof Date){const l=isNaN(s.getTime())?"Invalid Date":s.toISOString(),u=Object.keys(r).filter(g=>!g.startsWith("__")).length;return u>0?`${l} {${u}}`:l}const a=De(r);if(a&&!a.startsWith("Object{"))return a.length>n?a.substring(0,n)+"...":a;const o=Object.entries(r).filter(([l])=>!l.startsWith(ke)).slice(0,Ae.MAX_OBJECT_PROPERTIES_PREVIEW);if(o.length===0)return a;const i=o.map(([l,u])=>u===null?`"${l}":null`:u===void 0?`"${l}":undefined`:typeof u=="string"?`"${l}":"${u}"`:typeof u=="number"||typeof u=="boolean"?`"${l}":${u}`:Array.isArray(u)?`"${l}":[Array]`:typeof u=="object"?`"${l}":[Object]`:typeof u=="function"?`"${l}":[Function]`:`"${l}":${typeof u}`),c=Object.keys(r).filter(l=>!l.startsWith(ke)).length>Ae.MAX_OBJECT_PROPERTIES_PREVIEW,d="{"+i.join(",")+(c?",...":"")+"}";return d.length>n?d.substring(0,n)+"...":d}formatFull(t){return De(t)}}const Zn=[new $n,new Hn,new Un,new jn,new Yn,new qn,new zn,new Wn,new Vn,new Gn,new Kn,new Jn,new Xn];function Qn(e,t="preview",n){const r=nt(e),s=Zn.find(a=>a.canFormat(r));return s?t==="preview"?s.formatPreview(e,n):s.formatFull(e):String(e)}function Fe(e,t="preview",n){const r=nt(e);return[Qn(e,t,n),r]}function er(e){if(e==null)return[];try{const n=Reflect.ownKeys(e).filter(s=>typeof s=="string");if(n.length>0)return n.map(s=>[s,e[s]]);const r=Object.entries(e);return r.length>0?r:[]}catch(t){return console.error("Failed to enumerate object properties with Reflect.ownKeys:",t),Object.entries(e)}}function tr(e){return er(e).filter(([t])=>!t.startsWith(ke))}function nr(e){const t=tr(e),n=[],r=[];for(const[s,a]of t)nt(a).isCollection?r.push([s,a]):n.push([s,a]);return{scalars:n,collections:r}}function St(e,t){let n=e;for(let r=1;r<t.length;r++){const s=t[r];if(s===void 0)return;if(!(s===""&&!(s in n))&&(n=n==null?void 0:n[s],n===void 0))return}return n}function rr(e){const t=document.createElement("div");t.className="inspector-tabs";const n=document.createElement("div");n.className="tab-headers";const r=document.createElement("div");r.className="tab-content";const s=e.findIndex(o=>!o.isEmpty),a=s>=0?s:0;return e.forEach((o,i)=>{const c=document.createElement("button");c.className="tab-header",c.textContent=o.label,c.disabled=o.isEmpty,c.dataset.tabId=o.id,i===a&&c.classList.add("active"),c.addEventListener("click",()=>{n.querySelectorAll(".tab-header").forEach(d=>d.classList.remove("active")),r.querySelectorAll(".tab-panel").forEach(d=>d.classList.remove("active")),c.classList.add("active"),o.content.classList.add("active")}),n.appendChild(c),o.content.className="tab-panel",o.content.dataset.tabId=o.id,i===a&&o.content.classList.add("active"),r.appendChild(o.content)}),t.appendChild(n),t.appendChild(r),t}function sr(e,t,n,r,s,a){const o=document.createElement("td");o.className=D.PROPERTY_VALUE;const[i,c]=Fe(e,"preview");return o.textContent=i,o.title=c.typeName,o.classList.add(c.cssClass),c.isNavigable&&(o.classList.add(D.VALUE_NAVIGABLE),o.addEventListener("click",()=>{At(n,r,t,s,a)})),o}function or(e,t,n,r,s){const a=document.createElement("td");a.className=D.PROPERTY_VALUE;const o=`${n.join(".")}.${t}`,i=r.isNestedExpanded(o),c=De(e),d=document.createElement("div");d.className="value-nested";const l=document.createElement("span");l.className=`value-nested-toggle ${i?"expanded":"collapsed"}`;const u=document.createElement("span");u.className="value-nested-summary",u.textContent=`{${c}}`,d.appendChild(l),d.appendChild(u);const g=document.createElement("div");g.className=`nested-properties ${i?"expanded":""}`;for(const[v,A]of Object.entries(e)){if(v.startsWith("__"))continue;const S=document.createElement("div");S.className="nested-prop";const N=document.createElement("span");N.className="nested-prop-key",N.textContent=`${v}:`;const[m,p]=Fe(A,"preview"),h=document.createElement("span");h.className=`nested-prop-value ${p.cssClass}`,h.textContent=m,S.appendChild(N),S.appendChild(h),g.appendChild(S)}a.appendChild(d),a.appendChild(g);let y=null;return d.addEventListener("click",v=>{if(v.stopPropagation(),y){clearTimeout(y),y=null;return}y=setTimeout(()=>{y=null,r.toggleNestedExpanded(o),s&&s()},250)}),d.addEventListener("dblclick",v=>{v.stopPropagation(),y&&(clearTimeout(y),y=null);const A=[...n,t];r.navigateTo(A,!0),s&&s()}),a}function At(e,t,n,r,s){const a=St(e,t),o=a==null?void 0:a[n];if(!o){console.error("Could not find referenced object");return}const i=Ze(e,o);if(!i){console.error("Could not find canonical path for object");return}r.navigateTo([...i],!0),s&&s()}function ar(e,t,n,r,s,a){const o=document.createElement("tr"),i=document.createElement("td");i.className=D.PROPERTY_NAME,i.textContent=e;const c=Bn(t)?or(t,e,r,s,a):sr(t,e,n,r,s,a);return o.appendChild(i),o.appendChild(c),o}function ir(e,t,n,r,s){const a=document.createElement("table");a.className=D.PROPERTY_TABLE;const o=document.createElement("thead");o.innerHTML="<tr><th>Property</th><th>Value</th></tr>",a.appendChild(o);const i=document.createElement("tbody");for(const[c,d]of e)i.appendChild(ar(c,d,t,n,r,s));return a.appendChild(i),a}function cr(e,t,n,r,s){const a=document.createElement("div");if(a.className="collections-panel",e.length===0)return a.innerHTML=`<div class="${D.EMPTY_STATE}">No collections</div>`,a;for(const[o,i]of e){const c=document.createElement("div");c.className="collection-section";const d=document.createElement("h3");d.textContent=o,d.className="collection-header",c.appendChild(d);const l=Qe(i);if(!l){const g=document.createElement("div");g.className=D.EMPTY_STATE,g.textContent="Unknown collection type",c.appendChild(g),a.appendChild(c);continue}const u=l.getChildren(i);if(u.length===0){const g=document.createElement("div");g.className=D.EMPTY_STATE,g.textContent="Empty collection",c.appendChild(g)}else{const g=document.createElement("ul");g.className="collection-items";for(const[y,v]of u){const A=document.createElement("li");A.className="collection-item";const[S,N]=Fe(v,"preview"),m=document.createElement("span");m.className="item-label",m.textContent=`${y}: `;const p=document.createElement("span");p.className=`item-value ${N.cssClass}`,p.textContent=S,p.title=N.typeName,A.appendChild(m),A.appendChild(p),N.isNavigable&&(p.classList.add(D.VALUE_NAVIGABLE),p.addEventListener("click",()=>{const h=[...n,o];At(t,h,y,r,s)})),g.appendChild(A)}c.appendChild(g)}a.appendChild(c)}return a}function lr(e,t,n,r){const s=t.selectedPath;if(s.length===0){n.innerHTML=`<div class="${D.EMPTY_STATE}">Select a node in the tree</div>`;return}const a=St(e,s);if(a==null){n.innerHTML=`<div class="${D.EMPTY_STATE}">Value is ${a===null?"null":"undefined"}</div>`;return}if(typeof a!="object"&&typeof a!="function"){const[l]=Fe(a,"preview");n.innerHTML=`<div class="${D.EMPTY_STATE}">Primitive value: ${l}</div>`;return}const{scalars:o,collections:i}=nr(a);if(o.length===0&&i.length===0){n.innerHTML=`<div class="${D.EMPTY_STATE}">No properties</div>`;return}const c=[{id:"properties",label:"Properties",content:ir(o,e,s,t,r),isEmpty:o.length===0},{id:"collections",label:"Collections",content:cr(i,e,s,t,r),isEmpty:i.length===0}],d=rr(c);n.innerHTML="",n.appendChild(d)}const xe="memimg-explorer",Ve=1e3,dr=100*1024;function ur(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function rt(e){return`script-history-${e}`}async function fr(e){const t=rt(e);return new Promise((n,r)=>{const s=indexedDB.open(xe);s.onerror=()=>{r(s.error)},s.onsuccess=async()=>{const a=s.result,o=a.objectStoreNames.contains(t),i=a.version;if(a.close(),await new Promise(d=>setTimeout(d,50)),o){n();return}const c=indexedDB.open(xe,i+1);c.onerror=()=>{r(c.error)},c.onblocked=()=>{},c.onsuccess=async()=>{c.result.close(),await new Promise(d=>setTimeout(d,50)),n()},c.onupgradeneeded=d=>{const l=d.target.result;if(!l.objectStoreNames.contains(t)){const u=l.createObjectStore(t,{keyPath:"id"});u.createIndex("timestamp","timestamp",{unique:!1}),u.createIndex("characterCount","characterCount",{unique:!1})}}},s.onupgradeneeded=a=>{const o=a.target.result;if(!o.objectStoreNames.contains(t)){const i=o.createObjectStore(t,{keyPath:"id"});i.createIndex("timestamp","timestamp",{unique:!1}),i.createIndex("characterCount","characterCount",{unique:!1})}}})}async function Pe(e,t="readonly"){const n=rt(e);return new Promise((r,s)=>{const a=indexedDB.open(xe);a.onerror=()=>s(a.error),a.onsuccess=async()=>{const o=a.result,i=!o.objectStoreNames.contains(n),c=o.version;if(o.close(),await new Promise(d=>setTimeout(d,50)),i){const d=indexedDB.open(xe,c+1);d.onerror=()=>s(d.error),d.onsuccess=()=>{const l=d.result;try{const g=l.transaction([n],t).objectStore(n);r({db:l,store:g})}catch(u){l.close(),s(u)}},d.onupgradeneeded=l=>{const u=l.target.result,g=l.target.transaction;if(!u.objectStoreNames.contains(n)){const y=u.createObjectStore(n,{keyPath:"id"});y.createIndex("timestamp","timestamp",{unique:!1}),y.createIndex("characterCount","characterCount",{unique:!1})}g.oncomplete=()=>{console.log(`Script history store created: ${n}`)}}}else{const d=indexedDB.open(xe);d.onerror=()=>s(d.error),d.onsuccess=()=>{const l=d.result,g=l.transaction([n],t).objectStore(n);r({db:l,store:g})}}},a.onupgradeneeded=o=>{const i=o.target.result;if(!i.objectStoreNames.contains(n)){const c=i.createObjectStore(n,{keyPath:"id"});c.createIndex("timestamp","timestamp",{unique:!1}),c.createIndex("characterCount","characterCount",{unique:!1})}}})}async function pr(e,t){const n=new Blob([t]).size;if(n>dr)throw new Error(`Script too large: ${(n/1024).toFixed(1)} KB (max 100 KB)`);const r={id:ur(),timestamp:Date.now(),code:t,status:"success",characterCount:t.length},{db:s,store:a}=await Pe(e,"readwrite");return new Promise((o,i)=>{const c=a.count();c.onsuccess=()=>{const d=c.result;if(d>=Ve){const l=d-Ve+1,g=a.index("timestamp").openCursor(null,"next");let y=0;const v=[];g.onsuccess=()=>{const A=g.result;if(A&&y<l)v.push(A.value.id),y++,A.continue();else{for(const N of v)a.delete(N);const S=a.add(r);S.onsuccess=async()=>{s.close(),await new Promise(N=>setTimeout(N,50)),o()},S.onerror=async()=>{s.close(),await new Promise(N=>setTimeout(N,50)),i(S.error)}}},g.onerror=async()=>{s.close(),await new Promise(A=>setTimeout(A,50)),i(g.error)}}else{const l=a.add(r);l.onsuccess=async()=>{s.close(),await new Promise(u=>setTimeout(u,50)),o()},l.onerror=async()=>{s.close(),await new Promise(u=>setTimeout(u,50)),i(l.error)}}},c.onerror=async()=>{s.close(),await new Promise(d=>setTimeout(d,50)),i(c.error)}})}async function Me(e,t=100){const{db:n,store:r}=await Pe(e,"readonly");return new Promise((s,a)=>{const i=r.index("timestamp").openCursor(null,"prev"),c=[];i.onsuccess=async()=>{const d=i.result;d&&c.length<t?(c.push(d.value),d.continue()):(n.close(),await new Promise(l=>setTimeout(l,50)),s(c))},i.onerror=async()=>{n.close(),await new Promise(d=>setTimeout(d,50)),a(i.error)}})}async function mr(e,t){if(!t||t.trim().length===0)return Me(e,100);const{db:n,store:r}=await Pe(e,"readonly"),s=t.toLowerCase();return new Promise((a,o)=>{const c=r.index("timestamp").openCursor(null,"prev"),d=[];c.onsuccess=async()=>{const l=c.result;if(l){const u=l.value;u.code.toLowerCase().includes(s)&&d.push(u),l.continue()}else n.close(),await new Promise(u=>setTimeout(u,50)),a(d)},c.onerror=async()=>{n.close(),await new Promise(l=>setTimeout(l,50)),o(c.error)}})}async function gr(e){const{db:t,store:n}=await Pe(e,"readwrite");return new Promise((r,s)=>{const a=n.clear();a.onsuccess=async()=>{t.close(),await new Promise(o=>setTimeout(o,50)),r()},a.onerror=async()=>{t.close(),await new Promise(o=>setTimeout(o,50)),s(a.error)}})}async function hr(e){const t=await Me(e,Ve),n={memimgId:e,exportedAt:new Date().toISOString(),entryCount:t.length,entries:t.map(r=>({timestamp:r.timestamp,timestampISO:new Date(r.timestamp).toISOString(),code:r.code,characterCount:r.characterCount}))};return JSON.stringify(n,null,2)}async function yr(e){const{db:t,store:n}=await Pe(e,"readonly");return new Promise((r,s)=>{const a=n.count();a.onsuccess=()=>{const o=a.result,i=n.openCursor();let c=0;i.onsuccess=async()=>{const d=i.result;if(d){const l=d.value;c+=l.characterCount,d.continue()}else t.close(),await new Promise(l=>setTimeout(l,50)),r({count:o,totalSize:c})},i.onerror=async()=>{t.close(),await new Promise(d=>setTimeout(d,50)),s(i.error)}},a.onerror=async()=>{t.close(),await new Promise(o=>setTimeout(o,50)),s(a.error)}})}const Er=window;function wr(e,t,n={}){const r={tab:"	",indentOn:/[({\[]$/,moveToNewLine:/^[)}\]]/,spellcheck:!1,catchTab:!0,preserveIdent:!0,addClosing:!0,history:!0,window:Er,autoclose:{open:`([{'"`,close:`)]}'"`},...n},s=r.window,a=s.document,o=[],i=[];let c=-1,d=!1,l=()=>{},u;e.setAttribute("contenteditable","plaintext-only"),e.setAttribute("spellcheck",r.spellcheck?"true":"false"),e.style.outline="none",e.style.overflowWrap="break-word",e.style.overflowY="auto",e.style.whiteSpace="pre-wrap";const g=(f,E)=>{t(f,E)},y=s.navigator.userAgent.match(/Firefox\/([0-9]+)\./),v=y?parseInt(y[1]):0;let A=!1;(e.contentEditable!=="plaintext-only"||v>=136)&&(A=!0),A&&e.setAttribute("contenteditable","true");const S=fe(()=>{const f=b();g(e,f),w(f)},30);let N=!1;const m=f=>!ce(f)&&!me(f)&&f.key!=="Meta"&&f.key!=="Control"&&f.key!=="Alt"&&!f.key.startsWith("Arrow"),p=fe(f=>{m(f)&&(ie(),N=!1)},300),h=(f,E)=>{o.push([f,E]),e.addEventListener(f,E)};h("keydown",f=>{f.defaultPrevented||(u=te(),r.preserveIdent?F(f):$(f),r.catchTab&&Ne(f),r.addClosing&&se(f),r.history&&(Ie(f),m(f)&&!N&&(ie(),N=!0)),A&&!X(f)&&w(b()))}),h("keyup",f=>{f.defaultPrevented||f.isComposing||(u!==te()&&S(),p(f),l(te()))}),h("focus",f=>{d=!0}),h("blur",f=>{d=!1}),h("paste",f=>{ie(),He(f),ie(),l(te())}),h("cut",f=>{ie(),Le(f),ie(),l(te())});function b(){const f=le(),E={start:0,end:0,dir:void 0};let{anchorNode:x,anchorOffset:P,focusNode:k,focusOffset:M}=f;if(!x||!k)throw"error1";if(x===e&&k===e)return E.start=P>0&&e.textContent?e.textContent.length:0,E.end=M>0&&e.textContent?e.textContent.length:0,E.dir=M>=P?"->":"<-",E;if(x.nodeType===Node.ELEMENT_NODE){const U=a.createTextNode("");x.insertBefore(U,x.childNodes[P]),x=U,P=0}if(k.nodeType===Node.ELEMENT_NODE){const U=a.createTextNode("");k.insertBefore(U,k.childNodes[M]),k=U,M=0}return H(e,U=>{if(U===x&&U===k)return E.start+=P,E.end+=M,E.dir=P<=M?"->":"<-","stop";if(U===x)if(E.start+=P,!E.dir)E.dir="->";else return"stop";else if(U===k)if(E.end+=M,!E.dir)E.dir="<-";else return"stop";U.nodeType===Node.TEXT_NODE&&(E.dir!="->"&&(E.start+=U.nodeValue.length),E.dir!="<-"&&(E.end+=U.nodeValue.length))}),e.normalize(),E}function w(f){var at,it;const E=le();let x,P=0,k,M=0;if(f.dir||(f.dir="->"),f.start<0&&(f.start=0),f.end<0&&(f.end=0),f.dir=="<-"){const{start:oe,end:de}=f;f.start=de,f.end=oe}let U=0;H(e,oe=>{if(oe.nodeType!==Node.TEXT_NODE)return;const de=(oe.nodeValue||"").length;if(U+de>f.start&&(x||(x=oe,P=f.start-U),U+de>f.end))return k=oe,M=f.end-U,"stop";U+=de}),x||(x=e,P=e.childNodes.length),k||(k=e,M=e.childNodes.length),f.dir=="<-"&&([x,P,k,M]=[k,M,x,P]);{const oe=_(x);if(oe){const Se=a.createTextNode("");(at=oe.parentNode)==null||at.insertBefore(Se,oe),x=Se,P=0}const de=_(k);if(de){const Se=a.createTextNode("");(it=de.parentNode)==null||it.insertBefore(Se,de),k=Se,M=0}}E.setBaseAndExtent(x,P,k,M),e.normalize()}function _(f){for(;f&&f!==e;){if(f.nodeType===Node.ELEMENT_NODE){const E=f;if(E.getAttribute("contenteditable")=="false")return E}f=f.parentNode}}function I(){const E=le().getRangeAt(0),x=a.createRange();return x.selectNodeContents(e),x.setEnd(E.startContainer,E.startOffset),x.toString()}function T(){const E=le().getRangeAt(0),x=a.createRange();return x.selectNodeContents(e),x.setStart(E.endContainer,E.endOffset),x.toString()}function F(f){if(f.key==="Enter"){const E=I(),x=T();let[P]=ge(E),k=P;if(r.indentOn.test(E)&&(k+=r.tab),k.length>0?(Q(f),f.stopPropagation(),z(`
`+k)):$(f),k!==P&&r.moveToNewLine.test(x)){const M=b();z(`
`+P),w(M)}}}function $(f){if(A&&f.key==="Enter")if(Q(f),f.stopPropagation(),T()==""){z(`
 `);const E=b();E.start=--E.end,w(E)}else z(`
`)}function se(f){const E=r.autoclose.open,x=r.autoclose.close;if(E.includes(f.key)){Q(f);const P=b(),k=P.start==P.end?"":le().toString(),M=f.key+k+(x[E.indexOf(f.key)]??"");z(M),P.start++,P.end++,w(P)}}function Ne(f){if(f.key==="Tab")if(Q(f),f.shiftKey){const E=I();let[x,P]=ge(E);if(x.length>0){const k=b(),M=Math.min(r.tab.length,x.length);w({start:P,end:P+M}),a.execCommand("delete"),k.start-=M,k.end-=M,w(k)}}else z(r.tab)}function Ie(f){if(ce(f)){Q(f),c--;const E=i[c];E&&(e.innerHTML=E.html,w(E.pos)),c<0&&(c=0)}if(me(f)){Q(f),c++;const E=i[c];E&&(e.innerHTML=E.html,w(E.pos)),c>=i.length&&c--}}function ie(){if(!d)return;const f=e.innerHTML,E=b(),x=i[c];if(x&&x.html===f&&x.pos.start===E.start&&x.pos.end===E.end)return;c++,i[c]={html:f,pos:E},i.splice(c+1);const P=300;c>P&&(c=P,i.splice(0,1))}function He(f){if(f.defaultPrevented)return;Q(f);const x=(f.originalEvent??f).clipboardData.getData("text/plain").replace(/\r\n?/g,`
`),P=b();z(x),g(e),w({start:Math.min(P.start,P.end)+x.length,end:Math.min(P.start,P.end)+x.length,dir:"<-"})}function Le(f){const E=b(),x=le();(f.originalEvent??f).clipboardData.setData("text/plain",x.toString()),a.execCommand("delete"),g(e),w({start:Math.min(E.start,E.end),end:Math.min(E.start,E.end),dir:"<-"}),Q(f)}function H(f,E){const x=[];f.firstChild&&x.push(f.firstChild);let P=x.pop();for(;P&&E(P)!=="stop";)P.nextSibling&&x.push(P.nextSibling),P.firstChild&&x.push(P.firstChild),P=x.pop()}function G(f){return f.metaKey||f.ctrlKey}function ce(f){return G(f)&&!f.shiftKey&&ve(f)==="Z"}function me(f){return G(f)&&f.shiftKey&&ve(f)==="Z"}function X(f){return G(f)&&ve(f)==="C"}function ve(f){let E=f.key||f.keyCode||f.which;if(E)return(typeof E=="string"?E:String.fromCharCode(E)).toUpperCase()}function z(f){f=f.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),a.execCommand("insertHTML",!1,f)}function fe(f,E){let x=0;return(...P)=>{clearTimeout(x),x=s.setTimeout(()=>f(...P),E)}}function ge(f){let E=f.length-1;for(;E>=0&&f[E]!==`
`;)E--;E++;let x=E;for(;x<f.length&&/[ \t]/.test(f[x]);)x++;return[f.substring(E,x)||"",E,x]}function te(){return e.textContent||""}function Q(f){f.preventDefault()}function le(){return e.getRootNode().getSelection()}return{updateOptions(f){Object.assign(r,f)},updateCode(f,E=!0){e.textContent=f,g(e),E&&l(f)},onUpdate(f){l=f},toString:te,save:b,restore:w,recordHistory:ie,destroy(){for(let[f,E]of o)e.removeEventListener(f,E)}}}var ft=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function br(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var Ue={exports:{}},pt;function vr(){return pt||(pt=1,(function(e){var t=typeof window<"u"?window:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:{};/**
 * Prism: Lightweight, robust, elegant syntax highlighting
 *
 * @license MIT <https://opensource.org/licenses/MIT>
 * @author Lea Verou <https://lea.verou.me>
 * @namespace
 * @public
 */var n=(function(r){var s=/(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,a=0,o={},i={manual:r.Prism&&r.Prism.manual,disableWorkerMessageHandler:r.Prism&&r.Prism.disableWorkerMessageHandler,util:{encode:function m(p){return p instanceof c?new c(p.type,m(p.content),p.alias):Array.isArray(p)?p.map(m):p.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(m){return Object.prototype.toString.call(m).slice(8,-1)},objId:function(m){return m.__id||Object.defineProperty(m,"__id",{value:++a}),m.__id},clone:function m(p,h){h=h||{};var b,w;switch(i.util.type(p)){case"Object":if(w=i.util.objId(p),h[w])return h[w];b={},h[w]=b;for(var _ in p)p.hasOwnProperty(_)&&(b[_]=m(p[_],h));return b;case"Array":return w=i.util.objId(p),h[w]?h[w]:(b=[],h[w]=b,p.forEach(function(I,T){b[T]=m(I,h)}),b);default:return p}},getLanguage:function(m){for(;m;){var p=s.exec(m.className);if(p)return p[1].toLowerCase();m=m.parentElement}return"none"},setLanguage:function(m,p){m.className=m.className.replace(RegExp(s,"gi"),""),m.classList.add("language-"+p)},currentScript:function(){if(typeof document>"u")return null;if(document.currentScript&&document.currentScript.tagName==="SCRIPT")return document.currentScript;try{throw new Error}catch(b){var m=(/at [^(\r\n]*\((.*):[^:]+:[^:]+\)$/i.exec(b.stack)||[])[1];if(m){var p=document.getElementsByTagName("script");for(var h in p)if(p[h].src==m)return p[h]}return null}},isActive:function(m,p,h){for(var b="no-"+p;m;){var w=m.classList;if(w.contains(p))return!0;if(w.contains(b))return!1;m=m.parentElement}return!!h}},languages:{plain:o,plaintext:o,text:o,txt:o,extend:function(m,p){var h=i.util.clone(i.languages[m]);for(var b in p)h[b]=p[b];return h},insertBefore:function(m,p,h,b){b=b||i.languages;var w=b[m],_={};for(var I in w)if(w.hasOwnProperty(I)){if(I==p)for(var T in h)h.hasOwnProperty(T)&&(_[T]=h[T]);h.hasOwnProperty(I)||(_[I]=w[I])}var F=b[m];return b[m]=_,i.languages.DFS(i.languages,function($,se){se===F&&$!=m&&(this[$]=_)}),_},DFS:function m(p,h,b,w){w=w||{};var _=i.util.objId;for(var I in p)if(p.hasOwnProperty(I)){h.call(p,I,p[I],b||I);var T=p[I],F=i.util.type(T);F==="Object"&&!w[_(T)]?(w[_(T)]=!0,m(T,h,null,w)):F==="Array"&&!w[_(T)]&&(w[_(T)]=!0,m(T,h,I,w))}}},plugins:{},highlightAll:function(m,p){i.highlightAllUnder(document,m,p)},highlightAllUnder:function(m,p,h){var b={callback:h,container:m,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};i.hooks.run("before-highlightall",b),b.elements=Array.prototype.slice.apply(b.container.querySelectorAll(b.selector)),i.hooks.run("before-all-elements-highlight",b);for(var w=0,_;_=b.elements[w++];)i.highlightElement(_,p===!0,b.callback)},highlightElement:function(m,p,h){var b=i.util.getLanguage(m),w=i.languages[b];i.util.setLanguage(m,b);var _=m.parentElement;_&&_.nodeName.toLowerCase()==="pre"&&i.util.setLanguage(_,b);var I=m.textContent,T={element:m,language:b,grammar:w,code:I};function F(se){T.highlightedCode=se,i.hooks.run("before-insert",T),T.element.innerHTML=T.highlightedCode,i.hooks.run("after-highlight",T),i.hooks.run("complete",T),h&&h.call(T.element)}if(i.hooks.run("before-sanity-check",T),_=T.element.parentElement,_&&_.nodeName.toLowerCase()==="pre"&&!_.hasAttribute("tabindex")&&_.setAttribute("tabindex","0"),!T.code){i.hooks.run("complete",T),h&&h.call(T.element);return}if(i.hooks.run("before-highlight",T),!T.grammar){F(i.util.encode(T.code));return}if(p&&r.Worker){var $=new Worker(i.filename);$.onmessage=function(se){F(se.data)},$.postMessage(JSON.stringify({language:T.language,code:T.code,immediateClose:!0}))}else F(i.highlight(T.code,T.grammar,T.language))},highlight:function(m,p,h){var b={code:m,grammar:p,language:h};if(i.hooks.run("before-tokenize",b),!b.grammar)throw new Error('The language "'+b.language+'" has no grammar.');return b.tokens=i.tokenize(b.code,b.grammar),i.hooks.run("after-tokenize",b),c.stringify(i.util.encode(b.tokens),b.language)},tokenize:function(m,p){var h=p.rest;if(h){for(var b in h)p[b]=h[b];delete p.rest}var w=new u;return g(w,w.head,m),l(m,w,p,w.head,0),v(w)},hooks:{all:{},add:function(m,p){var h=i.hooks.all;h[m]=h[m]||[],h[m].push(p)},run:function(m,p){var h=i.hooks.all[m];if(!(!h||!h.length))for(var b=0,w;w=h[b++];)w(p)}},Token:c};r.Prism=i;function c(m,p,h,b){this.type=m,this.content=p,this.alias=h,this.length=(b||"").length|0}c.stringify=function m(p,h){if(typeof p=="string")return p;if(Array.isArray(p)){var b="";return p.forEach(function(F){b+=m(F,h)}),b}var w={type:p.type,content:m(p.content,h),tag:"span",classes:["token",p.type],attributes:{},language:h},_=p.alias;_&&(Array.isArray(_)?Array.prototype.push.apply(w.classes,_):w.classes.push(_)),i.hooks.run("wrap",w);var I="";for(var T in w.attributes)I+=" "+T+'="'+(w.attributes[T]||"").replace(/"/g,"&quot;")+'"';return"<"+w.tag+' class="'+w.classes.join(" ")+'"'+I+">"+w.content+"</"+w.tag+">"};function d(m,p,h,b){m.lastIndex=p;var w=m.exec(h);if(w&&b&&w[1]){var _=w[1].length;w.index+=_,w[0]=w[0].slice(_)}return w}function l(m,p,h,b,w,_){for(var I in h)if(!(!h.hasOwnProperty(I)||!h[I])){var T=h[I];T=Array.isArray(T)?T:[T];for(var F=0;F<T.length;++F){if(_&&_.cause==I+","+F)return;var $=T[F],se=$.inside,Ne=!!$.lookbehind,Ie=!!$.greedy,ie=$.alias;if(Ie&&!$.pattern.global){var He=$.pattern.toString().match(/[imsuy]*$/)[0];$.pattern=RegExp($.pattern.source,He+"g")}for(var Le=$.pattern||$,H=b.next,G=w;H!==p.tail&&!(_&&G>=_.reach);G+=H.value.length,H=H.next){var ce=H.value;if(p.length>m.length)return;if(!(ce instanceof c)){var me=1,X;if(Ie){if(X=d(Le,G,m,Ne),!X||X.index>=m.length)break;var ge=X.index,ve=X.index+X[0].length,z=G;for(z+=H.value.length;ge>=z;)H=H.next,z+=H.value.length;if(z-=H.value.length,G=z,H.value instanceof c)continue;for(var fe=H;fe!==p.tail&&(z<ve||typeof fe.value=="string");fe=fe.next)me++,z+=fe.value.length;me--,ce=m.slice(G,z),X.index-=G}else if(X=d(Le,0,ce,Ne),!X)continue;var ge=X.index,te=X[0],Q=ce.slice(0,ge),le=ce.slice(ge+te.length),f=G+ce.length;_&&f>_.reach&&(_.reach=f);var E=H.prev;Q&&(E=g(p,E,Q),G+=Q.length),y(p,E,me);var x=new c(I,se?i.tokenize(te,se):te,ie,te);if(H=g(p,E,x),le&&g(p,H,le),me>1){var P={cause:I+","+F,reach:f};l(m,p,h,H.prev,G,P),_&&P.reach>_.reach&&(_.reach=P.reach)}}}}}}function u(){var m={value:null,prev:null,next:null},p={value:null,prev:m,next:null};m.next=p,this.head=m,this.tail=p,this.length=0}function g(m,p,h){var b=p.next,w={value:h,prev:p,next:b};return p.next=w,b.prev=w,m.length++,w}function y(m,p,h){for(var b=p.next,w=0;w<h&&b!==m.tail;w++)b=b.next;p.next=b,b.prev=p,m.length-=w}function v(m){for(var p=[],h=m.head.next;h!==m.tail;)p.push(h.value),h=h.next;return p}if(!r.document)return r.addEventListener&&(i.disableWorkerMessageHandler||r.addEventListener("message",function(m){var p=JSON.parse(m.data),h=p.language,b=p.code,w=p.immediateClose;r.postMessage(i.highlight(b,i.languages[h],h)),w&&r.close()},!1)),i;var A=i.util.currentScript();A&&(i.filename=A.src,A.hasAttribute("data-manual")&&(i.manual=!0));function S(){i.manual||i.highlightAll()}if(!i.manual){var N=document.readyState;N==="loading"||N==="interactive"&&A&&A.defer?document.addEventListener("DOMContentLoaded",S):window.requestAnimationFrame?window.requestAnimationFrame(S):window.setTimeout(S,16)}return i})(t);e.exports&&(e.exports=n),typeof ft<"u"&&(ft.Prism=n),n.languages.markup={comment:{pattern:/\x3C!--(?:(?!\x3C!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|\x3C!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},n.languages.markup.tag.inside["attr-value"].inside.entity=n.languages.markup.entity,n.languages.markup.doctype.inside["internal-subset"].inside=n.languages.markup,n.hooks.add("wrap",function(r){r.type==="entity"&&(r.attributes.title=r.content.replace(/&amp;/,"&"))}),Object.defineProperty(n.languages.markup.tag,"addInlined",{value:function(s,a){var o={};o["language-"+a]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:n.languages[a]},o.cdata=/^<!\[CDATA\[|\]\]>$/i;var i={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:o}};i["language-"+a]={pattern:/[\s\S]+/,inside:n.languages[a]};var c={};c[s]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,function(){return s}),"i"),lookbehind:!0,greedy:!0,inside:i},n.languages.insertBefore("markup","cdata",c)}}),Object.defineProperty(n.languages.markup.tag,"addAttribute",{value:function(r,s){n.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+r+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[s,"language-"+s],inside:n.languages[s]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}}),n.languages.html=n.languages.markup,n.languages.mathml=n.languages.markup,n.languages.svg=n.languages.markup,n.languages.xml=n.languages.extend("markup",{}),n.languages.ssml=n.languages.xml,n.languages.atom=n.languages.xml,n.languages.rss=n.languages.xml,(function(r){var s=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;r.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+s.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+s.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+s.source+"$"),alias:"url"}}},selector:{pattern:RegExp(`(^|[{}\\s])[^{}\\s](?:[^{};"'\\s]|\\s+(?![\\s{])|`+s.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:s,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},r.languages.css.atrule.inside.rest=r.languages.css;var a=r.languages.markup;a&&(a.tag.addInlined("style","css"),a.tag.addAttribute("style","css"))})(n),n.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/},n.languages.javascript=n.languages.extend("clike",{"class-name":[n.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+(/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source)+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/}),n.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/,n.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:n.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:n.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:n.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:n.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:n.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),n.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:n.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}}),n.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}}),n.languages.markup&&(n.languages.markup.tag.addInlined("script","javascript"),n.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript")),n.languages.js=n.languages.javascript,(function(){if(typeof n>"u"||typeof document>"u")return;Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);var r="Loading…",s=function(A,S){return"✖ Error "+A+" while fetching file: "+S},a="✖ Error: File does not exist or is empty",o={js:"javascript",py:"python",rb:"ruby",ps1:"powershell",psm1:"powershell",sh:"bash",bat:"batch",h:"c",tex:"latex"},i="data-src-status",c="loading",d="loaded",l="failed",u="pre[data-src]:not(["+i+'="'+d+'"]):not(['+i+'="'+c+'"])';function g(A,S,N){var m=new XMLHttpRequest;m.open("GET",A,!0),m.onreadystatechange=function(){m.readyState==4&&(m.status<400&&m.responseText?S(m.responseText):m.status>=400?N(s(m.status,m.statusText)):N(a))},m.send(null)}function y(A){var S=/^\s*(\d+)\s*(?:(,)\s*(?:(\d+)\s*)?)?$/.exec(A||"");if(S){var N=Number(S[1]),m=S[2],p=S[3];return m?p?[N,Number(p)]:[N,void 0]:[N,N]}}n.hooks.add("before-highlightall",function(A){A.selector+=", "+u}),n.hooks.add("before-sanity-check",function(A){var S=A.element;if(S.matches(u)){A.code="",S.setAttribute(i,c);var N=S.appendChild(document.createElement("CODE"));N.textContent=r;var m=S.getAttribute("data-src"),p=A.language;if(p==="none"){var h=(/\.(\w+)$/.exec(m)||[,"none"])[1];p=o[h]||h}n.util.setLanguage(N,p),n.util.setLanguage(S,p);var b=n.plugins.autoloader;b&&b.loadLanguages(p),g(m,function(w){S.setAttribute(i,d);var _=y(S.getAttribute("data-range"));if(_){var I=w.split(/\r\n?|\n/g),T=_[0],F=_[1]==null?I.length:_[1];T<0&&(T+=I.length),T=Math.max(0,Math.min(T-1,I.length)),F<0&&(F+=I.length),F=Math.max(0,Math.min(F,I.length)),w=I.slice(T,F).join(`
`),S.hasAttribute("data-start")||S.setAttribute("data-start",String(T+1))}N.textContent=w,n.highlightElement(N)},function(w){S.setAttribute(i,l),N.textContent=w})}}),n.plugins.fileHighlight={highlight:function(S){for(var N=(S||document).querySelectorAll(u),m=0,p;p=N[m++];)n.highlightElement(p)}};var v=!1;n.fileHighlight=function(){v||(console.warn("Prism.fileHighlight is deprecated. Use `Prism.plugins.fileHighlight.highlight` instead."),v=!0),n.plugins.fileHighlight.highlight.apply(this,arguments)}})()})(Ue)),Ue.exports}var Sr=vr();const je=br(Sr);let ue=null;const xt="memimg-line-numbers";let Ge=null;function Ar(e){Ge=e}function Tt(e){ue&&ue.updateCode(e)}function _t(){const e=localStorage.getItem(xt);return e===null?!0:e==="true"}function xr(e){localStorage.setItem(xt,e.toString())}function st(){const e=document.getElementById("line-numbers"),t=document.getElementById("code-editor");if(!ue||!e)return;const s=ue.toString().split(`
`).length,a=Array.from({length:s},(o,i)=>i+1).join(`
`);e.textContent=a,t.addEventListener("scroll",()=>{e.scrollTop=t.scrollTop})}function Tr(){const e=document.getElementById("line-numbers"),n=!_t();xr(n),e&&(e.style.display=n?"block":"none"),n&&st()}function _r(){const e=document.getElementById("line-numbers"),t=_t();e&&(e.style.display=t?"block":"none"),t&&st()}function Ye(e,t=""){const n=document.getElementById("status");n.textContent=e,n.className=t,e&&t!=="error"&&setTimeout(()=>{n.textContent="",n.className=""},3e3)}async function Pt(e,t,n,r){var i,c;if(!ue)return;const s=ue.toString().trim();if(!s)return;let a;try{a=new Function(s)}catch(d){const l=d;let u=l.message;const g=u.match(/\((\d+):(\d+)\)/),y=u.match(/line (\d+)/);let v,A;if(g?(v=parseInt(g[1]),A=parseInt(g[2]),u=`Line ${v}, Col ${A}: ${l.message}`):y&&(v=parseInt(y[1]),u=`Line ${v}: ${l.message}`),v!==void 0){const N=s.split(`
`),m=v-1;m>=0&&m<N.length&&(u+=`

`+N[m])}const S=document.getElementById("error-panel");S.textContent=u,S.style.display="block",Ye("Syntax error - see below editor","error"),console.error("Syntax error:",l),console.error("Message:",l.message);return}const o=t.createCheckpoint();try{const d=a.call(e);d!==void 0&&console.log("Result:",d);const l=document.getElementById("error-panel");if(l.textContent="",l.style.display="none",n)try{await pr(n,s),Ge&&(await new Promise(u=>setTimeout(u,50)),await Ge())}catch(u){console.error("Failed to save script to history:",u)}ue.updateCode(""),Ye("Code executed","success"),r&&r()}catch(d){t.restoreCheckpoint(o);const l=d;let u=l.message;const g=(i=l.stack)==null?void 0:i.match(/<anonymous>:(\d+):(\d+)/),y=(c=l.stack)==null?void 0:c.match(/Function:(\d+):(\d+)/),v=g||y;if(v){const S=parseInt(v[1]),N=parseInt(v[2]),m=S-2;u=`Line ${m}, Col ${N}: ${l.message}`;const p=s.split(`
`),h=m-1;h>=0&&h<p.length&&(console.error("Error at line",m,":",p[h]),u+=`

`+p[h])}const A=document.getElementById("error-panel");A.textContent=u,A.style.display="block",Ye("Runtime error - changes rolled back","error"),console.error("Runtime error:",l),console.error("Stack:",l.stack),console.log("Delta restored to checkpoint (partial mutations discarded)")}}let be=null;function Pr(e,t,n,r){const s=document.getElementById("code-editor");be={root:e,txn:t,memimgId:n,onExecute:r},ue||(ue=wr(s,o=>{const i=o.textContent||"";je.languages.javascript&&(o.innerHTML=je.highlight(i,je.languages.javascript,"javascript")),st()},{tab:"  ",indentOn:/[(\[{]$/}),_r(),s.addEventListener("keydown",async o=>{o.ctrlKey&&o.key==="Enter"&&(o.preventDefault(),be&&await Pt(be.root,be.txn,be.memimgId,be.onExecute))}))}const Re="memimg-explorer",Y="memimg-metadata";function Nr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}async function Ee(){return new Promise((e,t)=>{const n=indexedDB.open(Re);n.onerror=()=>{t(n.error)},n.onsuccess=async()=>{const r=n.result,s=r.version,a=!r.objectStoreNames.contains(Y);if(r.close(),await new Promise(o=>setTimeout(o,50)),a){const o=indexedDB.open(Re,s+1);o.onerror=()=>{t(o.error)},o.onblocked=()=>{},o.onsuccess=()=>{e(o.result)},o.onupgradeneeded=i=>{const c=i.target.result;if(!c.objectStoreNames.contains(Y)){const d=c.createObjectStore(Y,{keyPath:"id"});d.createIndex("createdAt","createdAt",{unique:!1}),d.createIndex("updatedAt","updatedAt",{unique:!1})}}}else{const o=indexedDB.open(Re);o.onblocked=()=>{},o.onerror=()=>{t(o.error)},o.onsuccess=()=>{e(o.result)}}},n.onupgradeneeded=r=>{const s=r.target.result;if(!s.objectStoreNames.contains(Y)){const a=s.createObjectStore(Y,{keyPath:"id"});a.createIndex("createdAt","createdAt",{unique:!1}),a.createIndex("updatedAt","updatedAt",{unique:!1})}}})}async function Nt(){const e=await Ee();return new Promise((t,n)=>{const o=e.transaction([Y],"readonly").objectStore(Y).index("updatedAt").openCursor(null,"prev"),i=[];o.onsuccess=async()=>{const c=o.result;c?(i.push(c.value),c.continue()):(e.close(),await new Promise(d=>setTimeout(d,50)),t(i))},o.onerror=async()=>{e.close(),await new Promise(c=>setTimeout(c,50)),n(o.error)}})}async function Ir(e){const t=await Ee();return new Promise((n,r)=>{const o=t.transaction([Y],"readonly").objectStore(Y).get(e);o.onsuccess=async()=>{t.close(),await new Promise(i=>setTimeout(i,50)),n(o.result||null)},o.onerror=async()=>{t.close(),await new Promise(i=>setTimeout(i,50)),r(o.error)}})}async function It(e,t){const n=await Nt(),r=e.trim().toLowerCase();return n.some(a=>a.id!==t&&a.name.toLowerCase()===r)}async function Lr(e,t=""){if(!e||e.trim().length===0)throw new Error("Memory image name cannot be empty");if(await It(e))throw new Error("A memory image with this name already exists");const n={id:Nr(),name:e.trim(),description:t.trim(),createdAt:Date.now(),updatedAt:Date.now(),eventCount:0},r=await Ee();return new Promise((s,a)=>{const c=r.transaction([Y],"readwrite").objectStore(Y).add(n);c.onsuccess=async()=>{r.close(),await new Promise(d=>setTimeout(d,50)),s(n)},c.onerror=async()=>{r.close(),await new Promise(d=>setTimeout(d,50)),a(c.error)}})}async function Cr(e,t){if(!t||t.trim().length===0)throw new Error("Memory image name cannot be empty");if(await It(t,e))throw new Error("A memory image with this name already exists");const n=await Ee();return new Promise((r,s)=>{const o=n.transaction([Y],"readwrite").objectStore(Y),i=o.get(e);i.onsuccess=async()=>{const c=i.result;if(!c){n.close(),await new Promise(l=>setTimeout(l,50)),s(new Error(`Memory image not found: ${e}`));return}c.name=t.trim(),c.updatedAt=Date.now();const d=o.put(c);d.onsuccess=async()=>{n.close(),await new Promise(l=>setTimeout(l,50)),r()},d.onerror=async()=>{n.close(),await new Promise(l=>setTimeout(l,50)),s(d.error)}},i.onerror=async()=>{n.close(),await new Promise(c=>setTimeout(c,50)),s(i.error)}})}async function Rr(e,t){const n=await Ee();return new Promise((r,s)=>{const o=n.transaction([Y],"readwrite").objectStore(Y),i=o.get(e);i.onsuccess=async()=>{const c=i.result;if(!c){n.close(),await new Promise(l=>setTimeout(l,50)),s(new Error(`Memory image not found: ${e}`));return}c.description=t.trim(),c.updatedAt=Date.now();const d=o.put(c);d.onsuccess=async()=>{n.close(),await new Promise(l=>setTimeout(l,50)),r()},d.onerror=async()=>{n.close(),await new Promise(l=>setTimeout(l,50)),s(d.error)}},i.onerror=async()=>{n.close(),await new Promise(c=>setTimeout(c,50)),s(i.error)}})}async function kr(e){const t=await Ee();return new Promise((n,r)=>{const a=t.transaction([Y],"readwrite").objectStore(Y),o=a.get(e);o.onsuccess=async()=>{const i=o.result;if(!i){t.close(),await new Promise(d=>setTimeout(d,50)),r(new Error(`Memory image not found: ${e}`));return}i.updatedAt=Date.now();const c=a.put(i);c.onsuccess=async()=>{t.close(),await new Promise(d=>setTimeout(d,50)),n()},c.onerror=async()=>{t.close(),await new Promise(d=>setTimeout(d,50)),r(c.error)}},o.onerror=async()=>{t.close(),await new Promise(i=>setTimeout(i,50)),r(o.error)}})}async function Dr(e){const t=await Ee();return new Promise((n,r)=>{const o=t.transaction([Y],"readwrite").objectStore(Y).delete(e);o.onsuccess=async()=>{const i=`events-${e}`,c=rt(e);try{const d=t.objectStoreNames.contains(i),l=t.objectStoreNames.contains(c);if(d||l){t.close(),await new Promise(y=>setTimeout(y,50));const u=t.version,g=indexedDB.open(Re,u+1);g.onupgradeneeded=y=>{const v=y.target.result;v.objectStoreNames.contains(i)&&v.deleteObjectStore(i),v.objectStoreNames.contains(c)&&v.deleteObjectStore(c)},g.onsuccess=async()=>{g.result.close(),await new Promise(y=>setTimeout(y,50)),n()},g.onerror=()=>{r(g.error)}}else t.close(),await new Promise(u=>setTimeout(u,50)),n()}catch(d){t.close(),await new Promise(l=>setTimeout(l,50)),r(d)}},o.onerror=async()=>{t.close(),await new Promise(i=>setTimeout(i,50)),r(o.error)}})}function Or(e){return`events-${e}`}function mt(e){const t=new Date(e),r=new Date().getTime()-t.getTime(),s=Math.floor(r/6e4),a=Math.floor(r/36e5),o=Math.floor(r/864e5);return s<1?"Just now":s<60?`${s}m ago`:a<24?`${a}h ago`:o<7?`${o}d ago`:t.toLocaleDateString()}async function Be(e,t){try{const n=await Nt();if(n.length===0){e.innerHTML=`
        <div class="empty-state">
          <div class="empty-icon">📦</div>
          <h2>No Memory Images Yet</h2>
          <p>Create your first memory image to get started</p>
          <button id="create-first-btn" class="primary-button">+ New Memory Image</button>
        </div>
      `,e.querySelector("#create-first-btn").addEventListener("click",()=>Lt(e,t));return}const r=`
      <div class="memimg-grid">
        ${n.map(s=>Fr(s,t)).join("")}
      </div>
    `;e.innerHTML=r,n.forEach(s=>{const a=e.querySelector(`[data-id="${s.id}"]`);a.querySelector(".open-btn").addEventListener("click",l=>{l.stopPropagation(),t(s.id)}),a.querySelector(".rename-btn").addEventListener("click",l=>{l.stopPropagation(),Mr(s,e,t)}),a.querySelector(".edit-desc-btn").addEventListener("click",l=>{l.stopPropagation(),Br(s,e,t)}),a.querySelector(".delete-btn").addEventListener("click",async l=>{if(l.stopPropagation(),confirm(`Delete "${s.name}"? This cannot be undone.`))try{await Dr(s.id),await new Promise(u=>setTimeout(u,50)),await Be(e,t)}catch(u){alert(`Error deleting memory image: ${u.message}`)}}),a.addEventListener("click",()=>t(s.id))})}catch(n){e.innerHTML=`
      <div class="error-state">
        <h2>Error Loading Memory Images</h2>
        <p>${n.message}</p>
      </div>
    `}}function Fr(e,t){const n=e.eventCount!==void 0?`${e.eventCount} events`:"Unknown size";return`
    <div class="memimg-card" data-id="${e.id}">
      <div class="card-header">
        <h3 class="card-title">${Oe(e.name)}</h3>
        <div class="card-actions">
          <button class="icon-btn rename-btn" title="Rename">✏️</button>
          <button class="icon-btn edit-desc-btn" title="Edit description">📝</button>
          <button class="icon-btn delete-btn" title="Delete">🗑️</button>
        </div>
      </div>
      <div class="card-body">
        <p class="card-description">${Oe(e.description)||"<em>No description</em>"}</p>
        <div class="card-meta">
          <span class="meta-item">📅 Created ${mt(e.createdAt)}</span>
          <span class="meta-item">🕒 Updated ${mt(e.updatedAt)}</span>
          <span class="meta-item">📊 ${n}</span>
        </div>
      </div>
      <div class="card-footer">
        <button class="open-btn">Open →</button>
      </div>
    </div>
  `}function Lt(e,t){const n=document.createElement("div");n.className="modal-overlay",n.innerHTML=`
    <div class="modal-dialog">
      <div class="modal-header">
        <h2>New Memory Image</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="memimg-name">Name *</label>
          <input type="text" id="memimg-name" class="form-input" placeholder="My Memory Image" required autofocus>
        </div>
        <div class="form-group">
          <label for="memimg-desc">Description</label>
          <textarea id="memimg-desc" class="form-textarea" placeholder="Optional description" rows="3"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel-btn">Cancel</button>
        <button class="create-btn primary-button">Create</button>
      </div>
    </div>
  `,document.body.appendChild(n);const r=n.querySelector("#memimg-name"),s=n.querySelector("#memimg-desc"),a=n.querySelector(".modal-close"),o=n.querySelector(".cancel-btn"),i=n.querySelector(".create-btn"),c=()=>{n.remove()},d=async()=>{const l=r.value.trim();if(!l){alert("Please enter a name"),r.focus();return}i.disabled=!0;const u=i.textContent;i.textContent="Creating...";try{console.log("Creating memory image:",l);const g=await Lr(l,s.value.trim());console.log("Memory image created:",g),c(),t(g.id)}catch(g){console.error("Error creating memory image:",g),alert(`Error creating memory image: ${g.message}`),i.disabled=!1,i.textContent=u,r.focus()}};a.addEventListener("click",c),o.addEventListener("click",c),i.addEventListener("click",d),r.addEventListener("keydown",l=>{l.key==="Enter"&&(l.preventDefault(),d())}),n.addEventListener("keydown",l=>{l.key==="Escape"&&c()}),n.addEventListener("click",l=>{l.target===n&&c()}),r.focus()}function Mr(e,t,n){const r=document.createElement("div");r.className="modal-overlay",r.innerHTML=`
    <div class="modal-dialog">
      <div class="modal-header">
        <h2>Rename Memory Image</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="memimg-name">Name *</label>
          <input type="text" id="memimg-name" class="form-input" value="${Oe(e.name)}" required autofocus>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel-btn">Cancel</button>
        <button class="save-btn primary-button">Save</button>
      </div>
    </div>
  `,document.body.appendChild(r);const s=r.querySelector("#memimg-name"),a=r.querySelector(".modal-close"),o=r.querySelector(".cancel-btn"),i=r.querySelector(".save-btn"),c=()=>{r.remove()},d=async()=>{const l=s.value.trim();if(!l){alert("Please enter a name"),s.focus();return}try{await Cr(e.id,l),c(),await Be(t,n)}catch(u){alert(`Error renaming: ${u.message}`)}};a.addEventListener("click",c),o.addEventListener("click",c),i.addEventListener("click",d),s.addEventListener("keydown",l=>{l.key==="Enter"&&(l.preventDefault(),d())}),r.addEventListener("keydown",l=>{l.key==="Escape"&&c()}),r.addEventListener("click",l=>{l.target===r&&c()}),s.select()}function Br(e,t,n){const r=document.createElement("div");r.className="modal-overlay",r.innerHTML=`
    <div class="modal-dialog">
      <div class="modal-header">
        <h2>Edit Description</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="memimg-desc">Description</label>
          <textarea id="memimg-desc" class="form-textarea" rows="4" autofocus>${Oe(e.description)}</textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel-btn">Cancel</button>
        <button class="save-btn primary-button">Save</button>
      </div>
    </div>
  `,document.body.appendChild(r);const s=r.querySelector("#memimg-desc"),a=r.querySelector(".modal-close"),o=r.querySelector(".cancel-btn"),i=r.querySelector(".save-btn"),c=()=>{r.remove()},d=async()=>{try{await Rr(e.id,s.value.trim()),c(),await Be(t,n)}catch(l){alert(`Error updating description: ${l.message}`)}};a.addEventListener("click",c),o.addEventListener("click",c),i.addEventListener("click",d),r.addEventListener("keydown",l=>{l.key==="Escape"&&c()}),r.addEventListener("click",l=>{l.target===r&&c()}),s.focus()}function Oe(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}const Ct=50;function $r(e){const n=Date.now()-e,r=Math.floor(n/1e3),s=Math.floor(r/60),a=Math.floor(s/60),o=Math.floor(a/24);return r<60?"just now":s<60?`${s} min${s>1?"s":""} ago`:a<24?`${a} hour${a>1?"s":""} ago`:`${o} day${o>1?"s":""} ago`}function Hr(e){return new Date(e).toLocaleString()}function gt(e,t=Ct){return e.length<=t?e:e.substring(0,t)+"..."}function qe(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function Rt(e,t,n){const r=document.createElement("div");r.className="history-entry",r.dataset.entryId=e.id;const s=e.code.length>Ct,a=gt(e.code);r.innerHTML=`
    <div class="history-entry-header">
      <span class="history-status">●</span>
      <span class="history-timestamp" title="${qe(Hr(e.timestamp))}">
        ${qe($r(e.timestamp))}
      </span>
      <span class="history-size">${e.characterCount} chars</span>
    </div>
    <div class="history-code ${s?"expandable":""}" data-expanded="false">
      <pre>${qe(a)}</pre>
    </div>
    <div class="history-actions">
      <button class="history-btn load-btn" title="Load into editor">⬆ Load</button>
      <button class="history-btn copy-btn" title="Copy to clipboard">📋 Copy</button>
      ${s?'<button class="history-btn expand-btn" title="Expand/collapse">▼ Expand</button>':""}
    </div>
  `;const o=r.querySelector(".load-btn"),i=r.querySelector(".copy-btn"),c=r.querySelector(".expand-btn"),d=r.querySelector(".history-code");return o==null||o.addEventListener("click",l=>{l.stopPropagation(),t(e.code)}),i==null||i.addEventListener("click",async l=>{l.stopPropagation(),n(e.code)}),c&&s&&c.addEventListener("click",l=>{l.stopPropagation(),d.dataset.expanded==="true"?(d.querySelector("pre").textContent=gt(e.code),d.dataset.expanded="false",c.textContent="▼ Expand"):(d.querySelector("pre").textContent=e.code,d.dataset.expanded="true",c.textContent="▲ Collapse")}),r}async function Ke(e,t,n){try{const r=await Me(t,100);if(e.innerHTML="",r.length===0){e.innerHTML='<div class="history-empty">No script history yet. Run a script to get started.</div>';return}for(const o of r){const i=Rt(o,n,async c=>{try{await navigator.clipboard.writeText(c);const d=e.querySelector(`[data-entry-id="${o.id}"] .copy-btn`);if(d){const l=d.textContent;d.textContent="✓ Copied",setTimeout(()=>{d.textContent=l},1e3)}}catch(d){console.error("Failed to copy:",d),alert("Failed to copy to clipboard")}});e.appendChild(i)}const s=await yr(t),a=document.querySelector(".history-stats");if(a){const o=(s.totalSize/1048576).toFixed(2);a.textContent=`${s.count} entries, ${o} MB`}}catch(r){console.error("Failed to render script history:",r),e.innerHTML='<div class="history-error">Failed to load script history</div>'}}function Ur(e,t,n,r){let s=null;e.addEventListener("input",()=>{s&&clearTimeout(s),s=window.setTimeout(async()=>{const a=e.value.trim();try{const o=a?await mr(n,a):await Me(n,100);if(t.innerHTML="",o.length===0){t.innerHTML='<div class="history-empty">No matching scripts found.</div>';return}for(const i of o){const c=Rt(i,r,async d=>{try{await navigator.clipboard.writeText(d);const l=t.querySelector(`[data-entry-id="${i.id}"] .copy-btn`);if(l){const u=l.textContent;l.textContent="✓ Copied",setTimeout(()=>{l.textContent=u},1e3)}}catch(l){console.error("Failed to copy:",l),alert("Failed to copy to clipboard")}});t.appendChild(c)}}catch(o){console.error("Search failed:",o),t.innerHTML='<div class="history-error">Search failed</div>'}},300)})}function jr(e,t,n){e.addEventListener("click",async()=>{if(confirm("Clear all script history? This cannot be undone."))try{await gr(t),n()}catch(r){console.error("Failed to clear history:",r),alert("Failed to clear history")}})}function Yr(e,t,n){e.addEventListener("click",async()=>{try{const r=await hr(t),s=new Blob([r],{type:"application/json"}),a=URL.createObjectURL(s),o=document.createElement("a");o.href=a;const i=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);o.download=`${n}-script-history-${i}.json`,o.click(),URL.revokeObjectURL(a)}catch(r){console.error("Failed to export history:",r),alert("Failed to export history")}})}let j=null,ae=null,R=null,B=null,O;const ee=new vn;function ot(e){window.location.hash=e}function kt(){const e=window.location.hash.slice(1);if(!e||e==="/")return{view:"list"};const t=e.match(/^\/edit\/(.+)$/);return t?{view:"edit",memimgId:t[1]}:{view:"list"}}async function qr(){const e=kt();if(e.view==="list")j&&await Bt();else if(e.view==="edit"&&e.memimgId&&j!==e.memimgId)try{await $e(e.memimgId)}catch(t){console.error(`Failed to open memory image from hash: ${e.memimgId}`,t),C(`Memory image not found: ${e.memimgId}`,"error"),ot("/")}}const Dt=document.getElementById("list-view"),Ot=document.getElementById("explorer-view"),Ft=document.getElementById("memimg-list-content");window.viewAsJson=function(e,t=!0){const n=JSON.parse(yt(e,new WeakMap)),r=t?JSON.stringify(n,null,2):JSON.stringify(n);return console.log(r),n};function C(e,t=""){const n=document.getElementById("status");n&&(n.textContent=e,n.className="status-bar "+t,e&&t!=="error"&&setTimeout(()=>{n.textContent="",n.className="status-bar"},3e3))}function we(){const e=R?R.isDirty():!1,t=document.getElementById("dirty-indicator"),n=document.getElementById("discard-btn");!t||!n||(e?(t.style.display="flex",n.style.display="inline-block"):(t.style.display="none",n.style.display="none"))}function ne(){B&&(On(B,ee,document.getElementById("tree-view"),ne),lr(B,ee,document.getElementById("inspector-view"),ne),zr(),we())}function zr(){const e=document.getElementById("back-btn"),t=document.getElementById("forward-btn");!e||!t||(e.disabled=!ee.canGoBack(),t.disabled=!ee.canGoForward())}async function Wr(){if(!B){C("No memory image open","error");return}try{const e=window.ObjectType,t=window.NumberType,n=window.StringType,r=window.DateTypeInstance;if(!e)throw new Error("ObjectType not found - javascript-types library not loaded");const s=e({name:"Name",properties:{firstName:{type:n},middleName:{type:n},lastName:{type:n}}}),a=e({name:"Dept",properties:{deptno:{type:t},dname:{type:n},loc:{type:n},emps:{type:null}}}),o=e({name:"Emp",properties:{empno:{type:t},ename:{type:s},job:{type:n},mgr:{type:null},hiredate:{type:r},sal:{type:t},comm:{type:t},dept:{type:a},subordinates:{type:null}}}),i=a({deptno:10,dname:"ACCOUNTING",loc:"NEW YORK"}),c=a({deptno:20,dname:"RESEARCH",loc:"DALLAS"}),d=a({deptno:30,dname:"SALES",loc:"CHICAGO"}),l=a({deptno:40,dname:"OPERATIONS",loc:"BOSTON"}),u=o({empno:7839,ename:s({firstName:"Arthur",middleName:"Rex",lastName:"KING"}),job:"PRESIDENT",mgr:null,hiredate:new Date("1981-11-17"),sal:5e3,comm:null,dept:i,subordinates:[]}),g=o({empno:7566,ename:s({firstName:"Indiana",middleName:"Henry",lastName:"JONES"}),job:"MANAGER",mgr:u,hiredate:new Date("1981-04-02"),sal:2975,comm:null,dept:c,subordinates:[]}),y=o({empno:7698,ename:s({firstName:"William",middleName:"Arthur",lastName:"BLAKE"}),job:"MANAGER",mgr:u,hiredate:new Date("1981-05-01"),sal:2850,comm:null,dept:d,subordinates:[]}),v=o({empno:7369,ename:s({firstName:"John",middleName:"Paul",lastName:"SMITH"}),job:"CLERK",mgr:g,hiredate:new Date("1980-12-17"),sal:800,comm:null,dept:c,subordinates:[]}),A=o({empno:7499,ename:s({firstName:"Ethan",middleName:"James",lastName:"ALLEN"}),job:"SALESMAN",mgr:y,hiredate:new Date("1981-02-20"),sal:1600,comm:300,dept:d,subordinates:[]}),S=o({empno:7521,ename:s({firstName:"Christopher",middleName:"Lee",lastName:"WARD"}),job:"SALESMAN",mgr:y,hiredate:new Date("1981-02-22"),sal:1250,comm:500,dept:d,subordinates:[]});i.emps=[u],c.emps=[g,v],d.emps=[y,A,S],l.emps=[],u.subordinates=[g,y],g.subordinates=[v],y.subordinates=[A,S],v.subordinates=[],A.subordinates=[],S.subordinates=[],B.depts={accounting:i,research:c,sales:d,operations:l},B.emps={king:u,jones:g,blake:y,smith:v,allen:A,ward:S},window.types={Dept:a,Emp:o,Name:s},console.log("Types available at: window.types = { Dept, Emp, Name }"),C("Scott schema loaded (with ObjectType)","success"),we(),await ne()}catch(e){const t=e;C("Error loading Scott: "+t.message,"error"),console.error(t)}}async function Vr(){if(!R){C("Transaction not initialized","error");return}if(!R.isDirty()){C("No changes to save","success");return}try{console.log("Committing transaction to IndexedDB..."),await R.save(),j&&await kr(j),we(),C("Changes saved to IndexedDB","success"),await ne()}catch(e){const t=e;C("Save error: "+t.message,"error"),console.error(t)}}async function Gr(){if(!R){C("Transaction not initialized","error");return}if(R.isDirty()&&confirm("Discard all unsaved changes?"))try{console.log("Rolling back transaction..."),R.discard(),we(),C("Changes discarded","success"),await ne()}catch(e){C("Discard error: "+e.message,"error"),console.error(e)}}async function Kr(){if(confirm("Clear all data from memory image and IndexedDB?")){if(!O||!R){C("Not initialized","error");return}try{for(const e in B)delete B[e];await R.save(),O!=null&&O.clear&&await O.clear(),R=await Xe(O),B=R.root,window.root=B,tt(R.unwrap.bind(R)),ee.reset(),we(),C("Cleared all data","success"),await ne()}catch(e){const t=e;C("Clear error: "+t.message,"error"),console.error(t)}}}function Mt(e,t){const n=new Blob([t],{type:"text/plain"}),r=URL.createObjectURL(n),s=document.createElement("a");s.href=r,s.download=e,s.click(),URL.revokeObjectURL(r)}async function Jr(){if(!B){C("No memory image open","error");return}if(!ae){C("No metadata available","error");return}if(!confirm(`📸 Export Snapshot (External Use Only)

⚠️  IMPORTANT: Snapshots CANNOT be re-imported into Filer.

Snapshots are for:
• Sharing data with external tools
• Data analysis and reporting
• Human-readable backups

To save your work for later:
✅ Use 'Export Event Log' instead (re-importable)

Continue with snapshot export?`)){C("Snapshot export cancelled","info");return}try{console.log("Exporting snapshot...");const t=(d,l=new WeakSet)=>{if(d==null||typeof d!="object"||l.has(d))return d;l.add(d);const u=R.unwrap(d);if(u instanceof Date)return u;if(Array.isArray(u))return u.map(y=>t(y,l));if(u instanceof Map){const y=new Map;return u.forEach((v,A)=>{y.set(t(A,l),t(v,l))}),y}if(u instanceof Set){const y=new Set;return u.forEach(v=>{y.add(t(v,l))}),y}const g={};for(const y in u)Object.prototype.hasOwnProperty.call(u,y)&&(g[y]=t(u[y],l));return g},n=t(B),r=yt(n,new WeakMap),s=JSON.parse(r),a={type:"snapshot",version:1,timestamp:Date.now(),name:ae.name,description:ae.description,state:s},o=JSON.stringify(a,null,2),i=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5),c=`${ae.name}-snapshot-${i}.json`;Mt(c,o),C(`Exported snapshot to ${c}`,"success"),console.log(`Exported snapshot (${o.length} bytes)`)}catch(t){const n=t;C("Export error: "+n.message,"error"),console.error("Export error:",n)}}async function Xr(){if(!O){C("No memory image open","error");return}if(!ae){C("No metadata available","error");return}try{console.log("Exporting events...");const e=await O.getAll();if(e.length===0){C("No events to export","success");return}const t=e.map(s=>JSON.stringify(s)).join(`
`),n=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5),r=`${ae.name}-${n}.ndjson`;Mt(r,t),C(`Exported ${e.length} events to ${r}`,"success"),console.log(`Exported ${e.length} events`)}catch(e){const t=e;C("Export error: "+t.message,"error"),console.error("Export error:",t)}}async function Zr(e){if(!O||!R){C("No memory image open","error");return}try{console.log(`Importing event log from ${e.name}...`);const t=await e.text();try{const s=JSON.parse(t);if(s&&typeof s=="object"&&s.type==="snapshot"){C("Snapshot files cannot be imported. Use 'Export Event Log' to create re-importable files.","error"),alert(`⚠️  Snapshot Import Not Supported

Snapshot files are for external consumption only and cannot be re-imported.

To save and restore your data:
• Use 'Export Event Log' (not 'Export Snapshot')
• Event logs can be imported to restore your work

Snapshots are useful for sharing data with other tools,
but only Event Logs preserve the mutation history needed for import.`);return}}catch{}const n=t.trim().split(`
`).filter(s=>s.trim());if(n.length===0){C("No events found in file","error");return}const r=n.map(s=>{try{return JSON.parse(s)}catch{throw new Error(`Invalid JSON in file: ${s.slice(0,50)}...`)}});if(console.log(`Parsed ${r.length} events`),!confirm(`Import ${r.length} events? This will replace all current data.`))return;O!=null&&O.clear&&(await O.clear(),console.log("Cleared existing event log"));for(const s of r)await O.append(s);console.log(`Replayed ${r.length} events`),R=await Xe(O),B=R.root,window.root=B,tt(R.unwrap.bind(R)),ee.reset(),we(),C(`Imported ${r.length} events from ${e.name}`,"success"),await ne()}catch(t){const n=t;C("Import error: "+n.message,"error"),console.error("Import error:",n)}}function Qr(){document.querySelectorAll(".resize-handle").forEach(t=>{let n=0,r=0,s=0,a=null,o=null;t.addEventListener("mousedown",d=>{d.preventDefault();const l=t.dataset.direction;a=t.previousElementSibling,o=t.nextElementSibling,!(!a||!o)&&(n=l==="vertical"?d.clientY:d.clientX,r=l==="vertical"?a.offsetHeight:a.offsetWidth,s=l==="vertical"?o.offsetHeight:o.offsetWidth,document.addEventListener("mousemove",i),document.addEventListener("mouseup",c),document.body.style.cursor=l==="vertical"?"ns-resize":"ew-resize",document.body.style.userSelect="none")});function i(d){if(!a||!o||!t)return;const l=t.dataset.direction,g=(l==="vertical"?d.clientY:d.clientX)-n,y=r+g,v=s-g,A=200;y<A||v<A||(l==="vertical"?(a.style.flex="none",a.style.height=`${y}px`,o.style.flex="none",o.style.height=`${v}px`):(a.style.flex="none",a.style.width=`${y}px`,o.style.flex="none",o.style.width=`${v}px`))}function c(){document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",c),document.body.style.cursor="",document.body.style.userSelect=""}})}function es(){if(!j||!ae)return;const e=document.getElementById("history-list"),t=document.getElementById("history-search"),n=document.getElementById("clear-history-btn"),r=document.getElementById("export-history-btn"),s=document.getElementById("toggle-history-btn"),a=document.getElementById("close-history-btn"),o=document.getElementById("script-history-sidebar");if(!e||!t||!n||!r)return;let i=!1;const c=l=>{Tt(l);const u=document.getElementById("code-editor");u&&u.focus(),o&&o.classList.add("collapsed")},d=async()=>{if(!i&&j)try{await Ke(e,j,c),i=!0}catch(l){console.error("Failed to load script history:",l),e.innerHTML='<div class="history-error">Failed to load history</div>'}};Ur(t,e,j,c),jr(n,j,async()=>{j&&(await Ke(e,j,c),i=!0)}),Yr(r,j,ae.name),s&&o&&(s.onclick=async()=>{const l=o.classList.contains("collapsed");o.classList.toggle("collapsed"),l&&await d()}),a&&o&&(a.onclick=()=>{o.classList.add("collapsed")}),e.innerHTML='<div class="history-empty">Open history panel to view scripts</div>'}async function ts(){if(!j)return;const e=document.getElementById("script-history-sidebar"),t=document.getElementById("history-list");if(!e||!t||e.classList.contains("collapsed"))return;await Ke(t,j,r=>{Tt(r);const s=document.getElementById("code-editor");s&&s.focus(),e&&e.classList.add("collapsed")})}async function Je(){Ot.style.display="none",Dt.style.display="flex",await Be(Ft,$e),document.title="Navigator - Memory Image Explorer",ot("/"),console.log("Showing list view")}async function $e(e){j=e;try{console.log(`Opening memory image: ${e}`);const t=await Ir(e);if(!t)throw new Error(`Memory image not found: ${e}`);ae=t,await fr(e),console.log("Script history store ensured");const n=Or(e);O=Wt("memimg-explorer",n),R=await Xe(O),B=R.root,window.root=B,tt(R.unwrap.bind(R)),ee.onNavigate=ne;const r=O.append.bind(O);O.append=async function(o){await r(o),we()},Dt.style.display="none",Ot.style.display="flex";const s=document.getElementById("current-memimg-name");s&&(s.textContent=t.name),document.title=`${t.name} - Navigator`;const a=document.getElementById("code-editor");a&&(a.value=""),es(),Pr(B,R,j,ne),Ar(ts),C("Ready","success"),await ne(),ot(`/edit/${e}`),console.log("Memory image opened successfully")}catch(t){const n=t;C("Error opening memory image: "+n.message,"error"),console.error("Open error:",n)}}async function Bt(){if(R&&R.isDirty()&&!confirm("You have unsaved changes. Close anyway?"))return;const e=document.getElementById("code-editor");e&&(e.value="");const t=document.getElementById("script-history-sidebar");if(t&&t.classList.add("collapsed"),O!=null&&O.close)try{await O.close()}catch{}j=null,ae=null,R=null,B=null,O=void 0,window.root=void 0,ee.reset(),await Je(),console.log("Memory image closed")}const $t="memimg-theme";function Ht(){return localStorage.getItem($t)||"dark"}function Ut(e){localStorage.setItem($t,e),document.documentElement.setAttribute("data-theme",e),ns(e)}function ns(e){const t=e==="dark"?"☀️":"🌙",n=document.getElementById("theme-toggle-list"),r=document.getElementById("theme-toggle-explorer");n&&(n.textContent=t),r&&(r.textContent=t)}function ht(){const t=Ht()==="dark"?"light":"dark";Ut(t)}function rs(){const e=Ht();Ut(e)}function ss(){const e=document.getElementById("create-memimg-btn");e&&e.addEventListener("click",()=>{Lt(Ft,$e)});const t=document.getElementById("back-to-list-btn");t&&t.addEventListener("click",Bt);const n=document.getElementById("back-btn"),r=document.getElementById("forward-btn");n&&n.addEventListener("click",()=>{ee.goBack()}),r&&r.addEventListener("click",()=>{ee.goForward()}),document.addEventListener("keydown",S=>{S.altKey&&S.key==="ArrowLeft"&&(S.preventDefault(),ee.goBack()),S.altKey&&S.key==="ArrowRight"&&(S.preventDefault(),ee.goForward())});const s=document.getElementById("load-scott-btn"),a=document.getElementById("export-snapshot-btn"),o=document.getElementById("export-events-btn"),i=document.getElementById("import-events-btn"),c=document.getElementById("save-btn"),d=document.getElementById("discard-btn"),l=document.getElementById("clear-btn");s&&s.addEventListener("click",Wr),a&&a.addEventListener("click",Jr),o&&o.addEventListener("click",Xr),i&&i.addEventListener("click",()=>{const S=document.getElementById("events-file-input");S&&S.click()}),c&&c.addEventListener("click",Vr),d&&d.addEventListener("click",Gr),l&&l.addEventListener("click",Kr);const u=document.getElementById("events-file-input");u&&u.addEventListener("change",async S=>{var p;const N=S.target,m=(p=N.files)==null?void 0:p[0];m&&(await Zr(m),N.value="")});const g=document.getElementById("run-btn");g&&g.addEventListener("click",async()=>{B&&R&&j&&await Pt(B,R,j,ne)});const y=document.getElementById("toggle-line-numbers-btn");y&&y.addEventListener("click",Tr),window.addEventListener("hashchange",qr),Qr();const v=document.getElementById("theme-toggle-list"),A=document.getElementById("theme-toggle-explorer");v&&v.addEventListener("click",ht),A&&A.addEventListener("click",ht),console.log("Event listeners attached")}(async()=>{try{console.log("Initializing Navigator..."),window.addEventListener("pageshow",n=>{if(n.persisted){const r=document.getElementById("code-editor");r&&(r.value="")}});const e=document.getElementById("code-editor");e&&(e.value=""),rs(),ss();const t=kt();if(t.view==="edit"&&t.memimgId){console.log(`Loading memory image from hash: ${t.memimgId}`);try{await $e(t.memimgId)}catch(n){console.error(`Failed to load memory image from hash: ${t.memimgId}`,n),C(`Could not load memory image: ${t.memimgId}`,"error"),await Je()}}else await Je();console.log("Navigator initialization complete")}catch(e){console.error("Failed to initialize:",e),C("Initialization error: "+e.message,"error")}})();</script>
  <link rel="stylesheet" crossorigin href="./navigator.css">
</head>
<body>
    <div id="app">
        <!-- List View (shown by default) -->
        <div id="list-view" class="view-container">
            <div class="app-title">Filer Navigator</div>
            <header class="list-header">
                <div class="logo">
                    <svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"
                    width="32" height="32" aria-label="Navigator">
                        <circle cx="24" cy="24" r="22" fill="#6366f1"/>
                        <line x1="24" y1="14" x2="16" y2="24" stroke="#fbbf24" stroke-width="2" stroke-linecap="round"/>
                        <line x1="24" y1="14" x2="32" y2="24" stroke="#fbbf24" stroke-width="2" stroke-linecap="round"/>
                        <line x1="16" y1="24" x2="24" y2="34" stroke="#10b981" stroke-width="2" stroke-linecap="round"/>
                        <line x1="32" y1="24" x2="24" y2="34" stroke="#10b981" stroke-width="2" stroke-linecap="round"/>
                        <line x1="16" y1="24" x2="32" y2="24" stroke="#ec4899" stroke-width="2" stroke-linecap="round"/>
                        <circle cx="24" cy="14" r="4" fill="#fef3c7"/>
                        <circle cx="16" cy="24" r="4" fill="#fde68a"/>
                        <circle cx="32" cy="24" r="4" fill="#fde68a"/>
                        <circle cx="24" cy="34" r="4" fill="#fef3c7"/>
                        <circle cx="24" cy="24" r="3" fill="#ffffff"/>
                        <text x="24" y="43" font-family="Arial, sans-serif"
                        font-size="5.5" font-weight="bold" fill="#ffffff"
                        text-anchor="middle" letter-spacing="1.5">Navigator</text>
                    </svg>
                    <h1>Navigator</h1>
                    <span class="subtitle">Memory Image Explorer</span>
                </div>
                <div class="controls">
                    <button id="theme-toggle-list" class="icon-btn" title="Toggle theme">🌙</button>
                    <button id="create-memimg-btn" class="primary-button">+ New Memory Image</button>
                </div>
            </header>
            <div id="memimg-list-content" class="list-content"></div>
        </div>

        <!-- Explorer View (hidden by default) -->
        <div id="explorer-view" class="view-container" style="display: none;">
            <!-- Script History Sidebar -->
            <div id="script-history-sidebar" class="sidebar collapsed">
                <div class="sidebar-header">
                    <h3>Script History</h3>
                    <button id="close-history-btn" class="icon-btn" title="Close history panel">✕</button>
                </div>
                <div class="sidebar-controls">
                    <input type="text" id="history-search" placeholder="Search scripts..." />
                    <button id="export-history-btn" class="icon-btn" title="Export history">📥</button>
                    <button id="clear-history-btn" class="icon-btn" title="Clear history">🗑️</button>
                </div>
                <div class="sidebar-stats">
                    <span class="history-stats"></span>
                </div>
                <div id="history-list" class="sidebar-content"></div>
            </div>

            <div class="app-title">Filer Navigator</div>

            <!-- Header -->
            <header>
                <div class="logo">
                    <svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"
                    width="32" height="32" aria-label="Navigator">
                        <circle cx="24" cy="24" r="22" fill="#6366f1"/>
                        <line x1="24" y1="14" x2="16" y2="24" stroke="#fbbf24" stroke-width="2" stroke-linecap="round"/>
                        <line x1="24" y1="14" x2="32" y2="24" stroke="#fbbf24" stroke-width="2" stroke-linecap="round"/>
                        <line x1="16" y1="24" x2="24" y2="34" stroke="#10b981" stroke-width="2" stroke-linecap="round"/>
                        <line x1="32" y1="24" x2="24" y2="34" stroke="#10b981" stroke-width="2" stroke-linecap="round"/>
                        <line x1="16" y1="24" x2="32" y2="24" stroke="#ec4899" stroke-width="2" stroke-linecap="round"/>
                        <circle cx="24" cy="14" r="4" fill="#fef3c7"/>
                        <circle cx="16" cy="24" r="4" fill="#fde68a"/>
                        <circle cx="32" cy="24" r="4" fill="#fde68a"/>
                        <circle cx="24" cy="34" r="4" fill="#fef3c7"/>
                        <circle cx="24" cy="24" r="3" fill="#ffffff"/>
                        <text x="24" y="43" font-family="Arial, sans-serif"
                        font-size="5.5" font-weight="bold" fill="#ffffff"
                        text-anchor="middle" letter-spacing="1.5">Navigator</text>
                    </svg>
                    <div class="header-info">
                        <button id="back-to-list-btn" class="back-button">← Back to List</button>
                        <h1 id="current-memimg-name">Memory Image</h1>
                    </div>
                </div>
                <div class="controls">
                    <div class="controls-left">
                        <button id="theme-toggle-explorer" class="icon-btn" title="Toggle theme">🌙</button>
                        <span id="dirty-indicator" class="dirty-indicator" style="display: none;">● Unsaved</span>
                        <button id="save-btn" title="Save to IndexedDB">💾 Save</button>
                        <button id="discard-btn" title="Discard unsaved changes" style="display: none;">↩️ Discard</button>
                        <button id="export-events-btn" title="✅ Export event log (NDJSON format - CAN be re-imported)">📜 Export Event Log</button>
                        <button id="import-events-btn" title="Import event log (NDJSON format only - snapshots cannot be imported)">📥 Import Event Log</button>
                        <button id="export-snapshot-btn" title="⚠️  Export current state as JSON (for external use only - CANNOT be re-imported)">📸 Snapshot (External)</button>
                        <button id="clear-btn" title="Clear all data">🗑️ Clear</button>
                    </div>
                    <div class="controls-right">
                        <button id="load-scott-btn" title="Load example data">📂 Load Example</button>
                    </div>
                </div>
                <!-- Hidden file input for import -->
                <input type="file" id="events-file-input" accept=".json,.ndjson,.txt" style="display: none">
                <div id="status" class="status-bar"></div>
            </header>

            <!-- Code editor (TOP panel) -->
            <section id="editor-panel" class="panel">
                <div class="panel-header">
                    <h2>Code Editor</h2>
                    <div class="editor-controls">
                        <button id="toggle-line-numbers-btn" class="icon-btn" title="Toggle line numbers">#</button>
                        <button id="toggle-history-btn" title="Show script history">📜 History</button>
                        <button id="run-btn" title="Run code (Ctrl+Enter)">▶ Run</button>
                    </div>
                </div>
                <div class="editor-wrapper">
                    <div class="line-numbers" id="line-numbers"></div>
                    <div id="code-editor" class="code-editor" spellcheck="false"></div>
                </div>
                <div id="error-panel" class="error-panel" style="display: none;"></div>
            </section>

            <!-- Vertical resize handle -->
            <div class="resize-handle resize-handle-horizontal" data-direction="vertical"></div>

            <!-- Bottom panels (Object Graph) -->
            <main id="bottom-panels">
                <!-- Tree view (left panel) -->
                <section id="tree-panel" class="panel">
                    <div class="panel-header">
                        <h2>Object Graph</h2>
                        <div class="nav-buttons">
                            <button id="back-btn" title="Back (Alt+Left)" disabled>◀</button>
                            <button id="forward-btn" title="Forward (Alt+Right)" disabled>▶</button>
                        </div>
                    </div>
                    <div id="tree-view" class="panel-content"></div>
                </section>

                <!-- Horizontal resize handle -->
                <div class="resize-handle resize-handle-vertical" data-direction="horizontal"></div>

                <!-- Property inspector (right panel) -->
                <section id="inspector-panel" class="panel">
                    <div class="panel-header">
                        <h2>Properties</h2>
                        <span id="selected-path" class="path-display"></span>
                    </div>
                    <div id="inspector-view" class="panel-content"></div>
                </section>
            </main>
        </div>
    </div>

    <!-- Load main module -->
</body>
</html>
