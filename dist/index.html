<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigator - Memory Image Explorer</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg
    viewBox='0 0 48 48' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='24'
    cy='24' r='22' fill='%236366f1'/%3E%3Cline x1='24' y1='14' x2='16' y2='24'
    stroke='%23fbbf24' stroke-width='2' stroke-linecap='round'/%3E%3Cline
    x1='24' y1='14' x2='32' y2='24' stroke='%23fbbf24' stroke-width='2'
    stroke-linecap='round'/%3E%3Cline x1='16' y1='24' x2='24' y2='34'
    stroke='%2310b981' stroke-width='2' stroke-linecap='round'/%3E%3Cline
    x1='32' y1='24' x2='24' y2='34' stroke='%2310b981' stroke-width='2'
    stroke-linecap='round'/%3E%3Cline x1='16' y1='24' x2='32' y2='24'
    stroke='%23ec4899' stroke-width='2' stroke-linecap='round'/%3E%3Ccircle
    cx='24' cy='14' r='4' fill='%23fef3c7'/%3E%3Ccircle cx='16' cy='24' r='4'
    fill='%23fde68a'/%3E%3Ccircle cx='32' cy='24' r='4'
    fill='%23fde68a'/%3E%3Ccircle cx='24' cy='34' r='4'
    fill='%23fef3c7'/%3E%3Ccircle cx='24' cy='24' r='3'
    fill='%23ffffff'/%3E%3Ctext x='24' y='43' font-family='Arial, sans-serif'
    font-size='5.5' font-weight='bold' fill='%23ffffff' text-anchor='middle'
    letter-spacing='1.5'%3ENavigator%3C/text%3E%3C/svg%3E">
    <style rel="stylesheet">:root,[data-theme=dark]{--bg-primary: #1e1e1e;--bg-secondary: #252526;--bg-tertiary: #2d2d30;--bg-hover: #2a2d2e;--bg-active: #094771;--bg-input: #1e1e1e;--border-primary: #3e3e42;--border-hover: #555;--text-primary: #d4d4d4;--text-secondary: #cccccc;--text-muted: #858585;--text-disabled: #666;--accent-primary: #0e639c;--accent-hover: #1177bb;--accent-active: #0d5a8f;--error-bg: #5a1d1d;--error-text: #f48771;--error-border: #f48771;--success-text: #89d185;--code-property: #9cdcfe;--code-value: #ce9178;--code-type: #4ec9b0;--scrollbar-track: #1e1e1e;--scrollbar-thumb: #424242;--scrollbar-thumb-hover: #4e4e4e;--shadow-color: rgba(0, 0, 0, .3);--overlay-bg: rgba(0, 0, 0, .7)}[data-theme=light]{--bg-primary: #ffffff;--bg-secondary: #f3f3f3;--bg-tertiary: #e8e8e8;--bg-hover: #e0e0e0;--bg-active: #0078d4;--bg-input: #ffffff;--border-primary: #d4d4d4;--border-hover: #a0a0a0;--text-primary: #333333;--text-secondary: #1e1e1e;--text-muted: #666666;--text-disabled: #a0a0a0;--accent-primary: #0078d4;--accent-hover: #106ebe;--accent-active: #005a9e;--error-bg: #fde7e9;--error-text: #d13438;--error-border: #d13438;--success-text: #107c10;--code-property: #0070c1;--code-value: #a31515;--code-type: #008080;--scrollbar-track: #f3f3f3;--scrollbar-thumb: #c0c0c0;--scrollbar-thumb-hover: #a8a8a8;--shadow-color: rgba(0, 0, 0, .15);--overlay-bg: rgba(0, 0, 0, .4)}*{box-sizing:border-box;margin:0;padding:0}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;height:100vh;display:flex;flex-direction:column;background:var(--bg-primary);color:var(--text-primary);overflow:hidden}#app{display:flex;flex-direction:column;height:100vh}.app-title{background:var(--bg-tertiary);color:var(--text-secondary);text-align:center;padding:8px 16px;font-size:14px;font-weight:600;letter-spacing:.5px;border-bottom:1px solid var(--border-primary);flex-shrink:0}header{background:var(--bg-secondary);border-bottom:1px solid var(--border-primary);flex-shrink:0}.logo{display:flex;align-items:center;gap:12px;padding:10px 16px}.logo img{width:32px;height:32px}.logo h1{font-size:20px;font-weight:600;color:var(--text-secondary);margin:0}.logo .subtitle{font-size:12px;color:var(--text-muted);font-weight:400}.controls{display:flex;gap:8px;padding:8px 16px;align-items:center;border-top:1px solid var(--border-primary);justify-content:space-between}.controls-left,.controls-right{display:flex;gap:8px;align-items:center}.status-bar{padding:6px 16px;font-size:12px;color:var(--text-muted);border-top:1px solid var(--border-primary);min-height:28px}.status-bar.error{color:var(--error-text);background:var(--error-bg)}.status-bar.success{color:var(--success-text)}.dirty-indicator{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;margin-right:4px;background:var(--error-bg);border:1px solid var(--error-border);border-radius:3px;color:var(--error-text);font-size:11px;font-weight:600;letter-spacing:.5px;animation:pulse 2s ease-in-out infinite}@keyframes pulse{0%,to{box-shadow:0 0 #f48771b3}50%{box-shadow:0 0 0 3px #f4877100}}button{background:var(--accent-primary);color:#fff;border:none;padding:6px 14px;border-radius:2px;cursor:pointer;font-size:13px;transition:background .2s}button:hover{background:var(--accent-hover)}button:active{background:var(--accent-active)}button:disabled{background:var(--border-hover);cursor:not-allowed;opacity:.5}#bottom-panels{flex:1;display:flex;flex-direction:row;overflow:hidden;min-height:150px}.panel{display:flex;flex-direction:column;overflow:hidden}#tree-panel{flex:1;border-right:1px solid var(--border-primary)}#inspector-panel{flex:1}.panel-header{background:var(--bg-tertiary);padding:10px 16px;font-size:13px;font-weight:600;color:var(--text-secondary);border-bottom:1px solid var(--border-primary);display:flex;align-items:center;justify-content:space-between;flex-shrink:0}.panel-header h2{font-size:13px;font-weight:600;margin:0}.nav-buttons{display:flex;gap:4px}.nav-buttons button{background:var(--border-primary);color:var(--text-secondary);border:none;padding:4px 10px;border-radius:2px;cursor:pointer;font-size:12px;transition:background .2s;min-width:32px}.nav-buttons button:hover:not(:disabled){background:var(--border-hover)}.nav-buttons button:active:not(:disabled){background:var(--bg-tertiary)}.nav-buttons button:disabled{background:var(--bg-tertiary);color:var(--text-disabled);cursor:not-allowed;opacity:.5}.panel-content{flex:1;overflow:auto;padding:12px;background:var(--bg-primary)}.path-display{font-size:11px;color:var(--text-muted);font-family:Consolas,Monaco,monospace}.tree-node{-webkit-user-select:none;user-select:none;margin:2px 0}.tree-node-header{display:flex;align-items:center;padding:3px 6px;cursor:pointer;border-radius:3px}.tree-node-header:hover{background:var(--bg-hover)}.tree-node-header.selected{background:var(--bg-active)}.tree-toggle{width:16px;height:16px;display:inline-flex;align-items:center;justify-content:center;font-size:10px;margin-right:4px;color:var(--text-secondary);flex-shrink:0}.tree-toggle.collapsed:before{content:"▶"}.tree-toggle.expanded:before{content:"▼"}.tree-toggle.leaf{visibility:hidden}.tree-icon{margin-right:6px;font-size:14px;flex-shrink:0}.tree-label{font-size:13px;color:var(--text-secondary)}.tree-children{margin-left:20px;display:none}.tree-children.expanded{display:block}.property-table{width:100%;border-collapse:collapse;font-size:13px}.property-table th{text-align:left;padding:10px 12px;background:var(--bg-tertiary);border-bottom:1px solid var(--border-primary);font-weight:600;color:var(--text-secondary)}.property-table td{padding:8px 12px;border-bottom:1px solid var(--border-primary);vertical-align:top}.property-name{color:var(--code-property);font-family:Consolas,Monaco,monospace}.property-value{color:var(--code-value);font-family:Consolas,Monaco,monospace;word-break:break-word}.property-value.clickable{cursor:pointer;text-decoration:underline}.property-value.clickable:hover{color:var(--code-value);opacity:.8}.property-type{color:var(--code-type);font-size:11px;font-style:italic;margin-left:8px}.empty-state{color:var(--text-muted);font-size:13px;padding:24px;text-align:center}#editor-panel{border-bottom:1px solid var(--border-primary);flex:1;min-height:150px;display:flex;flex-direction:column}.editor-wrapper{flex:1;display:flex;position:relative;overflow:hidden;background:var(--bg-primary);min-height:0}.line-numbers{background:var(--bg-primary);color:var(--text-muted);padding:16px 8px;text-align:right;font-family:Consolas,Monaco,Courier New,monospace;font-size:14px;line-height:1.5;-webkit-user-select:none;user-select:none;border-right:1px solid var(--border-primary);overflow-y:auto;overflow-x:hidden;white-space:pre;flex-shrink:0}.code-editor{flex:1;font-family:Consolas,Monaco,Courier New,monospace;font-size:14px;padding:16px;background:var(--bg-primary);color:var(--text-primary);border:none;outline:none;-moz-tab-size:2;tab-size:2;line-height:1.5;overflow-y:auto;overflow-x:auto;white-space:pre;overflow-wrap:normal}.code-editor>div{min-height:100%;outline:none}.code-editor .token.comment,.code-editor .token.prolog,.code-editor .token.doctype,.code-editor .token.cdata{color:#6a9955}.code-editor .token.punctuation{color:var(--text-primary)}.code-editor .token.property,.code-editor .token.tag,.code-editor .token.boolean,.code-editor .token.number,.code-editor .token.constant,.code-editor .token.symbol{color:#b5cea8}.code-editor .token.selector,.code-editor .token.attr-name,.code-editor .token.string,.code-editor .token.char,.code-editor .token.builtin{color:#ce9178}.code-editor .token.operator,.code-editor .token.entity,.code-editor .token.url,.code-editor .token.variable{color:var(--text-primary)}.code-editor .token.atrule,.code-editor .token.attr-value,.code-editor .token.keyword{color:#569cd6}.code-editor .token.function,.code-editor .token.class-name{color:#dcdcaa}.code-editor .token.regex,.code-editor .token.important{color:#d16969}.error-panel{background:var(--error-bg);border-top:2px solid var(--error-border);padding:12px 16px;font-family:Consolas,Monaco,Courier New,monospace;font-size:12px;color:var(--error-text);line-height:1.6;white-space:pre-wrap;word-wrap:break-word;max-height:120px;overflow-y:auto}::-webkit-scrollbar{width:12px;height:12px}::-webkit-scrollbar-track{background:var(--scrollbar-track)}::-webkit-scrollbar-thumb{background:var(--scrollbar-thumb);border-radius:6px}::-webkit-scrollbar-thumb:hover{background:var(--scrollbar-thumb-hover)}.view-container{display:flex;flex-direction:column;height:100vh;width:100%}#explorer-view{display:flex;flex-direction:column;overflow:hidden}.list-header{background:var(--bg-secondary);border-bottom:1px solid var(--border-primary);padding:16px 24px;flex-shrink:0}.list-header .logo{display:flex;align-items:center;gap:12px;margin-bottom:16px}.list-header .controls{display:flex;gap:8px;justify-content:flex-end}.list-content{flex:1;overflow-y:auto;padding:32px;background:var(--bg-primary)}.memimg-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:24px;max-width:1400px;margin:0 auto}.memimg-card{background:var(--bg-secondary);border:1px solid var(--border-primary);border-radius:6px;padding:20px;cursor:pointer;transition:all .2s ease;display:flex;flex-direction:column;gap:12px}.memimg-card:hover{border-color:var(--accent-primary);transform:translateY(-2px);box-shadow:0 4px 12px var(--shadow-color)}.card-header{display:flex;justify-content:space-between;align-items:flex-start;gap:12px}.card-title{font-size:18px;font-weight:600;color:var(--text-secondary);margin:0;flex:1;word-break:break-word}.card-actions{display:flex;gap:4px;flex-shrink:0}.icon-btn{background:transparent;border:1px solid var(--border-primary);padding:4px 8px;border-radius:3px;cursor:pointer;font-size:14px;transition:all .2s;min-width:unset}.icon-btn:hover{background:var(--border-primary);border-color:var(--border-hover)}.icon-btn:active{background:var(--bg-tertiary)}.card-body{flex:1;display:flex;flex-direction:column;gap:12px}.card-description{color:var(--text-muted);font-size:14px;line-height:1.5;margin:0;min-height:42px}.card-description em{opacity:.6}.card-meta{display:flex;flex-direction:column;gap:6px;font-size:12px;color:var(--text-disabled)}.meta-item{display:flex;align-items:center;gap:6px}.card-footer{display:flex;justify-content:flex-end;padding-top:12px;border-top:1px solid var(--border-primary)}.open-btn{background:var(--accent-primary);color:#fff;border:none;padding:8px 16px;border-radius:3px;cursor:pointer;font-size:14px;font-weight:600;transition:background .2s}.open-btn:hover{background:var(--accent-hover)}.empty-state{text-align:center;padding:80px 24px;color:var(--text-muted)}.empty-icon{font-size:64px;margin-bottom:24px}.empty-state h2{font-size:24px;color:var(--text-secondary);margin:0 0 12px}.empty-state p{font-size:16px;margin:0 0 24px}.primary-button{background:var(--accent-primary);color:#fff;border:none;padding:10px 20px;border-radius:3px;cursor:pointer;font-size:14px;font-weight:600;transition:background .2s}.primary-button:hover{background:var(--accent-hover)}.error-state{text-align:center;padding:80px 24px;color:var(--error-text)}.error-state h2{font-size:24px;margin:0 0 12px}.error-state p{font-size:16px;margin:0}.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--overlay-bg);display:flex;align-items:center;justify-content:center;z-index:1000;animation:fadeIn .2s ease}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.modal-dialog{background:var(--bg-secondary);border:1px solid var(--border-primary);border-radius:6px;width:90%;max-width:500px;max-height:90vh;overflow:hidden;display:flex;flex-direction:column;animation:slideIn .2s ease}@keyframes slideIn{0%{transform:translateY(-20px);opacity:0}to{transform:translateY(0);opacity:1}}.modal-header{padding:20px 24px;border-bottom:1px solid var(--border-primary);display:flex;justify-content:space-between;align-items:center}.modal-header h2{font-size:18px;font-weight:600;color:var(--text-secondary);margin:0}.modal-close{background:transparent;border:none;color:var(--text-muted);font-size:28px;line-height:1;cursor:pointer;padding:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:3px;transition:all .2s}.modal-close:hover{background:var(--border-primary);color:var(--text-secondary)}.modal-body{padding:24px;overflow-y:auto;flex:1}.form-group{margin-bottom:20px}.form-group:last-child{margin-bottom:0}.form-group label{display:block;margin-bottom:8px;color:var(--text-secondary);font-size:14px;font-weight:600}.form-input,.form-textarea{width:100%;background:var(--bg-input);border:1px solid var(--border-primary);border-radius:3px;padding:10px 12px;color:var(--text-primary);font-size:14px;font-family:inherit;transition:border-color .2s}.form-input:focus,.form-textarea:focus{outline:none;border-color:var(--accent-primary)}.form-textarea{resize:vertical;font-family:inherit}.modal-footer{padding:16px 24px;border-top:1px solid var(--border-primary);display:flex;justify-content:flex-end;gap:12px}.cancel-btn{background:transparent;border:1px solid var(--border-primary);color:var(--text-secondary);padding:8px 16px;border-radius:3px;cursor:pointer;font-size:14px;transition:all .2s}.cancel-btn:hover{background:var(--border-primary);border-color:var(--border-hover)}.save-btn,.create-btn{background:var(--accent-primary);color:#fff;border:none;padding:8px 16px;border-radius:3px;cursor:pointer;font-size:14px;font-weight:600;transition:background .2s}.save-btn:hover,.create-btn:hover{background:var(--accent-hover)}.header-info{display:flex;flex-direction:column;gap:8px}.back-button{background:transparent;border:1px solid var(--border-primary);color:var(--text-muted);padding:4px 12px;border-radius:3px;cursor:pointer;font-size:13px;align-self:flex-start;transition:all .2s}.back-button:hover{background:var(--border-primary);color:var(--text-secondary);border-color:var(--border-hover)}#current-memimg-name{font-size:16px;margin:0;color:var(--text-secondary)}.resize-handle{background:var(--border-primary);flex-shrink:0;position:relative;z-index:10;transition:background .2s}.resize-handle:hover{background:var(--accent-primary)}.resize-handle:active{background:var(--accent-hover)}.resize-handle-horizontal{height:4px;cursor:ns-resize;width:100%}.resize-handle-vertical{width:4px;cursor:ew-resize;height:100%}.sidebar{position:fixed;left:0;top:0;bottom:0;width:400px;background:var(--bg-secondary);border-right:1px solid var(--border-primary);transform:translate(0);transition:transform .3s ease;z-index:1000;display:flex;flex-direction:column;box-shadow:2px 0 8px var(--shadow-color)}.sidebar.collapsed{transform:translate(-400px)}.sidebar-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid var(--border-primary);background:var(--bg-tertiary)}.sidebar-header h3{font-size:15px;font-weight:600;color:var(--text-secondary);margin:0}.sidebar-controls{display:flex;gap:8px;padding:12px 16px;border-bottom:1px solid var(--border-primary);background:var(--bg-secondary)}#history-search{flex:1;background:var(--bg-primary);border:1px solid var(--border-primary);border-radius:3px;padding:6px 10px;color:var(--text-primary);font-size:13px;outline:none}#history-search:focus{border-color:var(--accent-primary)}.sidebar-stats{padding:8px 16px;font-size:11px;color:var(--text-muted);border-bottom:1px solid var(--border-primary);background:var(--bg-secondary)}.sidebar-content{flex:1;overflow-y:auto;background:var(--bg-primary)}.history-entry{padding:12px 16px;border-bottom:1px solid var(--border-primary);transition:background .2s}.history-entry:hover{background:var(--bg-hover)}.history-entry-header{display:flex;align-items:center;gap:8px;margin-bottom:8px}.history-status{color:var(--success-text);font-size:8px;line-height:1}.history-timestamp{font-size:11px;color:var(--text-muted);flex:1}.history-size{font-size:11px;color:var(--text-disabled)}.history-code{margin-bottom:8px}.history-code pre{font-family:Consolas,Monaco,monospace;font-size:12px;color:var(--text-primary);background:var(--bg-primary);padding:8px 10px;border-radius:3px;border:1px solid var(--border-primary);margin:0;overflow-x:auto;white-space:pre-wrap;word-wrap:break-word;line-height:1.4}.history-code.expandable pre{cursor:pointer}.history-actions{display:flex;gap:6px;flex-wrap:wrap}.history-btn{background:transparent;border:1px solid var(--border-primary);color:var(--text-secondary);padding:4px 10px;border-radius:3px;cursor:pointer;font-size:11px;transition:all .2s;white-space:nowrap}.history-btn:hover{background:var(--border-primary);border-color:var(--border-hover)}.history-btn:active{background:var(--bg-tertiary)}.history-empty,.history-error{padding:40px 24px;text-align:center;color:var(--text-muted);font-size:13px}.history-error{color:var(--error-text)}.editor-controls{display:flex;gap:8px;align-items:center}#toggle-history-btn{background:transparent;border:1px solid var(--border-primary);color:var(--text-secondary);padding:6px 12px}#toggle-history-btn:hover{background:var(--border-primary);border-color:var(--border-hover)}#theme-toggle-list,#theme-toggle-explorer{min-width:36px;font-size:18px;padding:6px 10px}#toggle-line-numbers-btn{color:var(--text-secondary);font-weight:700;font-size:16px}.value-navigable{cursor:pointer}.value-navigable:hover{opacity:.8}.value-null,.value-undefined{color:var(--text-muted);font-style:italic}.value-string{color:var(--code-value)}.value-number{color:#b5cea8}.value-boolean{color:#569cd6}.value-bigint{color:#b5cea8}.value-symbol{color:#ce9178}.value-date{color:#4fc1ff}.value-function,.value-array,.value-map,.value-set,.value-object{color:var(--code-type)}[data-theme=light] .value-number,[data-theme=light] .value-bigint{color:#098658}[data-theme=light] .value-boolean{color:#00f}[data-theme=light] .value-symbol{color:#a31515}[data-theme=light] .value-date{color:#0078d4}.inspector-tabs{display:flex;flex-direction:column;height:100%}.tab-headers{display:flex;border-bottom:1px solid var(--border-primary);background:var(--bg-secondary);flex-shrink:0}.tab-header{background:transparent;border:none;border-bottom:2px solid transparent;padding:10px 20px;cursor:pointer;font-size:13px;font-weight:500;color:var(--text-muted);transition:all .2s;position:relative}.tab-header:hover:not(:disabled){color:var(--text-secondary);background:var(--bg-hover)}.tab-header.active{color:var(--accent-primary);border-bottom-color:var(--accent-primary);font-weight:600}.tab-header:disabled{color:var(--text-disabled);cursor:not-allowed;opacity:.5}.tab-content{flex:1;overflow:auto;background:var(--bg-primary)}.tab-panel{display:none;padding:12px}.tab-panel.active{display:block}.collections-panel{display:flex;flex-direction:column;gap:16px}.collection-section{border:1px solid var(--border-primary);border-radius:4px;background:var(--bg-secondary);padding:12px}.collection-header{color:var(--code-property);font-family:Consolas,Monaco,monospace;font-size:14px;font-weight:600;margin:0 0 12px;padding-bottom:8px;border-bottom:1px solid var(--border-primary)}.collection-items{list-style:none;padding:0;margin:0}.collection-item{padding:6px 8px;border-radius:3px;font-family:Consolas,Monaco,monospace;font-size:13px;transition:background .2s}.collection-item:hover{background:var(--bg-hover)}.item-label{color:var(--text-muted);margin-right:4px}.item-value{color:var(--code-value)}.value-nested{color:var(--code-type);cursor:pointer;display:inline-flex;align-items:center;font-family:Consolas,Monaco,monospace}.value-nested-toggle{display:inline-block;width:14px;height:14px;margin-right:4px;font-size:10px;color:var(--text-muted)}.value-nested-toggle.collapsed:before{content:"▶"}.value-nested-toggle.expanded:before{content:"▼"}.value-nested-summary{color:var(--code-type);text-decoration:underline}.value-nested:hover .value-nested-summary{opacity:.8}.nested-properties{display:none;margin-top:8px;padding-left:24px;border-left:2px solid var(--border-primary)}.nested-properties.expanded{display:block}.nested-prop{padding:4px 0;font-size:12px}.nested-prop-key{color:var(--code-property);margin-right:6px}.nested-prop-value{color:var(--code-value)}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.comment,.token.prolog,.token.doctype,.token.cdata{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.property,.token.tag,.token.constant,.token.symbol,.token.deleted{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.selector,.token.attr-name,.token.string,.token.char,.token.builtin,.token.inserted{color:#a6e22e}.token.operator,.token.entity,.token.url,.language-css .token.string,.style .token.string,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.function,.token.class-name{color:#e6db74}.token.keyword{color:#66d9ef}.token.regex,.token.important{color:#fd971f}.token.important,.token.bold{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style>
    <!-- JavaScript Type System - Inlined for file:// protocol compatibility -->
    <script>
(function(global) {
  'use strict';

  function Type(name) {
    this.typeName = name;
  }

  Type.prototype.check = function(value) {
    throw new Error(`${this.typeName}.check() not implemented`);
  };

  function PrimitiveType(name) {
    Type.call(this, name);
  }

  PrimitiveType.prototype = Object.create(Type.prototype);
  PrimitiveType.prototype.constructor = PrimitiveType;

  PrimitiveType.prototype.check = function(value) {
    switch(this.typeName) {
      case 'number': return typeof value === 'number';
      case 'string': return typeof value === 'string';
      case 'boolean': return typeof value === 'boolean';
      case 'bigint': return typeof value === 'bigint';
      case 'symbol': return typeof value === 'symbol';
      case 'undefined': return value === undefined;
      case 'null': return value === null;
      default: return false;
    }
  };

  const NumberType = new PrimitiveType('number');
  const StringType = new PrimitiveType('string');
  const BooleanType = new PrimitiveType('boolean');
  const BigIntType = new PrimitiveType('bigint');
  const SymbolType = new PrimitiveType('symbol');
  const UndefinedType = new PrimitiveType('undefined');
  const NullType = new PrimitiveType('null');

  function ObjectType({name, properties = {}, prototype = null}) {
    const factory = function(props = {}) {
      const instance = Object.create(factory.prototype);

      Object.keys(properties).forEach(propName => {
        if (propName in props) {
          instance[propName] = props[propName];
        }
      });

      Object.defineProperty(instance, '__type__', {
        value: factory,
        writable: false,
        enumerable: false,
        configurable: false
      });

      return instance;
    };

    if (prototype) {
      factory.prototype = Object.create(prototype);
    } else {
      factory.prototype = {};
    }

    factory.typeName = name;
    factory.properties = properties;

    Object.setPrototypeOf(factory, ObjectType.prototype);
    Type.call(factory, name);

    return factory;
  }

  Type.call(ObjectType, 'ObjectType');
  ObjectType.prototype = Object.create(Type.prototype);
  ObjectType.prototype.constructor = ObjectType;

  ObjectType.prototype.check = function(value) {
    return typeof value === 'object' && value !== null && value.__type__ === this;
  };

  function FunctionType({name, signature = null}) {
    Type.call(this, name);
    this.signature = signature;
  }

  FunctionType.prototype = Object.create(Type.prototype);
  FunctionType.prototype.constructor = FunctionType;

  FunctionType.prototype.check = function(value) {
    return typeof value === 'function';
  };

  function ArrayType(elementType = null) {
    Type.call(this, elementType ? `Array<${elementType.typeName}>` : 'Array');
    this.elementType = elementType;
  }

  ArrayType.prototype = Object.create(Type.prototype);
  ArrayType.prototype.constructor = ArrayType;

  ArrayType.prototype.check = function(value) {
    return Array.isArray(value);
  };

  const ArrayTypeInstance = new ArrayType();

  function SetType(elementType = null) {
    Type.call(this, elementType ? `Set<${elementType.typeName}>` : 'Set');
    this.elementType = elementType;
  }

  SetType.prototype = Object.create(Type.prototype);
  SetType.prototype.constructor = SetType;

  SetType.prototype.check = function(value) {
    return value instanceof Set;
  };

  const SetTypeInstance = new SetType();

  function MapType(keyType = null, valueType = null) {
    const keyPart = keyType ? keyType.typeName : '*';
    const valuePart = valueType ? valueType.typeName : '*';
    Type.call(this, `Map<${keyPart}, ${valuePart}>`);
    this.keyType = keyType;
    this.valueType = valueType;
  }

  MapType.prototype = Object.create(Type.prototype);
  MapType.prototype.constructor = MapType;

  MapType.prototype.check = function(value) {
    return value instanceof Map;
  };

  const MapTypeInstance = new MapType();

  function DateType() {
    Type.call(this, 'Date');
  }

  DateType.prototype = Object.create(Type.prototype);
  DateType.prototype.constructor = DateType;

  DateType.prototype.check = function(value) {
    return value instanceof Date;
  };

  const DateTypeInstance = new DateType();

  const JSTypes = {
    Type,
    PrimitiveType,
    NumberType,
    StringType,
    BooleanType,
    BigIntType,
    SymbolType,
    UndefinedType,
    NullType,
    ObjectType,
    FunctionType,
    ArrayType,
    ArrayTypeInstance,
    SetType,
    SetTypeInstance,
    MapType,
    MapTypeInstance,
    DateType,
    DateTypeInstance
  };

  global.JSTypes = JSTypes;
  global.Type = Type;
  global.PrimitiveType = PrimitiveType;
  global.NumberType = NumberType;
  global.StringType = StringType;
  global.BooleanType = BooleanType;
  global.BigIntType = BigIntType;
  global.SymbolType = SymbolType;
  global.UndefinedType = UndefinedType;
  global.NullType = NullType;
  global.ObjectType = ObjectType;
  global.FunctionType = FunctionType;
  global.ArrayType = ArrayType;
  global.SetType = SetType;
  global.MapType = MapType;
  global.DateType = DateType;
  global.DateTypeInstance = DateTypeInstance;

})(typeof window !== 'undefined' ? window : global);
    </script>
  <script type="module" crossorigin>(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))r(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const o of a.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&r(o)}).observe(document,{childList:!0,subtree:!0});function n(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerPolicy&&(a.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?a.credentials="include":s.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function r(s){if(s.ep)return;s.ep=!0;const a=n(s);fetch(s.href,a)}})();const C={SET:"SET",DELETE:"DELETE",ARRAY_PUSH:"ARRAY_PUSH",ARRAY_POP:"ARRAY_POP",ARRAY_SHIFT:"ARRAY_SHIFT",ARRAY_UNSHIFT:"ARRAY_UNSHIFT",ARRAY_SPLICE:"ARRAY_SPLICE",ARRAY_SORT:"ARRAY_SORT",ARRAY_REVERSE:"ARRAY_REVERSE",ARRAY_FILL:"ARRAY_FILL",ARRAY_COPYWITHIN:"ARRAY_COPYWITHIN",MAP_SET:"MAP_SET",MAP_DELETE:"MAP_DELETE",MAP_CLEAR:"MAP_CLEAR",SET_ADD:"SET_ADD",SET_DELETE:"SET_DELETE",SET_CLEAR:"SET_CLEAR",SCRIPT:"SCRIPT"},Ee={TYPE:"__type__"};var W=(e=>(e[e.NULL=0]="NULL",e[e.UNDEFINED=1]="UNDEFINED",e[e.PRIMITIVE=2]="PRIMITIVE",e[e.BIGINT=3]="BIGINT",e[e.SYMBOL=4]="SYMBOL",e[e.DATE=5]="DATE",e[e.FUNCTION=6]="FUNCTION",e[e.ARRAY=7]="ARRAY",e[e.MAP=8]="MAP",e[e.SET=9]="SET",e[e.OBJECT=10]="OBJECT",e))(W||{});function Bt(e){if(e===null)return{category:0,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!1};if(e===void 0)return{category:1,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!1};const t=typeof e;return t==="string"||t==="number"||t==="boolean"?{category:2,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!1}:t==="bigint"?{category:3,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!0}:t==="symbol"?{category:4,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!0}:e instanceof Date?{category:5,isPrimitive:!1,isObject:!0,isCollection:!1,needsSpecialSerialization:!0}:t==="function"?{category:6,isPrimitive:!1,isObject:!0,isCollection:!1,needsSpecialSerialization:!0}:Array.isArray(e)?{category:7,isPrimitive:!1,isObject:!0,isCollection:!0,needsSpecialSerialization:!1}:e instanceof Map?{category:8,isPrimitive:!1,isObject:!0,isCollection:!0,needsSpecialSerialization:!0}:e instanceof Set?{category:9,isPrimitive:!1,isObject:!0,isCollection:!0,needsSpecialSerialization:!0}:{category:10,isPrimitive:!1,isObject:!0,isCollection:!1,needsSpecialSerialization:!1}}class $t{constructor(){this.seen=new Map}hasSeen(t){return this.seen.has(t)}markSeen(t,n){this.seen.set(t,n)}getReference(t){return this.seen.has(t)?{__type__:"ref",path:this.seen.get(t)||[]}:null}}class Ht{constructor(t,n){this.targetToPath=t,this.currentPath=n,this.seen=new WeakSet}hasSeen(t){return this.seen.has(t)}markSeen(t,n){this.seen.add(t)}getReference(t){const n=this.targetToPath.get(t);return n&&n.length>0&&!(n.length>=this.currentPath.length&&this.currentPath.every((s,a)=>s===n[a]))?{__type__:"ref",path:n}:this.hasSeen(t)?{__type__:"circular"}:null}}function ye(e,t,n,r){const s=Bt(e);switch(s.category){case W.NULL:case W.UNDEFINED:return e;case W.PRIMITIVE:return e;case W.BIGINT:return{[Ee.TYPE]:"bigint",value:e.toString()};case W.SYMBOL:return{[Ee.TYPE]:"symbol",description:e.description};case W.DATE:return{[Ee.TYPE]:"date",value:e.toISOString()};case W.FUNCTION:{const a=e;return a.__type__==="function"?{[Ee.TYPE]:"function",sourceCode:a.sourceCode||e.toString()}:void 0}case W.MAP:case W.SET:case W.ARRAY:case W.OBJECT:{const a=r.get(e)||e,o=n.getReference(a);if(o)return o;if(n.markSeen(a,t),s.category===W.MAP)return{[Ee.TYPE]:"map",entries:Array.from(a.entries()).map(([l,d],f)=>[ye(l,[...t,"key",String(f)],n,r),ye(d,[...t,"value",String(f)],n,r)])};if(s.category===W.SET)return{[Ee.TYPE]:"set",values:Array.from(a.values()).map((l,d)=>ye(l,[...t,String(d)],n,r))};if(s.category===W.ARRAY)return e.map((l,d)=>ye(l,[...t,String(d)],n,r));const i={},c=e;for(const l in c)Object.prototype.hasOwnProperty.call(c,l)&&(i[l]=ye(c[l],[...t,l],n,r));return i}default:return}}const pt=(e,t)=>{const n=new $t,r=ye(e,[],n,t);return JSON.stringify(r,null,2)},ae=(e,t,n,r)=>{const s=new Ht(n,r);return ye(e,r,s,t)},jt=e=>typeof e=="object"&&e!==null&&"__type__"in e&&typeof e.__type__=="string",mt=e=>{const n=new Function(`return (${e.sourceCode})`)();return n.__type__="function",n.sourceCode=e.sourceCode,n},gt=e=>new Date(e.value),yt=e=>BigInt(e.value),ht=e=>Symbol(e.description),rt=e=>typeof e=="object"&&e!==null&&"__unresolved_ref__"in e,Ut=(e,t)=>{var r,s;const n=new Map;for(const[a,o]of e.entries){const i=typeof a=="object"&&a!==null&&a.__type__&&((r=Z[a.__type__])==null?void 0:r.call(Z,a,t))||a,c=typeof o=="object"&&o!==null&&o.__type__&&((s=Z[o.__type__])==null?void 0:s.call(Z,o,t))||o;n.set(i,c)}return n},Yt=(e,t)=>{var r;const n=new Set;for(const s of e.values){const a=typeof s=="object"&&s!==null&&s.__type__&&((r=Z[s.__type__])==null?void 0:r.call(Z,s,t))||s;n.add(a)}return n},Z={function:e=>mt(e),date:e=>gt(e),bigint:e=>yt(e),symbol:e=>ht(e),ref:e=>({__unresolved_ref__:e.path}),map:(e,t)=>Ut(e,t),set:(e,t)=>Yt(e,t)},qt=e=>{const t=typeof e=="string"?JSON.parse(e):e,n=[];function r(s,a=[]){if(s===null||typeof s!="object")return s;if(s.__type__&&Z[s.__type__]){const o=Z[s.__type__];if(!o)return s;const i=o(s,t);return i&&rt(i)&&n.push({parent:null,key:null,path:i.__unresolved_ref__}),i}for(const o in s)if(Object.prototype.hasOwnProperty.call(s,o)){const i=s[o];if(i&&typeof i=="object")if(i.__type__&&Z[i.__type__]){const c=Z[i.__type__];if(!c)continue;const l=c(i,t);l&&rt(l)?n.push({parent:s,key:o,path:l.__unresolved_ref__}):s[o]=l}else r(i,[...a,o])}return s}r(t);for(const s of n){const{parent:a,key:o,path:i}=s;let c=t;for(const l of i)if(c=c[l],c===void 0)throw new Error(`Cannot resolve reference path: ${i.join(".")}`);a&&o!==null&&(a[o]=c)}return t},G=(e,t,n=new WeakMap)=>{if(e==null||typeof e!="object")return e;if(n.has(e))return n.get(e);if(jt(e)){const s=e;switch(s.__type__){case"function":return mt(s);case"date":return gt(s);case"bigint":return yt(s);case"symbol":return ht(s);case"ref":{const a=s;let o=t;for(const i of a.path)if(o=o[i],o===void 0)throw new Error(`Cannot resolve ref path: ${a.path.join(".")}`);return o}case"map":{const a=s,o=new Map;n.set(e,o);for(const[i,c]of a.entries){const l=G(i,t,n),d=G(c,t,n);o.set(l,d)}return o}case"set":{const a=s,o=new Set;n.set(e,o);for(const i of a.values)o.add(G(i,t,n));return o}case"circular":throw new Error("Encountered explicit circular marker - this indicates a serialization issue")}}if(Array.isArray(e)){const s=[];n.set(e,s);for(const a of e)s.push(G(a,t,n));return s}const r={};n.set(e,r);for(const s in e)Object.prototype.hasOwnProperty.call(e,s)&&(r[s]=G(e[s],t,n));return r};class zt{createEvent(t,n,r){const[s]=n;return{type:C.SET,path:t,value:ae(s,r.proxyToTarget,r.targetToPath,t),timestamp:Date.now()}}applyEvent(t,n,r,s){const a=t;n[r]=G(a.value,s)}}class Wt{createEvent(t){return{type:C.DELETE,path:t,timestamp:Date.now()}}applyEvent(t,n,r){delete n[r]}}class Gt{createEvent(t,n,r){return{type:C.ARRAY_PUSH,path:t,items:n.map(s=>ae(s,r.proxyToTarget,r.targetToPath,t)),timestamp:Date.now()}}applyEvent(t,n,r,s){const a=t,o=n[r];for(const i of a.items)o.push(G(i,s))}}class Vt{createEvent(t){return{type:C.ARRAY_POP,path:t,timestamp:Date.now()}}applyEvent(t,n,r){n[r].pop()}}class Jt{createEvent(t){return{type:C.ARRAY_SHIFT,path:t,timestamp:Date.now()}}applyEvent(t,n,r){n[r].shift()}}class Kt{createEvent(t,n,r){return{type:C.ARRAY_UNSHIFT,path:t,items:n.map(s=>ae(s,r.proxyToTarget,r.targetToPath,t)),timestamp:Date.now()}}applyEvent(t,n,r,s){const a=t,o=n[r],i=a.items.map(c=>G(c,s));o.unshift(...i)}}class Xt{createEvent(t,n,r){return{type:C.ARRAY_SPLICE,path:t,start:n[0],deleteCount:n[1]||0,items:n.slice(2).map(s=>ae(s,r.proxyToTarget,r.targetToPath,t)),timestamp:Date.now()}}applyEvent(t,n,r,s){const a=t,o=n[r],i=a.items.map(c=>G(c,s));o.splice(a.start,a.deleteCount,...i)}}class Zt{createEvent(t){return{type:C.ARRAY_SORT,path:t,timestamp:Date.now()}}applyEvent(t,n,r){n[r].sort()}}class Qt{createEvent(t){return{type:C.ARRAY_REVERSE,path:t,timestamp:Date.now()}}applyEvent(t,n,r){n[r].reverse()}}class en{createEvent(t,n,r){return{type:C.ARRAY_FILL,path:t,value:ae(n[0],r.proxyToTarget,r.targetToPath,t),start:n[1],end:n[2],timestamp:Date.now()}}applyEvent(t,n,r,s){const a=t,o=n[r],i=G(a.value,s);o.fill(i,a.start,a.end)}}class tn{createEvent(t,n){return{type:C.ARRAY_COPYWITHIN,path:t,target:n[0],start:n[1],end:n[2],timestamp:Date.now()}}applyEvent(t,n,r){const s=t;n[r].copyWithin(s.target,s.start,s.end)}}class nn{createEvent(t,n,r){return{type:C.MAP_SET,path:t,key:ae(n[0],r.proxyToTarget,r.targetToPath,t),value:ae(n[1],r.proxyToTarget,r.targetToPath,t),timestamp:Date.now()}}applyEvent(t,n,r,s){const a=t,o=n[r],i=G(a.key,s),c=G(a.value,s);o.set(i,c)}}class rn{createEvent(t,n,r){return{type:C.MAP_DELETE,path:t,key:ae(n[0],r.proxyToTarget,r.targetToPath,t),timestamp:Date.now()}}applyEvent(t,n,r,s){const a=t,o=n[r],i=G(a.key,s);o.delete(i)}}class sn{createEvent(t){return{type:C.MAP_CLEAR,path:t,timestamp:Date.now()}}applyEvent(t,n,r){n[r].clear()}}class on{createEvent(t,n,r){return{type:C.SET_ADD,path:t,value:ae(n[0],r.proxyToTarget,r.targetToPath,t),timestamp:Date.now()}}applyEvent(t,n,r,s){const a=t,o=n[r],i=G(a.value,s);o.add(i)}}class an{createEvent(t,n,r){return{type:C.SET_DELETE,path:t,value:ae(n[0],r.proxyToTarget,r.targetToPath,t),timestamp:Date.now()}}applyEvent(t,n,r,s){const a=t,o=n[r],i=G(a.value,s);o.delete(i)}}class cn{createEvent(t){return{type:C.SET_CLEAR,path:t,timestamp:Date.now()}}applyEvent(t,n,r){n[r].clear()}}class ln{createEvent(t,n){return{type:C.SCRIPT,path:t,source:n[0],timestamp:Date.now()}}applyEvent(){}}class dn{constructor(){this.handlers=new Map}register(t,n){this.handlers.set(t,n)}createEvent(t,n,r,s){const a=this.handlers.get(t);if(!a)throw new Error(`No handler registered for event type: ${t}`);return a.createEvent(n,r,s)}applyEvent(t,n,r,s){const a=this.handlers.get(t.type);if(!a)throw new Error(`No handler registered for event type: ${t.type}`);a.applyEvent(t,n,r,s)}hasHandler(t){return this.handlers.has(t)}}const q=new dn;q.register(C.SET,new zt);q.register(C.DELETE,new Wt);q.register(C.ARRAY_PUSH,new Gt);q.register(C.ARRAY_POP,new Vt);q.register(C.ARRAY_SHIFT,new Jt);q.register(C.ARRAY_UNSHIFT,new Kt);q.register(C.ARRAY_SPLICE,new Xt);q.register(C.ARRAY_SORT,new Zt);q.register(C.ARRAY_REVERSE,new Qt);q.register(C.ARRAY_FILL,new en);q.register(C.ARRAY_COPYWITHIN,new tn);q.register(C.MAP_SET,new nn);q.register(C.MAP_DELETE,new rn);q.register(C.MAP_CLEAR,new sn);q.register(C.SET_ADD,new on);q.register(C.SET_DELETE,new an);q.register(C.SET_CLEAR,new cn);q.register(C.SCRIPT,new ln);const st=(e,t)=>{let n=e;for(let s=0;s<t.path.length-1;s++){const a=t.path[s];if(a){if(!(a in n)){const o=t.path[s+1];n[a]=o&&/^\d+$/.test(o)?[]:{}}n=n[a]}}const r=t.path[t.path.length-1];r&&q.applyEvent(t,n,r,e)},ot=async(e,t,n)=>{if(n.isReplaying=!0,Array.isArray(t))for(const r of t)st(e,r);else for await(const r of t)st(e,r);n.isReplaying=!1},un=async(e,t,n)=>{if(t.stream)await ot(e,t.stream(),n);else{const r=await t.getAll();await ot(e,r,n)}};class fn{constructor(){this.delta=new Map,this.DELETED=Symbol("deleted")}getDeletedSymbol(){return this.DELETED}isDirty(){return this.delta.size>0}size(){return this.delta.size}has(t){return this.delta.has(t)}get(t){return this.delta.get(t)}set(t,n){this.delta.set(t,n)}delete(t){this.delta.set(t,this.DELETED)}isDeleted(t){return this.delta.get(t)===this.DELETED}clear(){this.delta.clear()}entries(){return Array.from(this.delta.entries()).sort((t,n)=>{const r=t[0].split(".").length,s=n[0].split(".").length;return r-s})}createCheckpoint(){return new Map(this.delta)}restoreCheckpoint(t){this.delta.clear();for(const[n,r]of t)this.delta.set(n,r)}}function pn(e){return e!==null&&typeof e=="object"}function be(e,t,n=new WeakMap){if(!pn(e))return e;if(n.has(e))return n.get(e);const r=t.has(e)?t.get(e):e;if(r!==e&&n.has(r)){const i=n.get(r);return n.set(e,i),i}if(r instanceof Map){const i=new Map;n.set(e,i),r!==e&&n.set(r,i);let c=!1;for(const[d,f]of r.entries()){const g=be(d,t,n),S=be(f,t,n);i.set(g,S),(g!==d||S!==f)&&(c=!0)}const l=c?i:r;return n.set(e,l),r!==e&&n.set(r,l),l}if(r instanceof Set){const i=new Set;n.set(e,i),r!==e&&n.set(r,i);let c=!1;for(const d of r.values()){const f=be(d,t,n);i.add(f),f!==d&&(c=!0)}const l=c?i:r;return n.set(e,l),r!==e&&n.set(r,l),l}if(Array.isArray(r)){const i=[];n.set(e,i),r!==e&&n.set(r,i);let c=!1;for(const d of r){const f=be(d,t,n);i.push(f),f!==d&&(c=!0)}const l=c?i:r;return n.set(e,l),r!==e&&n.set(r,l),l}const s={};n.set(e,s),r!==e&&n.set(r,s);let a=!1;for(const[i,c]of Object.entries(r)){const l=be(c,t,n);s[i]=l,l!==c&&(a=!0)}const o=a?s:r;return n.set(e,o),r!==e&&n.set(r,o),o}function at(e){return e!==null&&typeof e=="object"}function Ye(e,t,n,r,s){if(r.has(e))return r.get(e);const a=t.getDeletedSymbol(),o=new Proxy(e,{get(i,c){if(typeof c=="symbol")return i[c];const l=[...n,String(c)],d=l.join(".");if(t.has(d)){const g=t.get(d);return g===a?void 0:at(g)?s.has(g)?g:Ye(g,t,l,r,s):g}const f=i[c];if(typeof f=="function"&&Array.isArray(i)){const g=String(c);return["push","pop","shift","unshift","splice","sort","reverse"].includes(g)?function(...v){const A=n.join(".");let b;return t.has(A)?b=t.get(A):(b=[...i],t.set(A,b)),f.apply(b,v)}:f.bind(i)}return at(f)?s.has(f)?f:Ye(f,t,l,r,s):f},set(i,c,l){const f=[...n,String(c)].join(".");return t.set(f,l),!0},has(i,c){const d=[...n,String(c)].join(".");return t.has(d)?t.get(d)!==a:c in i},deleteProperty(i,c){const d=[...n,String(c)].join(".");return t.delete(d),!0},ownKeys(i){const c=Reflect.ownKeys(i),l=n.length>0?n.join(".")+".":"",d=new Set;for(const[g,S]of t.entries())if(g.startsWith(l)){const v=g.slice(l.length),A=v.indexOf("."),b=A===-1?v:v.slice(0,A);S!==a&&d.add(b)}const f=new Set(c);for(const[g,S]of t.entries())if(g.startsWith(l)){const v=g.slice(l.length);if(v.indexOf(".")===-1){const b=v;S===a?f.delete(b):f.add(b)}}return Array.from(f)},getOwnPropertyDescriptor(i,c){const d=[...n,String(c)].join(".");if(t.has(d)){const f=t.get(d);return f===a?void 0:{value:f,writable:!0,enumerable:!0,configurable:!0}}return Reflect.getOwnPropertyDescriptor(i,c)}});return r.set(e,o),s.set(o,e),o}async function Ce(e){const t=new fn,n=t.getDeletedSymbol(),r=new WeakMap,s=new WeakMap,a={};return await un(a,e,{isReplaying:!0}),{root:Ye(a,t,[],r,s),isDirty(){return t.isDirty()},getUncommittedCount(){return t.size()},async save(){const i=t.entries(),c=new WeakMap;for(const[l,d]of i){const f=l.split(".");let g=a;for(let v=0;v<f.length-1;v++)g=g[f[v]];const S=f[f.length-1];if(d===n)delete g[S],await e.append({type:"DELETE",path:f,timestamp:Date.now()});else{const v=be(d,s,c);g[S]=v,await e.append({type:"SET",path:f,value:v,timestamp:Date.now()})}}t.clear()},discard(){t.clear()},createCheckpoint(){return t.createCheckpoint()},restoreCheckpoint(i){t.restoreCheckpoint(i)}}}const mn=new WeakMap,gn=e=>qt(e),yn=e=>mn.get(e)||null,hn=(e="memimg",t="events")=>{let n,r=!1;const s=new Promise((o,i)=>{if(typeof indexedDB>"u"){i(new Error("IndexedDB not available (browser only)"));return}const c=indexedDB.open(e);c.onerror=()=>i(c.error),c.onsuccess=()=>{const l=c.result,d=l.objectStoreNames.contains(t),f=l.version;if(l.close(),d){const g=indexedDB.open(e,f);g.onerror=()=>i(g.error),g.onsuccess=()=>{n=g.result,o()}}else{const g=indexedDB.open(e,f+1);g.onerror=()=>i(g.error),g.onsuccess=()=>{n=g.result,o()},g.onupgradeneeded=S=>{const v=S.target.result;v.objectStoreNames.contains(t)||v.createObjectStore(t,{autoIncrement:!0})}}},c.onupgradeneeded=l=>{const d=l.target.result;d.objectStoreNames.contains(t)||d.createObjectStore(t,{autoIncrement:!0})}}),a=()=>{if(r)throw new Error(`EventLog (${t}) has been closed and cannot be used. This usually happens when switching between memory images.`)};return{append:async o=>(a(),await s,new Promise((i,c)=>{const f=n.transaction([t],"readwrite").objectStore(t).add(o);f.onsuccess=()=>i(),f.onerror=()=>c(f.error)})),getAll:async()=>(a(),await s,new Promise((o,i)=>{const d=n.transaction([t],"readonly").objectStore(t).getAll();d.onsuccess=()=>o(d.result),d.onerror=()=>i(d.error)})),clear:async()=>(a(),await s,new Promise((o,i)=>{const d=n.transaction([t],"readwrite").objectStore(t).clear();d.onsuccess=()=>o(),d.onerror=()=>i(d.error)})),close:async()=>{if(!r){r=!0;try{await s,n&&(n.close(),await new Promise(o=>setTimeout(o,50)))}catch(o){console.warn(`EventLog close(): Database was never initialized (${t})`,o)}}}}};class En{constructor(){this._history=[["root"]],this._currentIndex=0,this._selectedPath=["root"],this._expandedPaths=new Set(["root"]),this._expandedNestedObjects=new Set,this.onNavigate=null}get selectedPath(){return[...this._selectedPath]}get currentIndex(){return this._currentIndex}get history(){return this._history.map(t=>[...t])}expandAncestors(t){for(let n=1;n<=t.length;n++){const r=t.slice(0,n).join(".");this._expandedPaths.add(r)}}reset(){this._selectedPath=["root"],this._expandedPaths=new Set(["root"]),this._expandedNestedObjects=new Set,this._history=[["root"]],this._currentIndex=0}navigateTo(t,n=!0){n&&(this._history=this._history.slice(0,this._currentIndex+1),this._history.push([...t]),this._currentIndex=this._history.length-1),this.expandAncestors(t),this._selectedPath=[...t],this.onNavigate&&this.onNavigate()}goBack(){this.canGoBack()&&(this._currentIndex--,this._selectedPath=[...this._history[this._currentIndex]],this.expandAncestors(this._selectedPath),this.onNavigate&&this.onNavigate())}goForward(){this.canGoForward()&&(this._currentIndex++,this._selectedPath=[...this._history[this._currentIndex]],this.expandAncestors(this._selectedPath),this.onNavigate&&this.onNavigate())}canGoBack(){return this._currentIndex>0}canGoForward(){return this._currentIndex<this._history.length-1}toggleExpanded(t){this._expandedPaths.has(t)?this._expandedPaths.delete(t):this._expandedPaths.add(t)}isExpanded(t){return this._expandedPaths.has(t)}toggleNestedExpanded(t){this._expandedNestedObjects.has(t)?this._expandedNestedObjects.delete(t):this._expandedNestedObjects.add(t)}isNestedExpanded(t){return this._expandedNestedObjects.has(t)}}function wn(e,t){if(e===t)return["root"];if(!e||typeof e!="object")return null;const n=[[e,["root"]]],r=new Set;for(r.add(e);n.length>0;){const[s,a]=n.shift(),o=s instanceof Map?Array.from(s.entries()):s instanceof Set?Array.from(s.values()).map((i,c)=>[`[${c}]`,i]):Object.entries(s);for(const[i,c]of o)if(!(typeof i=="string"&&i.startsWith("__"))){if(c===t)return[...a,String(i)];c&&typeof c=="object"&&!r.has(c)&&(r.add(c),n.push([c,[...a,String(i)]]))}}return null}function Ve(e,t){const n=yn(e);if(n){const{targetToPath:r,proxyToTarget:s}=n,a=s.get(t)||t,o=r.get(a);if(o)return["root",...o]}return wn(e,t)}class bn{getChildren(t){return t.map((r,s)=>[`[${s}]`,r])}createChildPath(t,n){return[...t,n.toString()]}}class vn{getChildren(t){const n=t;return Array.from(n.entries()).map(([r,s])=>[String(r),s])}createChildPath(t,n){return[...t,`map:${n}`]}}class Sn{getChildren(t){const n=t;return Array.from(n.values()).map((r,s)=>[`[${s}]`,r])}createChildPath(t,n){return[...t,`set:${n}`]}}function Je(e){return Array.isArray(e)?new bn:e instanceof Map?new vn:e instanceof Set?new Sn:null}function it(e){if(e==null||e instanceof Date)return!1;const t=typeof e;return t==="object"||t==="function"}function An(e){return e==null?"○":Array.isArray(e)?"[]":typeof e=="object"?"{}":typeof e=="function"?"ƒ":"•"}function xn(e,t,n){if(!it(e))return[];const r=Je(e);return r?r.getChildren(e):Object.entries(e).filter(([o,i])=>{if(o.startsWith("__")||!it(i))return!1;if(typeof i=="object"&&i!==null){const c=Ve(n,i);if(c){const l=t.join("."),d=c.join(".");if(!d.startsWith(l+".")&&d!==l)return!1}}return!0})}function Tn(e,t,n,r,s,a){const o=document.createElement("div");o.className="tree-node-header",a&&o.classList.add("selected");const i=document.createElement("span");i.className=r?s?"tree-toggle expanded":"tree-toggle collapsed":"tree-toggle leaf";const c=document.createElement("span");c.className="tree-icon",c.textContent=An(t);const l=document.createElement("span");return l.className="tree-label",l.textContent=e,o.appendChild(i),o.appendChild(c),o.appendChild(l),o}function _n(e,t,n,r,s,a,o){const i=n.join(".");e.querySelector(".tree-toggle").addEventListener("click",l=>{l.stopPropagation(),s&&(a.toggleExpanded(i),o&&o())}),e.addEventListener("click",l=>{l.stopPropagation();let d=n;if(t!=null&&(typeof t=="object"||typeof t=="function")){const f=Ve(r,t);f&&(d=[...f])}a.navigateTo(d,!0),o&&o()})}function Pn(e,t,n,r,s,a){const o=document.createElement("div");o.className="tree-children expanded";const i=Je(e);return i?Nn(o,n,t,i,r,s,a):In(o,n,t,r,s,a),o}function Nn(e,t,n,r,s,a,o){if(!r)return;let i=0;for(const[c,l]of t){const d=r.createChildPath(n,i);e.appendChild(Ke(c,l,d,s,a,o)),i++}}function In(e,t,n,r,s,a){for(const[o,i]of t){const c=[...n,o];e.appendChild(Ke(o,i,c,r,s,a))}}function Ke(e,t,n,r,s,a){const o=document.createElement("div");o.className="tree-node";const i=n.join("."),c=i===s.selectedPath.join("."),l=xn(t,n,r),d=l.length>0,f=s.isExpanded(i),g=Tn(e,t,n,d,f,c);if(_n(g,t,n,r,d,s,a),o.appendChild(g),d&&f){const S=Pn(t,n,l,r,s,a);o.appendChild(S)}return o}function Cn(e,t,n,r){n.innerHTML="";const s=Ke("this",e,["root"],e,t,r);n.appendChild(s)}const Le="__",D={PROPERTY_TABLE:"property-table",PROPERTY_NAME:"property-name",PROPERTY_VALUE:"property-value",EMPTY_STATE:"empty-state",VALUE_NAVIGABLE:"value-navigable",VALUE_NULL:"value-null",VALUE_UNDEFINED:"value-undefined",VALUE_STRING:"value-string",VALUE_NUMBER:"value-number",VALUE_BOOLEAN:"value-boolean",VALUE_BIGINT:"value-bigint",VALUE_SYMBOL:"value-symbol",VALUE_DATE:"value-date",VALUE_FUNCTION:"value-function",VALUE_ARRAY:"value-array",VALUE_MAP:"value-map",VALUE_SET:"value-set",VALUE_OBJECT:"value-object"},Ae={MAX_PREVIEW_LENGTH:80,MAX_OBJECT_PROPERTIES_PREVIEW:5},Ln=/name|desc(ription)?$/i,X={NULL:"∅",UNDEFINED:"∅",STRING:'"',NUMBER:"#",BOOLEAN:"✓",BIGINT:"#n",SYMBOL:"Σ",DATE:"📅",FUNCTION:"ƒ",ARRAY:"[]",MAP:"M{}",SET:"S{}",OBJECT:"{}"};var J=(e=>(e[e.NULL=1]="NULL",e[e.UNDEFINED=2]="UNDEFINED",e[e.STRING=3]="STRING",e[e.NUMBER=4]="NUMBER",e[e.BOOLEAN=5]="BOOLEAN",e[e.BIGINT=6]="BIGINT",e[e.SYMBOL=7]="SYMBOL",e[e.DATE=8]="DATE",e[e.FUNCTION=9]="FUNCTION",e[e.ARRAY=10]="ARRAY",e[e.MAP=11]="MAP",e[e.SET=12]="SET",e[e.OBJECT=13]="OBJECT",e))(J||{});function Xe(e){if(e===null)return{category:1,typeName:"null",isNavigable:!1,isCollection:!1,displayIcon:X.NULL,cssClass:D.VALUE_NULL};if(e===void 0)return{category:2,typeName:"undefined",isNavigable:!1,isCollection:!1,displayIcon:X.UNDEFINED,cssClass:D.VALUE_UNDEFINED};const t=typeof e;return t==="string"?{category:3,typeName:"string",isNavigable:!1,isCollection:!1,displayIcon:X.STRING,cssClass:D.VALUE_STRING}:t==="number"?{category:4,typeName:"number",isNavigable:!1,isCollection:!1,displayIcon:X.NUMBER,cssClass:D.VALUE_NUMBER}:t==="boolean"?{category:5,typeName:"boolean",isNavigable:!1,isCollection:!1,displayIcon:X.BOOLEAN,cssClass:D.VALUE_BOOLEAN}:t==="bigint"?{category:6,typeName:"bigint",isNavigable:!1,isCollection:!1,displayIcon:X.BIGINT,cssClass:D.VALUE_BIGINT}:t==="symbol"?{category:7,typeName:"symbol",isNavigable:!1,isCollection:!1,displayIcon:X.SYMBOL,cssClass:D.VALUE_SYMBOL}:e instanceof Date?{category:8,typeName:"Date",isNavigable:!1,isCollection:!1,displayIcon:X.DATE,cssClass:D.VALUE_DATE}:t==="function"?{category:9,typeName:"Function",isNavigable:!0,isCollection:!1,displayIcon:X.FUNCTION,cssClass:D.VALUE_FUNCTION}:Array.isArray(e)?{category:10,typeName:"Array",isNavigable:!0,isCollection:!0,displayIcon:X.ARRAY,cssClass:D.VALUE_ARRAY}:e instanceof Map?{category:11,typeName:"Map",isNavigable:!0,isCollection:!0,displayIcon:X.MAP,cssClass:D.VALUE_MAP}:e instanceof Set?{category:12,typeName:"Set",isNavigable:!0,isCollection:!0,displayIcon:X.SET,cssClass:D.VALUE_SET}:{category:13,typeName:"Object",isNavigable:!0,isCollection:!1,displayIcon:X.OBJECT,cssClass:D.VALUE_OBJECT}}function Rn(e){return Array.isArray(e)||e instanceof Map||e instanceof Set}function kn(e){if(e==null||typeof e!="object"||e instanceof Date||Rn(e))return!1;const t=Object.entries(e).filter(([n])=>!n.startsWith("__"));return t.length>5?!1:t.every(([n,r])=>{if(r==null)return!0;const s=typeof r;return s==="string"||s==="number"||s==="boolean"||s==="bigint"||r instanceof Date})}class Dn{canFormat(t){return t.category===J.NULL}formatPreview(t){return""}formatFull(t){return""}}class Fn{canFormat(t){return t.category===J.UNDEFINED}formatPreview(t){return"undefined"}formatFull(t){return"undefined"}}class On{canFormat(t){return t.category===J.STRING}formatPreview(t,n=Ae.MAX_PREVIEW_LENGTH){const r=String(t);return r.length>n?r.substring(0,n)+"...":r}formatFull(t){return String(t)}}class Mn{canFormat(t){return t.category===J.NUMBER}formatPreview(t){return String(t)}formatFull(t){return String(t)}}class Bn{canFormat(t){return t.category===J.BOOLEAN}formatPreview(t){return String(t)}formatFull(t){return String(t)}}class $n{canFormat(t){return t.category===J.BIGINT}formatPreview(t){return t.toString()+"n"}formatFull(t){return t.toString()+"n"}}class Hn{canFormat(t){return t.category===J.SYMBOL}formatPreview(t){return t.toString()}formatFull(t){return t.toString()}}class jn{canFormat(t){return t.category===J.DATE}formatPreview(t){const n=t;return isNaN(n.getTime())?"Invalid Date":n.toISOString()}formatFull(t){const n=t;return isNaN(n.getTime())?"Invalid Date":n.toISOString()}}class Un{canFormat(t){return t.category===J.FUNCTION}formatPreview(t){return"ƒ "+(t.name||"(anonymous)")}formatFull(t){return"ƒ "+(t.name||"(anonymous)")}}class Yn{canFormat(t){return t.category===J.ARRAY}formatPreview(t,n=Ae.MAX_PREVIEW_LENGTH){const r=t;try{const s=JSON.stringify(r,null,0);return s.length>n?s.substring(0,n)+"...":s}catch{return`[Array(${r.length})]`}}formatFull(t){return`Array(${t.length})`}}class qn{canFormat(t){return t.category===J.MAP}formatPreview(t){return`Map{${t.size}}`}formatFull(t){return`Map{${t.size}}`}}class zn{canFormat(t){return t.category===J.SET}formatPreview(t){return`Set{${t.size}}`}formatFull(t){return`Set{${t.size}}`}}function Re(e){if(e==null)return"";const t=typeof e;if(t!=="object"&&t!=="function")return String(e);if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return`[${e.length} items]`;if(e instanceof Map)return`Map{${e.size}}`;if(e instanceof Set)return`Set{${e.size}}`;const n=[],r=Object.entries(e).filter(([a])=>!a.startsWith(Le));for(const[a,o]of r)if(Ln.test(a)){if(typeof o=="string")n.push(o);else if(o!==null&&typeof o=="object"&&!(o instanceof Date)&&!Array.isArray(o)&&!(o instanceof Map)&&!(o instanceof Set)){const i=Re(o);i&&!i.startsWith("Object{")&&n.push(i)}}return n.length>0?n.join(" "):`Object{${r.length}}`}class Wn{canFormat(t){return t.category===J.OBJECT}formatPreview(t,n=Ae.MAX_PREVIEW_LENGTH){const r=t,s=Re(r);if(s&&!s.startsWith("Object{"))return s.length>n?s.substring(0,n)+"...":s;const a=Object.entries(r).filter(([l])=>!l.startsWith(Le)).slice(0,Ae.MAX_OBJECT_PROPERTIES_PREVIEW);if(a.length===0)return s;const o=a.map(([l,d])=>d===null?`"${l}":null`:d===void 0?`"${l}":undefined`:typeof d=="string"?`"${l}":"${d}"`:typeof d=="number"||typeof d=="boolean"?`"${l}":${d}`:Array.isArray(d)?`"${l}":[Array]`:typeof d=="object"?`"${l}":[Object]`:typeof d=="function"?`"${l}":[Function]`:`"${l}":${typeof d}`),i=Object.keys(r).filter(l=>!l.startsWith(Le)).length>Ae.MAX_OBJECT_PROPERTIES_PREVIEW,c="{"+o.join(",")+(i?",...":"")+"}";return c.length>n?c.substring(0,n)+"...":c}formatFull(t){return Re(t)}}const Gn=[new Dn,new Fn,new On,new Mn,new Bn,new $n,new Hn,new jn,new Un,new Yn,new qn,new zn,new Wn];function Vn(e,t="preview",n){const r=Xe(e),s=Gn.find(a=>a.canFormat(r));return s?t==="preview"?s.formatPreview(e,n):s.formatFull(e):String(e)}function De(e,t="preview",n){const r=Xe(e);return[Vn(e,t,n),r]}function Jn(e){if(e==null)return[];try{return Reflect.ownKeys(e).filter(r=>typeof r=="string").map(r=>[r,e[r]])}catch(t){return console.error("Failed to enumerate object properties with Reflect.ownKeys:",t),Object.entries(e)}}function Kn(e){return Jn(e).filter(([t])=>!t.startsWith(Le))}function Xn(e){const t=Kn(e),n=[],r=[];for(const[s,a]of t)Xe(a).isCollection?r.push([s,a]):n.push([s,a]);return{scalars:n,collections:r}}function Et(e,t){let n=e;for(let r=1;r<t.length;r++){const s=t[r];if(s===void 0)return;if(!(s===""&&!(s in n))&&(n=n==null?void 0:n[s],n===void 0))return}return n}function Zn(e){const t=document.createElement("div");t.className="inspector-tabs";const n=document.createElement("div");n.className="tab-headers";const r=document.createElement("div");r.className="tab-content";const s=e.findIndex(o=>!o.isEmpty),a=s>=0?s:0;return e.forEach((o,i)=>{const c=document.createElement("button");c.className="tab-header",c.textContent=o.label,c.disabled=o.isEmpty,c.dataset.tabId=o.id,i===a&&c.classList.add("active"),c.addEventListener("click",()=>{n.querySelectorAll(".tab-header").forEach(l=>l.classList.remove("active")),r.querySelectorAll(".tab-panel").forEach(l=>l.classList.remove("active")),c.classList.add("active"),o.content.classList.add("active")}),n.appendChild(c),o.content.className="tab-panel",o.content.dataset.tabId=o.id,i===a&&o.content.classList.add("active"),r.appendChild(o.content)}),t.appendChild(n),t.appendChild(r),t}function Qn(e,t,n,r,s,a){const o=document.createElement("td");o.className=D.PROPERTY_VALUE;const[i,c]=De(e,"preview");return o.textContent=i,o.title=c.typeName,o.classList.add(c.cssClass),c.isNavigable&&(o.classList.add(D.VALUE_NAVIGABLE),o.addEventListener("click",()=>{wt(n,r,t,s,a)})),o}function er(e,t,n,r,s){const a=document.createElement("td");a.className=D.PROPERTY_VALUE;const o=`${n.join(".")}.${t}`,i=r.isNestedExpanded(o),c=Re(e),l=document.createElement("div");l.className="value-nested";const d=document.createElement("span");d.className=`value-nested-toggle ${i?"expanded":"collapsed"}`;const f=document.createElement("span");f.className="value-nested-summary",f.textContent=`{${c}}`,l.appendChild(d),l.appendChild(f);const g=document.createElement("div");g.className=`nested-properties ${i?"expanded":""}`;for(const[v,A]of Object.entries(e)){if(v.startsWith("__"))continue;const b=document.createElement("div");b.className="nested-prop";const N=document.createElement("span");N.className="nested-prop-key",N.textContent=`${v}:`;const[m,p]=De(A,"preview"),y=document.createElement("span");y.className=`nested-prop-value ${p.cssClass}`,y.textContent=m,b.appendChild(N),b.appendChild(y),g.appendChild(b)}a.appendChild(l),a.appendChild(g);let S=null;return l.addEventListener("click",v=>{if(v.stopPropagation(),S){clearTimeout(S),S=null;return}S=setTimeout(()=>{S=null,r.toggleNestedExpanded(o),s&&s()},250)}),l.addEventListener("dblclick",v=>{v.stopPropagation(),S&&(clearTimeout(S),S=null);const A=[...n,t];r.navigateTo(A,!0),s&&s()}),a}function wt(e,t,n,r,s){const a=Et(e,t),o=a==null?void 0:a[n];if(!o){console.error("Could not find referenced object");return}const i=Ve(e,o);if(!i){console.error("Could not find canonical path for object");return}r.navigateTo([...i],!0),s&&s()}function tr(e,t,n,r,s,a){const o=document.createElement("tr"),i=document.createElement("td");i.className=D.PROPERTY_NAME,i.textContent=e;const c=kn(t)?er(t,e,r,s,a):Qn(t,e,n,r,s,a);return o.appendChild(i),o.appendChild(c),o}function nr(e,t,n,r,s){const a=document.createElement("table");a.className=D.PROPERTY_TABLE;const o=document.createElement("thead");o.innerHTML="<tr><th>Property</th><th>Value</th></tr>",a.appendChild(o);const i=document.createElement("tbody");for(const[c,l]of e)i.appendChild(tr(c,l,t,n,r,s));return a.appendChild(i),a}function rr(e,t,n,r,s){const a=document.createElement("div");if(a.className="collections-panel",e.length===0)return a.innerHTML=`<div class="${D.EMPTY_STATE}">No collections</div>`,a;for(const[o,i]of e){const c=document.createElement("div");c.className="collection-section";const l=document.createElement("h3");l.textContent=o,l.className="collection-header",c.appendChild(l);const d=Je(i);if(!d){const g=document.createElement("div");g.className=D.EMPTY_STATE,g.textContent="Unknown collection type",c.appendChild(g),a.appendChild(c);continue}const f=d.getChildren(i);if(f.length===0){const g=document.createElement("div");g.className=D.EMPTY_STATE,g.textContent="Empty collection",c.appendChild(g)}else{const g=document.createElement("ul");g.className="collection-items";for(const[S,v]of f){const A=document.createElement("li");A.className="collection-item";const[b,N]=De(v,"preview"),m=document.createElement("span");m.className="item-label",m.textContent=`${S}: `;const p=document.createElement("span");p.className=`item-value ${N.cssClass}`,p.textContent=b,p.title=N.typeName,A.appendChild(m),A.appendChild(p),N.isNavigable&&(p.classList.add(D.VALUE_NAVIGABLE),p.addEventListener("click",()=>{const y=[...n,o];wt(t,y,S,r,s)})),g.appendChild(A)}c.appendChild(g)}a.appendChild(c)}return a}function sr(e,t,n,r){const s=t.selectedPath;if(s.length===0){n.innerHTML=`<div class="${D.EMPTY_STATE}">Select a node in the tree</div>`;return}const a=Et(e,s);if(a==null){n.innerHTML=`<div class="${D.EMPTY_STATE}">Value is ${a===null?"null":"undefined"}</div>`;return}if(typeof a!="object"&&typeof a!="function"){const[d]=De(a,"preview");n.innerHTML=`<div class="${D.EMPTY_STATE}">Primitive value: ${d}</div>`;return}const{scalars:o,collections:i}=Xn(a);if(o.length===0&&i.length===0){n.innerHTML=`<div class="${D.EMPTY_STATE}">No properties</div>`;return}const c=[{id:"properties",label:"Properties",content:nr(o,e,s,t,r),isEmpty:o.length===0},{id:"collections",label:"Collections",content:rr(i,e,s,t,r),isEmpty:i.length===0}],l=Zn(c);n.innerHTML="",n.appendChild(l)}const xe="memimg-explorer",qe=1e3,or=100*1024;function ar(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}function Ze(e){return`script-history-${e}`}async function ir(e){const t=Ze(e);return new Promise((n,r)=>{const s=indexedDB.open(xe);s.onerror=()=>{r(s.error)},s.onsuccess=async()=>{const a=s.result,o=a.objectStoreNames.contains(t),i=a.version;if(a.close(),await new Promise(l=>setTimeout(l,50)),o){n();return}const c=indexedDB.open(xe,i+1);c.onerror=()=>{r(c.error)},c.onblocked=()=>{},c.onsuccess=async()=>{c.result.close(),await new Promise(l=>setTimeout(l,50)),n()},c.onupgradeneeded=l=>{const d=l.target.result;if(!d.objectStoreNames.contains(t)){const f=d.createObjectStore(t,{keyPath:"id"});f.createIndex("timestamp","timestamp",{unique:!1}),f.createIndex("characterCount","characterCount",{unique:!1})}}},s.onupgradeneeded=a=>{const o=a.target.result;if(!o.objectStoreNames.contains(t)){const i=o.createObjectStore(t,{keyPath:"id"});i.createIndex("timestamp","timestamp",{unique:!1}),i.createIndex("characterCount","characterCount",{unique:!1})}}})}async function Te(e,t="readonly"){const n=Ze(e);return new Promise((r,s)=>{const a=indexedDB.open(xe);a.onerror=()=>s(a.error),a.onsuccess=async()=>{const o=a.result,i=!o.objectStoreNames.contains(n),c=o.version;if(o.close(),await new Promise(l=>setTimeout(l,50)),i){const l=indexedDB.open(xe,c+1);l.onerror=()=>s(l.error),l.onsuccess=()=>{const d=l.result;try{const g=d.transaction([n],t).objectStore(n);r({db:d,store:g})}catch(f){d.close(),s(f)}},l.onupgradeneeded=d=>{const f=d.target.result,g=d.target.transaction;if(!f.objectStoreNames.contains(n)){const S=f.createObjectStore(n,{keyPath:"id"});S.createIndex("timestamp","timestamp",{unique:!1}),S.createIndex("characterCount","characterCount",{unique:!1})}g.oncomplete=()=>{console.log(`Script history store created: ${n}`)}}}else{const l=indexedDB.open(xe);l.onerror=()=>s(l.error),l.onsuccess=()=>{const d=l.result,g=d.transaction([n],t).objectStore(n);r({db:d,store:g})}}},a.onupgradeneeded=o=>{const i=o.target.result;if(!i.objectStoreNames.contains(n)){const c=i.createObjectStore(n,{keyPath:"id"});c.createIndex("timestamp","timestamp",{unique:!1}),c.createIndex("characterCount","characterCount",{unique:!1})}}})}async function cr(e,t){const n=new Blob([t]).size;if(n>or)throw new Error(`Script too large: ${(n/1024).toFixed(1)} KB (max 100 KB)`);const r={id:ar(),timestamp:Date.now(),code:t,status:"success",characterCount:t.length},{db:s,store:a}=await Te(e,"readwrite");return new Promise((o,i)=>{const c=a.count();c.onsuccess=()=>{const l=c.result;if(l>=qe){const d=l-qe+1,g=a.index("timestamp").openCursor(null,"next");let S=0;const v=[];g.onsuccess=()=>{const A=g.result;if(A&&S<d)v.push(A.value.id),S++,A.continue();else{for(const N of v)a.delete(N);const b=a.add(r);b.onsuccess=async()=>{s.close(),await new Promise(N=>setTimeout(N,50)),o()},b.onerror=async()=>{s.close(),await new Promise(N=>setTimeout(N,50)),i(b.error)}}},g.onerror=async()=>{s.close(),await new Promise(A=>setTimeout(A,50)),i(g.error)}}else{const d=a.add(r);d.onsuccess=async()=>{s.close(),await new Promise(f=>setTimeout(f,50)),o()},d.onerror=async()=>{s.close(),await new Promise(f=>setTimeout(f,50)),i(d.error)}}},c.onerror=async()=>{s.close(),await new Promise(l=>setTimeout(l,50)),i(c.error)}})}async function Fe(e,t=100){const{db:n,store:r}=await Te(e,"readonly");return new Promise((s,a)=>{const i=r.index("timestamp").openCursor(null,"prev"),c=[];i.onsuccess=async()=>{const l=i.result;l&&c.length<t?(c.push(l.value),l.continue()):(n.close(),await new Promise(d=>setTimeout(d,50)),s(c))},i.onerror=async()=>{n.close(),await new Promise(l=>setTimeout(l,50)),a(i.error)}})}async function lr(e,t){if(!t||t.trim().length===0)return Fe(e,100);const{db:n,store:r}=await Te(e,"readonly"),s=t.toLowerCase();return new Promise((a,o)=>{const c=r.index("timestamp").openCursor(null,"prev"),l=[];c.onsuccess=async()=>{const d=c.result;if(d){const f=d.value;f.code.toLowerCase().includes(s)&&l.push(f),d.continue()}else n.close(),await new Promise(f=>setTimeout(f,50)),a(l)},c.onerror=async()=>{n.close(),await new Promise(d=>setTimeout(d,50)),o(c.error)}})}async function dr(e){const{db:t,store:n}=await Te(e,"readwrite");return new Promise((r,s)=>{const a=n.clear();a.onsuccess=async()=>{t.close(),await new Promise(o=>setTimeout(o,50)),r()},a.onerror=async()=>{t.close(),await new Promise(o=>setTimeout(o,50)),s(a.error)}})}async function ur(e){const t=await Fe(e,qe),n={memimgId:e,exportedAt:new Date().toISOString(),entryCount:t.length,entries:t.map(r=>({timestamp:r.timestamp,timestampISO:new Date(r.timestamp).toISOString(),code:r.code,characterCount:r.characterCount}))};return JSON.stringify(n,null,2)}async function fr(e){const{db:t,store:n}=await Te(e,"readonly");return new Promise((r,s)=>{const a=n.count();a.onsuccess=()=>{const o=a.result,i=n.openCursor();let c=0;i.onsuccess=async()=>{const l=i.result;if(l){const d=l.value;c+=d.characterCount,l.continue()}else t.close(),await new Promise(d=>setTimeout(d,50)),r({count:o,totalSize:c})},i.onerror=async()=>{t.close(),await new Promise(l=>setTimeout(l,50)),s(i.error)}},a.onerror=async()=>{t.close(),await new Promise(o=>setTimeout(o,50)),s(a.error)}})}const pr=window;function mr(e,t,n={}){const r={tab:"	",indentOn:/[({\[]$/,moveToNewLine:/^[)}\]]/,spellcheck:!1,catchTab:!0,preserveIdent:!0,addClosing:!0,history:!0,window:pr,autoclose:{open:`([{'"`,close:`)]}'"`},...n},s=r.window,a=s.document,o=[],i=[];let c=-1,l=!1,d=()=>{},f;e.setAttribute("contenteditable","plaintext-only"),e.setAttribute("spellcheck",r.spellcheck?"true":"false"),e.style.outline="none",e.style.overflowWrap="break-word",e.style.overflowY="auto",e.style.whiteSpace="pre-wrap";const g=(u,h)=>{t(u,h)},S=s.navigator.userAgent.match(/Firefox\/([0-9]+)\./),v=S?parseInt(S[1]):0;let A=!1;(e.contentEditable!=="plaintext-only"||v>=136)&&(A=!0),A&&e.setAttribute("contenteditable","true");const b=fe(()=>{const u=w();g(e,u),E(u)},30);let N=!1;const m=u=>!ce(u)&&!me(u)&&u.key!=="Meta"&&u.key!=="Control"&&u.key!=="Alt"&&!u.key.startsWith("Arrow"),p=fe(u=>{m(u)&&(ie(),N=!1)},300),y=(u,h)=>{o.push([u,h]),e.addEventListener(u,h)};y("keydown",u=>{u.defaultPrevented||(f=ne(),r.preserveIdent?O(u):$(u),r.catchTab&&_e(u),r.addClosing&&re(u),r.history&&(Pe(u),m(u)&&!N&&(ie(),N=!0)),A&&!K(u)&&E(w()))}),y("keyup",u=>{u.defaultPrevented||u.isComposing||(f!==ne()&&b(),p(u),d(ne()))}),y("focus",u=>{l=!0}),y("blur",u=>{l=!1}),y("paste",u=>{ie(),Be(u),ie(),d(ne())}),y("cut",u=>{ie(),Ne(u),ie(),d(ne())});function w(){const u=le(),h={start:0,end:0,dir:void 0};let{anchorNode:x,anchorOffset:P,focusNode:k,focusOffset:M}=u;if(!x||!k)throw"error1";if(x===e&&k===e)return h.start=P>0&&e.textContent?e.textContent.length:0,h.end=M>0&&e.textContent?e.textContent.length:0,h.dir=M>=P?"->":"<-",h;if(x.nodeType===Node.ELEMENT_NODE){const j=a.createTextNode("");x.insertBefore(j,x.childNodes[P]),x=j,P=0}if(k.nodeType===Node.ELEMENT_NODE){const j=a.createTextNode("");k.insertBefore(j,k.childNodes[M]),k=j,M=0}return H(e,j=>{if(j===x&&j===k)return h.start+=P,h.end+=M,h.dir=P<=M?"->":"<-","stop";if(j===x)if(h.start+=P,!h.dir)h.dir="->";else return"stop";else if(j===k)if(h.end+=M,!h.dir)h.dir="<-";else return"stop";j.nodeType===Node.TEXT_NODE&&(h.dir!="->"&&(h.start+=j.nodeValue.length),h.dir!="<-"&&(h.end+=j.nodeValue.length))}),e.normalize(),h}function E(u){var tt,nt;const h=le();let x,P=0,k,M=0;if(u.dir||(u.dir="->"),u.start<0&&(u.start=0),u.end<0&&(u.end=0),u.dir=="<-"){const{start:se,end:de}=u;u.start=de,u.end=se}let j=0;H(e,se=>{if(se.nodeType!==Node.TEXT_NODE)return;const de=(se.nodeValue||"").length;if(j+de>u.start&&(x||(x=se,P=u.start-j),j+de>u.end))return k=se,M=u.end-j,"stop";j+=de}),x||(x=e,P=e.childNodes.length),k||(k=e,M=e.childNodes.length),u.dir=="<-"&&([x,P,k,M]=[k,M,x,P]);{const se=_(x);if(se){const Se=a.createTextNode("");(tt=se.parentNode)==null||tt.insertBefore(Se,se),x=Se,P=0}const de=_(k);if(de){const Se=a.createTextNode("");(nt=de.parentNode)==null||nt.insertBefore(Se,de),k=Se,M=0}}h.setBaseAndExtent(x,P,k,M),e.normalize()}function _(u){for(;u&&u!==e;){if(u.nodeType===Node.ELEMENT_NODE){const h=u;if(h.getAttribute("contenteditable")=="false")return h}u=u.parentNode}}function I(){const h=le().getRangeAt(0),x=a.createRange();return x.selectNodeContents(e),x.setEnd(h.startContainer,h.startOffset),x.toString()}function T(){const h=le().getRangeAt(0),x=a.createRange();return x.selectNodeContents(e),x.setStart(h.endContainer,h.endOffset),x.toString()}function O(u){if(u.key==="Enter"){const h=I(),x=T();let[P]=ge(h),k=P;if(r.indentOn.test(h)&&(k+=r.tab),k.length>0?(ee(u),u.stopPropagation(),z(`
`+k)):$(u),k!==P&&r.moveToNewLine.test(x)){const M=w();z(`
`+P),E(M)}}}function $(u){if(A&&u.key==="Enter")if(ee(u),u.stopPropagation(),T()==""){z(`
 `);const h=w();h.start=--h.end,E(h)}else z(`
`)}function re(u){const h=r.autoclose.open,x=r.autoclose.close;if(h.includes(u.key)){ee(u);const P=w(),k=P.start==P.end?"":le().toString(),M=u.key+k+(x[h.indexOf(u.key)]??"");z(M),P.start++,P.end++,E(P)}}function _e(u){if(u.key==="Tab")if(ee(u),u.shiftKey){const h=I();let[x,P]=ge(h);if(x.length>0){const k=w(),M=Math.min(r.tab.length,x.length);E({start:P,end:P+M}),a.execCommand("delete"),k.start-=M,k.end-=M,E(k)}}else z(r.tab)}function Pe(u){if(ce(u)){ee(u),c--;const h=i[c];h&&(e.innerHTML=h.html,E(h.pos)),c<0&&(c=0)}if(me(u)){ee(u),c++;const h=i[c];h&&(e.innerHTML=h.html,E(h.pos)),c>=i.length&&c--}}function ie(){if(!l)return;const u=e.innerHTML,h=w(),x=i[c];if(x&&x.html===u&&x.pos.start===h.start&&x.pos.end===h.end)return;c++,i[c]={html:u,pos:h},i.splice(c+1);const P=300;c>P&&(c=P,i.splice(0,1))}function Be(u){if(u.defaultPrevented)return;ee(u);const x=(u.originalEvent??u).clipboardData.getData("text/plain").replace(/\r\n?/g,`
`),P=w();z(x),g(e),E({start:Math.min(P.start,P.end)+x.length,end:Math.min(P.start,P.end)+x.length,dir:"<-"})}function Ne(u){const h=w(),x=le();(u.originalEvent??u).clipboardData.setData("text/plain",x.toString()),a.execCommand("delete"),g(e),E({start:Math.min(h.start,h.end),end:Math.min(h.start,h.end),dir:"<-"}),ee(u)}function H(u,h){const x=[];u.firstChild&&x.push(u.firstChild);let P=x.pop();for(;P&&h(P)!=="stop";)P.nextSibling&&x.push(P.nextSibling),P.firstChild&&x.push(P.firstChild),P=x.pop()}function V(u){return u.metaKey||u.ctrlKey}function ce(u){return V(u)&&!u.shiftKey&&ve(u)==="Z"}function me(u){return V(u)&&u.shiftKey&&ve(u)==="Z"}function K(u){return V(u)&&ve(u)==="C"}function ve(u){let h=u.key||u.keyCode||u.which;if(h)return(typeof h=="string"?h:String.fromCharCode(h)).toUpperCase()}function z(u){u=u.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),a.execCommand("insertHTML",!1,u)}function fe(u,h){let x=0;return(...P)=>{clearTimeout(x),x=s.setTimeout(()=>u(...P),h)}}function ge(u){let h=u.length-1;for(;h>=0&&u[h]!==`
`;)h--;h++;let x=h;for(;x<u.length&&/[ \t]/.test(u[x]);)x++;return[u.substring(h,x)||"",h,x]}function ne(){return e.textContent||""}function ee(u){u.preventDefault()}function le(){return e.getRootNode().getSelection()}return{updateOptions(u){Object.assign(r,u)},updateCode(u,h=!0){e.textContent=u,g(e),h&&d(u)},onUpdate(u){d=u},toString:ne,save:w,restore:E,recordHistory:ie,destroy(){for(let[u,h]of o)e.removeEventListener(u,h)}}}var ct=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function gr(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var $e={exports:{}},lt;function yr(){return lt||(lt=1,(function(e){var t=typeof window<"u"?window:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:{};/**
 * Prism: Lightweight, robust, elegant syntax highlighting
 *
 * @license MIT <https://opensource.org/licenses/MIT>
 * @author Lea Verou <https://lea.verou.me>
 * @namespace
 * @public
 */var n=(function(r){var s=/(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,a=0,o={},i={manual:r.Prism&&r.Prism.manual,disableWorkerMessageHandler:r.Prism&&r.Prism.disableWorkerMessageHandler,util:{encode:function m(p){return p instanceof c?new c(p.type,m(p.content),p.alias):Array.isArray(p)?p.map(m):p.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(m){return Object.prototype.toString.call(m).slice(8,-1)},objId:function(m){return m.__id||Object.defineProperty(m,"__id",{value:++a}),m.__id},clone:function m(p,y){y=y||{};var w,E;switch(i.util.type(p)){case"Object":if(E=i.util.objId(p),y[E])return y[E];w={},y[E]=w;for(var _ in p)p.hasOwnProperty(_)&&(w[_]=m(p[_],y));return w;case"Array":return E=i.util.objId(p),y[E]?y[E]:(w=[],y[E]=w,p.forEach(function(I,T){w[T]=m(I,y)}),w);default:return p}},getLanguage:function(m){for(;m;){var p=s.exec(m.className);if(p)return p[1].toLowerCase();m=m.parentElement}return"none"},setLanguage:function(m,p){m.className=m.className.replace(RegExp(s,"gi"),""),m.classList.add("language-"+p)},currentScript:function(){if(typeof document>"u")return null;if(document.currentScript&&document.currentScript.tagName==="SCRIPT")return document.currentScript;try{throw new Error}catch(w){var m=(/at [^(\r\n]*\((.*):[^:]+:[^:]+\)$/i.exec(w.stack)||[])[1];if(m){var p=document.getElementsByTagName("script");for(var y in p)if(p[y].src==m)return p[y]}return null}},isActive:function(m,p,y){for(var w="no-"+p;m;){var E=m.classList;if(E.contains(p))return!0;if(E.contains(w))return!1;m=m.parentElement}return!!y}},languages:{plain:o,plaintext:o,text:o,txt:o,extend:function(m,p){var y=i.util.clone(i.languages[m]);for(var w in p)y[w]=p[w];return y},insertBefore:function(m,p,y,w){w=w||i.languages;var E=w[m],_={};for(var I in E)if(E.hasOwnProperty(I)){if(I==p)for(var T in y)y.hasOwnProperty(T)&&(_[T]=y[T]);y.hasOwnProperty(I)||(_[I]=E[I])}var O=w[m];return w[m]=_,i.languages.DFS(i.languages,function($,re){re===O&&$!=m&&(this[$]=_)}),_},DFS:function m(p,y,w,E){E=E||{};var _=i.util.objId;for(var I in p)if(p.hasOwnProperty(I)){y.call(p,I,p[I],w||I);var T=p[I],O=i.util.type(T);O==="Object"&&!E[_(T)]?(E[_(T)]=!0,m(T,y,null,E)):O==="Array"&&!E[_(T)]&&(E[_(T)]=!0,m(T,y,I,E))}}},plugins:{},highlightAll:function(m,p){i.highlightAllUnder(document,m,p)},highlightAllUnder:function(m,p,y){var w={callback:y,container:m,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};i.hooks.run("before-highlightall",w),w.elements=Array.prototype.slice.apply(w.container.querySelectorAll(w.selector)),i.hooks.run("before-all-elements-highlight",w);for(var E=0,_;_=w.elements[E++];)i.highlightElement(_,p===!0,w.callback)},highlightElement:function(m,p,y){var w=i.util.getLanguage(m),E=i.languages[w];i.util.setLanguage(m,w);var _=m.parentElement;_&&_.nodeName.toLowerCase()==="pre"&&i.util.setLanguage(_,w);var I=m.textContent,T={element:m,language:w,grammar:E,code:I};function O(re){T.highlightedCode=re,i.hooks.run("before-insert",T),T.element.innerHTML=T.highlightedCode,i.hooks.run("after-highlight",T),i.hooks.run("complete",T),y&&y.call(T.element)}if(i.hooks.run("before-sanity-check",T),_=T.element.parentElement,_&&_.nodeName.toLowerCase()==="pre"&&!_.hasAttribute("tabindex")&&_.setAttribute("tabindex","0"),!T.code){i.hooks.run("complete",T),y&&y.call(T.element);return}if(i.hooks.run("before-highlight",T),!T.grammar){O(i.util.encode(T.code));return}if(p&&r.Worker){var $=new Worker(i.filename);$.onmessage=function(re){O(re.data)},$.postMessage(JSON.stringify({language:T.language,code:T.code,immediateClose:!0}))}else O(i.highlight(T.code,T.grammar,T.language))},highlight:function(m,p,y){var w={code:m,grammar:p,language:y};if(i.hooks.run("before-tokenize",w),!w.grammar)throw new Error('The language "'+w.language+'" has no grammar.');return w.tokens=i.tokenize(w.code,w.grammar),i.hooks.run("after-tokenize",w),c.stringify(i.util.encode(w.tokens),w.language)},tokenize:function(m,p){var y=p.rest;if(y){for(var w in y)p[w]=y[w];delete p.rest}var E=new f;return g(E,E.head,m),d(m,E,p,E.head,0),v(E)},hooks:{all:{},add:function(m,p){var y=i.hooks.all;y[m]=y[m]||[],y[m].push(p)},run:function(m,p){var y=i.hooks.all[m];if(!(!y||!y.length))for(var w=0,E;E=y[w++];)E(p)}},Token:c};r.Prism=i;function c(m,p,y,w){this.type=m,this.content=p,this.alias=y,this.length=(w||"").length|0}c.stringify=function m(p,y){if(typeof p=="string")return p;if(Array.isArray(p)){var w="";return p.forEach(function(O){w+=m(O,y)}),w}var E={type:p.type,content:m(p.content,y),tag:"span",classes:["token",p.type],attributes:{},language:y},_=p.alias;_&&(Array.isArray(_)?Array.prototype.push.apply(E.classes,_):E.classes.push(_)),i.hooks.run("wrap",E);var I="";for(var T in E.attributes)I+=" "+T+'="'+(E.attributes[T]||"").replace(/"/g,"&quot;")+'"';return"<"+E.tag+' class="'+E.classes.join(" ")+'"'+I+">"+E.content+"</"+E.tag+">"};function l(m,p,y,w){m.lastIndex=p;var E=m.exec(y);if(E&&w&&E[1]){var _=E[1].length;E.index+=_,E[0]=E[0].slice(_)}return E}function d(m,p,y,w,E,_){for(var I in y)if(!(!y.hasOwnProperty(I)||!y[I])){var T=y[I];T=Array.isArray(T)?T:[T];for(var O=0;O<T.length;++O){if(_&&_.cause==I+","+O)return;var $=T[O],re=$.inside,_e=!!$.lookbehind,Pe=!!$.greedy,ie=$.alias;if(Pe&&!$.pattern.global){var Be=$.pattern.toString().match(/[imsuy]*$/)[0];$.pattern=RegExp($.pattern.source,Be+"g")}for(var Ne=$.pattern||$,H=w.next,V=E;H!==p.tail&&!(_&&V>=_.reach);V+=H.value.length,H=H.next){var ce=H.value;if(p.length>m.length)return;if(!(ce instanceof c)){var me=1,K;if(Pe){if(K=l(Ne,V,m,_e),!K||K.index>=m.length)break;var ge=K.index,ve=K.index+K[0].length,z=V;for(z+=H.value.length;ge>=z;)H=H.next,z+=H.value.length;if(z-=H.value.length,V=z,H.value instanceof c)continue;for(var fe=H;fe!==p.tail&&(z<ve||typeof fe.value=="string");fe=fe.next)me++,z+=fe.value.length;me--,ce=m.slice(V,z),K.index-=V}else if(K=l(Ne,0,ce,_e),!K)continue;var ge=K.index,ne=K[0],ee=ce.slice(0,ge),le=ce.slice(ge+ne.length),u=V+ce.length;_&&u>_.reach&&(_.reach=u);var h=H.prev;ee&&(h=g(p,h,ee),V+=ee.length),S(p,h,me);var x=new c(I,re?i.tokenize(ne,re):ne,ie,ne);if(H=g(p,h,x),le&&g(p,H,le),me>1){var P={cause:I+","+O,reach:u};d(m,p,y,H.prev,V,P),_&&P.reach>_.reach&&(_.reach=P.reach)}}}}}}function f(){var m={value:null,prev:null,next:null},p={value:null,prev:m,next:null};m.next=p,this.head=m,this.tail=p,this.length=0}function g(m,p,y){var w=p.next,E={value:y,prev:p,next:w};return p.next=E,w.prev=E,m.length++,E}function S(m,p,y){for(var w=p.next,E=0;E<y&&w!==m.tail;E++)w=w.next;p.next=w,w.prev=p,m.length-=E}function v(m){for(var p=[],y=m.head.next;y!==m.tail;)p.push(y.value),y=y.next;return p}if(!r.document)return r.addEventListener&&(i.disableWorkerMessageHandler||r.addEventListener("message",function(m){var p=JSON.parse(m.data),y=p.language,w=p.code,E=p.immediateClose;r.postMessage(i.highlight(w,i.languages[y],y)),E&&r.close()},!1)),i;var A=i.util.currentScript();A&&(i.filename=A.src,A.hasAttribute("data-manual")&&(i.manual=!0));function b(){i.manual||i.highlightAll()}if(!i.manual){var N=document.readyState;N==="loading"||N==="interactive"&&A&&A.defer?document.addEventListener("DOMContentLoaded",b):window.requestAnimationFrame?window.requestAnimationFrame(b):window.setTimeout(b,16)}return i})(t);e.exports&&(e.exports=n),typeof ct<"u"&&(ct.Prism=n),n.languages.markup={comment:{pattern:/\x3C!--(?:(?!\x3C!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|\x3C!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},n.languages.markup.tag.inside["attr-value"].inside.entity=n.languages.markup.entity,n.languages.markup.doctype.inside["internal-subset"].inside=n.languages.markup,n.hooks.add("wrap",function(r){r.type==="entity"&&(r.attributes.title=r.content.replace(/&amp;/,"&"))}),Object.defineProperty(n.languages.markup.tag,"addInlined",{value:function(s,a){var o={};o["language-"+a]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:n.languages[a]},o.cdata=/^<!\[CDATA\[|\]\]>$/i;var i={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:o}};i["language-"+a]={pattern:/[\s\S]+/,inside:n.languages[a]};var c={};c[s]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,function(){return s}),"i"),lookbehind:!0,greedy:!0,inside:i},n.languages.insertBefore("markup","cdata",c)}}),Object.defineProperty(n.languages.markup.tag,"addAttribute",{value:function(r,s){n.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+r+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[s,"language-"+s],inside:n.languages[s]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}}),n.languages.html=n.languages.markup,n.languages.mathml=n.languages.markup,n.languages.svg=n.languages.markup,n.languages.xml=n.languages.extend("markup",{}),n.languages.ssml=n.languages.xml,n.languages.atom=n.languages.xml,n.languages.rss=n.languages.xml,(function(r){var s=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;r.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+s.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+s.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+s.source+"$"),alias:"url"}}},selector:{pattern:RegExp(`(^|[{}\\s])[^{}\\s](?:[^{};"'\\s]|\\s+(?![\\s{])|`+s.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:s,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},r.languages.css.atrule.inside.rest=r.languages.css;var a=r.languages.markup;a&&(a.tag.addInlined("style","css"),a.tag.addAttribute("style","css"))})(n),n.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/},n.languages.javascript=n.languages.extend("clike",{"class-name":[n.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+(/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source)+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/}),n.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/,n.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:n.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:n.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:n.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:n.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:n.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),n.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:n.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}}),n.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}}),n.languages.markup&&(n.languages.markup.tag.addInlined("script","javascript"),n.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript")),n.languages.js=n.languages.javascript,(function(){if(typeof n>"u"||typeof document>"u")return;Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);var r="Loading…",s=function(A,b){return"✖ Error "+A+" while fetching file: "+b},a="✖ Error: File does not exist or is empty",o={js:"javascript",py:"python",rb:"ruby",ps1:"powershell",psm1:"powershell",sh:"bash",bat:"batch",h:"c",tex:"latex"},i="data-src-status",c="loading",l="loaded",d="failed",f="pre[data-src]:not(["+i+'="'+l+'"]):not(['+i+'="'+c+'"])';function g(A,b,N){var m=new XMLHttpRequest;m.open("GET",A,!0),m.onreadystatechange=function(){m.readyState==4&&(m.status<400&&m.responseText?b(m.responseText):m.status>=400?N(s(m.status,m.statusText)):N(a))},m.send(null)}function S(A){var b=/^\s*(\d+)\s*(?:(,)\s*(?:(\d+)\s*)?)?$/.exec(A||"");if(b){var N=Number(b[1]),m=b[2],p=b[3];return m?p?[N,Number(p)]:[N,void 0]:[N,N]}}n.hooks.add("before-highlightall",function(A){A.selector+=", "+f}),n.hooks.add("before-sanity-check",function(A){var b=A.element;if(b.matches(f)){A.code="",b.setAttribute(i,c);var N=b.appendChild(document.createElement("CODE"));N.textContent=r;var m=b.getAttribute("data-src"),p=A.language;if(p==="none"){var y=(/\.(\w+)$/.exec(m)||[,"none"])[1];p=o[y]||y}n.util.setLanguage(N,p),n.util.setLanguage(b,p);var w=n.plugins.autoloader;w&&w.loadLanguages(p),g(m,function(E){b.setAttribute(i,l);var _=S(b.getAttribute("data-range"));if(_){var I=E.split(/\r\n?|\n/g),T=_[0],O=_[1]==null?I.length:_[1];T<0&&(T+=I.length),T=Math.max(0,Math.min(T-1,I.length)),O<0&&(O+=I.length),O=Math.max(0,Math.min(O,I.length)),E=I.slice(T,O).join(`
`),b.hasAttribute("data-start")||b.setAttribute("data-start",String(T+1))}N.textContent=E,n.highlightElement(N)},function(E){b.setAttribute(i,d),N.textContent=E})}}),n.plugins.fileHighlight={highlight:function(b){for(var N=(b||document).querySelectorAll(f),m=0,p;p=N[m++];)n.highlightElement(p)}};var v=!1;n.fileHighlight=function(){v||(console.warn("Prism.fileHighlight is deprecated. Use `Prism.plugins.fileHighlight.highlight` instead."),v=!0),n.plugins.fileHighlight.highlight.apply(this,arguments)}})()})($e)),$e.exports}var hr=yr();const He=gr(hr);let ue=null;const bt="memimg-line-numbers";let ze=null;function Er(e){ze=e}function vt(e){ue&&ue.updateCode(e)}function St(){const e=localStorage.getItem(bt);return e===null?!0:e==="true"}function wr(e){localStorage.setItem(bt,e.toString())}function Qe(){const e=document.getElementById("line-numbers"),t=document.getElementById("code-editor");if(!ue||!e)return;const s=ue.toString().split(`
`).length,a=Array.from({length:s},(o,i)=>i+1).join(`
`);e.textContent=a,t.addEventListener("scroll",()=>{e.scrollTop=t.scrollTop})}function br(){const e=document.getElementById("line-numbers"),n=!St();wr(n),e&&(e.style.display=n?"block":"none"),n&&Qe()}function vr(){const e=document.getElementById("line-numbers"),t=St();e&&(e.style.display=t?"block":"none"),t&&Qe()}function je(e,t=""){const n=document.getElementById("status");n.textContent=e,n.className=t,e&&t!=="error"&&setTimeout(()=>{n.textContent="",n.className=""},3e3)}async function At(e,t,n,r){var i,c;if(!ue)return;const s=ue.toString().trim();if(!s)return;let a;try{a=new Function(s)}catch(l){const d=l;let f=d.message;const g=f.match(/\((\d+):(\d+)\)/),S=f.match(/line (\d+)/);let v,A;if(g?(v=parseInt(g[1]),A=parseInt(g[2]),f=`Line ${v}, Col ${A}: ${d.message}`):S&&(v=parseInt(S[1]),f=`Line ${v}: ${d.message}`),v!==void 0){const N=s.split(`
`),m=v-1;m>=0&&m<N.length&&(f+=`

`+N[m])}const b=document.getElementById("error-panel");b.textContent=f,b.style.display="block",je("Syntax error - see below editor","error"),console.error("Syntax error:",d),console.error("Message:",d.message);return}const o=t.createCheckpoint();try{const l=a.call(e);l!==void 0&&console.log("Result:",l);const d=document.getElementById("error-panel");if(d.textContent="",d.style.display="none",n)try{await cr(n,s),ze&&(await new Promise(f=>setTimeout(f,50)),await ze())}catch(f){console.error("Failed to save script to history:",f)}ue.updateCode(""),je("Code executed","success"),r&&r()}catch(l){t.restoreCheckpoint(o);const d=l;let f=d.message;const g=(i=d.stack)==null?void 0:i.match(/<anonymous>:(\d+):(\d+)/),S=(c=d.stack)==null?void 0:c.match(/Function:(\d+):(\d+)/),v=g||S;if(v){const b=parseInt(v[1]),N=parseInt(v[2]),m=b-2;f=`Line ${m}, Col ${N}: ${d.message}`;const p=s.split(`
`),y=m-1;y>=0&&y<p.length&&(console.error("Error at line",m,":",p[y]),f+=`

`+p[y])}const A=document.getElementById("error-panel");A.textContent=f,A.style.display="block",je("Runtime error - changes rolled back","error"),console.error("Runtime error:",d),console.error("Stack:",d.stack),console.log("Delta restored to checkpoint (partial mutations discarded)")}}let we=null;function Sr(e,t,n,r){const s=document.getElementById("code-editor");we={root:e,txn:t,memimgId:n,onExecute:r},ue||(ue=mr(s,o=>{const i=o.textContent||"";He.languages.javascript&&(o.innerHTML=He.highlight(i,He.languages.javascript,"javascript")),Qe()},{tab:"  ",indentOn:/[(\[{]$/}),vr(),s.addEventListener("keydown",async o=>{o.ctrlKey&&o.key==="Enter"&&(o.preventDefault(),we&&await At(we.root,we.txn,we.memimgId,we.onExecute))}))}const Ie="memimg-explorer",Y="memimg-metadata";function Ar(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=Math.random()*16|0;return(e==="x"?t:t&3|8).toString(16)})}async function he(){return new Promise((e,t)=>{const n=indexedDB.open(Ie);n.onerror=()=>{t(n.error)},n.onsuccess=async()=>{const r=n.result,s=r.version,a=!r.objectStoreNames.contains(Y);if(r.close(),await new Promise(o=>setTimeout(o,50)),a){const o=indexedDB.open(Ie,s+1);o.onerror=()=>{t(o.error)},o.onblocked=()=>{},o.onsuccess=()=>{e(o.result)},o.onupgradeneeded=i=>{const c=i.target.result;if(!c.objectStoreNames.contains(Y)){const l=c.createObjectStore(Y,{keyPath:"id"});l.createIndex("createdAt","createdAt",{unique:!1}),l.createIndex("updatedAt","updatedAt",{unique:!1})}}}else{const o=indexedDB.open(Ie);o.onblocked=()=>{},o.onerror=()=>{t(o.error)},o.onsuccess=()=>{e(o.result)}}},n.onupgradeneeded=r=>{const s=r.target.result;if(!s.objectStoreNames.contains(Y)){const a=s.createObjectStore(Y,{keyPath:"id"});a.createIndex("createdAt","createdAt",{unique:!1}),a.createIndex("updatedAt","updatedAt",{unique:!1})}}})}async function xt(){const e=await he();return new Promise((t,n)=>{const o=e.transaction([Y],"readonly").objectStore(Y).index("updatedAt").openCursor(null,"prev"),i=[];o.onsuccess=async()=>{const c=o.result;c?(i.push(c.value),c.continue()):(e.close(),await new Promise(l=>setTimeout(l,50)),t(i))},o.onerror=async()=>{e.close(),await new Promise(c=>setTimeout(c,50)),n(o.error)}})}async function xr(e){const t=await he();return new Promise((n,r)=>{const o=t.transaction([Y],"readonly").objectStore(Y).get(e);o.onsuccess=async()=>{t.close(),await new Promise(i=>setTimeout(i,50)),n(o.result||null)},o.onerror=async()=>{t.close(),await new Promise(i=>setTimeout(i,50)),r(o.error)}})}async function Tt(e,t){const n=await xt(),r=e.trim().toLowerCase();return n.some(a=>a.id!==t&&a.name.toLowerCase()===r)}async function Tr(e,t=""){if(!e||e.trim().length===0)throw new Error("Memory image name cannot be empty");if(await Tt(e))throw new Error("A memory image with this name already exists");const n={id:Ar(),name:e.trim(),description:t.trim(),createdAt:Date.now(),updatedAt:Date.now(),eventCount:0},r=await he();return new Promise((s,a)=>{const c=r.transaction([Y],"readwrite").objectStore(Y).add(n);c.onsuccess=async()=>{r.close(),await new Promise(l=>setTimeout(l,50)),s(n)},c.onerror=async()=>{r.close(),await new Promise(l=>setTimeout(l,50)),a(c.error)}})}async function _r(e,t){if(!t||t.trim().length===0)throw new Error("Memory image name cannot be empty");if(await Tt(t,e))throw new Error("A memory image with this name already exists");const n=await he();return new Promise((r,s)=>{const o=n.transaction([Y],"readwrite").objectStore(Y),i=o.get(e);i.onsuccess=async()=>{const c=i.result;if(!c){n.close(),await new Promise(d=>setTimeout(d,50)),s(new Error(`Memory image not found: ${e}`));return}c.name=t.trim(),c.updatedAt=Date.now();const l=o.put(c);l.onsuccess=async()=>{n.close(),await new Promise(d=>setTimeout(d,50)),r()},l.onerror=async()=>{n.close(),await new Promise(d=>setTimeout(d,50)),s(l.error)}},i.onerror=async()=>{n.close(),await new Promise(c=>setTimeout(c,50)),s(i.error)}})}async function Pr(e,t){const n=await he();return new Promise((r,s)=>{const o=n.transaction([Y],"readwrite").objectStore(Y),i=o.get(e);i.onsuccess=async()=>{const c=i.result;if(!c){n.close(),await new Promise(d=>setTimeout(d,50)),s(new Error(`Memory image not found: ${e}`));return}c.description=t.trim(),c.updatedAt=Date.now();const l=o.put(c);l.onsuccess=async()=>{n.close(),await new Promise(d=>setTimeout(d,50)),r()},l.onerror=async()=>{n.close(),await new Promise(d=>setTimeout(d,50)),s(l.error)}},i.onerror=async()=>{n.close(),await new Promise(c=>setTimeout(c,50)),s(i.error)}})}async function Nr(e){const t=await he();return new Promise((n,r)=>{const a=t.transaction([Y],"readwrite").objectStore(Y),o=a.get(e);o.onsuccess=async()=>{const i=o.result;if(!i){t.close(),await new Promise(l=>setTimeout(l,50)),r(new Error(`Memory image not found: ${e}`));return}i.updatedAt=Date.now();const c=a.put(i);c.onsuccess=async()=>{t.close(),await new Promise(l=>setTimeout(l,50)),n()},c.onerror=async()=>{t.close(),await new Promise(l=>setTimeout(l,50)),r(c.error)}},o.onerror=async()=>{t.close(),await new Promise(i=>setTimeout(i,50)),r(o.error)}})}async function Ir(e){const t=await he();return new Promise((n,r)=>{const o=t.transaction([Y],"readwrite").objectStore(Y).delete(e);o.onsuccess=async()=>{const i=`events-${e}`,c=Ze(e);try{const l=t.objectStoreNames.contains(i),d=t.objectStoreNames.contains(c);if(l||d){t.close(),await new Promise(S=>setTimeout(S,50));const f=t.version,g=indexedDB.open(Ie,f+1);g.onupgradeneeded=S=>{const v=S.target.result;v.objectStoreNames.contains(i)&&v.deleteObjectStore(i),v.objectStoreNames.contains(c)&&v.deleteObjectStore(c)},g.onsuccess=async()=>{g.result.close(),await new Promise(S=>setTimeout(S,50)),n()},g.onerror=()=>{r(g.error)}}else t.close(),await new Promise(f=>setTimeout(f,50)),n()}catch(l){t.close(),await new Promise(d=>setTimeout(d,50)),r(l)}},o.onerror=async()=>{t.close(),await new Promise(i=>setTimeout(i,50)),r(o.error)}})}function Cr(e){return`events-${e}`}function dt(e){const t=new Date(e),r=new Date().getTime()-t.getTime(),s=Math.floor(r/6e4),a=Math.floor(r/36e5),o=Math.floor(r/864e5);return s<1?"Just now":s<60?`${s}m ago`:a<24?`${a}h ago`:o<7?`${o}d ago`:t.toLocaleDateString()}async function Oe(e,t){try{const n=await xt();if(n.length===0){e.innerHTML=`
        <div class="empty-state">
          <div class="empty-icon">📦</div>
          <h2>No Memory Images Yet</h2>
          <p>Create your first memory image to get started</p>
          <button id="create-first-btn" class="primary-button">+ New Memory Image</button>
        </div>
      `,e.querySelector("#create-first-btn").addEventListener("click",()=>_t(e,t));return}const r=`
      <div class="memimg-grid">
        ${n.map(s=>Lr(s,t)).join("")}
      </div>
    `;e.innerHTML=r,n.forEach(s=>{const a=e.querySelector(`[data-id="${s.id}"]`);a.querySelector(".open-btn").addEventListener("click",d=>{d.stopPropagation(),t(s.id)}),a.querySelector(".rename-btn").addEventListener("click",d=>{d.stopPropagation(),Rr(s,e,t)}),a.querySelector(".edit-desc-btn").addEventListener("click",d=>{d.stopPropagation(),kr(s,e,t)}),a.querySelector(".delete-btn").addEventListener("click",async d=>{if(d.stopPropagation(),confirm(`Delete "${s.name}"? This cannot be undone.`))try{await Ir(s.id),await new Promise(f=>setTimeout(f,50)),await Oe(e,t)}catch(f){alert(`Error deleting memory image: ${f.message}`)}}),a.addEventListener("click",()=>t(s.id))})}catch(n){e.innerHTML=`
      <div class="error-state">
        <h2>Error Loading Memory Images</h2>
        <p>${n.message}</p>
      </div>
    `}}function Lr(e,t){const n=e.eventCount!==void 0?`${e.eventCount} events`:"Unknown size";return`
    <div class="memimg-card" data-id="${e.id}">
      <div class="card-header">
        <h3 class="card-title">${ke(e.name)}</h3>
        <div class="card-actions">
          <button class="icon-btn rename-btn" title="Rename">✏️</button>
          <button class="icon-btn edit-desc-btn" title="Edit description">📝</button>
          <button class="icon-btn delete-btn" title="Delete">🗑️</button>
        </div>
      </div>
      <div class="card-body">
        <p class="card-description">${ke(e.description)||"<em>No description</em>"}</p>
        <div class="card-meta">
          <span class="meta-item">📅 Created ${dt(e.createdAt)}</span>
          <span class="meta-item">🕒 Updated ${dt(e.updatedAt)}</span>
          <span class="meta-item">📊 ${n}</span>
        </div>
      </div>
      <div class="card-footer">
        <button class="open-btn">Open →</button>
      </div>
    </div>
  `}function _t(e,t){const n=document.createElement("div");n.className="modal-overlay",n.innerHTML=`
    <div class="modal-dialog">
      <div class="modal-header">
        <h2>New Memory Image</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="memimg-name">Name *</label>
          <input type="text" id="memimg-name" class="form-input" placeholder="My Memory Image" required autofocus>
        </div>
        <div class="form-group">
          <label for="memimg-desc">Description</label>
          <textarea id="memimg-desc" class="form-textarea" placeholder="Optional description" rows="3"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel-btn">Cancel</button>
        <button class="create-btn primary-button">Create</button>
      </div>
    </div>
  `,document.body.appendChild(n);const r=n.querySelector("#memimg-name"),s=n.querySelector("#memimg-desc"),a=n.querySelector(".modal-close"),o=n.querySelector(".cancel-btn"),i=n.querySelector(".create-btn"),c=()=>{n.remove()},l=async()=>{const d=r.value.trim();if(!d){alert("Please enter a name"),r.focus();return}i.disabled=!0;const f=i.textContent;i.textContent="Creating...";try{console.log("Creating memory image:",d);const g=await Tr(d,s.value.trim());console.log("Memory image created:",g),c(),t(g.id)}catch(g){console.error("Error creating memory image:",g),alert(`Error creating memory image: ${g.message}`),i.disabled=!1,i.textContent=f,r.focus()}};a.addEventListener("click",c),o.addEventListener("click",c),i.addEventListener("click",l),r.addEventListener("keydown",d=>{d.key==="Enter"&&(d.preventDefault(),l())}),n.addEventListener("keydown",d=>{d.key==="Escape"&&c()}),n.addEventListener("click",d=>{d.target===n&&c()}),r.focus()}function Rr(e,t,n){const r=document.createElement("div");r.className="modal-overlay",r.innerHTML=`
    <div class="modal-dialog">
      <div class="modal-header">
        <h2>Rename Memory Image</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="memimg-name">Name *</label>
          <input type="text" id="memimg-name" class="form-input" value="${ke(e.name)}" required autofocus>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel-btn">Cancel</button>
        <button class="save-btn primary-button">Save</button>
      </div>
    </div>
  `,document.body.appendChild(r);const s=r.querySelector("#memimg-name"),a=r.querySelector(".modal-close"),o=r.querySelector(".cancel-btn"),i=r.querySelector(".save-btn"),c=()=>{r.remove()},l=async()=>{const d=s.value.trim();if(!d){alert("Please enter a name"),s.focus();return}try{await _r(e.id,d),c(),await Oe(t,n)}catch(f){alert(`Error renaming: ${f.message}`)}};a.addEventListener("click",c),o.addEventListener("click",c),i.addEventListener("click",l),s.addEventListener("keydown",d=>{d.key==="Enter"&&(d.preventDefault(),l())}),r.addEventListener("keydown",d=>{d.key==="Escape"&&c()}),r.addEventListener("click",d=>{d.target===r&&c()}),s.select()}function kr(e,t,n){const r=document.createElement("div");r.className="modal-overlay",r.innerHTML=`
    <div class="modal-dialog">
      <div class="modal-header">
        <h2>Edit Description</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="memimg-desc">Description</label>
          <textarea id="memimg-desc" class="form-textarea" rows="4" autofocus>${ke(e.description)}</textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel-btn">Cancel</button>
        <button class="save-btn primary-button">Save</button>
      </div>
    </div>
  `,document.body.appendChild(r);const s=r.querySelector("#memimg-desc"),a=r.querySelector(".modal-close"),o=r.querySelector(".cancel-btn"),i=r.querySelector(".save-btn"),c=()=>{r.remove()},l=async()=>{try{await Pr(e.id,s.value.trim()),c(),await Oe(t,n)}catch(d){alert(`Error updating description: ${d.message}`)}};a.addEventListener("click",c),o.addEventListener("click",c),i.addEventListener("click",l),r.addEventListener("keydown",d=>{d.key==="Escape"&&c()}),r.addEventListener("click",d=>{d.target===r&&c()}),s.focus()}function ke(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}const Pt=50;function Dr(e){const n=Date.now()-e,r=Math.floor(n/1e3),s=Math.floor(r/60),a=Math.floor(s/60),o=Math.floor(a/24);return r<60?"just now":s<60?`${s} min${s>1?"s":""} ago`:a<24?`${a} hour${a>1?"s":""} ago`:`${o} day${o>1?"s":""} ago`}function Fr(e){return new Date(e).toLocaleString()}function ut(e,t=Pt){return e.length<=t?e:e.substring(0,t)+"..."}function Ue(e){const t=document.createElement("div");return t.textContent=e,t.innerHTML}function Nt(e,t,n){const r=document.createElement("div");r.className="history-entry",r.dataset.entryId=e.id;const s=e.code.length>Pt,a=ut(e.code);r.innerHTML=`
    <div class="history-entry-header">
      <span class="history-status">●</span>
      <span class="history-timestamp" title="${Ue(Fr(e.timestamp))}">
        ${Ue(Dr(e.timestamp))}
      </span>
      <span class="history-size">${e.characterCount} chars</span>
    </div>
    <div class="history-code ${s?"expandable":""}" data-expanded="false">
      <pre>${Ue(a)}</pre>
    </div>
    <div class="history-actions">
      <button class="history-btn load-btn" title="Load into editor">⬆ Load</button>
      <button class="history-btn copy-btn" title="Copy to clipboard">📋 Copy</button>
      ${s?'<button class="history-btn expand-btn" title="Expand/collapse">▼ Expand</button>':""}
    </div>
  `;const o=r.querySelector(".load-btn"),i=r.querySelector(".copy-btn"),c=r.querySelector(".expand-btn"),l=r.querySelector(".history-code");return o==null||o.addEventListener("click",d=>{d.stopPropagation(),t(e.code)}),i==null||i.addEventListener("click",async d=>{d.stopPropagation(),n(e.code)}),c&&s&&c.addEventListener("click",d=>{d.stopPropagation(),l.dataset.expanded==="true"?(l.querySelector("pre").textContent=ut(e.code),l.dataset.expanded="false",c.textContent="▼ Expand"):(l.querySelector("pre").textContent=e.code,l.dataset.expanded="true",c.textContent="▲ Collapse")}),r}async function We(e,t,n){try{const r=await Fe(t,100);if(e.innerHTML="",r.length===0){e.innerHTML='<div class="history-empty">No script history yet. Run a script to get started.</div>';return}for(const o of r){const i=Nt(o,n,async c=>{try{await navigator.clipboard.writeText(c);const l=e.querySelector(`[data-entry-id="${o.id}"] .copy-btn`);if(l){const d=l.textContent;l.textContent="✓ Copied",setTimeout(()=>{l.textContent=d},1e3)}}catch(l){console.error("Failed to copy:",l),alert("Failed to copy to clipboard")}});e.appendChild(i)}const s=await fr(t),a=document.querySelector(".history-stats");if(a){const o=(s.totalSize/1048576).toFixed(2);a.textContent=`${s.count} entries, ${o} MB`}}catch(r){console.error("Failed to render script history:",r),e.innerHTML='<div class="history-error">Failed to load script history</div>'}}function Or(e,t,n,r){let s=null;e.addEventListener("input",()=>{s&&clearTimeout(s),s=window.setTimeout(async()=>{const a=e.value.trim();try{const o=a?await lr(n,a):await Fe(n,100);if(t.innerHTML="",o.length===0){t.innerHTML='<div class="history-empty">No matching scripts found.</div>';return}for(const i of o){const c=Nt(i,r,async l=>{try{await navigator.clipboard.writeText(l);const d=t.querySelector(`[data-entry-id="${i.id}"] .copy-btn`);if(d){const f=d.textContent;d.textContent="✓ Copied",setTimeout(()=>{d.textContent=f},1e3)}}catch(d){console.error("Failed to copy:",d),alert("Failed to copy to clipboard")}});t.appendChild(c)}}catch(o){console.error("Search failed:",o),t.innerHTML='<div class="history-error">Search failed</div>'}},300)})}function Mr(e,t,n){e.addEventListener("click",async()=>{if(confirm("Clear all script history? This cannot be undone."))try{await dr(t),n()}catch(r){console.error("Failed to clear history:",r),alert("Failed to clear history")}})}function Br(e,t,n){e.addEventListener("click",async()=>{try{const r=await ur(t),s=new Blob([r],{type:"application/json"}),a=URL.createObjectURL(s),o=document.createElement("a");o.href=a;const i=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);o.download=`${n}-script-history-${i}.json`,o.click(),URL.revokeObjectURL(a)}catch(r){console.error("Failed to export history:",r),alert("Failed to export history")}})}let U=null,oe=null,F=null,B=null,R;const Q=new En;function et(e){window.location.hash=e}function It(){const e=window.location.hash.slice(1);if(!e||e==="/")return{view:"list"};const t=e.match(/^\/edit\/(.+)$/);return t?{view:"edit",memimgId:t[1]}:{view:"list"}}async function $r(){const e=It();if(e.view==="list")U&&await Dt();else if(e.view==="edit"&&e.memimgId&&U!==e.memimgId)try{await Me(e.memimgId)}catch(t){console.error(`Failed to open memory image from hash: ${e.memimgId}`,t),L(`Memory image not found: ${e.memimgId}`,"error"),et("/")}}const Ct=document.getElementById("list-view"),Lt=document.getElementById("explorer-view"),Rt=document.getElementById("memimg-list-content");window.viewAsJson=function(e,t=!0){const n=JSON.parse(pt(e,new WeakMap)),r=t?JSON.stringify(n,null,2):JSON.stringify(n);return console.log(r),n};function L(e,t=""){const n=document.getElementById("status");n&&(n.textContent=e,n.className="status-bar "+t,e&&t!=="error"&&setTimeout(()=>{n.textContent="",n.className="status-bar"},3e3))}function pe(){const e=F?F.isDirty():!1,t=document.getElementById("dirty-indicator"),n=document.getElementById("discard-btn");!t||!n||(e?(t.style.display="flex",n.style.display="inline-block"):(t.style.display="none",n.style.display="none"))}function te(){B&&(Cn(B,Q,document.getElementById("tree-view"),te),sr(B,Q,document.getElementById("inspector-view"),te),Hr(),pe())}function Hr(){const e=document.getElementById("back-btn"),t=document.getElementById("forward-btn");!e||!t||(e.disabled=!Q.canGoBack(),t.disabled=!Q.canGoForward())}async function jr(){if(!B){L("No memory image open","error");return}try{const e=window.ObjectType,t=window.NumberType,n=window.StringType,r=window.DateTypeInstance;if(!e)throw new Error("ObjectType not found - javascript-types library not loaded");const s=e({name:"Name",properties:{firstName:{type:n},middleName:{type:n},lastName:{type:n}}}),a=e({name:"Dept",properties:{deptno:{type:t},dname:{type:n},loc:{type:n},emps:{type:null}}}),o=e({name:"Emp",properties:{empno:{type:t},ename:{type:s},job:{type:n},mgr:{type:null},hiredate:{type:r},sal:{type:t},comm:{type:t},dept:{type:a},subordinates:{type:null}}}),i=a({deptno:10,dname:"ACCOUNTING",loc:"NEW YORK"}),c=a({deptno:20,dname:"RESEARCH",loc:"DALLAS"}),l=a({deptno:30,dname:"SALES",loc:"CHICAGO"}),d=a({deptno:40,dname:"OPERATIONS",loc:"BOSTON"}),f=o({empno:7839,ename:s({firstName:"Arthur",middleName:"Rex",lastName:"KING"}),job:"PRESIDENT",mgr:null,hiredate:new Date("1981-11-17"),sal:5e3,comm:null,dept:i,subordinates:[]}),g=o({empno:7566,ename:s({firstName:"Indiana",middleName:"Henry",lastName:"JONES"}),job:"MANAGER",mgr:f,hiredate:new Date("1981-04-02"),sal:2975,comm:null,dept:c,subordinates:[]}),S=o({empno:7698,ename:s({firstName:"William",middleName:"Arthur",lastName:"BLAKE"}),job:"MANAGER",mgr:f,hiredate:new Date("1981-05-01"),sal:2850,comm:null,dept:l,subordinates:[]}),v=o({empno:7369,ename:s({firstName:"John",middleName:"Paul",lastName:"SMITH"}),job:"CLERK",mgr:g,hiredate:new Date("1980-12-17"),sal:800,comm:null,dept:c,subordinates:[]}),A=o({empno:7499,ename:s({firstName:"Ethan",middleName:"James",lastName:"ALLEN"}),job:"SALESMAN",mgr:S,hiredate:new Date("1981-02-20"),sal:1600,comm:300,dept:l,subordinates:[]}),b=o({empno:7521,ename:s({firstName:"Christopher",middleName:"Lee",lastName:"WARD"}),job:"SALESMAN",mgr:S,hiredate:new Date("1981-02-22"),sal:1250,comm:500,dept:l,subordinates:[]});i.emps=[f],c.emps=[g,v],l.emps=[S,A,b],d.emps=[],f.subordinates=[g,S],g.subordinates=[v],S.subordinates=[A,b],v.subordinates=[],A.subordinates=[],b.subordinates=[],B.depts={accounting:i,research:c,sales:l,operations:d},B.emps={king:f,jones:g,blake:S,smith:v,allen:A,ward:b},window.types={Dept:a,Emp:o,Name:s},console.log("Types available at: window.types = { Dept, Emp, Name }"),L("Scott schema loaded (with ObjectType)","success"),pe(),await te()}catch(e){const t=e;L("Error loading Scott: "+t.message,"error"),console.error(t)}}async function Ur(){if(!F){L("Transaction not initialized","error");return}if(!F.isDirty()){L("No changes to save","success");return}try{console.log("Committing transaction to IndexedDB..."),await F.save(),U&&await Nr(U),pe(),L("Changes saved to IndexedDB","success"),await te()}catch(e){const t=e;L("Save error: "+t.message,"error"),console.error(t)}}async function Yr(){if(!F){L("Transaction not initialized","error");return}if(F.isDirty()&&confirm("Discard all unsaved changes?"))try{console.log("Rolling back transaction..."),F.discard(),pe(),L("Changes discarded","success"),await te()}catch(e){L("Discard error: "+e.message,"error"),console.error(e)}}async function qr(){if(confirm("Clear all data from memory image and IndexedDB?")){if(!R||!F){L("Not initialized","error");return}try{for(const e in B)delete B[e];await F.save(),R!=null&&R.clear&&await R.clear(),F=await Ce(R),B=F.root,window.root=B,Q.reset(),pe(),L("Cleared all data","success"),await te()}catch(e){const t=e;L("Clear error: "+t.message,"error"),console.error(t)}}}function kt(e,t){const n=new Blob([t],{type:"text/plain"}),r=URL.createObjectURL(n),s=document.createElement("a");s.href=r,s.download=e,s.click(),URL.revokeObjectURL(r)}function zr(e){const t=(n,r=new WeakSet)=>{if(n==null||typeof n!="object")return n;if(r.has(n))return{__type__:"cyclic_ref"};if(r.add(n),n instanceof Date)return{__type__:"date",value:n.toISOString()};if(Array.isArray(n))return n.map(a=>t(a,r));if(n instanceof Map)return{__type__:"map",entries:Array.from(n.entries()).map(([a,o])=>[t(a,r),t(o,r)])};if(n instanceof Set)return{__type__:"set",values:Array.from(n).map(a=>t(a,r))};const s={};for(const a in n)n.hasOwnProperty(a)&&(s[a]=t(n[a],r));return s};return{type:e.type,path:e.path,timestamp:e.timestamp,...e.value!==void 0&&{value:t(e.value)},...e.items!==void 0&&{items:t(e.items)},...e.key!==void 0&&{key:t(e.key)},...e.source!==void 0&&{source:e.source},...e.start!==void 0&&{start:e.start},...e.deleteCount!==void 0&&{deleteCount:e.deleteCount},...e.target!==void 0&&{target:e.target},...e.end!==void 0&&{end:e.end}}}async function Wr(){if(!B){L("No memory image open","error");return}if(!oe){L("No metadata available","error");return}try{console.log("Exporting snapshot...");const e=pt(B,new WeakMap),t=JSON.parse(e),n={type:"snapshot",version:1,timestamp:Date.now(),name:oe.name,description:oe.description,state:t},r=JSON.stringify(n,null,2),s=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5),a=`${oe.name}-snapshot-${s}.json`;kt(a,r),L(`Exported snapshot to ${a}`,"success"),console.log(`Exported snapshot (${r.length} bytes)`)}catch(e){const t=e;L("Export error: "+t.message,"error"),console.error("Export error:",t)}}async function Gr(){if(!R){L("No memory image open","error");return}if(!oe){L("No metadata available","error");return}try{console.log("Exporting events...");const e=await R.getAll();if(e.length===0){L("No events to export","success");return}const t=e.map(s=>zr(s)).map(s=>JSON.stringify(s)).join(`
`),n=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5),r=`${oe.name}-${n}.ndjson`;kt(r,t),L(`Exported ${e.length} events to ${r}`,"success"),console.log(`Exported ${e.length} events`)}catch(e){const t=e;L("Export error: "+t.message,"error"),console.error("Export error:",t)}}function Vr(e){const t=n=>{if(n==null||typeof n!="object")return n;if(n.__type__)switch(n.__type__){case"date":return new Date(n.value);case"map":return new Map(n.entries.map(([s,a])=>[t(s),t(a)]));case"set":return new Set(n.values.map(t));case"cyclic_ref":return n;default:return n}if(Array.isArray(n))return n.map(t);const r={};for(const s in n)n.hasOwnProperty(s)&&(r[s]=t(n[s]));return r};return{type:e.type,path:e.path,timestamp:e.timestamp,...e.value!==void 0&&{value:t(e.value)},...e.items!==void 0&&{items:t(e.items)},...e.key!==void 0&&{key:t(e.key)},...e.source!==void 0&&{source:e.source},...e.start!==void 0&&{start:e.start},...e.deleteCount!==void 0&&{deleteCount:e.deleteCount},...e.target!==void 0&&{target:e.target},...e.end!==void 0&&{end:e.end}}}async function Jr(e){if(!R||!F){L("No memory image open","error");return}try{console.log(`Importing from ${e.name}...`);const t=await e.text();let n=!1,r=null;try{const s=JSON.parse(t);s&&typeof s=="object"&&s.type==="snapshot"&&(n=!0,r=s,console.log("Detected snapshot format"))}catch{console.log("Not a snapshot, trying NDJSON format")}if(n&&r){if(console.log(`Importing snapshot: ${r.name||"unnamed"}`),!confirm(`Import snapshot "${r.name||e.name}"? This will replace all current data.`))return;R!=null&&R.clear&&(await R.clear(),console.log("Cleared existing event log"));const s=gn(r.state);if(s&&typeof s=="object"){for(const a in s)if(Object.prototype.hasOwnProperty.call(s,a)){const o={type:"SET",path:[a],value:s[a],timestamp:r.timestamp||Date.now()};await R.append(o)}}console.log("Snapshot imported successfully"),F=await Ce(R),B=F.root,window.root=B,Q.reset(),pe(),L(`Imported snapshot from ${e.name}`,"success"),await te()}else{console.log("Importing event log (NDJSON)");const s=t.trim().split(`
`).filter(o=>o.trim());if(s.length===0){L("No events found in file","error");return}const a=s.map(o=>{try{const i=JSON.parse(o);return Vr(i)}catch{throw new Error(`Invalid JSON in file: ${o.slice(0,50)}...`)}});if(console.log(`Parsed ${a.length} events`),!confirm(`Import ${a.length} events? This will replace all current data.`))return;R!=null&&R.clear&&(await R.clear(),console.log("Cleared existing event log"));for(const o of a)await R.append(o);console.log(`Replayed ${a.length} events`),F=await Ce(R),B=F.root,window.root=B,Q.reset(),pe(),L(`Imported ${a.length} events from ${e.name}`,"success"),await te()}}catch(t){const n=t;L("Import error: "+n.message,"error"),console.error("Import error:",n)}}function Kr(){document.querySelectorAll(".resize-handle").forEach(t=>{let n=0,r=0,s=0,a=null,o=null;t.addEventListener("mousedown",l=>{l.preventDefault();const d=t.dataset.direction;a=t.previousElementSibling,o=t.nextElementSibling,!(!a||!o)&&(n=d==="vertical"?l.clientY:l.clientX,r=d==="vertical"?a.offsetHeight:a.offsetWidth,s=d==="vertical"?o.offsetHeight:o.offsetWidth,document.addEventListener("mousemove",i),document.addEventListener("mouseup",c),document.body.style.cursor=d==="vertical"?"ns-resize":"ew-resize",document.body.style.userSelect="none")});function i(l){if(!a||!o||!t)return;const d=t.dataset.direction,g=(d==="vertical"?l.clientY:l.clientX)-n,S=r+g,v=s-g,A=200;S<A||v<A||(d==="vertical"?(a.style.flex="none",a.style.height=`${S}px`,o.style.flex="none",o.style.height=`${v}px`):(a.style.flex="none",a.style.width=`${S}px`,o.style.flex="none",o.style.width=`${v}px`))}function c(){document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",c),document.body.style.cursor="",document.body.style.userSelect=""}})}function Xr(){if(!U||!oe)return;const e=document.getElementById("history-list"),t=document.getElementById("history-search"),n=document.getElementById("clear-history-btn"),r=document.getElementById("export-history-btn"),s=document.getElementById("toggle-history-btn"),a=document.getElementById("close-history-btn"),o=document.getElementById("script-history-sidebar");if(!e||!t||!n||!r)return;let i=!1;const c=d=>{vt(d);const f=document.getElementById("code-editor");f&&f.focus(),o&&o.classList.add("collapsed")},l=async()=>{if(!i&&U)try{await We(e,U,c),i=!0}catch(d){console.error("Failed to load script history:",d),e.innerHTML='<div class="history-error">Failed to load history</div>'}};Or(t,e,U,c),Mr(n,U,async()=>{U&&(await We(e,U,c),i=!0)}),Br(r,U,oe.name),s&&o&&(s.onclick=async()=>{const d=o.classList.contains("collapsed");o.classList.toggle("collapsed"),d&&await l()}),a&&o&&(a.onclick=()=>{o.classList.add("collapsed")}),e.innerHTML='<div class="history-empty">Open history panel to view scripts</div>'}async function Zr(){if(!U)return;const e=document.getElementById("script-history-sidebar"),t=document.getElementById("history-list");if(!e||!t||e.classList.contains("collapsed"))return;await We(t,U,r=>{vt(r);const s=document.getElementById("code-editor");s&&s.focus(),e&&e.classList.add("collapsed")})}async function Ge(){Lt.style.display="none",Ct.style.display="flex",await Oe(Rt,Me),document.title="Navigator - Memory Image Explorer",et("/"),console.log("Showing list view")}async function Me(e){U=e;try{console.log(`Opening memory image: ${e}`);const t=await xr(e);if(!t)throw new Error(`Memory image not found: ${e}`);oe=t,await ir(e),console.log("Script history store ensured");const n=Cr(e);R=hn("memimg-explorer",n),F=await Ce(R),B=F.root,window.root=B,Q.onNavigate=te;const r=R.append.bind(R);R.append=async function(o){await r(o),pe()},Ct.style.display="none",Lt.style.display="flex";const s=document.getElementById("current-memimg-name");s&&(s.textContent=t.name),document.title=`${t.name} - Navigator`;const a=document.getElementById("code-editor");a&&(a.value=""),Xr(),Sr(B,F,U,te),Er(Zr),L("Ready","success"),await te(),et(`/edit/${e}`),console.log("Memory image opened successfully")}catch(t){const n=t;L("Error opening memory image: "+n.message,"error"),console.error("Open error:",n)}}async function Dt(){if(F&&F.isDirty()&&!confirm("You have unsaved changes. Close anyway?"))return;const e=document.getElementById("code-editor");e&&(e.value="");const t=document.getElementById("script-history-sidebar");if(t&&t.classList.add("collapsed"),R!=null&&R.close)try{await R.close()}catch{}U=null,oe=null,F=null,B=null,R=void 0,window.root=void 0,Q.reset(),await Ge(),console.log("Memory image closed")}const Ft="memimg-theme";function Ot(){return localStorage.getItem(Ft)||"dark"}function Mt(e){localStorage.setItem(Ft,e),document.documentElement.setAttribute("data-theme",e),Qr(e)}function Qr(e){const t=e==="dark"?"☀️":"🌙",n=document.getElementById("theme-toggle-list"),r=document.getElementById("theme-toggle-explorer");n&&(n.textContent=t),r&&(r.textContent=t)}function ft(){const t=Ot()==="dark"?"light":"dark";Mt(t)}function es(){const e=Ot();Mt(e)}function ts(){const e=document.getElementById("create-memimg-btn");e&&e.addEventListener("click",()=>{_t(Rt,Me)});const t=document.getElementById("back-to-list-btn");t&&t.addEventListener("click",Dt);const n=document.getElementById("back-btn"),r=document.getElementById("forward-btn");n&&n.addEventListener("click",()=>{Q.goBack()}),r&&r.addEventListener("click",()=>{Q.goForward()}),document.addEventListener("keydown",b=>{b.altKey&&b.key==="ArrowLeft"&&(b.preventDefault(),Q.goBack()),b.altKey&&b.key==="ArrowRight"&&(b.preventDefault(),Q.goForward())});const s=document.getElementById("load-scott-btn"),a=document.getElementById("export-snapshot-btn"),o=document.getElementById("export-events-btn"),i=document.getElementById("import-events-btn"),c=document.getElementById("save-btn"),l=document.getElementById("discard-btn"),d=document.getElementById("clear-btn");s&&s.addEventListener("click",jr),a&&a.addEventListener("click",Wr),o&&o.addEventListener("click",Gr),i&&i.addEventListener("click",()=>{const b=document.getElementById("events-file-input");b&&b.click()}),c&&c.addEventListener("click",Ur),l&&l.addEventListener("click",Yr),d&&d.addEventListener("click",qr);const f=document.getElementById("events-file-input");f&&f.addEventListener("change",async b=>{var p;const N=b.target,m=(p=N.files)==null?void 0:p[0];m&&(await Jr(m),N.value="")});const g=document.getElementById("run-btn");g&&g.addEventListener("click",async()=>{B&&F&&U&&await At(B,F,U,te)});const S=document.getElementById("toggle-line-numbers-btn");S&&S.addEventListener("click",br),window.addEventListener("hashchange",$r),Kr();const v=document.getElementById("theme-toggle-list"),A=document.getElementById("theme-toggle-explorer");v&&v.addEventListener("click",ft),A&&A.addEventListener("click",ft),console.log("Event listeners attached")}(async()=>{try{console.log("Initializing Navigator..."),window.addEventListener("pageshow",n=>{if(n.persisted){const r=document.getElementById("code-editor");r&&(r.value="")}});const e=document.getElementById("code-editor");e&&(e.value=""),es(),ts();const t=It();if(t.view==="edit"&&t.memimgId){console.log(`Loading memory image from hash: ${t.memimgId}`);try{await Me(t.memimgId)}catch(n){console.error(`Failed to load memory image from hash: ${t.memimgId}`,n),L(`Could not load memory image: ${t.memimgId}`,"error"),await Ge()}}else await Ge();console.log("Navigator initialization complete")}catch(e){console.error("Failed to initialize:",e),L("Initialization error: "+e.message,"error")}})();</script>
  <link rel="stylesheet" crossorigin href="./navigator.css">
</head>
<body>
    <div id="app">
        <!-- List View (shown by default) -->
        <div id="list-view" class="view-container">
            <div class="app-title">Filer Navigator</div>
            <header class="list-header">
                <div class="logo">
                    <svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"
                    width="32" height="32" aria-label="Navigator">
                        <circle cx="24" cy="24" r="22" fill="#6366f1"/>
                        <line x1="24" y1="14" x2="16" y2="24" stroke="#fbbf24" stroke-width="2" stroke-linecap="round"/>
                        <line x1="24" y1="14" x2="32" y2="24" stroke="#fbbf24" stroke-width="2" stroke-linecap="round"/>
                        <line x1="16" y1="24" x2="24" y2="34" stroke="#10b981" stroke-width="2" stroke-linecap="round"/>
                        <line x1="32" y1="24" x2="24" y2="34" stroke="#10b981" stroke-width="2" stroke-linecap="round"/>
                        <line x1="16" y1="24" x2="32" y2="24" stroke="#ec4899" stroke-width="2" stroke-linecap="round"/>
                        <circle cx="24" cy="14" r="4" fill="#fef3c7"/>
                        <circle cx="16" cy="24" r="4" fill="#fde68a"/>
                        <circle cx="32" cy="24" r="4" fill="#fde68a"/>
                        <circle cx="24" cy="34" r="4" fill="#fef3c7"/>
                        <circle cx="24" cy="24" r="3" fill="#ffffff"/>
                        <text x="24" y="43" font-family="Arial, sans-serif"
                        font-size="5.5" font-weight="bold" fill="#ffffff"
                        text-anchor="middle" letter-spacing="1.5">Navigator</text>
                    </svg>
                    <h1>Navigator</h1>
                    <span class="subtitle">Memory Image Explorer</span>
                </div>
                <div class="controls">
                    <button id="theme-toggle-list" class="icon-btn" title="Toggle theme">🌙</button>
                    <button id="create-memimg-btn" class="primary-button">+ New Memory Image</button>
                </div>
            </header>
            <div id="memimg-list-content" class="list-content"></div>
        </div>

        <!-- Explorer View (hidden by default) -->
        <div id="explorer-view" class="view-container" style="display: none;">
            <!-- Script History Sidebar -->
            <div id="script-history-sidebar" class="sidebar collapsed">
                <div class="sidebar-header">
                    <h3>Script History</h3>
                    <button id="close-history-btn" class="icon-btn" title="Close history panel">✕</button>
                </div>
                <div class="sidebar-controls">
                    <input type="text" id="history-search" placeholder="Search scripts..." />
                    <button id="export-history-btn" class="icon-btn" title="Export history">📥</button>
                    <button id="clear-history-btn" class="icon-btn" title="Clear history">🗑️</button>
                </div>
                <div class="sidebar-stats">
                    <span class="history-stats"></span>
                </div>
                <div id="history-list" class="sidebar-content"></div>
            </div>

            <div class="app-title">Filer Navigator</div>

            <!-- Header -->
            <header>
                <div class="logo">
                    <svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"
                    width="32" height="32" aria-label="Navigator">
                        <circle cx="24" cy="24" r="22" fill="#6366f1"/>
                        <line x1="24" y1="14" x2="16" y2="24" stroke="#fbbf24" stroke-width="2" stroke-linecap="round"/>
                        <line x1="24" y1="14" x2="32" y2="24" stroke="#fbbf24" stroke-width="2" stroke-linecap="round"/>
                        <line x1="16" y1="24" x2="24" y2="34" stroke="#10b981" stroke-width="2" stroke-linecap="round"/>
                        <line x1="32" y1="24" x2="24" y2="34" stroke="#10b981" stroke-width="2" stroke-linecap="round"/>
                        <line x1="16" y1="24" x2="32" y2="24" stroke="#ec4899" stroke-width="2" stroke-linecap="round"/>
                        <circle cx="24" cy="14" r="4" fill="#fef3c7"/>
                        <circle cx="16" cy="24" r="4" fill="#fde68a"/>
                        <circle cx="32" cy="24" r="4" fill="#fde68a"/>
                        <circle cx="24" cy="34" r="4" fill="#fef3c7"/>
                        <circle cx="24" cy="24" r="3" fill="#ffffff"/>
                        <text x="24" y="43" font-family="Arial, sans-serif"
                        font-size="5.5" font-weight="bold" fill="#ffffff"
                        text-anchor="middle" letter-spacing="1.5">Navigator</text>
                    </svg>
                    <div class="header-info">
                        <button id="back-to-list-btn" class="back-button">← Back to List</button>
                        <h1 id="current-memimg-name">Memory Image</h1>
                    </div>
                </div>
                <div class="controls">
                    <div class="controls-left">
                        <button id="theme-toggle-explorer" class="icon-btn" title="Toggle theme">🌙</button>
                        <span id="dirty-indicator" class="dirty-indicator" style="display: none;">● Unsaved</span>
                        <button id="save-btn" title="Save to IndexedDB">💾 Save</button>
                        <button id="discard-btn" title="Discard unsaved changes" style="display: none;">↩️ Discard</button>
                        <button id="clear-btn" title="Clear all data">🗑️ Clear</button>
                        <button id="import-events-btn" title="Import snapshot or event log">📥 Import</button>
                        <button id="export-snapshot-btn" title="Export current state as JSON snapshot">📸 Export Snapshot</button>
                        <button id="export-events-btn" title="Export full event log as NDJSON">📜 Export Events</button>
                    </div>
                    <div class="controls-right">
                        <button id="load-scott-btn" title="Load example data">📂 Load Example</button>
                    </div>
                </div>
                <!-- Hidden file input for import -->
                <input type="file" id="events-file-input" accept=".json,.ndjson,.txt" style="display: none">
                <div id="status" class="status-bar"></div>
            </header>

            <!-- Code editor (TOP panel) -->
            <section id="editor-panel" class="panel">
                <div class="panel-header">
                    <h2>Code Editor</h2>
                    <div class="editor-controls">
                        <button id="toggle-line-numbers-btn" class="icon-btn" title="Toggle line numbers">#</button>
                        <button id="toggle-history-btn" title="Show script history">📜 History</button>
                        <button id="run-btn" title="Run code (Ctrl+Enter)">▶ Run</button>
                    </div>
                </div>
                <div class="editor-wrapper">
                    <div class="line-numbers" id="line-numbers"></div>
                    <div id="code-editor" class="code-editor" spellcheck="false"></div>
                </div>
                <div id="error-panel" class="error-panel" style="display: none;"></div>
            </section>

            <!-- Vertical resize handle -->
            <div class="resize-handle resize-handle-horizontal" data-direction="vertical"></div>

            <!-- Bottom panels (Object Graph) -->
            <main id="bottom-panels">
                <!-- Tree view (left panel) -->
                <section id="tree-panel" class="panel">
                    <div class="panel-header">
                        <h2>Object Graph</h2>
                        <div class="nav-buttons">
                            <button id="back-btn" title="Back (Alt+Left)" disabled>◀</button>
                            <button id="forward-btn" title="Forward (Alt+Right)" disabled>▶</button>
                        </div>
                    </div>
                    <div id="tree-view" class="panel-content"></div>
                </section>

                <!-- Horizontal resize handle -->
                <div class="resize-handle resize-handle-vertical" data-direction="horizontal"></div>

                <!-- Property inspector (right panel) -->
                <section id="inspector-panel" class="panel">
                    <div class="panel-header">
                        <h2>Properties</h2>
                        <span id="selected-path" class="path-display"></span>
                    </div>
                    <div id="inspector-view" class="panel-content"></div>
                </section>
            </main>
        </div>
    </div>

    <!-- Load main module -->
</body>
</html>
