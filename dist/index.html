<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Navigator - Memory Image Explorer</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg
    viewBox='0 0 48 48' xmlns='http://www.w3.org/2000/svg'%3E%3Ccircle cx='24'
    cy='24' r='22' fill='%236366f1'/%3E%3Cline x1='24' y1='14' x2='16' y2='24'
    stroke='%23fbbf24' stroke-width='2' stroke-linecap='round'/%3E%3Cline
    x1='24' y1='14' x2='32' y2='24' stroke='%23fbbf24' stroke-width='2'
    stroke-linecap='round'/%3E%3Cline x1='16' y1='24' x2='24' y2='34'
    stroke='%2310b981' stroke-width='2' stroke-linecap='round'/%3E%3Cline
    x1='32' y1='24' x2='24' y2='34' stroke='%2310b981' stroke-width='2'
    stroke-linecap='round'/%3E%3Cline x1='16' y1='24' x2='32' y2='24'
    stroke='%23ec4899' stroke-width='2' stroke-linecap='round'/%3E%3Ccircle
    cx='24' cy='14' r='4' fill='%23fef3c7'/%3E%3Ccircle cx='16' cy='24' r='4'
    fill='%23fde68a'/%3E%3Ccircle cx='32' cy='24' r='4'
    fill='%23fde68a'/%3E%3Ccircle cx='24' cy='34' r='4'
    fill='%23fef3c7'/%3E%3Ccircle cx='24' cy='24' r='3'
    fill='%23ffffff'/%3E%3Ctext x='24' y='43' font-family='Arial, sans-serif'
    font-size='5.5' font-weight='bold' fill='%23ffffff' text-anchor='middle'
    letter-spacing='1.5'%3ENavigator%3C/text%3E%3C/svg%3E">
    <style rel="stylesheet">:root,[data-theme=dark]{--bg-primary: #1e1e1e;--bg-secondary: #252526;--bg-tertiary: #2d2d30;--bg-hover: #2a2d2e;--bg-active: #094771;--bg-input: #1e1e1e;--border-primary: #3e3e42;--border-hover: #555;--text-primary: #d4d4d4;--text-secondary: #cccccc;--text-muted: #858585;--text-disabled: #666;--accent-primary: #0e639c;--accent-hover: #1177bb;--accent-active: #0d5a8f;--error-bg: #5a1d1d;--error-text: #f48771;--error-border: #f48771;--success-text: #89d185;--code-property: #9cdcfe;--code-value: #ce9178;--code-type: #4ec9b0;--scrollbar-track: #1e1e1e;--scrollbar-thumb: #424242;--scrollbar-thumb-hover: #4e4e4e;--shadow-color: rgba(0, 0, 0, .3);--overlay-bg: rgba(0, 0, 0, .7)}[data-theme=light]{--bg-primary: #ffffff;--bg-secondary: #f3f3f3;--bg-tertiary: #e8e8e8;--bg-hover: #e0e0e0;--bg-active: #0078d4;--bg-input: #ffffff;--border-primary: #d4d4d4;--border-hover: #a0a0a0;--text-primary: #333333;--text-secondary: #1e1e1e;--text-muted: #666666;--text-disabled: #a0a0a0;--accent-primary: #0078d4;--accent-hover: #106ebe;--accent-active: #005a9e;--error-bg: #fde7e9;--error-text: #d13438;--error-border: #d13438;--success-text: #107c10;--code-property: #0070c1;--code-value: #a31515;--code-type: #008080;--scrollbar-track: #f3f3f3;--scrollbar-thumb: #c0c0c0;--scrollbar-thumb-hover: #a8a8a8;--shadow-color: rgba(0, 0, 0, .15);--overlay-bg: rgba(0, 0, 0, .4)}*{box-sizing:border-box;margin:0;padding:0}body{font-family:-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,sans-serif;height:100vh;display:flex;flex-direction:column;background:var(--bg-primary);color:var(--text-primary);overflow:hidden}#app{display:flex;flex-direction:column;height:100vh}.app-title{background:var(--bg-tertiary);color:var(--text-secondary);text-align:center;padding:8px 16px;font-size:14px;font-weight:600;letter-spacing:.5px;border-bottom:1px solid var(--border-primary);flex-shrink:0}header{background:var(--bg-secondary);border-bottom:1px solid var(--border-primary);flex-shrink:0}.compact-header{display:flex;align-items:center;justify-content:space-between;background:var(--bg-secondary);border-bottom:1px solid var(--border-primary);padding:6px 12px;gap:16px;flex-shrink:0;min-height:40px}.header-left{display:flex;align-items:center;gap:10px;flex-shrink:1;min-width:0}.header-left svg{flex-shrink:0}.app-title-inline{font-size:14px;font-weight:600;color:var(--text-secondary);white-space:nowrap;flex-shrink:0}.title-separator{color:var(--text-muted);font-size:14px;flex-shrink:0}.memimg-name-inline{font-size:14px;font-weight:600;color:var(--text-primary);margin:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;min-width:0}.header-right{display:flex;align-items:center;gap:6px;flex-shrink:0}.compact-btn{padding:4px 8px;font-size:12px;min-width:unset}.logo{display:flex;align-items:center;gap:12px;padding:10px 16px}.logo img{width:32px;height:32px}.logo h1{font-size:20px;font-weight:600;color:var(--text-secondary);margin:0}.logo .subtitle{font-size:12px;color:var(--text-muted);font-weight:400}.controls{display:flex;gap:8px;padding:8px 16px;align-items:center;border-top:1px solid var(--border-primary);justify-content:space-between}.controls-left,.controls-right{display:flex;gap:8px;align-items:center}.status-bar{padding:6px 16px;font-size:12px;color:var(--text-muted);border-top:1px solid var(--border-primary);min-height:28px}.status-bar.error{color:var(--error-text);background:var(--error-bg)}.status-bar.success{color:var(--success-text)}.dirty-indicator{display:inline-flex;align-items:center;gap:6px;padding:4px 10px;margin-right:4px;background:var(--error-bg);border:1px solid var(--error-border);border-radius:3px;color:var(--error-text);font-size:11px;font-weight:600;letter-spacing:.5px;animation:pulse 2s ease-in-out infinite}@keyframes pulse{0%,to{box-shadow:0 0 #f48771b3}50%{box-shadow:0 0 0 3px #f4877100}}#save-btn.dirty{animation:save-pulse 3s ease-in-out infinite}@keyframes save-pulse{0%,to{background:var(--accent-primary);box-shadow:0 0 #f48771b3}50%{background:#c75146;box-shadow:0 0 0 4px #f4877100}}#save-btn.dirty:hover{background:#d66058;animation:none}button{background:var(--accent-primary);color:#fff;border:none;padding:6px 14px;border-radius:2px;cursor:pointer;font-size:13px;transition:background .2s}button:hover{background:var(--accent-hover)}button:active{background:var(--accent-active)}button:disabled{background:var(--border-hover);cursor:not-allowed;opacity:.5}#bottom-panels{flex:1;display:flex;flex-direction:row;overflow:hidden;min-height:50px}.panel{display:flex;flex-direction:column;overflow:hidden}#tree-panel{flex:1;border-right:1px solid var(--border-primary)}#inspector-panel{flex:1}.panel-header{background:var(--bg-tertiary);padding:10px 16px;font-size:13px;font-weight:600;color:var(--text-secondary);border-bottom:1px solid var(--border-primary);display:flex;align-items:center;justify-content:space-between;flex-shrink:0}.panel-header h2{font-size:13px;font-weight:600;margin:0}.nav-buttons{display:flex;gap:4px}.nav-buttons button{background:var(--border-primary);color:var(--text-secondary);border:none;padding:4px 10px;border-radius:2px;cursor:pointer;font-size:12px;transition:background .2s;min-width:32px}.nav-buttons button:hover:not(:disabled){background:var(--border-hover)}.nav-buttons button:active:not(:disabled){background:var(--bg-tertiary)}.nav-buttons button:disabled{background:var(--bg-tertiary);color:var(--text-disabled);cursor:not-allowed;opacity:.5}.panel-content{flex:1;overflow:auto;padding:12px;background:var(--bg-primary)}.path-display{font-size:11px;color:var(--text-muted);font-family:Consolas,Monaco,monospace}.tree-node{-webkit-user-select:none;user-select:none;margin:2px 0}.tree-node-header{display:flex;align-items:center;padding:3px 6px;cursor:pointer;border-radius:3px}.tree-node-header:hover{background:var(--bg-hover)}.tree-node-header.selected{background:var(--bg-active)}.tree-toggle{width:16px;height:16px;display:inline-flex;align-items:center;justify-content:center;font-size:10px;margin-right:4px;color:var(--text-secondary);flex-shrink:0}.tree-toggle.collapsed:before{content:"▶"}.tree-toggle.expanded:before{content:"▼"}.tree-toggle.leaf{visibility:hidden}.tree-icon{margin-right:6px;font-size:14px;flex-shrink:0}.tree-label{font-size:13px;color:var(--text-secondary)}.tree-children{margin-left:20px;display:none}.tree-children.expanded{display:block}.property-table{width:100%;border-collapse:collapse;font-size:13px}.property-table th{text-align:left;padding:10px 12px;background:var(--bg-tertiary);border-bottom:1px solid var(--border-primary);font-weight:600;color:var(--text-secondary)}.property-table td{padding:8px 12px;border-bottom:1px solid var(--border-primary);vertical-align:top}.property-name{color:var(--code-property);font-family:Consolas,Monaco,monospace}.property-value{color:var(--code-value);font-family:Consolas,Monaco,monospace;word-break:break-word}.property-value.clickable{cursor:pointer;text-decoration:underline}.property-value.clickable:hover{color:var(--code-value);opacity:.8}.property-type{color:var(--code-type);font-size:11px;font-style:italic;margin-left:8px}.empty-state{color:var(--text-muted);font-size:13px;padding:24px;text-align:center}#editor-panel{border-bottom:1px solid var(--border-primary);flex:1;min-height:50px;display:flex;flex-direction:column}.editor-wrapper{flex:1;display:flex;position:relative;overflow:hidden;background:var(--bg-primary);min-height:0}.line-numbers{background:var(--bg-primary);color:var(--text-muted);padding:16px 8px;text-align:right;font-family:Consolas,Monaco,Courier New,monospace;font-size:14px;line-height:1.5;-webkit-user-select:none;user-select:none;border-right:1px solid var(--border-primary);overflow-y:auto;overflow-x:hidden;white-space:pre;flex-shrink:0}.code-editor{flex:1;font-family:Consolas,Monaco,Courier New,monospace;font-size:14px;padding:16px;background:var(--bg-primary);color:var(--text-primary);border:none;outline:none;-moz-tab-size:2;tab-size:2;line-height:1.5;overflow-y:auto;overflow-x:auto;white-space:pre;overflow-wrap:normal}.code-editor>div{min-height:100%;outline:none}.code-editor .token.comment,.code-editor .token.prolog,.code-editor .token.doctype,.code-editor .token.cdata{color:#6a9955}.code-editor .token.punctuation{color:var(--text-primary)}.code-editor .token.property,.code-editor .token.tag,.code-editor .token.boolean,.code-editor .token.number,.code-editor .token.constant,.code-editor .token.symbol{color:#b5cea8}.code-editor .token.selector,.code-editor .token.attr-name,.code-editor .token.string,.code-editor .token.char,.code-editor .token.builtin{color:#ce9178}.code-editor .token.operator,.code-editor .token.entity,.code-editor .token.url,.code-editor .token.variable{color:var(--text-primary)}.code-editor .token.atrule,.code-editor .token.attr-value,.code-editor .token.keyword{color:#569cd6}.code-editor .token.function,.code-editor .token.class-name{color:#dcdcaa}.code-editor .token.regex,.code-editor .token.important{color:#d16969}.error-panel{background:var(--error-bg);border-top:2px solid var(--error-border);padding:12px 16px;font-family:Consolas,Monaco,Courier New,monospace;font-size:12px;color:var(--error-text);line-height:1.6;white-space:pre-wrap;word-wrap:break-word;max-height:120px;overflow-y:auto}::-webkit-scrollbar{width:12px;height:12px}::-webkit-scrollbar-track{background:var(--scrollbar-track)}::-webkit-scrollbar-thumb{background:var(--scrollbar-thumb);border-radius:6px}::-webkit-scrollbar-thumb:hover{background:var(--scrollbar-thumb-hover)}.view-container{display:flex;flex-direction:column;height:100vh;width:100%}#explorer-view{display:flex;flex-direction:column;overflow:hidden}.list-header{background:var(--bg-secondary);border-bottom:1px solid var(--border-primary);padding:16px 24px;flex-shrink:0}.list-header .logo{display:flex;align-items:center;gap:12px;margin-bottom:16px}.list-header .controls{display:flex;gap:8px;justify-content:flex-end}.list-content{flex:1;overflow-y:auto;padding:32px;background:var(--bg-primary)}.memimg-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:24px;max-width:1400px;margin:0 auto}.memimg-card{background:var(--bg-secondary);border:1px solid var(--border-primary);border-radius:6px;padding:20px;cursor:pointer;transition:all .2s ease;display:flex;flex-direction:column;gap:12px}.memimg-card:hover{border-color:var(--accent-primary);transform:translateY(-2px);box-shadow:0 4px 12px var(--shadow-color)}.card-header{display:flex;justify-content:space-between;align-items:flex-start;gap:12px}.card-title{font-size:18px;font-weight:600;color:var(--text-secondary);margin:0;flex:1;word-break:break-word}.card-actions{display:flex;gap:4px;flex-shrink:0}.icon-btn{background:transparent;border:1px solid var(--border-primary);padding:4px 8px;border-radius:3px;cursor:pointer;font-size:14px;transition:all .2s;min-width:unset}.icon-btn:hover{background:var(--border-primary);border-color:var(--border-hover)}.icon-btn:active{background:var(--bg-tertiary)}.card-body{flex:1;display:flex;flex-direction:column;gap:12px}.card-description{color:var(--text-muted);font-size:14px;line-height:1.5;margin:0;min-height:42px}.card-description em{opacity:.6}.card-meta{display:flex;flex-direction:column;gap:6px;font-size:12px;color:var(--text-disabled)}.meta-item{display:flex;align-items:center;gap:6px}.card-footer{display:flex;justify-content:flex-end;padding-top:12px;border-top:1px solid var(--border-primary)}.open-btn{background:var(--accent-primary);color:#fff;border:none;padding:8px 16px;border-radius:3px;cursor:pointer;font-size:14px;font-weight:600;transition:background .2s}.open-btn:hover{background:var(--accent-hover)}.empty-state{text-align:center;padding:80px 24px;color:var(--text-muted)}.empty-icon{font-size:64px;margin-bottom:24px}.empty-state h2{font-size:24px;color:var(--text-secondary);margin:0 0 12px}.empty-state p{font-size:16px;margin:0 0 24px}.primary-button{background:var(--accent-primary);color:#fff;border:none;padding:10px 20px;border-radius:3px;cursor:pointer;font-size:14px;font-weight:600;transition:background .2s}.primary-button:hover{background:var(--accent-hover)}.error-state{text-align:center;padding:80px 24px;color:var(--error-text)}.error-state h2{font-size:24px;margin:0 0 12px}.error-state p{font-size:16px;margin:0}.modal-overlay{position:fixed;top:0;left:0;right:0;bottom:0;background:var(--overlay-bg);display:flex;align-items:center;justify-content:center;z-index:1000;animation:fadeIn .2s ease}@keyframes fadeIn{0%{opacity:0}to{opacity:1}}.modal-dialog{background:var(--bg-secondary);border:1px solid var(--border-primary);border-radius:6px;width:90%;max-width:500px;max-height:90vh;overflow:hidden;display:flex;flex-direction:column;animation:slideIn .2s ease}@keyframes slideIn{0%{transform:translateY(-20px);opacity:0}to{transform:translateY(0);opacity:1}}.modal-header{padding:20px 24px;border-bottom:1px solid var(--border-primary);display:flex;justify-content:space-between;align-items:center}.modal-header h2{font-size:18px;font-weight:600;color:var(--text-secondary);margin:0}.modal-close{background:transparent;border:none;color:var(--text-muted);font-size:28px;line-height:1;cursor:pointer;padding:0;width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:3px;transition:all .2s}.modal-close:hover{background:var(--border-primary);color:var(--text-secondary)}.modal-body{padding:24px;overflow-y:auto;flex:1}.form-group{margin-bottom:20px}.form-group:last-child{margin-bottom:0}.form-group label{display:block;margin-bottom:8px;color:var(--text-secondary);font-size:14px;font-weight:600}.form-input,.form-textarea{width:100%;background:var(--bg-input);border:1px solid var(--border-primary);border-radius:3px;padding:10px 12px;color:var(--text-primary);font-size:14px;font-family:inherit;transition:border-color .2s}.form-input:focus,.form-textarea:focus{outline:none;border-color:var(--accent-primary)}.form-textarea{resize:vertical;font-family:inherit}.modal-footer{padding:16px 24px;border-top:1px solid var(--border-primary);display:flex;justify-content:flex-end;gap:12px}.cancel-btn{background:transparent;border:1px solid var(--border-primary);color:var(--text-secondary);padding:8px 16px;border-radius:3px;cursor:pointer;font-size:14px;transition:all .2s}.cancel-btn:hover{background:var(--border-primary);border-color:var(--border-hover)}.save-btn,.create-btn{background:var(--accent-primary);color:#fff;border:none;padding:8px 16px;border-radius:3px;cursor:pointer;font-size:14px;font-weight:600;transition:background .2s}.save-btn:hover,.create-btn:hover{background:var(--accent-hover)}.header-info{display:flex;flex-direction:column;gap:8px}.back-button{background:transparent;border:1px solid var(--border-primary);color:var(--text-muted);padding:4px 12px;border-radius:3px;cursor:pointer;font-size:13px;align-self:flex-start;transition:all .2s}.back-button:hover{background:var(--border-primary);color:var(--text-secondary);border-color:var(--border-hover)}#current-memimg-name{font-size:16px;margin:0;color:var(--text-secondary)}.resize-handle{background:var(--border-primary);flex-shrink:0;position:relative;z-index:10;transition:background .2s}.resize-handle:hover{background:var(--accent-primary)}.resize-handle:active{background:var(--accent-hover)}.resize-handle-horizontal{height:4px;cursor:ns-resize;width:100%}.resize-handle-vertical{width:4px;cursor:ew-resize;height:100%}.sidebar{position:fixed;left:0;top:0;bottom:0;width:400px;background:var(--bg-secondary);border-right:1px solid var(--border-primary);transform:translate(0);transition:transform .3s ease;z-index:1000;display:flex;flex-direction:column;box-shadow:2px 0 8px var(--shadow-color)}.sidebar.collapsed{transform:translate(-400px)}.sidebar-header{display:flex;justify-content:space-between;align-items:center;padding:16px 20px;border-bottom:1px solid var(--border-primary);background:var(--bg-tertiary)}.sidebar-header h3{font-size:15px;font-weight:600;color:var(--text-secondary);margin:0}.sidebar-controls{display:flex;gap:8px;padding:12px 16px;border-bottom:1px solid var(--border-primary);background:var(--bg-secondary)}#history-search{flex:1;background:var(--bg-primary);border:1px solid var(--border-primary);border-radius:3px;padding:6px 10px;color:var(--text-primary);font-size:13px;outline:none}#history-search:focus{border-color:var(--accent-primary)}.sidebar-stats{padding:8px 16px;font-size:11px;color:var(--text-muted);border-bottom:1px solid var(--border-primary);background:var(--bg-secondary)}.sidebar-content{flex:1;overflow-y:auto;background:var(--bg-primary)}.history-entry{padding:12px 16px;border-bottom:1px solid var(--border-primary);transition:background .2s}.history-entry:hover{background:var(--bg-hover)}.history-entry-header{display:flex;align-items:center;gap:8px;margin-bottom:8px}.history-status{color:var(--success-text);font-size:8px;line-height:1}.history-timestamp{font-size:11px;color:var(--text-muted);flex:1}.history-size{font-size:11px;color:var(--text-disabled)}.history-code{margin-bottom:8px}.history-code pre{font-family:Consolas,Monaco,monospace;font-size:12px;color:var(--text-primary);background:var(--bg-primary);padding:8px 10px;border-radius:3px;border:1px solid var(--border-primary);margin:0;overflow-x:auto;white-space:pre-wrap;word-wrap:break-word;line-height:1.4}.history-code.expandable pre{cursor:pointer}.history-actions{display:flex;gap:6px;flex-wrap:wrap}.history-btn{background:transparent;border:1px solid var(--border-primary);color:var(--text-secondary);padding:4px 10px;border-radius:3px;cursor:pointer;font-size:11px;transition:all .2s;white-space:nowrap}.history-btn:hover{background:var(--border-primary);border-color:var(--border-hover)}.history-btn:active{background:var(--bg-tertiary)}.history-empty,.history-error{padding:40px 24px;text-align:center;color:var(--text-muted);font-size:13px}.history-error{color:var(--error-text)}.editor-controls{display:flex;gap:8px;align-items:center}#toggle-history-btn{background:transparent;border:1px solid var(--border-primary);color:var(--text-secondary);padding:6px 12px}#toggle-history-btn:hover{background:var(--border-primary);border-color:var(--border-hover)}#theme-toggle-list,#theme-toggle-explorer{min-width:36px;font-size:18px;padding:6px 10px}#toggle-line-numbers-btn{color:var(--text-secondary);font-weight:700;font-size:16px}.value-navigable{cursor:pointer}.value-navigable:hover{opacity:.8}.value-null,.value-undefined{color:var(--text-muted);font-style:italic}.value-string{color:var(--code-value)}.value-number{color:#b5cea8}.value-boolean{color:#569cd6}.value-bigint{color:#b5cea8}.value-symbol{color:#ce9178}.value-date{color:#4fc1ff}.value-function,.value-array,.value-map,.value-set,.value-object{color:var(--code-type)}[data-theme=light] .value-number,[data-theme=light] .value-bigint{color:#098658}[data-theme=light] .value-boolean{color:#00f}[data-theme=light] .value-symbol{color:#a31515}[data-theme=light] .value-date{color:#0078d4}.inspector-tabs{display:flex;flex-direction:column;height:100%}.tab-headers{display:flex;border-bottom:1px solid var(--border-primary);background:var(--bg-secondary);flex-shrink:0}.tab-header{background:transparent;border:none;border-bottom:2px solid transparent;padding:10px 20px;cursor:pointer;font-size:13px;font-weight:500;color:var(--text-muted);transition:all .2s;position:relative}.tab-header:hover:not(:disabled){color:var(--text-secondary);background:var(--bg-hover)}.tab-header.active{color:var(--accent-primary);border-bottom-color:var(--accent-primary);font-weight:600}.tab-header:disabled{color:var(--text-disabled);cursor:not-allowed;opacity:.5}.tab-content{flex:1;overflow:auto;background:var(--bg-primary)}.tab-panel{display:none;padding:12px}.tab-panel.active{display:block}.collections-panel{display:flex;flex-direction:column;gap:16px}.collection-section{border:1px solid var(--border-primary);border-radius:4px;background:var(--bg-secondary);padding:12px}.collection-header{color:var(--code-property);font-family:Consolas,Monaco,monospace;font-size:14px;font-weight:600;margin:0 0 12px;padding-bottom:8px;border-bottom:1px solid var(--border-primary)}.collection-items{list-style:none;padding:0;margin:0}.collection-item{padding:6px 8px;border-radius:3px;font-family:Consolas,Monaco,monospace;font-size:13px;transition:background .2s}.collection-item:hover{background:var(--bg-hover)}.item-label{color:var(--text-muted);margin-right:4px}.item-value{color:var(--code-value)}.value-nested{color:var(--code-type);cursor:pointer;display:inline-flex;align-items:center;font-family:Consolas,Monaco,monospace}.value-nested-toggle{display:inline-block;width:14px;height:14px;margin-right:4px;font-size:10px;color:var(--text-muted)}.value-nested-toggle.collapsed:before{content:"▶"}.value-nested-toggle.expanded:before{content:"▼"}.value-nested-summary{color:var(--code-type);text-decoration:underline}.value-nested:hover .value-nested-summary{opacity:.8}.nested-properties{display:none;margin-top:8px;padding-left:24px;border-left:2px solid var(--border-primary)}.nested-properties.expanded{display:block}.nested-prop{padding:4px 0;font-size:12px}.nested-prop-key{color:var(--code-property);margin-right:6px}.nested-prop-value{color:var(--code-value)}code[class*=language-],pre[class*=language-]{color:#f8f8f2;background:none;text-shadow:0 1px rgba(0,0,0,.3);font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto;border-radius:.3em}:not(pre)>code[class*=language-],pre[class*=language-]{background:#272822}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.comment,.token.prolog,.token.doctype,.token.cdata{color:#8292a2}.token.punctuation{color:#f8f8f2}.token.namespace{opacity:.7}.token.property,.token.tag,.token.constant,.token.symbol,.token.deleted{color:#f92672}.token.boolean,.token.number{color:#ae81ff}.token.selector,.token.attr-name,.token.string,.token.char,.token.builtin,.token.inserted{color:#a6e22e}.token.operator,.token.entity,.token.url,.language-css .token.string,.style .token.string,.token.variable{color:#f8f8f2}.token.atrule,.token.attr-value,.token.function,.token.class-name{color:#e6db74}.token.keyword{color:#66d9ef}.token.regex,.token.important{color:#fd971f}.token.important,.token.bold{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}</style>
    <!-- JavaScript Type System - Inlined for file:// protocol compatibility -->
    <script>
(function(global) {
  'use strict';

  function Type(name) {
    this.typeName = name;
  }

  Type.prototype.check = function(value) {
    throw new Error(`${this.typeName}.check() not implemented`);
  };

  function PrimitiveType(name) {
    Type.call(this, name);
  }

  PrimitiveType.prototype = Object.create(Type.prototype);
  PrimitiveType.prototype.constructor = PrimitiveType;

  PrimitiveType.prototype.check = function(value) {
    switch(this.typeName) {
      case 'number': return typeof value === 'number';
      case 'string': return typeof value === 'string';
      case 'boolean': return typeof value === 'boolean';
      case 'bigint': return typeof value === 'bigint';
      case 'symbol': return typeof value === 'symbol';
      case 'undefined': return value === undefined;
      case 'null': return value === null;
      default: return false;
    }
  };

  const NumberType = new PrimitiveType('number');
  const StringType = new PrimitiveType('string');
  const BooleanType = new PrimitiveType('boolean');
  const BigIntType = new PrimitiveType('bigint');
  const SymbolType = new PrimitiveType('symbol');
  const UndefinedType = new PrimitiveType('undefined');
  const NullType = new PrimitiveType('null');

  function ObjectType({name, properties = {}, prototype = null}) {
    const factory = function(props = {}) {
      const instance = Object.create(factory.prototype);

      Object.keys(properties).forEach(propName => {
        if (propName in props) {
          instance[propName] = props[propName];
        }
      });

      Object.defineProperty(instance, '__type__', {
        value: factory,
        writable: false,
        enumerable: false,
        configurable: false
      });

      return instance;
    };

    if (prototype) {
      factory.prototype = Object.create(prototype);
    } else {
      factory.prototype = {};
    }

    factory.typeName = name;
    factory.properties = properties;

    Object.setPrototypeOf(factory, ObjectType.prototype);
    Type.call(factory, name);

    return factory;
  }

  Type.call(ObjectType, 'ObjectType');
  ObjectType.prototype = Object.create(Type.prototype);
  ObjectType.prototype.constructor = ObjectType;

  ObjectType.prototype.check = function(value) {
    return typeof value === 'object' && value !== null && value.__type__ === this;
  };

  function FunctionType({name, signature = null}) {
    Type.call(this, name);
    this.signature = signature;
  }

  FunctionType.prototype = Object.create(Type.prototype);
  FunctionType.prototype.constructor = FunctionType;

  FunctionType.prototype.check = function(value) {
    return typeof value === 'function';
  };

  function ArrayType(elementType = null) {
    Type.call(this, elementType ? `Array<${elementType.typeName}>` : 'Array');
    this.elementType = elementType;
  }

  ArrayType.prototype = Object.create(Type.prototype);
  ArrayType.prototype.constructor = ArrayType;

  ArrayType.prototype.check = function(value) {
    return Array.isArray(value);
  };

  const ArrayTypeInstance = new ArrayType();

  function SetType(elementType = null) {
    Type.call(this, elementType ? `Set<${elementType.typeName}>` : 'Set');
    this.elementType = elementType;
  }

  SetType.prototype = Object.create(Type.prototype);
  SetType.prototype.constructor = SetType;

  SetType.prototype.check = function(value) {
    return value instanceof Set;
  };

  const SetTypeInstance = new SetType();

  function MapType(keyType = null, valueType = null) {
    const keyPart = keyType ? keyType.typeName : '*';
    const valuePart = valueType ? valueType.typeName : '*';
    Type.call(this, `Map<${keyPart}, ${valuePart}>`);
    this.keyType = keyType;
    this.valueType = valueType;
  }

  MapType.prototype = Object.create(Type.prototype);
  MapType.prototype.constructor = MapType;

  MapType.prototype.check = function(value) {
    return value instanceof Map;
  };

  const MapTypeInstance = new MapType();

  function DateType() {
    Type.call(this, 'Date');
  }

  DateType.prototype = Object.create(Type.prototype);
  DateType.prototype.constructor = DateType;

  DateType.prototype.check = function(value) {
    return value instanceof Date;
  };

  const DateTypeInstance = new DateType();

  const JSTypes = {
    Type,
    PrimitiveType,
    NumberType,
    StringType,
    BooleanType,
    BigIntType,
    SymbolType,
    UndefinedType,
    NullType,
    ObjectType,
    FunctionType,
    ArrayType,
    ArrayTypeInstance,
    SetType,
    SetTypeInstance,
    MapType,
    MapTypeInstance,
    DateType,
    DateTypeInstance
  };

  global.JSTypes = JSTypes;
  global.Type = Type;
  global.PrimitiveType = PrimitiveType;
  global.NumberType = NumberType;
  global.StringType = StringType;
  global.BooleanType = BooleanType;
  global.BigIntType = BigIntType;
  global.SymbolType = SymbolType;
  global.UndefinedType = UndefinedType;
  global.NullType = NullType;
  global.ObjectType = ObjectType;
  global.FunctionType = FunctionType;
  global.ArrayType = ArrayType;
  global.SetType = SetType;
  global.MapType = MapType;
  global.DateType = DateType;
  global.DateTypeInstance = DateTypeInstance;

})(typeof window !== 'undefined' ? window : global);
    </script>
  <script type="module" crossorigin>(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const i of o)if(i.type==="childList")for(const s of i.addedNodes)s.tagName==="LINK"&&s.rel==="modulepreload"&&r(s)}).observe(document,{childList:!0,subtree:!0});function n(o){const i={};return o.integrity&&(i.integrity=o.integrity),o.referrerPolicy&&(i.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?i.credentials="include":o.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function r(o){if(o.ep)return;o.ep=!0;const i=n(o);fetch(o.href,i)}})();const C={SET:"SET",DELETE:"DELETE",ARRAY_PUSH:"ARRAY_PUSH",ARRAY_POP:"ARRAY_POP",ARRAY_SHIFT:"ARRAY_SHIFT",ARRAY_UNSHIFT:"ARRAY_UNSHIFT",ARRAY_SPLICE:"ARRAY_SPLICE",ARRAY_SORT:"ARRAY_SORT",ARRAY_REVERSE:"ARRAY_REVERSE",ARRAY_FILL:"ARRAY_FILL",ARRAY_COPYWITHIN:"ARRAY_COPYWITHIN",MAP_SET:"MAP_SET",MAP_DELETE:"MAP_DELETE",MAP_CLEAR:"MAP_CLEAR",SET_ADD:"SET_ADD",SET_DELETE:"SET_DELETE",SET_CLEAR:"SET_CLEAR",SCRIPT:"SCRIPT"},me={TYPE:"__type__",CLASS:"__class__",DATE_VALUE:"__dateValue__"};var W=(t=>(t[t.NULL=0]="NULL",t[t.UNDEFINED=1]="UNDEFINED",t[t.PRIMITIVE=2]="PRIMITIVE",t[t.BIGINT=3]="BIGINT",t[t.SYMBOL=4]="SYMBOL",t[t.DATE=5]="DATE",t[t.REGEXP=6]="REGEXP",t[t.FUNCTION=7]="FUNCTION",t[t.ARRAY=8]="ARRAY",t[t.MAP=9]="MAP",t[t.SET=10]="SET",t[t.OBJECT=11]="OBJECT",t))(W||{});function Xt(t){if(t===null)return{category:0,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!1};if(t===void 0)return{category:1,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!1};const e=typeof t;return e==="string"||e==="number"||e==="boolean"?{category:2,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!1}:e==="bigint"?{category:3,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!0}:e==="symbol"?{category:4,isPrimitive:!0,isObject:!1,isCollection:!1,needsSpecialSerialization:!0}:t instanceof Date?{category:5,isPrimitive:!1,isObject:!0,isCollection:!1,needsSpecialSerialization:!0}:t instanceof RegExp?{category:6,isPrimitive:!1,isObject:!0,isCollection:!1,needsSpecialSerialization:!0}:e==="function"?{category:7,isPrimitive:!1,isObject:!0,isCollection:!1,needsSpecialSerialization:!0}:Array.isArray(t)?{category:8,isPrimitive:!1,isObject:!0,isCollection:!0,needsSpecialSerialization:!1}:t instanceof Map?{category:9,isPrimitive:!1,isObject:!0,isCollection:!0,needsSpecialSerialization:!0}:t instanceof Set?{category:10,isPrimitive:!1,isObject:!0,isCollection:!0,needsSpecialSerialization:!0}:{category:11,isPrimitive:!1,isObject:!0,isCollection:!1,needsSpecialSerialization:!1}}function Zt(t){if(typeof t!="object"||t===null)return!1;const e=Object.getPrototypeOf(t);return!(e===null||e===Object.prototype||t instanceof Date||t instanceof RegExp||t instanceof Map||t instanceof Set||t instanceof Array||t instanceof Error||ArrayBuffer.isView(t)||t instanceof ArrayBuffer)}function Qt(t){const e=Object.getPrototypeOf(t);if(!e||e===Object.prototype)return null;const n=e.constructor;return!n||!n.name?null:n.name}class en{constructor(){this.seen=new Map}hasSeen(e){return this.seen.has(e)}markSeen(e,n){this.seen.set(e,n)}getReference(e){return this.seen.has(e)?{__type__:"ref",path:this.seen.get(e)||[]}:null}}class tn{constructor(e,n){this.targetToPath=e,this.currentPath=n,this.seen=new Map}hasSeen(e){return this.seen.has(e)}markSeen(e,n){this.seen.set(e,n)}getReference(e){const n=this.targetToPath.get(e);return n&&n.length>0&&!(n.length>=this.currentPath.length&&this.currentPath.every((r,o)=>r===n[o]))?{__type__:"ref",path:n}:this.hasSeen(e)?{__type__:"ref",path:this.seen.get(e).slice(this.currentPath.length)}:null}}function ye(t,e,n,r){const o=typeof t=="object"&&t!==null&&r.get(t)||t,i=Xt(o);switch(i.category){case W.NULL:case W.UNDEFINED:return t;case W.PRIMITIVE:return t;case W.BIGINT:return{[me.TYPE]:"bigint",value:t.toString()};case W.SYMBOL:return{[me.TYPE]:"symbol",description:t.description};case W.DATE:{const s=r.get(t)||t,a=n.getReference(s);if(a)return a;n.markSeen(s,e);const c=s,u=c.getTime(),l=isNaN(u)?null:c.toISOString(),f={[me.TYPE]:"date",[me.DATE_VALUE]:l},p=Object.entries(c);for(const[w,h]of p)f[w]=ye(h,[...e,w],n,r);return f}case W.REGEXP:{const s=r.get(t)||t,a=n.getReference(s);if(a)return a;n.markSeen(s,e);const c=s;return{[me.TYPE]:"regexp",source:c.source,flags:c.flags,lastIndex:c.lastIndex}}case W.FUNCTION:{const s=t;return s.__type__==="function"?{[me.TYPE]:"function",sourceCode:s.sourceCode||t.toString()}:void 0}case W.MAP:case W.SET:case W.ARRAY:case W.OBJECT:{const s=r.get(t)||t,a=n.getReference(s);if(a)return a;if(n.markSeen(s,e),i.category===W.MAP)return{[me.TYPE]:"map",entries:Array.from(s.entries()).map(([l,f],p)=>[ye(l,[...e,"key",String(p)],n,r),ye(f,[...e,"value",String(p)],n,r)])};if(i.category===W.SET)return{[me.TYPE]:"set",values:Array.from(s.values()).map((l,f)=>ye(l,[...e,String(f)],n,r))};if(i.category===W.ARRAY)return t.map((l,f)=>ye(l,[...e,String(f)],n,r));const c={},u=t;if(Zt(s)){const l=Qt(s);l&&(c[me.CLASS]=l)}for(const l in u)Object.prototype.hasOwnProperty.call(u,l)&&(c[l]=ye(u[l],[...e,l],n,r));return c}default:return}}const nn=(t,e)=>{const n=new en,r=ye(t,[],n,e);return JSON.stringify(r,null,2)},ae=(t,e,n,r)=>{const o=new tn(n,r);return ye(t,r,o,e)},rn=t=>typeof t=="object"&&t!==null&&"__type__"in t&&typeof t.__type__=="string",xt=t=>{const e=new Function(`return (${t.sourceCode})`)();return e.__type__="function",e.sourceCode=t.sourceCode,e},At=(t,e,n)=>{if(!("__dateValue__"in t))throw new Error("Invalid Date serialization format: missing __dateValue__ field");const r=t.__dateValue__,o=r===null?new Date("invalid"):new Date(r);for(const[i,s]of Object.entries(t))i==="__type__"||i==="__dateValue__"||(o[i]=e(s,n));return o},Tt=t=>{const e=new RegExp(t.source,t.flags);return t.lastIndex!==void 0&&(e.lastIndex=t.lastIndex),e},_t=t=>BigInt(t.value),Nt=t=>Symbol(t.description),Oe=t=>typeof t=="object"&&t!==null&&"__unresolved_ref__"in t,on=(t,e)=>{var r,o;const n=new Map;for(const[i,s]of t.entries){const a=typeof i=="object"&&i!==null&&i.__type__&&((r=J[i.__type__])==null?void 0:r.call(J,i,e))||i,c=typeof s=="object"&&s!==null&&s.__type__&&((o=J[s.__type__])==null?void 0:o.call(J,s,e))||s;n.set(a,c)}return n},sn=(t,e)=>{var r;const n=new Set;for(const o of t.values){const i=typeof o=="object"&&o!==null&&o.__type__&&((r=J[o.__type__])==null?void 0:r.call(J,o,e))||o;n.add(i)}return n},J={function:t=>xt(t),date:(t,e)=>At(t,(n,r)=>{if(n&&typeof n=="object"&&"__type__"in n){const o=J[n.__type__];return o?o(n,e):n}return n},e),regexp:t=>Tt(t),bigint:t=>_t(t),symbol:t=>Nt(t),ref:t=>({__unresolved_ref__:t.path}),map:(t,e)=>on(t,e),set:(t,e)=>sn(t,e)};function an(t,e,n){const r=[];function o(s,a=[]){if(s===null||typeof s!="object")return s;if(s.__type__&&J[s.__type__]){const c=J[s.__type__];if(!c)return s;const u=c(s,t);if(u&&Oe(u))return r.push({parent:null,key:null,path:u.__unresolved_ref__}),u;if(u instanceof Date){for(const l in u)if(Object.prototype.hasOwnProperty.call(u,l)){const f=u[l];f&&Oe(f)&&r.push({parent:u,key:l,path:f.__unresolved_ref__})}}return u}for(const c in s)if(Object.prototype.hasOwnProperty.call(s,c)){const u=s[c];if(u&&typeof u=="object")if(u.__type__&&J[u.__type__]){const l=J[u.__type__];if(!l)continue;const f=l(u,t);if(f&&Oe(f))r.push({parent:s,key:c,path:f.__unresolved_ref__});else if(s[c]=f,f instanceof Date){for(const p in f)if(Object.prototype.hasOwnProperty.call(f,p)){const w=f[p];w&&Oe(w)&&r.push({parent:f,key:p,path:w.__unresolved_ref__})}}}else{const l=o(u,[...a,c]);l!==u&&(s[c]=l)}}return s}let i=o(t);for(const s of r){const{parent:a,key:c,path:u}=s,l=e(u,i);a&&c!==null?a[c]=l:a===null&&c===null&&(i=l)}return i}function cn(t,e,n){return an(t,(r,o)=>{let i=o,s=!0;for(const a of r){const c=i==null?void 0:i[a];if(c===void 0){s=!1;break}i=c}if(s)return i;i=e;for(const a of r){const c=i==null?void 0:i[a];if(c===void 0)throw new Error(`Cannot resolve event value ref path: ${r.join(".")} (not found in value scope or memory scope)`);i=c}return i})}const G=(t,e,n=new WeakMap,r)=>{if(t==null||typeof t!="object")return t;if(n.has(t))return n.get(t);if(rn(t)){const i=t;switch(i.__type__){case"function":return xt(i);case"date":return At(i,(s,a)=>G(s,e,n),e);case"regexp":return Tt(i);case"bigint":return _t(i);case"symbol":return Nt(i);case"ref":{const s=i;let a=e;for(const c of s.path)if(a=a[c],a===void 0)throw new Error(`Cannot resolve ref path: ${s.path.join(".")}`);return a}case"map":{const s=i,a=new Map;n.set(t,a);for(const[c,u]of s.entries){const l=G(c,e,n),f=G(u,e,n);a.set(l,f)}return a}case"set":{const s=i,a=new Set;n.set(t,a);for(const c of s.values)a.add(G(c,e,n));return a}case"circular":throw new Error("Encountered explicit circular marker - this indicates a serialization issue")}}if(Array.isArray(t)){const i=[];n.set(t,i);for(const s of t)i.push(G(s,e,n));return i}const o={};n.set(t,o);for(const i in t)Object.prototype.hasOwnProperty.call(t,i)&&(o[i]=G(t[i],e,n));return o};class ln{createEvent(e,n,r){const[o]=n;return{type:C.SET,path:e,value:ae(o,r.proxyToTarget,r.targetToPath,e),timestamp:Date.now()}}applyEvent(e,n,r,o){const i=cn(e.value,o);n instanceof Map?n.set(r,i):n[r]=i}}class un{createEvent(e){return{type:C.DELETE,path:e,timestamp:Date.now()}}applyEvent(e,n,r){delete n[r]}}class dn{createEvent(e,n,r){return{type:C.ARRAY_PUSH,path:e,items:n.map(o=>ae(o,r.proxyToTarget,r.targetToPath,e)),timestamp:Date.now()}}applyEvent(e,n,r,o){const i=e,s=n[r];for(const a of i.items)s.push(G(a,o))}}class fn{createEvent(e){return{type:C.ARRAY_POP,path:e,timestamp:Date.now()}}applyEvent(e,n,r){n[r].pop()}}class pn{createEvent(e){return{type:C.ARRAY_SHIFT,path:e,timestamp:Date.now()}}applyEvent(e,n,r){n[r].shift()}}class mn{createEvent(e,n,r){return{type:C.ARRAY_UNSHIFT,path:e,items:n.map(o=>ae(o,r.proxyToTarget,r.targetToPath,e)),timestamp:Date.now()}}applyEvent(e,n,r,o){const i=e,s=n[r],a=i.items.map(c=>G(c,o));s.unshift(...a)}}class gn{createEvent(e,n,r){return{type:C.ARRAY_SPLICE,path:e,start:n[0],deleteCount:n[1]||0,items:n.slice(2).map(o=>ae(o,r.proxyToTarget,r.targetToPath,e)),timestamp:Date.now()}}applyEvent(e,n,r,o){const i=e,s=n[r],a=i.items.map(c=>G(c,o));s.splice(i.start,i.deleteCount,...a)}}class hn{createEvent(e){return{type:C.ARRAY_SORT,path:e,timestamp:Date.now()}}applyEvent(e,n,r){n[r].sort()}}class yn{createEvent(e){return{type:C.ARRAY_REVERSE,path:e,timestamp:Date.now()}}applyEvent(e,n,r){n[r].reverse()}}class En{createEvent(e,n,r){return{type:C.ARRAY_FILL,path:e,value:ae(n[0],r.proxyToTarget,r.targetToPath,e),start:n[1],end:n[2],timestamp:Date.now()}}applyEvent(e,n,r,o){const i=e,s=n[r],a=G(i.value,o);s.fill(a,i.start,i.end)}}class wn{createEvent(e,n){return{type:C.ARRAY_COPYWITHIN,path:e,target:n[0],start:n[1],end:n[2],timestamp:Date.now()}}applyEvent(e,n,r){const o=e;n[r].copyWithin(o.target,o.start,o.end)}}class bn{createEvent(e,n,r){return{type:C.MAP_SET,path:e,key:ae(n[0],r.proxyToTarget,r.targetToPath,e),value:ae(n[1],r.proxyToTarget,r.targetToPath,e),timestamp:Date.now()}}applyEvent(e,n,r,o){const i=e,s=n[r],a=G(i.key,o),c=G(i.value,o);s.set(a,c)}}class vn{createEvent(e,n,r){return{type:C.MAP_DELETE,path:e,key:ae(n[0],r.proxyToTarget,r.targetToPath,e),timestamp:Date.now()}}applyEvent(e,n,r,o){const i=e,s=n[r],a=G(i.key,o);s.delete(a)}}class Sn{createEvent(e){return{type:C.MAP_CLEAR,path:e,timestamp:Date.now()}}applyEvent(e,n,r){n[r].clear()}}class xn{createEvent(e,n,r){return{type:C.SET_ADD,path:e,value:ae(n[0],r.proxyToTarget,r.targetToPath,e),timestamp:Date.now()}}applyEvent(e,n,r,o){const i=e,s=n[r],a=G(i.value,o);s.add(a)}}class An{createEvent(e,n,r){return{type:C.SET_DELETE,path:e,value:ae(n[0],r.proxyToTarget,r.targetToPath,e),timestamp:Date.now()}}applyEvent(e,n,r,o){const i=e,s=n[r],a=G(i.value,o);s.delete(a)}}class Tn{createEvent(e){return{type:C.SET_CLEAR,path:e,timestamp:Date.now()}}applyEvent(e,n,r){n[r].clear()}}class _n{createEvent(e,n){return{type:C.SCRIPT,path:e,source:n[0],timestamp:Date.now()}}applyEvent(){}}class Nn{constructor(){this.handlers=new Map}register(e,n){this.handlers.set(e,n)}createEvent(e,n,r,o){const i=this.handlers.get(e);if(!i)throw new Error(`No handler registered for event type: ${e}`);return i.createEvent(n,r,o)}applyEvent(e,n,r,o){const i=this.handlers.get(e.type);if(!i)throw new Error(`No handler registered for event type: ${e.type}`);i.applyEvent(e,n,r,o)}hasHandler(e){return this.handlers.has(e)}}const q=new Nn;q.register(C.SET,new ln);q.register(C.DELETE,new un);q.register(C.ARRAY_PUSH,new dn);q.register(C.ARRAY_POP,new fn);q.register(C.ARRAY_SHIFT,new pn);q.register(C.ARRAY_UNSHIFT,new mn);q.register(C.ARRAY_SPLICE,new gn);q.register(C.ARRAY_SORT,new hn);q.register(C.ARRAY_REVERSE,new yn);q.register(C.ARRAY_FILL,new En);q.register(C.ARRAY_COPYWITHIN,new wn);q.register(C.MAP_SET,new bn);q.register(C.MAP_DELETE,new vn);q.register(C.MAP_CLEAR,new Sn);q.register(C.SET_ADD,new xn);q.register(C.SET_DELETE,new An);q.register(C.SET_CLEAR,new Tn);q.register(C.SCRIPT,new _n);function It(t,e,n={}){const{createIntermediates:r=!1}=n;if(e.length===0)return null;if(e.length===1)return{parent:t,key:e[0],exists:!0};let o=t,i=!0;for(let a=0;a<e.length-1;a++){const c=e[a];if(c)if(o instanceof Map){if(!o.has(c))if(r){const u=e[a+1],l=u&&/^\d+$/.test(u)?[]:{};o.set(c,l)}else{i=!1;break}o=o.get(c)}else if(o!==null&&typeof o=="object"){if(!(c in o))if(r){const u=e[a+1];o[c]=u&&/^\d+$/.test(u)?[]:{}}else{i=!1;break}o=o[c]}else{i=!1;break}}const s=e[e.length-1];return{parent:o,key:s,exists:i}}const pt=(t,e)=>{const n=It(t,e.path,{createIntermediates:!0});if(!n)return;const{parent:r,key:o}=n;q.applyEvent(e,r,o,t)},mt=async(t,e,n)=>{if(n.isReplaying=!0,Array.isArray(e))for(const r of e)pt(t,r);else for await(const r of e)pt(t,r);n.isReplaying=!1},In=async(t,e,n)=>{if(e.stream)await mt(t,e.stream(),n);else{const r=await e.getAll();await mt(t,r,n)}};class Pn{constructor(){this.delta=new Map,this.DELETED=Symbol("deleted")}getDeletedSymbol(){return this.DELETED}isDirty(){return this.delta.size>0}size(){return this.delta.size}has(e){return this.delta.has(e)}get(e){return this.delta.get(e)}set(e,n){this.delta.set(e,n)}delete(e){this.delta.set(e,this.DELETED)}isDeleted(e){return this.delta.get(e)===this.DELETED}clear(){this.delta.clear()}entries(){return Array.from(this.delta.entries()).sort((e,n)=>{const r=e[0].split(".").length,o=n[0].split(".").length;return r-o})}createCheckpoint(){return new Map(this.delta)}restoreCheckpoint(e){this.delta.clear();for(const[n,r]of e)this.delta.set(n,r)}}function Cn(t){return t!==null&&typeof t=="object"}function be(t,e,n=new WeakMap){if(!Cn(t))return t;if(n.has(t))return n.get(t);const r=e.has(t)?e.get(t):t;if(r!==t&&n.has(r)){const a=n.get(r);return n.set(t,a),a}if(r instanceof Map){const a=new Map;n.set(t,a),r!==t&&n.set(r,a);let c=!1;for(const[l,f]of r.entries()){const p=be(l,e,n),w=be(f,e,n);a.set(p,w),(p!==l||w!==f)&&(c=!0)}const u=c?a:r;return n.set(t,u),r!==t&&n.set(r,u),u}if(r instanceof Set){const a=new Set;n.set(t,a),r!==t&&n.set(r,a);let c=!1;for(const l of r.values()){const f=be(l,e,n);a.add(f),f!==l&&(c=!0)}const u=c?a:r;return n.set(t,u),r!==t&&n.set(r,u),u}if(Array.isArray(r)){const a=[];n.set(t,a),r!==t&&n.set(r,a);let c=!1;for(const l of r){const f=be(l,e,n);a.push(f),f!==l&&(c=!0)}const u=c?a:r;return n.set(t,u),r!==t&&n.set(r,u),u}const o={};n.set(t,o),r!==t&&n.set(r,o);let i=!1;for(const[a,c]of Object.entries(r)){const u=be(c,e,n);o[a]=u,u!==c&&(i=!0)}const s=i?o:r;return n.set(t,s),r!==t&&n.set(r,s),s}function te(t){return t!==null&&typeof t=="object"}function Q(t,e,n,r,o){if(r.has(t))return r.get(t);const i=e.getDeletedSymbol(),s=new Proxy(t,{get(a,c){if(typeof c=="symbol")return a[c];const u=[...n,String(c)],l=u.join(".");if(e.has(l)){const p=e.get(l);return p===i?void 0:te(p)?o.has(p)?p:Q(p,e,u,r,o):p}const f=a[c];if(typeof f=="function"&&Array.isArray(a)){const p=String(c);return["push","pop","shift","unshift","splice","sort","reverse"].includes(p)?function(...w){const h=n.join(".");let E;e.has(h)?E=e.get(h):(E=[...a],e.set(h,E));let v=w;return(p==="push"||p==="unshift"||p==="splice")&&(v=w.map((b,d)=>{if(!te(b))return b;if(r.has(b))return r.get(b);if(o.has(b))return b;let m;if(p==="push")m=[...n,String(E.length+d)];else if(p==="unshift")m=[...n,String(d)];else{const y=w[0];if(d<2)return b;m=[...n,String(y+d-2)]}return Q(b,e,m,r,o)})),f.apply(E,v)}:["find","findLast","filter","map","flatMap"].includes(p)?function(...w){const h=f.apply(a,w);if(h==null)return h;if(p==="find"||p==="findLast"){if(te(h)){const E=a.indexOf(h);if(E!==-1){const v=[...n,String(E)];return Q(h,e,v,r,o)}}return h}else return Array.isArray(h)?h.map((E,v)=>{if(te(E)){const b=a.indexOf(E);if(b!==-1){const d=[...n,String(b)];return Q(E,e,d,r,o)}}return E}):h}:f.bind(a)}if(typeof f=="function"&&a instanceof Map){const p=String(c);return["set","delete","clear"].includes(p)?function(...w){if(p==="set"&&w.length>=2){const[h,E]=w,v=[...n,String(h)],b=v.join(".");let d=E;return te(E)&&(r.has(E)?d=r.get(E):o.has(E)||(d=Q(E,e,v,r,o))),e.set(b,d),a}if(p==="delete"&&w.length>=1){const[h]=w,E=[...n,String(h)].join(".");return e.delete(E),!0}if(p==="clear"){const h=new Set(a.keys()),E=n.join(".")+".";for(const[v]of e.entries())if(v.startsWith(E)){const b=v.slice(E.length);b.includes(".")||h.add(b)}for(const v of h){const b=[...n,String(v)].join(".");e.delete(b)}return}return f.apply(a,w)}:["get"].includes(p)?function(...w){const[h]=w,E=[...n,String(h)],v=E.join(".");if(e.has(v)){const d=e.get(v);return d===i?void 0:te(d)?r.has(d)?r.get(d):o.has(d)?d:Q(d,e,E,r,o):d}const b=a.get(h);return b!=null&&te(b)?r.has(b)?r.get(b):o.has(b)?b:Q(b,e,E,r,o):b}:["values","entries","keys","forEach"].includes(p)?function(...w){const h=new Map;for(const[v,b]of a.entries())h.set(v,b);const E=n.join(".")+".";for(const[v,b]of e.entries())if(v.startsWith(E)){const d=v.slice(E.length);if(!d.includes(".")){const m=d;b===i?h.delete(m):h.set(m,b)}}if(p==="forEach"){const[v,b]=w;for(const[d,m]of h.entries()){let y=m;if(te(m)){const S=[...n,String(d)];r.has(m)?y=r.get(m):o.has(m)||(y=Q(m,e,S,r,o))}v.call(b,y,d,a)}return}else{let v;return p==="values"?v=h.values():p==="entries"?v=h.entries():v=h.keys(),{[Symbol.iterator](){return this},next(){const b=v.next();if(!b.done&&b.value!==void 0){if(p==="values"){const d=b.value;if(te(d)){let m=null;for(const[y,S]of h.entries())if(S===d){m=y;break}if(m!==null&&!r.has(d)&&!o.has(d)){const y=[...n,String(m)];b.value=Q(d,e,y,r,o)}else r.has(d)&&(b.value=r.get(d))}}else if(p==="entries"){const[d,m]=b.value;if(te(m)){if(r.has(m))b.value=[d,r.get(m)];else if(!o.has(m)){const y=[...n,String(d)];b.value=[d,Q(m,e,y,r,o)]}}}}return b}}}}:f.bind(a)}if(typeof f=="function"&&a instanceof Set){const p=String(c);return["add","delete","clear"].includes(p)?function(...w){const h=n.join(".");let E;if(e.has(h)?E=e.get(h):(E=new Set(a),e.set(h,E)),p==="add"&&w.length>=1){const v=w[0];if(te(v)&&!r.has(v)&&!o.has(v)){const b=[...n,String(v)];w[0]=Q(v,e,b,r,o)}}return f.apply(E,w)}:f.bind(a)}return te(f)?o.has(f)?f:Q(f,e,u,r,o):f},set(a,c,u){const l=[...n,String(c)].join(".");return e.set(l,u),!0},has(a,c){const u=[...n,String(c)].join(".");return e.has(u)?e.get(u)!==i:c in a},deleteProperty(a,c){const u=[...n,String(c)].join(".");return e.delete(u),!0},ownKeys(a){const c=Reflect.ownKeys(a),u=n.length>0?n.join(".")+".":"",l=new Set;for(const[p,w]of e.entries())if(p.startsWith(u)){const h=p.slice(u.length),E=h.indexOf("."),v=E===-1?h:h.slice(0,E);w!==i&&l.add(v)}const f=new Set(c);for(const[p,w]of e.entries())if(p.startsWith(u)){const h=p.slice(u.length);if(h.indexOf(".")===-1){const E=h;w===i?f.delete(E):f.add(E)}}return Array.from(f)},getOwnPropertyDescriptor(a,c){const u=[...n,String(c)].join(".");if(e.has(u)){const l=e.get(u);return l===i?void 0:{value:l,writable:!0,enumerable:!0,configurable:!0}}return Reflect.getOwnPropertyDescriptor(a,c)}});return r.set(t,s),o.set(s,t),s}async function et(t){const e=new Pn,n=e.getDeletedSymbol(),r=new WeakMap,o=new WeakMap,i={};return await In(i,t,{isReplaying:!0}),{root:Q(i,e,[],r,o),isDirty(){return e.isDirty()},getUncommittedCount(){return e.size()},async save(){const s=e.entries(),a=new WeakMap,c=(u,l,f=[])=>{if(!(l===null||typeof l!="object")&&!u.has(l))if(u.set(l,f),Array.isArray(l))l.forEach((p,w)=>c(u,p,[...f,String(w)]));else if(l instanceof Map){let p=0;l.forEach(w=>c(u,w,[...f,`map:${p++}`]))}else if(l instanceof Set){let p=0;l.forEach(w=>c(u,w,[...f,`set:${p++}`]))}else l instanceof Date||Object.entries(l).forEach(([p,w])=>c(u,w,[...f,p]))};for(const[u,l]of s){const f=new WeakMap;c(f,i);const p=u.split("."),w=It(i,p,{createIntermediates:!1});if(!w)continue;const{parent:h,key:E}=w;if(l===n)h instanceof Map||h instanceof Set?h.delete(E):h!==null&&typeof h=="object"&&delete h[E],await t.append({type:"DELETE",path:p,timestamp:Date.now()});else{const v=be(l,o,a),b=ae(v,new WeakMap,f,p);h instanceof Map?h.set(E,v):h!==null&&typeof h=="object"&&(h[E]=v),await t.append({type:"SET",path:p,value:b,timestamp:Date.now()})}}e.clear()},discard(){e.clear()},createCheckpoint(){return e.createCheckpoint()},restoreCheckpoint(s){e.restoreCheckpoint(s)},unwrap(s){return be(s,o)}}}const Pt=new WeakMap,Ct=t=>{const e=Pt.get(t);if(!e)throw new Error("Not a memory image root - use createMemoryImage() first");return nn(t,e.proxyToTarget)},Ln=t=>Pt.get(t)||null,Rn=(t="ireneo",e="events")=>{let n,r=!1;const o=new Promise((s,a)=>{if(typeof indexedDB>"u"){a(new Error("IndexedDB not available (browser only)"));return}const c=indexedDB.open(t);c.onerror=()=>a(c.error),c.onsuccess=()=>{const u=c.result,l=u.objectStoreNames.contains(e),f=u.version;if(u.close(),l){const p=indexedDB.open(t,f);p.onerror=()=>a(p.error),p.onsuccess=()=>{n=p.result,s()}}else{const p=indexedDB.open(t,f+1);p.onerror=()=>a(p.error),p.onsuccess=()=>{n=p.result,s()},p.onupgradeneeded=w=>{const h=w.target.result;h.objectStoreNames.contains(e)||h.createObjectStore(e,{autoIncrement:!0})}}},c.onupgradeneeded=u=>{const l=u.target.result;l.objectStoreNames.contains(e)||l.createObjectStore(e,{autoIncrement:!0})}}),i=()=>{if(r)throw new Error(`EventLog (${e}) has been closed and cannot be used. This usually happens when switching between memory images.`)};return{append:async s=>(i(),await o,new Promise((a,c)=>{const u=n.transaction([e],"readwrite").objectStore(e).add(s);u.onsuccess=()=>a(),u.onerror=()=>c(u.error)})),getAll:async()=>(i(),await o,new Promise((s,a)=>{const c=n.transaction([e],"readonly").objectStore(e).getAll();c.onsuccess=()=>s(c.result),c.onerror=()=>a(c.error)})),clear:async()=>(i(),await o,new Promise((s,a)=>{const c=n.transaction([e],"readwrite").objectStore(e).clear();c.onsuccess=()=>s(),c.onerror=()=>a(c.error)})),close:async()=>{if(!r){r=!0;try{await o,n&&(n.close(),await new Promise(s=>setTimeout(s,50)))}catch(s){console.warn(`EventLog close(): Database was never initialized (${e})`,s)}}}}};class kn{constructor(){this._history=[["root"]],this._currentIndex=0,this._selectedPath=["root"],this._expandedPaths=new Set(["root"]),this._expandedNestedObjects=new Set,this.onNavigate=null}get selectedPath(){return[...this._selectedPath]}get currentIndex(){return this._currentIndex}get history(){return this._history.map(e=>[...e])}expandAncestors(e){for(let n=1;n<=e.length;n++){const r=e.slice(0,n).join(".");this._expandedPaths.add(r)}}reset(){this._selectedPath=["root"],this._expandedPaths=new Set(["root"]),this._expandedNestedObjects=new Set,this._history=[["root"]],this._currentIndex=0}navigateTo(e,n=!0){n&&(this._history=this._history.slice(0,this._currentIndex+1),this._history.push([...e]),this._currentIndex=this._history.length-1),this.expandAncestors(e),this._selectedPath=[...e],this.onNavigate&&this.onNavigate()}goBack(){this.canGoBack()&&(this._currentIndex--,this._selectedPath=[...this._history[this._currentIndex]],this.expandAncestors(this._selectedPath),this.onNavigate&&this.onNavigate())}goForward(){this.canGoForward()&&(this._currentIndex++,this._selectedPath=[...this._history[this._currentIndex]],this.expandAncestors(this._selectedPath),this.onNavigate&&this.onNavigate())}canGoBack(){return this._currentIndex>0}canGoForward(){return this._currentIndex<this._history.length-1}toggleExpanded(e){this._expandedPaths.has(e)?this._expandedPaths.delete(e):this._expandedPaths.add(e)}isExpanded(e){return this._expandedPaths.has(e)}toggleNestedExpanded(e){this._expandedNestedObjects.has(e)?this._expandedNestedObjects.delete(e):this._expandedNestedObjects.add(e)}isNestedExpanded(e){return this._expandedNestedObjects.has(e)}}function Dn(t,e){if(t===e)return["root"];if(!t||typeof t!="object")return null;const n=[[t,["root"]]],r=new Set;for(r.add(t);n.length>0;){const[o,i]=n.shift(),s=o instanceof Map?Array.from(o.entries()):o instanceof Set?Array.from(o.values()).map((a,c)=>[`[${c}]`,a]):Object.entries(o);for(const[a,c]of s)if(!(typeof a=="string"&&a.startsWith("__"))){if(c===e)return[...i,String(a)];c&&typeof c=="object"&&!r.has(c)&&(r.add(c),n.push([c,[...i,String(a)]]))}}return null}function tt(t,e){const n=Ln(t);if(n){const{targetToPath:r,proxyToTarget:o}=n,i=o.get(e)||e,s=r.get(i);if(s)return["root",...s]}return Dn(t,e)}function On(t){return Array.isArray(t)||t instanceof Map||t instanceof Set}class Mn{getChildren(e){return e.map((r,o)=>[`[${o}]`,r])}createChildPath(e,n){return[...e,n.toString()]}}class Fn{getChildren(e){const n=e;return Array.from(n.entries()).map(([r,o])=>[String(r),o])}createChildPath(e,n){return[...e,`map:${n}`]}}class Bn{getChildren(e){const n=e;return Array.from(n.values()).map((r,o)=>[`[${o}]`,r])}createChildPath(e,n){return[...e,`set:${n}`]}}function nt(t){return Array.isArray(t)?new Mn:t instanceof Map?new Fn:t instanceof Set?new Bn:null}function gt(t){if(t==null)return!1;const e=typeof t;return e==="object"||e==="function"}function $n(t){return t==null?"○":Array.isArray(t)?"[]":typeof t=="object"?"{}":typeof t=="function"?"ƒ":"•"}function jn(t,e,n){if(!gt(t))return[];const r=nt(t);return r?r.getChildren(t):Object.entries(t).filter(([s,a])=>{if(s.startsWith("__")||!gt(a))return!1;if(typeof a=="object"&&a!==null){const c=tt(n,a);if(c){const u=e.join("."),l=c.join(".");if(!l.startsWith(u+".")&&l!==u)return!1}}return!0})}function Hn(t,e,n,r,o,i){const s=document.createElement("div");s.className="tree-node-header",i&&s.classList.add("selected");const a=document.createElement("span");a.className=r?o?"tree-toggle expanded":"tree-toggle collapsed":"tree-toggle leaf";const c=document.createElement("span");c.className="tree-icon",c.textContent=$n(e);const u=document.createElement("span");return u.className="tree-label",u.textContent=t,s.appendChild(a),s.appendChild(c),s.appendChild(u),s}function Un(t,e,n,r,o,i,s){const a=n.join(".");t.querySelector(".tree-toggle").addEventListener("click",u=>{u.stopPropagation(),o&&(i.toggleExpanded(a),s&&s())}),t.addEventListener("click",u=>{u.stopPropagation();let l=n;if(e!=null&&(typeof e=="object"||typeof e=="function")){const f=tt(r,e);f&&(l=[...f])}i.navigateTo(l,!0),s&&s()})}function Yn(t,e,n,r,o,i){const s=document.createElement("div");s.className="tree-children expanded";const a=nt(t);return a?qn(s,n,e,a,r,o,i):zn(s,n,e,r,o,i),s}function qn(t,e,n,r,o,i,s){if(!r)return;let a=0;for(const[c,u]of e){const l=r.createChildPath(n,a);t.appendChild(rt(c,u,l,o,i,s)),a++}}function zn(t,e,n,r,o,i){for(const[s,a]of e){const c=[...n,s];t.appendChild(rt(s,a,c,r,o,i))}}function rt(t,e,n,r,o,i){const s=document.createElement("div");s.className="tree-node";const a=n.join("."),c=a===o.selectedPath.join("."),u=jn(e,n,r),l=u.length>0,f=o.isExpanded(a),p=Hn(t,e,n,l,f,c);if(Un(p,e,n,r,l,o,i),s.appendChild(p),l&&f){const w=Yn(e,n,u,r,o,i);s.appendChild(w)}return s}function Wn(t,e,n,r){n.innerHTML="";const o=rt("this",t,["root"],t,e,r);n.appendChild(o)}const Fe="__",D={PROPERTY_TABLE:"property-table",PROPERTY_NAME:"property-name",PROPERTY_VALUE:"property-value",EMPTY_STATE:"empty-state",VALUE_NAVIGABLE:"value-navigable",VALUE_NULL:"value-null",VALUE_UNDEFINED:"value-undefined",VALUE_STRING:"value-string",VALUE_NUMBER:"value-number",VALUE_BOOLEAN:"value-boolean",VALUE_BIGINT:"value-bigint",VALUE_SYMBOL:"value-symbol",VALUE_DATE:"value-date",VALUE_FUNCTION:"value-function",VALUE_ARRAY:"value-array",VALUE_MAP:"value-map",VALUE_SET:"value-set",VALUE_OBJECT:"value-object"},Ne={MAX_PREVIEW_LENGTH:80,MAX_OBJECT_PROPERTIES_PREVIEW:5},Gn=/name|desc(ription)?$/i,Z={NULL:"∅",UNDEFINED:"∅",STRING:'"',NUMBER:"#",BOOLEAN:"✓",BIGINT:"#n",SYMBOL:"Σ",DATE:"📅",FUNCTION:"ƒ",ARRAY:"[]",MAP:"M{}",SET:"S{}",OBJECT:"{}"};let Je=null;function ot(t){Je=t}function Pe(t){return Je?Je(t):t}var K=(t=>(t[t.NULL=1]="NULL",t[t.UNDEFINED=2]="UNDEFINED",t[t.STRING=3]="STRING",t[t.NUMBER=4]="NUMBER",t[t.BOOLEAN=5]="BOOLEAN",t[t.BIGINT=6]="BIGINT",t[t.SYMBOL=7]="SYMBOL",t[t.DATE=8]="DATE",t[t.FUNCTION=9]="FUNCTION",t[t.ARRAY=10]="ARRAY",t[t.MAP=11]="MAP",t[t.SET=12]="SET",t[t.OBJECT=13]="OBJECT",t))(K||{});function st(t){if(t===null)return{category:1,typeName:"null",isNavigable:!1,isCollection:!1,displayIcon:Z.NULL,cssClass:D.VALUE_NULL};if(t===void 0)return{category:2,typeName:"undefined",isNavigable:!1,isCollection:!1,displayIcon:Z.UNDEFINED,cssClass:D.VALUE_UNDEFINED};const e=typeof t;return e==="string"?{category:3,typeName:"string",isNavigable:!1,isCollection:!1,displayIcon:Z.STRING,cssClass:D.VALUE_STRING}:e==="number"?{category:4,typeName:"number",isNavigable:!1,isCollection:!1,displayIcon:Z.NUMBER,cssClass:D.VALUE_NUMBER}:e==="boolean"?{category:5,typeName:"boolean",isNavigable:!1,isCollection:!1,displayIcon:Z.BOOLEAN,cssClass:D.VALUE_BOOLEAN}:e==="bigint"?{category:6,typeName:"bigint",isNavigable:!1,isCollection:!1,displayIcon:Z.BIGINT,cssClass:D.VALUE_BIGINT}:e==="symbol"?{category:7,typeName:"symbol",isNavigable:!1,isCollection:!1,displayIcon:Z.SYMBOL,cssClass:D.VALUE_SYMBOL}:Ce(t)?{category:8,typeName:"Date",isNavigable:!0,isCollection:!1,displayIcon:Z.DATE,cssClass:D.VALUE_DATE}:e==="function"?{category:9,typeName:"Function",isNavigable:!0,isCollection:!1,displayIcon:Z.FUNCTION,cssClass:D.VALUE_FUNCTION}:Array.isArray(t)?{category:10,typeName:"Array",isNavigable:!0,isCollection:!0,displayIcon:Z.ARRAY,cssClass:D.VALUE_ARRAY}:t instanceof Map?{category:11,typeName:"Map",isNavigable:!0,isCollection:!0,displayIcon:Z.MAP,cssClass:D.VALUE_MAP}:t instanceof Set?{category:12,typeName:"Set",isNavigable:!0,isCollection:!0,displayIcon:Z.SET,cssClass:D.VALUE_SET}:{category:13,typeName:"Object",isNavigable:!0,isCollection:!1,displayIcon:Z.OBJECT,cssClass:D.VALUE_OBJECT}}const Vn=On;function Ce(t){if(t==null||typeof t!="object")return!1;if(t instanceof Date)return!0;let e=t;for(let n=0;n<5;n++){const r=Pe(e);if(r===e)break;if(r instanceof Date)return!0;if(typeof r!="object"||r===null)break;e=r}try{let n=Object.getPrototypeOf(t);for(;n!==null;){if(n===Date.prototype)return!0;n=Object.getPrototypeOf(n)}}catch{}return typeof t.getTime=="function"&&typeof t.toISOString=="function"}function Jn(t){if(t==null||typeof t!="object"||Vn(t))return!1;const e=Object.entries(t).filter(([n])=>!n.startsWith("__"));if(Ce(t)){if(e.length===0||e.length>5)return!1}else if(e.length>5)return!1;return e.every(([n,r])=>{if(r==null)return!0;const o=typeof r;return!!(o==="string"||o==="number"||o==="boolean"||o==="bigint"||Ce(r))})}class Kn{canFormat(e){return e.category===K.NULL}formatPreview(e){return""}formatFull(e){return""}}class Xn{canFormat(e){return e.category===K.UNDEFINED}formatPreview(e){return"undefined"}formatFull(e){return"undefined"}}class Zn{canFormat(e){return e.category===K.STRING}formatPreview(e,n=Ne.MAX_PREVIEW_LENGTH){const r=String(e);return r.length>n?r.substring(0,n)+"...":r}formatFull(e){return String(e)}}class Qn{canFormat(e){return e.category===K.NUMBER}formatPreview(e){return String(e)}formatFull(e){return String(e)}}class er{canFormat(e){return e.category===K.BOOLEAN}formatPreview(e){return String(e)}formatFull(e){return String(e)}}class tr{canFormat(e){return e.category===K.BIGINT}formatPreview(e){return e.toString()+"n"}formatFull(e){return e.toString()+"n"}}class nr{canFormat(e){return e.category===K.SYMBOL}formatPreview(e){return e.toString()}formatFull(e){return e.toString()}}class rr{canFormat(e){return e.category===K.DATE}formatPreview(e){const n=Pe(e),r=isNaN(n.getTime())?"Invalid Date":n.toISOString(),o=Object.keys(e).filter(i=>!i.startsWith("__")).length;return o>0?`${r} {${o}}`:r}formatFull(e){const n=Pe(e),r=isNaN(n.getTime())?"Invalid Date":n.toISOString(),o=Object.keys(e).filter(i=>!i.startsWith("__")).length;return o>0?`Date(${r}) {${o}}`:r}}class or{canFormat(e){return e.category===K.FUNCTION}formatPreview(e){return"ƒ "+(e.name||"(anonymous)")}formatFull(e){return"ƒ "+(e.name||"(anonymous)")}}class sr{canFormat(e){return e.category===K.ARRAY}formatPreview(e,n=Ne.MAX_PREVIEW_LENGTH){const r=e;try{const o=JSON.stringify(r,null,0);return o.length>n?o.substring(0,n)+"...":o}catch{return`[Array(${r.length})]`}}formatFull(e){return`Array(${e.length})`}}class ar{canFormat(e){return e.category===K.MAP}formatPreview(e){return`Map{${e.size}}`}formatFull(e){return`Map{${e.size}}`}}class ir{canFormat(e){return e.category===K.SET}formatPreview(e){return`Set{${e.size}}`}formatFull(e){return`Set{${e.size}}`}}function Be(t){if(t==null)return"";const e=typeof t;if(e!=="object"&&e!=="function")return String(t);if(Ce(t))return Pe(t).toISOString();if(Array.isArray(t))return`[${t.length} items]`;if(t instanceof Map)return`Map{${t.size}}`;if(t instanceof Set)return`Set{${t.size}}`;const n=[],r=Object.entries(t).filter(([i])=>!i.startsWith(Fe));for(const[i,s]of r)if(Gn.test(i)){if(typeof s=="string")n.push(s);else if(s!==null&&typeof s=="object"&&!Ce(s)&&!Array.isArray(s)&&!(s instanceof Map)&&!(s instanceof Set)){const a=Be(s);a&&!a.startsWith("Object{")&&n.push(a)}}return n.length>0?n.join(" "):`Object{${r.length}}`}class cr{canFormat(e){return e.category===K.OBJECT}formatPreview(e,n=Ne.MAX_PREVIEW_LENGTH){const r=e,o=Pe(e);if(o instanceof Date){const l=isNaN(o.getTime())?"Invalid Date":o.toISOString(),f=Object.keys(r).filter(p=>!p.startsWith("__")).length;return f>0?`${l} {${f}}`:l}const i=Be(r);if(i&&!i.startsWith("Object{"))return i.length>n?i.substring(0,n)+"...":i;const s=Object.entries(r).filter(([l])=>!l.startsWith(Fe)).slice(0,Ne.MAX_OBJECT_PROPERTIES_PREVIEW);if(s.length===0)return i;const a=s.map(([l,f])=>f===null?`"${l}":null`:f===void 0?`"${l}":undefined`:typeof f=="string"?`"${l}":"${f}"`:typeof f=="number"||typeof f=="boolean"?`"${l}":${f}`:Array.isArray(f)?`"${l}":[Array]`:typeof f=="object"?`"${l}":[Object]`:typeof f=="function"?`"${l}":[Function]`:`"${l}":${typeof f}`),c=Object.keys(r).filter(l=>!l.startsWith(Fe)).length>Ne.MAX_OBJECT_PROPERTIES_PREVIEW,u="{"+a.join(",")+(c?",...":"")+"}";return u.length>n?u.substring(0,n)+"...":u}formatFull(e){return Be(e)}}const lr=[new Kn,new Xn,new Zn,new Qn,new er,new tr,new nr,new rr,new or,new sr,new ar,new ir,new cr];function ur(t,e="preview",n){const r=st(t),o=lr.find(i=>i.canFormat(r));return o?e==="preview"?o.formatPreview(t,n):o.formatFull(t):String(t)}function je(t,e="preview",n){const r=st(t);return[ur(t,e,n),r]}function dr(t){if(t==null)return[];try{const n=Reflect.ownKeys(t).filter(o=>typeof o=="string");if(n.length>0)return n.map(o=>[o,t[o]]);const r=Object.entries(t);return r.length>0?r:[]}catch(e){return console.error("Failed to enumerate object properties with Reflect.ownKeys:",e),Object.entries(t)}}function fr(t){return dr(t).filter(([e])=>!e.startsWith(Fe))}function pr(t){const e=fr(t),n=[],r=[];for(const[o,i]of e)st(i).isCollection?r.push([o,i]):n.push([o,i]);return{scalars:n,collections:r}}function Lt(t,e){let n=t;for(let r=1;r<e.length;r++){const o=e[r];if(o===void 0)return;if(!(o===""&&!(o in n))&&(n=n==null?void 0:n[o],n===void 0))return}return n}function mr(t){const e=document.createElement("div");e.className="inspector-tabs";const n=document.createElement("div");n.className="tab-headers";const r=document.createElement("div");r.className="tab-content";const o=t.findIndex(s=>!s.isEmpty),i=o>=0?o:0;return t.forEach((s,a)=>{const c=document.createElement("button");c.className="tab-header",c.textContent=s.label,c.disabled=s.isEmpty,c.dataset.tabId=s.id,a===i&&c.classList.add("active"),c.addEventListener("click",()=>{n.querySelectorAll(".tab-header").forEach(u=>u.classList.remove("active")),r.querySelectorAll(".tab-panel").forEach(u=>u.classList.remove("active")),c.classList.add("active"),s.content.classList.add("active")}),n.appendChild(c),s.content.className="tab-panel",s.content.dataset.tabId=s.id,a===i&&s.content.classList.add("active"),r.appendChild(s.content)}),e.appendChild(n),e.appendChild(r),e}function gr(t,e,n,r,o,i){const s=document.createElement("td");s.className=D.PROPERTY_VALUE;const[a,c]=je(t,"preview");return s.textContent=a,s.title=c.typeName,s.classList.add(c.cssClass),c.isNavigable&&(s.classList.add(D.VALUE_NAVIGABLE),s.addEventListener("click",()=>{Rt(n,r,e,o,i)})),s}function hr(t,e,n,r,o){const i=document.createElement("td");i.className=D.PROPERTY_VALUE;const s=`${n.join(".")}.${e}`,a=r.isNestedExpanded(s),c=Be(t),u=document.createElement("div");u.className="value-nested";const l=document.createElement("span");l.className=`value-nested-toggle ${a?"expanded":"collapsed"}`;const f=document.createElement("span");f.className="value-nested-summary",f.textContent=`{${c}}`,u.appendChild(l),u.appendChild(f);const p=document.createElement("div");p.className=`nested-properties ${a?"expanded":""}`;for(const[h,E]of Object.entries(t)){if(h.startsWith("__"))continue;const v=document.createElement("div");v.className="nested-prop";const b=document.createElement("span");b.className="nested-prop-key",b.textContent=`${h}:`;const[d,m]=je(E,"preview"),y=document.createElement("span");y.className=`nested-prop-value ${m.cssClass}`,y.textContent=d,v.appendChild(b),v.appendChild(y),p.appendChild(v)}i.appendChild(u),i.appendChild(p);let w=null;return u.addEventListener("click",h=>{if(h.stopPropagation(),w){clearTimeout(w),w=null;return}w=setTimeout(()=>{w=null,r.toggleNestedExpanded(s),o&&o()},250)}),u.addEventListener("dblclick",h=>{h.stopPropagation(),w&&(clearTimeout(w),w=null);const E=[...n,e];r.navigateTo(E,!0),o&&o()}),i}function Rt(t,e,n,r,o){const i=Lt(t,e),s=i==null?void 0:i[n];if(!s){console.error("Could not find referenced object");return}const a=tt(t,s);if(!a){console.error("Could not find canonical path for object");return}r.navigateTo([...a],!0),o&&o()}function yr(t,e,n,r,o,i){const s=document.createElement("tr"),a=document.createElement("td");a.className=D.PROPERTY_NAME,a.textContent=t;const c=Jn(e)?hr(e,t,r,o,i):gr(e,t,n,r,o,i);return s.appendChild(a),s.appendChild(c),s}function Er(t,e,n,r,o){const i=document.createElement("table");i.className=D.PROPERTY_TABLE;const s=document.createElement("thead");s.innerHTML="<tr><th>Property</th><th>Value</th></tr>",i.appendChild(s);const a=document.createElement("tbody");for(const[c,u]of t)a.appendChild(yr(c,u,e,n,r,o));return i.appendChild(a),i}function wr(t,e,n,r,o){const i=document.createElement("div");if(i.className="collections-panel",t.length===0)return i.innerHTML=`<div class="${D.EMPTY_STATE}">No collections</div>`,i;for(const[s,a]of t){const c=document.createElement("div");c.className="collection-section";const u=document.createElement("h3");u.textContent=s,u.className="collection-header",c.appendChild(u);const l=nt(a);if(!l){const p=document.createElement("div");p.className=D.EMPTY_STATE,p.textContent="Unknown collection type",c.appendChild(p),i.appendChild(c);continue}const f=l.getChildren(a);if(f.length===0){const p=document.createElement("div");p.className=D.EMPTY_STATE,p.textContent="Empty collection",c.appendChild(p)}else{const p=document.createElement("ul");p.className="collection-items";for(const[w,h]of f){const E=document.createElement("li");E.className="collection-item";const[v,b]=je(h,"preview"),d=document.createElement("span");d.className="item-label",d.textContent=`${w}: `;const m=document.createElement("span");m.className=`item-value ${b.cssClass}`,m.textContent=v,m.title=b.typeName,E.appendChild(d),E.appendChild(m),b.isNavigable&&(m.classList.add(D.VALUE_NAVIGABLE),m.addEventListener("click",()=>{const y=[...n,s];Rt(e,y,w,r,o)})),p.appendChild(E)}c.appendChild(p)}i.appendChild(c)}return i}function br(t,e,n,r){const o=e.selectedPath;if(o.length===0){n.innerHTML=`<div class="${D.EMPTY_STATE}">Select a node in the tree</div>`;return}const i=Lt(t,o);if(i==null){n.innerHTML=`<div class="${D.EMPTY_STATE}">Value is ${i===null?"null":"undefined"}</div>`;return}if(typeof i!="object"&&typeof i!="function"){const[l]=je(i,"preview");n.innerHTML=`<div class="${D.EMPTY_STATE}">Primitive value: ${l}</div>`;return}const{scalars:s,collections:a}=pr(i);if(s.length===0&&a.length===0){n.innerHTML=`<div class="${D.EMPTY_STATE}">No properties</div>`;return}const c=[{id:"properties",label:"Properties",content:Er(s,t,o,e,r),isEmpty:s.length===0},{id:"collections",label:"Collections",content:wr(a,t,o,e,r),isEmpty:a.length===0}],u=mr(c);n.innerHTML="",n.appendChild(u)}const Ie="memimg-explorer",Ke=1e3,vr=100*1024;function Sr(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}function at(t){return`script-history-${t}`}async function xr(t){const e=at(t);return new Promise((n,r)=>{const o=indexedDB.open(Ie);o.onerror=()=>{r(o.error)},o.onsuccess=async()=>{const i=o.result,s=i.objectStoreNames.contains(e),a=i.version;if(i.close(),await new Promise(u=>setTimeout(u,50)),s){n();return}const c=indexedDB.open(Ie,a+1);c.onerror=()=>{r(c.error)},c.onblocked=()=>{},c.onsuccess=async()=>{c.result.close(),await new Promise(u=>setTimeout(u,50)),n()},c.onupgradeneeded=u=>{const l=u.target.result;if(!l.objectStoreNames.contains(e)){const f=l.createObjectStore(e,{keyPath:"id"});f.createIndex("timestamp","timestamp",{unique:!1}),f.createIndex("characterCount","characterCount",{unique:!1})}}},o.onupgradeneeded=i=>{const s=i.target.result;if(!s.objectStoreNames.contains(e)){const a=s.createObjectStore(e,{keyPath:"id"});a.createIndex("timestamp","timestamp",{unique:!1}),a.createIndex("characterCount","characterCount",{unique:!1})}}})}async function Le(t,e="readonly"){const n=at(t);return new Promise((r,o)=>{const i=indexedDB.open(Ie);i.onerror=()=>o(i.error),i.onsuccess=async()=>{const s=i.result,a=!s.objectStoreNames.contains(n),c=s.version;if(s.close(),await new Promise(u=>setTimeout(u,50)),a){const u=indexedDB.open(Ie,c+1);u.onerror=()=>o(u.error),u.onsuccess=()=>{const l=u.result;try{const p=l.transaction([n],e).objectStore(n);r({db:l,store:p})}catch(f){l.close(),o(f)}},u.onupgradeneeded=l=>{const f=l.target.result,p=l.target.transaction;if(!f.objectStoreNames.contains(n)){const w=f.createObjectStore(n,{keyPath:"id"});w.createIndex("timestamp","timestamp",{unique:!1}),w.createIndex("characterCount","characterCount",{unique:!1})}p.oncomplete=()=>{console.log(`Script history store created: ${n}`)}}}else{const u=indexedDB.open(Ie);u.onerror=()=>o(u.error),u.onsuccess=()=>{const l=u.result,p=l.transaction([n],e).objectStore(n);r({db:l,store:p})}}},i.onupgradeneeded=s=>{const a=s.target.result;if(!a.objectStoreNames.contains(n)){const c=a.createObjectStore(n,{keyPath:"id"});c.createIndex("timestamp","timestamp",{unique:!1}),c.createIndex("characterCount","characterCount",{unique:!1})}}})}async function Ar(t,e){const n=new Blob([e]).size;if(n>vr)throw new Error(`Script too large: ${(n/1024).toFixed(1)} KB (max 100 KB)`);const r={id:Sr(),timestamp:Date.now(),code:e,status:"success",characterCount:e.length},{db:o,store:i}=await Le(t,"readwrite");return new Promise((s,a)=>{const c=i.count();c.onsuccess=()=>{const u=c.result;if(u>=Ke){const l=u-Ke+1,p=i.index("timestamp").openCursor(null,"next");let w=0;const h=[];p.onsuccess=()=>{const E=p.result;if(E&&w<l)h.push(E.value.id),w++,E.continue();else{for(const b of h)i.delete(b);const v=i.add(r);v.onsuccess=async()=>{o.close(),await new Promise(b=>setTimeout(b,50)),s()},v.onerror=async()=>{o.close(),await new Promise(b=>setTimeout(b,50)),a(v.error)}}},p.onerror=async()=>{o.close(),await new Promise(E=>setTimeout(E,50)),a(p.error)}}else{const l=i.add(r);l.onsuccess=async()=>{o.close(),await new Promise(f=>setTimeout(f,50)),s()},l.onerror=async()=>{o.close(),await new Promise(f=>setTimeout(f,50)),a(l.error)}}},c.onerror=async()=>{o.close(),await new Promise(u=>setTimeout(u,50)),a(c.error)}})}async function He(t,e=100){const{db:n,store:r}=await Le(t,"readonly");return new Promise((o,i)=>{const a=r.index("timestamp").openCursor(null,"prev"),c=[];a.onsuccess=async()=>{const u=a.result;u&&c.length<e?(c.push(u.value),u.continue()):(n.close(),await new Promise(l=>setTimeout(l,50)),o(c))},a.onerror=async()=>{n.close(),await new Promise(u=>setTimeout(u,50)),i(a.error)}})}async function Tr(t,e){if(!e||e.trim().length===0)return He(t,100);const{db:n,store:r}=await Le(t,"readonly"),o=e.toLowerCase();return new Promise((i,s)=>{const c=r.index("timestamp").openCursor(null,"prev"),u=[];c.onsuccess=async()=>{const l=c.result;if(l){const f=l.value;f.code.toLowerCase().includes(o)&&u.push(f),l.continue()}else n.close(),await new Promise(f=>setTimeout(f,50)),i(u)},c.onerror=async()=>{n.close(),await new Promise(l=>setTimeout(l,50)),s(c.error)}})}async function _r(t){const{db:e,store:n}=await Le(t,"readwrite");return new Promise((r,o)=>{const i=n.clear();i.onsuccess=async()=>{e.close(),await new Promise(s=>setTimeout(s,50)),r()},i.onerror=async()=>{e.close(),await new Promise(s=>setTimeout(s,50)),o(i.error)}})}async function Nr(t){const e=await He(t,Ke),n={memimgId:t,exportedAt:new Date().toISOString(),entryCount:e.length,entries:e.map(r=>({timestamp:r.timestamp,timestampISO:new Date(r.timestamp).toISOString(),code:r.code,characterCount:r.characterCount}))};return JSON.stringify(n,null,2)}async function Ir(t){const{db:e,store:n}=await Le(t,"readonly");return new Promise((r,o)=>{const i=n.count();i.onsuccess=()=>{const s=i.result,a=n.openCursor();let c=0;a.onsuccess=async()=>{const u=a.result;if(u){const l=u.value;c+=l.characterCount,u.continue()}else e.close(),await new Promise(l=>setTimeout(l,50)),r({count:s,totalSize:c})},a.onerror=async()=>{e.close(),await new Promise(u=>setTimeout(u,50)),o(a.error)}},i.onerror=async()=>{e.close(),await new Promise(s=>setTimeout(s,50)),o(i.error)}})}const Pr=window;function Cr(t,e,n={}){const r={tab:"	",indentOn:/[({\[]$/,moveToNewLine:/^[)}\]]/,spellcheck:!1,catchTab:!0,preserveIdent:!0,addClosing:!0,history:!0,window:Pr,autoclose:{open:`([{'"`,close:`)]}'"`},...n},o=r.window,i=o.document,s=[],a=[];let c=-1,u=!1,l=()=>{},f;t.setAttribute("contenteditable","plaintext-only"),t.setAttribute("spellcheck",r.spellcheck?"true":"false"),t.style.outline="none",t.style.overflowWrap="break-word",t.style.overflowY="auto",t.style.whiteSpace="pre-wrap";const p=(g,x)=>{e(g,x)},w=o.navigator.userAgent.match(/Firefox\/([0-9]+)\./),h=w?parseInt(w[1]):0;let E=!1;(t.contentEditable!=="plaintext-only"||h>=136)&&(E=!0),E&&t.setAttribute("contenteditable","true");const v=he(()=>{const g=S();p(t,g),A(g)},30);let b=!1;const d=g=>!de(g)&&!Ee(g)&&g.key!=="Meta"&&g.key!=="Control"&&g.key!=="Alt"&&!g.key.startsWith("Arrow"),m=he(g=>{d(g)&&(ue(),b=!1)},300),y=(g,x)=>{s.push([g,x]),t.addEventListener(g,x)};y("keydown",g=>{g.defaultPrevented||(f=oe(),r.preserveIdent?M(g):$(g),r.catchTab&&Re(g),r.addClosing&&ie(g),r.history&&(ke(g),d(g)&&!b&&(ue(),b=!0)),E&&!X(g)&&A(S()))}),y("keyup",g=>{g.defaultPrevented||g.isComposing||(f!==oe()&&v(),m(g),l(oe()))}),y("focus",g=>{u=!0}),y("blur",g=>{u=!1}),y("paste",g=>{ue(),qe(g),ue(),l(oe())}),y("cut",g=>{ue(),De(g),ue(),l(oe())});function S(){const g=fe(),x={start:0,end:0,dir:void 0};let{anchorNode:T,anchorOffset:I,focusNode:k,focusOffset:F}=g;if(!T||!k)throw"error1";if(T===t&&k===t)return x.start=I>0&&t.textContent?t.textContent.length:0,x.end=F>0&&t.textContent?t.textContent.length:0,x.dir=F>=I?"->":"<-",x;if(T.nodeType===Node.ELEMENT_NODE){const H=i.createTextNode("");T.insertBefore(H,T.childNodes[I]),T=H,I=0}if(k.nodeType===Node.ELEMENT_NODE){const H=i.createTextNode("");k.insertBefore(H,k.childNodes[F]),k=H,F=0}return j(t,H=>{if(H===T&&H===k)return x.start+=I,x.end+=F,x.dir=I<=F?"->":"<-","stop";if(H===T)if(x.start+=I,!x.dir)x.dir="->";else return"stop";else if(H===k)if(x.end+=F,!x.dir)x.dir="<-";else return"stop";H.nodeType===Node.TEXT_NODE&&(x.dir!="->"&&(x.start+=H.nodeValue.length),x.dir!="<-"&&(x.end+=H.nodeValue.length))}),t.normalize(),x}function A(g){var dt,ft;const x=fe();let T,I=0,k,F=0;if(g.dir||(g.dir="->"),g.start<0&&(g.start=0),g.end<0&&(g.end=0),g.dir=="<-"){const{start:ce,end:pe}=g;g.start=pe,g.end=ce}let H=0;j(t,ce=>{if(ce.nodeType!==Node.TEXT_NODE)return;const pe=(ce.nodeValue||"").length;if(H+pe>g.start&&(T||(T=ce,I=g.start-H),H+pe>g.end))return k=ce,F=g.end-H,"stop";H+=pe}),T||(T=t,I=t.childNodes.length),k||(k=t,F=t.childNodes.length),g.dir=="<-"&&([T,I,k,F]=[k,F,T,I]);{const ce=N(T);if(ce){const _e=i.createTextNode("");(dt=ce.parentNode)==null||dt.insertBefore(_e,ce),T=_e,I=0}const pe=N(k);if(pe){const _e=i.createTextNode("");(ft=pe.parentNode)==null||ft.insertBefore(_e,pe),k=_e,F=0}}x.setBaseAndExtent(T,I,k,F),t.normalize()}function N(g){for(;g&&g!==t;){if(g.nodeType===Node.ELEMENT_NODE){const x=g;if(x.getAttribute("contenteditable")=="false")return x}g=g.parentNode}}function P(){const x=fe().getRangeAt(0),T=i.createRange();return T.selectNodeContents(t),T.setEnd(x.startContainer,x.startOffset),T.toString()}function _(){const x=fe().getRangeAt(0),T=i.createRange();return T.selectNodeContents(t),T.setStart(x.endContainer,x.endOffset),T.toString()}function M(g){if(g.key==="Enter"){const x=P(),T=_();let[I]=we(x),k=I;if(r.indentOn.test(x)&&(k+=r.tab),k.length>0?(ee(g),g.stopPropagation(),z(`
`+k)):$(g),k!==I&&r.moveToNewLine.test(T)){const F=S();z(`
`+I),A(F)}}}function $(g){if(E&&g.key==="Enter")if(ee(g),g.stopPropagation(),_()==""){z(`
 `);const x=S();x.start=--x.end,A(x)}else z(`
`)}function ie(g){const x=r.autoclose.open,T=r.autoclose.close;if(x.includes(g.key)){ee(g);const I=S(),k=I.start==I.end?"":fe().toString(),F=g.key+k+(T[x.indexOf(g.key)]??"");z(F),I.start++,I.end++,A(I)}}function Re(g){if(g.key==="Tab")if(ee(g),g.shiftKey){const x=P();let[T,I]=we(x);if(T.length>0){const k=S(),F=Math.min(r.tab.length,T.length);A({start:I,end:I+F}),i.execCommand("delete"),k.start-=F,k.end-=F,A(k)}}else z(r.tab)}function ke(g){if(de(g)){ee(g),c--;const x=a[c];x&&(t.innerHTML=x.html,A(x.pos)),c<0&&(c=0)}if(Ee(g)){ee(g),c++;const x=a[c];x&&(t.innerHTML=x.html,A(x.pos)),c>=a.length&&c--}}function ue(){if(!u)return;const g=t.innerHTML,x=S(),T=a[c];if(T&&T.html===g&&T.pos.start===x.start&&T.pos.end===x.end)return;c++,a[c]={html:g,pos:x},a.splice(c+1);const I=300;c>I&&(c=I,a.splice(0,1))}function qe(g){if(g.defaultPrevented)return;ee(g);const T=(g.originalEvent??g).clipboardData.getData("text/plain").replace(/\r\n?/g,`
`),I=S();z(T),p(t),A({start:Math.min(I.start,I.end)+T.length,end:Math.min(I.start,I.end)+T.length,dir:"<-"})}function De(g){const x=S(),T=fe();(g.originalEvent??g).clipboardData.setData("text/plain",T.toString()),i.execCommand("delete"),p(t),A({start:Math.min(x.start,x.end),end:Math.min(x.start,x.end),dir:"<-"}),ee(g)}function j(g,x){const T=[];g.firstChild&&T.push(g.firstChild);let I=T.pop();for(;I&&x(I)!=="stop";)I.nextSibling&&T.push(I.nextSibling),I.firstChild&&T.push(I.firstChild),I=T.pop()}function V(g){return g.metaKey||g.ctrlKey}function de(g){return V(g)&&!g.shiftKey&&Te(g)==="Z"}function Ee(g){return V(g)&&g.shiftKey&&Te(g)==="Z"}function X(g){return V(g)&&Te(g)==="C"}function Te(g){let x=g.key||g.keyCode||g.which;if(x)return(typeof x=="string"?x:String.fromCharCode(x)).toUpperCase()}function z(g){g=g.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"),i.execCommand("insertHTML",!1,g)}function he(g,x){let T=0;return(...I)=>{clearTimeout(T),T=o.setTimeout(()=>g(...I),x)}}function we(g){let x=g.length-1;for(;x>=0&&g[x]!==`
`;)x--;x++;let T=x;for(;T<g.length&&/[ \t]/.test(g[T]);)T++;return[g.substring(x,T)||"",x,T]}function oe(){return t.textContent||""}function ee(g){g.preventDefault()}function fe(){return t.getRootNode().getSelection()}return{updateOptions(g){Object.assign(r,g)},updateCode(g,x=!0){t.textContent=g,p(t),x&&l(g)},onUpdate(g){l=g},toString:oe,save:S,restore:A,recordHistory:ue,destroy(){for(let[g,x]of s)t.removeEventListener(g,x)}}}var ht=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Lr(t){return t&&t.__esModule&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t}var ze={exports:{}},yt;function Rr(){return yt||(yt=1,(function(t){var e=typeof window<"u"?window:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:{};/**
 * Prism: Lightweight, robust, elegant syntax highlighting
 *
 * @license MIT <https://opensource.org/licenses/MIT>
 * @author Lea Verou <https://lea.verou.me>
 * @namespace
 * @public
 */var n=(function(r){var o=/(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,i=0,s={},a={manual:r.Prism&&r.Prism.manual,disableWorkerMessageHandler:r.Prism&&r.Prism.disableWorkerMessageHandler,util:{encode:function d(m){return m instanceof c?new c(m.type,d(m.content),m.alias):Array.isArray(m)?m.map(d):m.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(d){return Object.prototype.toString.call(d).slice(8,-1)},objId:function(d){return d.__id||Object.defineProperty(d,"__id",{value:++i}),d.__id},clone:function d(m,y){y=y||{};var S,A;switch(a.util.type(m)){case"Object":if(A=a.util.objId(m),y[A])return y[A];S={},y[A]=S;for(var N in m)m.hasOwnProperty(N)&&(S[N]=d(m[N],y));return S;case"Array":return A=a.util.objId(m),y[A]?y[A]:(S=[],y[A]=S,m.forEach(function(P,_){S[_]=d(P,y)}),S);default:return m}},getLanguage:function(d){for(;d;){var m=o.exec(d.className);if(m)return m[1].toLowerCase();d=d.parentElement}return"none"},setLanguage:function(d,m){d.className=d.className.replace(RegExp(o,"gi"),""),d.classList.add("language-"+m)},currentScript:function(){if(typeof document>"u")return null;if(document.currentScript&&document.currentScript.tagName==="SCRIPT")return document.currentScript;try{throw new Error}catch(S){var d=(/at [^(\r\n]*\((.*):[^:]+:[^:]+\)$/i.exec(S.stack)||[])[1];if(d){var m=document.getElementsByTagName("script");for(var y in m)if(m[y].src==d)return m[y]}return null}},isActive:function(d,m,y){for(var S="no-"+m;d;){var A=d.classList;if(A.contains(m))return!0;if(A.contains(S))return!1;d=d.parentElement}return!!y}},languages:{plain:s,plaintext:s,text:s,txt:s,extend:function(d,m){var y=a.util.clone(a.languages[d]);for(var S in m)y[S]=m[S];return y},insertBefore:function(d,m,y,S){S=S||a.languages;var A=S[d],N={};for(var P in A)if(A.hasOwnProperty(P)){if(P==m)for(var _ in y)y.hasOwnProperty(_)&&(N[_]=y[_]);y.hasOwnProperty(P)||(N[P]=A[P])}var M=S[d];return S[d]=N,a.languages.DFS(a.languages,function($,ie){ie===M&&$!=d&&(this[$]=N)}),N},DFS:function d(m,y,S,A){A=A||{};var N=a.util.objId;for(var P in m)if(m.hasOwnProperty(P)){y.call(m,P,m[P],S||P);var _=m[P],M=a.util.type(_);M==="Object"&&!A[N(_)]?(A[N(_)]=!0,d(_,y,null,A)):M==="Array"&&!A[N(_)]&&(A[N(_)]=!0,d(_,y,P,A))}}},plugins:{},highlightAll:function(d,m){a.highlightAllUnder(document,d,m)},highlightAllUnder:function(d,m,y){var S={callback:y,container:d,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};a.hooks.run("before-highlightall",S),S.elements=Array.prototype.slice.apply(S.container.querySelectorAll(S.selector)),a.hooks.run("before-all-elements-highlight",S);for(var A=0,N;N=S.elements[A++];)a.highlightElement(N,m===!0,S.callback)},highlightElement:function(d,m,y){var S=a.util.getLanguage(d),A=a.languages[S];a.util.setLanguage(d,S);var N=d.parentElement;N&&N.nodeName.toLowerCase()==="pre"&&a.util.setLanguage(N,S);var P=d.textContent,_={element:d,language:S,grammar:A,code:P};function M(ie){_.highlightedCode=ie,a.hooks.run("before-insert",_),_.element.innerHTML=_.highlightedCode,a.hooks.run("after-highlight",_),a.hooks.run("complete",_),y&&y.call(_.element)}if(a.hooks.run("before-sanity-check",_),N=_.element.parentElement,N&&N.nodeName.toLowerCase()==="pre"&&!N.hasAttribute("tabindex")&&N.setAttribute("tabindex","0"),!_.code){a.hooks.run("complete",_),y&&y.call(_.element);return}if(a.hooks.run("before-highlight",_),!_.grammar){M(a.util.encode(_.code));return}if(m&&r.Worker){var $=new Worker(a.filename);$.onmessage=function(ie){M(ie.data)},$.postMessage(JSON.stringify({language:_.language,code:_.code,immediateClose:!0}))}else M(a.highlight(_.code,_.grammar,_.language))},highlight:function(d,m,y){var S={code:d,grammar:m,language:y};if(a.hooks.run("before-tokenize",S),!S.grammar)throw new Error('The language "'+S.language+'" has no grammar.');return S.tokens=a.tokenize(S.code,S.grammar),a.hooks.run("after-tokenize",S),c.stringify(a.util.encode(S.tokens),S.language)},tokenize:function(d,m){var y=m.rest;if(y){for(var S in y)m[S]=y[S];delete m.rest}var A=new f;return p(A,A.head,d),l(d,A,m,A.head,0),h(A)},hooks:{all:{},add:function(d,m){var y=a.hooks.all;y[d]=y[d]||[],y[d].push(m)},run:function(d,m){var y=a.hooks.all[d];if(!(!y||!y.length))for(var S=0,A;A=y[S++];)A(m)}},Token:c};r.Prism=a;function c(d,m,y,S){this.type=d,this.content=m,this.alias=y,this.length=(S||"").length|0}c.stringify=function d(m,y){if(typeof m=="string")return m;if(Array.isArray(m)){var S="";return m.forEach(function(M){S+=d(M,y)}),S}var A={type:m.type,content:d(m.content,y),tag:"span",classes:["token",m.type],attributes:{},language:y},N=m.alias;N&&(Array.isArray(N)?Array.prototype.push.apply(A.classes,N):A.classes.push(N)),a.hooks.run("wrap",A);var P="";for(var _ in A.attributes)P+=" "+_+'="'+(A.attributes[_]||"").replace(/"/g,"&quot;")+'"';return"<"+A.tag+' class="'+A.classes.join(" ")+'"'+P+">"+A.content+"</"+A.tag+">"};function u(d,m,y,S){d.lastIndex=m;var A=d.exec(y);if(A&&S&&A[1]){var N=A[1].length;A.index+=N,A[0]=A[0].slice(N)}return A}function l(d,m,y,S,A,N){for(var P in y)if(!(!y.hasOwnProperty(P)||!y[P])){var _=y[P];_=Array.isArray(_)?_:[_];for(var M=0;M<_.length;++M){if(N&&N.cause==P+","+M)return;var $=_[M],ie=$.inside,Re=!!$.lookbehind,ke=!!$.greedy,ue=$.alias;if(ke&&!$.pattern.global){var qe=$.pattern.toString().match(/[imsuy]*$/)[0];$.pattern=RegExp($.pattern.source,qe+"g")}for(var De=$.pattern||$,j=S.next,V=A;j!==m.tail&&!(N&&V>=N.reach);V+=j.value.length,j=j.next){var de=j.value;if(m.length>d.length)return;if(!(de instanceof c)){var Ee=1,X;if(ke){if(X=u(De,V,d,Re),!X||X.index>=d.length)break;var we=X.index,Te=X.index+X[0].length,z=V;for(z+=j.value.length;we>=z;)j=j.next,z+=j.value.length;if(z-=j.value.length,V=z,j.value instanceof c)continue;for(var he=j;he!==m.tail&&(z<Te||typeof he.value=="string");he=he.next)Ee++,z+=he.value.length;Ee--,de=d.slice(V,z),X.index-=V}else if(X=u(De,0,de,Re),!X)continue;var we=X.index,oe=X[0],ee=de.slice(0,we),fe=de.slice(we+oe.length),g=V+de.length;N&&g>N.reach&&(N.reach=g);var x=j.prev;ee&&(x=p(m,x,ee),V+=ee.length),w(m,x,Ee);var T=new c(P,ie?a.tokenize(oe,ie):oe,ue,oe);if(j=p(m,x,T),fe&&p(m,j,fe),Ee>1){var I={cause:P+","+M,reach:g};l(d,m,y,j.prev,V,I),N&&I.reach>N.reach&&(N.reach=I.reach)}}}}}}function f(){var d={value:null,prev:null,next:null},m={value:null,prev:d,next:null};d.next=m,this.head=d,this.tail=m,this.length=0}function p(d,m,y){var S=m.next,A={value:y,prev:m,next:S};return m.next=A,S.prev=A,d.length++,A}function w(d,m,y){for(var S=m.next,A=0;A<y&&S!==d.tail;A++)S=S.next;m.next=S,S.prev=m,d.length-=A}function h(d){for(var m=[],y=d.head.next;y!==d.tail;)m.push(y.value),y=y.next;return m}if(!r.document)return r.addEventListener&&(a.disableWorkerMessageHandler||r.addEventListener("message",function(d){var m=JSON.parse(d.data),y=m.language,S=m.code,A=m.immediateClose;r.postMessage(a.highlight(S,a.languages[y],y)),A&&r.close()},!1)),a;var E=a.util.currentScript();E&&(a.filename=E.src,E.hasAttribute("data-manual")&&(a.manual=!0));function v(){a.manual||a.highlightAll()}if(!a.manual){var b=document.readyState;b==="loading"||b==="interactive"&&E&&E.defer?document.addEventListener("DOMContentLoaded",v):window.requestAnimationFrame?window.requestAnimationFrame(v):window.setTimeout(v,16)}return a})(e);t.exports&&(t.exports=n),typeof ht<"u"&&(ht.Prism=n),n.languages.markup={comment:{pattern:/\x3C!--(?:(?!\x3C!--)[\s\S])*?-->/,greedy:!0},prolog:{pattern:/<\?[\s\S]+?\?>/,greedy:!0},doctype:{pattern:/<!DOCTYPE(?:[^>"'[\]]|"[^"]*"|'[^']*')+(?:\[(?:[^<"'\]]|"[^"]*"|'[^']*'|<(?!!--)|\x3C!--(?:[^-]|-(?!->))*-->)*\]\s*)?>/i,greedy:!0,inside:{"internal-subset":{pattern:/(^[^\[]*\[)[\s\S]+(?=\]>$)/,lookbehind:!0,greedy:!0,inside:null},string:{pattern:/"[^"]*"|'[^']*'/,greedy:!0},punctuation:/^<!|>$|[[\]]/,"doctype-tag":/^DOCTYPE/i,name:/[^\s<>'"]+/}},cdata:{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,greedy:!0},tag:{pattern:/<\/?(?!\d)[^\s>\/=$<%]+(?:\s(?:\s*[^\s>\/=]+(?:\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))|(?=[\s/>])))+)?\s*\/?>/,greedy:!0,inside:{tag:{pattern:/^<\/?[^\s>\/]+/,inside:{punctuation:/^<\/?/,namespace:/^[^\s>\/:]+:/}},"special-attr":[],"attr-value":{pattern:/=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+)/,inside:{punctuation:[{pattern:/^=/,alias:"attr-equals"},{pattern:/^(\s*)["']|["']$/,lookbehind:!0}]}},punctuation:/\/?>/,"attr-name":{pattern:/[^\s>\/]+/,inside:{namespace:/^[^\s>\/:]+:/}}}},entity:[{pattern:/&[\da-z]{1,8};/i,alias:"named-entity"},/&#x?[\da-f]{1,8};/i]},n.languages.markup.tag.inside["attr-value"].inside.entity=n.languages.markup.entity,n.languages.markup.doctype.inside["internal-subset"].inside=n.languages.markup,n.hooks.add("wrap",function(r){r.type==="entity"&&(r.attributes.title=r.content.replace(/&amp;/,"&"))}),Object.defineProperty(n.languages.markup.tag,"addInlined",{value:function(o,i){var s={};s["language-"+i]={pattern:/(^<!\[CDATA\[)[\s\S]+?(?=\]\]>$)/i,lookbehind:!0,inside:n.languages[i]},s.cdata=/^<!\[CDATA\[|\]\]>$/i;var a={"included-cdata":{pattern:/<!\[CDATA\[[\s\S]*?\]\]>/i,inside:s}};a["language-"+i]={pattern:/[\s\S]+/,inside:n.languages[i]};var c={};c[o]={pattern:RegExp(/(<__[^>]*>)(?:<!\[CDATA\[(?:[^\]]|\](?!\]>))*\]\]>|(?!<!\[CDATA\[)[\s\S])*?(?=<\/__>)/.source.replace(/__/g,function(){return o}),"i"),lookbehind:!0,greedy:!0,inside:a},n.languages.insertBefore("markup","cdata",c)}}),Object.defineProperty(n.languages.markup.tag,"addAttribute",{value:function(r,o){n.languages.markup.tag.inside["special-attr"].push({pattern:RegExp(/(^|["'\s])/.source+"(?:"+r+")"+/\s*=\s*(?:"[^"]*"|'[^']*'|[^\s'">=]+(?=[\s>]))/.source,"i"),lookbehind:!0,inside:{"attr-name":/^[^\s=]+/,"attr-value":{pattern:/=[\s\S]+/,inside:{value:{pattern:/(^=\s*(["']|(?!["'])))\S[\s\S]*(?=\2$)/,lookbehind:!0,alias:[o,"language-"+o],inside:n.languages[o]},punctuation:[{pattern:/^=/,alias:"attr-equals"},/"|'/]}}}})}}),n.languages.html=n.languages.markup,n.languages.mathml=n.languages.markup,n.languages.svg=n.languages.markup,n.languages.xml=n.languages.extend("markup",{}),n.languages.ssml=n.languages.xml,n.languages.atom=n.languages.xml,n.languages.rss=n.languages.xml,(function(r){var o=/(?:"(?:\\(?:\r\n|[\s\S])|[^"\\\r\n])*"|'(?:\\(?:\r\n|[\s\S])|[^'\\\r\n])*')/;r.languages.css={comment:/\/\*[\s\S]*?\*\//,atrule:{pattern:RegExp("@[\\w-](?:"+/[^;{\s"']|\s+(?!\s)/.source+"|"+o.source+")*?"+/(?:;|(?=\s*\{))/.source),inside:{rule:/^@[\w-]+/,"selector-function-argument":{pattern:/(\bselector\s*\(\s*(?![\s)]))(?:[^()\s]|\s+(?![\s)])|\((?:[^()]|\([^()]*\))*\))+(?=\s*\))/,lookbehind:!0,alias:"selector"},keyword:{pattern:/(^|[^\w-])(?:and|not|only|or)(?![\w-])/,lookbehind:!0}}},url:{pattern:RegExp("\\burl\\((?:"+o.source+"|"+/(?:[^\\\r\n()"']|\\[\s\S])*/.source+")\\)","i"),greedy:!0,inside:{function:/^url/i,punctuation:/^\(|\)$/,string:{pattern:RegExp("^"+o.source+"$"),alias:"url"}}},selector:{pattern:RegExp(`(^|[{}\\s])[^{}\\s](?:[^{};"'\\s]|\\s+(?![\\s{])|`+o.source+")*(?=\\s*\\{)"),lookbehind:!0},string:{pattern:o,greedy:!0},property:{pattern:/(^|[^-\w\xA0-\uFFFF])(?!\s)[-_a-z\xA0-\uFFFF](?:(?!\s)[-\w\xA0-\uFFFF])*(?=\s*:)/i,lookbehind:!0},important:/!important\b/i,function:{pattern:/(^|[^-a-z0-9])[-a-z0-9]+(?=\()/i,lookbehind:!0},punctuation:/[(){};:,]/},r.languages.css.atrule.inside.rest=r.languages.css;var i=r.languages.markup;i&&(i.tag.addInlined("style","css"),i.tag.addAttribute("style","css"))})(n),n.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/},n.languages.javascript=n.languages.extend("clike",{"class-name":[n.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+(/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source)+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/}),n.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/,n.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:n.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:n.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:n.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:n.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:n.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/}),n.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:n.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}}),n.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}}),n.languages.markup&&(n.languages.markup.tag.addInlined("script","javascript"),n.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript")),n.languages.js=n.languages.javascript,(function(){if(typeof n>"u"||typeof document>"u")return;Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector);var r="Loading…",o=function(E,v){return"✖ Error "+E+" while fetching file: "+v},i="✖ Error: File does not exist or is empty",s={js:"javascript",py:"python",rb:"ruby",ps1:"powershell",psm1:"powershell",sh:"bash",bat:"batch",h:"c",tex:"latex"},a="data-src-status",c="loading",u="loaded",l="failed",f="pre[data-src]:not(["+a+'="'+u+'"]):not(['+a+'="'+c+'"])';function p(E,v,b){var d=new XMLHttpRequest;d.open("GET",E,!0),d.onreadystatechange=function(){d.readyState==4&&(d.status<400&&d.responseText?v(d.responseText):d.status>=400?b(o(d.status,d.statusText)):b(i))},d.send(null)}function w(E){var v=/^\s*(\d+)\s*(?:(,)\s*(?:(\d+)\s*)?)?$/.exec(E||"");if(v){var b=Number(v[1]),d=v[2],m=v[3];return d?m?[b,Number(m)]:[b,void 0]:[b,b]}}n.hooks.add("before-highlightall",function(E){E.selector+=", "+f}),n.hooks.add("before-sanity-check",function(E){var v=E.element;if(v.matches(f)){E.code="",v.setAttribute(a,c);var b=v.appendChild(document.createElement("CODE"));b.textContent=r;var d=v.getAttribute("data-src"),m=E.language;if(m==="none"){var y=(/\.(\w+)$/.exec(d)||[,"none"])[1];m=s[y]||y}n.util.setLanguage(b,m),n.util.setLanguage(v,m);var S=n.plugins.autoloader;S&&S.loadLanguages(m),p(d,function(A){v.setAttribute(a,u);var N=w(v.getAttribute("data-range"));if(N){var P=A.split(/\r\n?|\n/g),_=N[0],M=N[1]==null?P.length:N[1];_<0&&(_+=P.length),_=Math.max(0,Math.min(_-1,P.length)),M<0&&(M+=P.length),M=Math.max(0,Math.min(M,P.length)),A=P.slice(_,M).join(`
`),v.hasAttribute("data-start")||v.setAttribute("data-start",String(_+1))}b.textContent=A,n.highlightElement(b)},function(A){v.setAttribute(a,l),b.textContent=A})}}),n.plugins.fileHighlight={highlight:function(v){for(var b=(v||document).querySelectorAll(f),d=0,m;m=b[d++];)n.highlightElement(m)}};var h=!1;n.fileHighlight=function(){h||(console.warn("Prism.fileHighlight is deprecated. Use `Prism.plugins.fileHighlight.highlight` instead."),h=!0),n.plugins.fileHighlight.highlight.apply(this,arguments)}})()})(ze)),ze.exports}var kr=Rr();const We=Lr(kr);let ge=null;const kt="memimg-line-numbers";let Xe=null;function Dr(t){Xe=t}function Dt(t){ge&&ge.updateCode(t)}function Ot(){const t=localStorage.getItem(kt);return t===null?!0:t==="true"}function Or(t){localStorage.setItem(kt,t.toString())}function it(){const t=document.getElementById("line-numbers"),e=document.getElementById("code-editor");if(!ge||!t)return;const o=ge.toString().split(`
`).length,i=Array.from({length:o},(s,a)=>a+1).join(`
`);t.textContent=i,e.addEventListener("scroll",()=>{t.scrollTop=e.scrollTop})}function Mr(){const t=document.getElementById("line-numbers"),n=!Ot();Or(n),t&&(t.style.display=n?"block":"none"),n&&it()}function Fr(){const t=document.getElementById("line-numbers"),e=Ot();t&&(t.style.display=e?"block":"none"),e&&it()}function Ge(t,e=""){const n=document.getElementById("status");n.textContent=t,n.className=e,t&&e!=="error"&&setTimeout(()=>{n.textContent="",n.className=""},3e3)}async function Mt(t,e,n,r){var a,c;if(!ge)return;const o=ge.toString().trim();if(!o)return;let i;try{i=new Function(o)}catch(u){const l=u;let f=l.message;const p=f.match(/\((\d+):(\d+)\)/),w=f.match(/line (\d+)/);let h,E;if(p?(h=parseInt(p[1]),E=parseInt(p[2]),f=`Line ${h}, Col ${E}: ${l.message}`):w&&(h=parseInt(w[1]),f=`Line ${h}: ${l.message}`),h!==void 0){const b=o.split(`
`),d=h-1;d>=0&&d<b.length&&(f+=`

`+b[d])}const v=document.getElementById("error-panel");v.textContent=f,v.style.display="block",Ge("Syntax error - see below editor","error"),console.error("Syntax error:",l),console.error("Message:",l.message);return}const s=e.createCheckpoint();try{const u=i.call(t);u!==void 0&&console.log("Result:",u);const l=document.getElementById("error-panel");if(l.textContent="",l.style.display="none",n)try{await Ar(n,o),Xe&&(await new Promise(f=>setTimeout(f,50)),await Xe())}catch(f){console.error("Failed to save script to history:",f)}ge.updateCode(""),Ge("Code executed","success"),r&&r()}catch(u){e.restoreCheckpoint(s);const l=u;let f=l.message;const p=(a=l.stack)==null?void 0:a.match(/<anonymous>:(\d+):(\d+)/),w=(c=l.stack)==null?void 0:c.match(/Function:(\d+):(\d+)/),h=p||w;if(h){const v=parseInt(h[1]),b=parseInt(h[2]),d=v-2;f=`Line ${d}, Col ${b}: ${l.message}`;const m=o.split(`
`),y=d-1;y>=0&&y<m.length&&(console.error("Error at line",d,":",m[y]),f+=`

`+m[y])}const E=document.getElementById("error-panel");E.textContent=f,E.style.display="block",Ge("Runtime error - changes rolled back","error"),console.error("Runtime error:",l),console.error("Stack:",l.stack),console.log("Delta restored to checkpoint (partial mutations discarded)")}}let xe=null;function Br(t,e,n,r){const o=document.getElementById("code-editor");xe={root:t,txn:e,memimgId:n,onExecute:r},ge||(ge=Cr(o,s=>{const a=s.textContent||"";We.languages.javascript&&(s.innerHTML=We.highlight(a,We.languages.javascript,"javascript")),it()},{tab:"  ",indentOn:/[(\[{]$/}),Fr(),o.addEventListener("keydown",async s=>{s.ctrlKey&&s.key==="Enter"&&(s.preventDefault(),xe&&await Mt(xe.root,xe.txn,xe.memimgId,xe.onExecute))}))}const Me="memimg-explorer",Y="memimg-metadata";function $r(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}async function ve(){return new Promise((t,e)=>{const n=indexedDB.open(Me);n.onerror=()=>{e(n.error)},n.onsuccess=async()=>{const r=n.result,o=r.version,i=!r.objectStoreNames.contains(Y);if(r.close(),await new Promise(s=>setTimeout(s,50)),i){const s=indexedDB.open(Me,o+1);s.onerror=()=>{e(s.error)},s.onblocked=()=>{},s.onsuccess=()=>{t(s.result)},s.onupgradeneeded=a=>{const c=a.target.result;if(!c.objectStoreNames.contains(Y)){const u=c.createObjectStore(Y,{keyPath:"id"});u.createIndex("createdAt","createdAt",{unique:!1}),u.createIndex("updatedAt","updatedAt",{unique:!1})}}}else{const s=indexedDB.open(Me);s.onblocked=()=>{},s.onerror=()=>{e(s.error)},s.onsuccess=()=>{t(s.result)}}},n.onupgradeneeded=r=>{const o=r.target.result;if(!o.objectStoreNames.contains(Y)){const i=o.createObjectStore(Y,{keyPath:"id"});i.createIndex("createdAt","createdAt",{unique:!1}),i.createIndex("updatedAt","updatedAt",{unique:!1})}}})}async function Ft(){const t=await ve();return new Promise((e,n)=>{const s=t.transaction([Y],"readonly").objectStore(Y).index("updatedAt").openCursor(null,"prev"),a=[];s.onsuccess=async()=>{const c=s.result;c?(a.push(c.value),c.continue()):(t.close(),await new Promise(u=>setTimeout(u,50)),e(a))},s.onerror=async()=>{t.close(),await new Promise(c=>setTimeout(c,50)),n(s.error)}})}async function jr(t){const e=await ve();return new Promise((n,r)=>{const s=e.transaction([Y],"readonly").objectStore(Y).get(t);s.onsuccess=async()=>{e.close(),await new Promise(a=>setTimeout(a,50)),n(s.result||null)},s.onerror=async()=>{e.close(),await new Promise(a=>setTimeout(a,50)),r(s.error)}})}async function Bt(t,e){const n=await Ft(),r=t.trim().toLowerCase();return n.some(i=>i.id!==e&&i.name.toLowerCase()===r)}async function Hr(t,e=""){if(!t||t.trim().length===0)throw new Error("Memory image name cannot be empty");if(await Bt(t))throw new Error("A memory image with this name already exists");const n={id:$r(),name:t.trim(),description:e.trim(),createdAt:Date.now(),updatedAt:Date.now(),eventCount:0},r=await ve();return new Promise((o,i)=>{const c=r.transaction([Y],"readwrite").objectStore(Y).add(n);c.onsuccess=async()=>{r.close(),await new Promise(u=>setTimeout(u,50)),o(n)},c.onerror=async()=>{r.close(),await new Promise(u=>setTimeout(u,50)),i(c.error)}})}async function Ur(t,e){if(!e||e.trim().length===0)throw new Error("Memory image name cannot be empty");if(await Bt(e,t))throw new Error("A memory image with this name already exists");const n=await ve();return new Promise((r,o)=>{const s=n.transaction([Y],"readwrite").objectStore(Y),a=s.get(t);a.onsuccess=async()=>{const c=a.result;if(!c){n.close(),await new Promise(l=>setTimeout(l,50)),o(new Error(`Memory image not found: ${t}`));return}c.name=e.trim(),c.updatedAt=Date.now();const u=s.put(c);u.onsuccess=async()=>{n.close(),await new Promise(l=>setTimeout(l,50)),r()},u.onerror=async()=>{n.close(),await new Promise(l=>setTimeout(l,50)),o(u.error)}},a.onerror=async()=>{n.close(),await new Promise(c=>setTimeout(c,50)),o(a.error)}})}async function Yr(t,e){const n=await ve();return new Promise((r,o)=>{const s=n.transaction([Y],"readwrite").objectStore(Y),a=s.get(t);a.onsuccess=async()=>{const c=a.result;if(!c){n.close(),await new Promise(l=>setTimeout(l,50)),o(new Error(`Memory image not found: ${t}`));return}c.description=e.trim(),c.updatedAt=Date.now();const u=s.put(c);u.onsuccess=async()=>{n.close(),await new Promise(l=>setTimeout(l,50)),r()},u.onerror=async()=>{n.close(),await new Promise(l=>setTimeout(l,50)),o(u.error)}},a.onerror=async()=>{n.close(),await new Promise(c=>setTimeout(c,50)),o(a.error)}})}async function qr(t){const e=await ve();return new Promise((n,r)=>{const i=e.transaction([Y],"readwrite").objectStore(Y),s=i.get(t);s.onsuccess=async()=>{const a=s.result;if(!a){e.close(),await new Promise(u=>setTimeout(u,50)),r(new Error(`Memory image not found: ${t}`));return}a.updatedAt=Date.now();const c=i.put(a);c.onsuccess=async()=>{e.close(),await new Promise(u=>setTimeout(u,50)),n()},c.onerror=async()=>{e.close(),await new Promise(u=>setTimeout(u,50)),r(c.error)}},s.onerror=async()=>{e.close(),await new Promise(a=>setTimeout(a,50)),r(s.error)}})}async function zr(t){const e=await ve();return new Promise((n,r)=>{const s=e.transaction([Y],"readwrite").objectStore(Y).delete(t);s.onsuccess=async()=>{const a=`events-${t}`,c=at(t);try{const u=e.objectStoreNames.contains(a),l=e.objectStoreNames.contains(c);if(u||l){e.close(),await new Promise(w=>setTimeout(w,50));const f=e.version,p=indexedDB.open(Me,f+1);p.onupgradeneeded=w=>{const h=w.target.result;h.objectStoreNames.contains(a)&&h.deleteObjectStore(a),h.objectStoreNames.contains(c)&&h.deleteObjectStore(c)},p.onsuccess=async()=>{p.result.close(),await new Promise(w=>setTimeout(w,50)),n()},p.onerror=()=>{r(p.error)}}else e.close(),await new Promise(f=>setTimeout(f,50)),n()}catch(u){e.close(),await new Promise(l=>setTimeout(l,50)),r(u)}},s.onerror=async()=>{e.close(),await new Promise(a=>setTimeout(a,50)),r(s.error)}})}function Wr(t){return`events-${t}`}function Et(t){const e=new Date(t),r=new Date().getTime()-e.getTime(),o=Math.floor(r/6e4),i=Math.floor(r/36e5),s=Math.floor(r/864e5);return o<1?"Just now":o<60?`${o}m ago`:i<24?`${i}h ago`:s<7?`${s}d ago`:e.toLocaleDateString()}async function Ue(t,e){try{const n=await Ft();if(n.length===0){t.innerHTML=`
        <div class="empty-state">
          <div class="empty-icon">📦</div>
          <h2>No Memory Images Yet</h2>
          <p>Create your first memory image to get started</p>
          <button id="create-first-btn" class="primary-button">+ New Memory Image</button>
        </div>
      `,t.querySelector("#create-first-btn").addEventListener("click",()=>$t(t,e));return}const r=`
      <div class="memimg-grid">
        ${n.map(o=>Gr(o,e)).join("")}
      </div>
    `;t.innerHTML=r,n.forEach(o=>{const i=t.querySelector(`[data-id="${o.id}"]`);i.querySelector(".open-btn").addEventListener("click",l=>{l.stopPropagation(),e(o.id)}),i.querySelector(".rename-btn").addEventListener("click",l=>{l.stopPropagation(),Vr(o,t,e)}),i.querySelector(".edit-desc-btn").addEventListener("click",l=>{l.stopPropagation(),Jr(o,t,e)}),i.querySelector(".delete-btn").addEventListener("click",async l=>{if(l.stopPropagation(),confirm(`Delete "${o.name}"? This cannot be undone.`))try{await zr(o.id),await new Promise(f=>setTimeout(f,50)),await Ue(t,e)}catch(f){alert(`Error deleting memory image: ${f.message}`)}}),i.addEventListener("click",()=>e(o.id))})}catch(n){t.innerHTML=`
      <div class="error-state">
        <h2>Error Loading Memory Images</h2>
        <p>${n.message}</p>
      </div>
    `}}function Gr(t,e){const n=t.eventCount!==void 0?`${t.eventCount} events`:"Unknown size";return`
    <div class="memimg-card" data-id="${t.id}">
      <div class="card-header">
        <h3 class="card-title">${$e(t.name)}</h3>
        <div class="card-actions">
          <button class="icon-btn rename-btn" title="Rename">✏️</button>
          <button class="icon-btn edit-desc-btn" title="Edit description">📝</button>
          <button class="icon-btn delete-btn" title="Delete">🗑️</button>
        </div>
      </div>
      <div class="card-body">
        <p class="card-description">${$e(t.description)||"<em>No description</em>"}</p>
        <div class="card-meta">
          <span class="meta-item">📅 Created ${Et(t.createdAt)}</span>
          <span class="meta-item">🕒 Updated ${Et(t.updatedAt)}</span>
          <span class="meta-item">📊 ${n}</span>
        </div>
      </div>
      <div class="card-footer">
        <button class="open-btn">Open →</button>
      </div>
    </div>
  `}function $t(t,e){const n=document.createElement("div");n.className="modal-overlay",n.innerHTML=`
    <div class="modal-dialog">
      <div class="modal-header">
        <h2>New Memory Image</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="memimg-name">Name *</label>
          <input type="text" id="memimg-name" class="form-input" placeholder="My Memory Image" required autofocus>
        </div>
        <div class="form-group">
          <label for="memimg-desc">Description</label>
          <textarea id="memimg-desc" class="form-textarea" placeholder="Optional description" rows="3"></textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel-btn">Cancel</button>
        <button class="create-btn primary-button">Create</button>
      </div>
    </div>
  `,document.body.appendChild(n);const r=n.querySelector("#memimg-name"),o=n.querySelector("#memimg-desc"),i=n.querySelector(".modal-close"),s=n.querySelector(".cancel-btn"),a=n.querySelector(".create-btn"),c=()=>{n.remove()},u=async()=>{const l=r.value.trim();if(!l){alert("Please enter a name"),r.focus();return}a.disabled=!0;const f=a.textContent;a.textContent="Creating...";try{console.log("Creating memory image:",l);const p=await Hr(l,o.value.trim());console.log("Memory image created:",p),c(),e(p.id)}catch(p){console.error("Error creating memory image:",p),alert(`Error creating memory image: ${p.message}`),a.disabled=!1,a.textContent=f,r.focus()}};i.addEventListener("click",c),s.addEventListener("click",c),a.addEventListener("click",u),r.addEventListener("keydown",l=>{l.key==="Enter"&&(l.preventDefault(),u())}),n.addEventListener("keydown",l=>{l.key==="Escape"&&c()}),n.addEventListener("click",l=>{l.target===n&&c()}),r.focus()}function Vr(t,e,n){const r=document.createElement("div");r.className="modal-overlay",r.innerHTML=`
    <div class="modal-dialog">
      <div class="modal-header">
        <h2>Rename Memory Image</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="memimg-name">Name *</label>
          <input type="text" id="memimg-name" class="form-input" value="${$e(t.name)}" required autofocus>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel-btn">Cancel</button>
        <button class="save-btn primary-button">Save</button>
      </div>
    </div>
  `,document.body.appendChild(r);const o=r.querySelector("#memimg-name"),i=r.querySelector(".modal-close"),s=r.querySelector(".cancel-btn"),a=r.querySelector(".save-btn"),c=()=>{r.remove()},u=async()=>{const l=o.value.trim();if(!l){alert("Please enter a name"),o.focus();return}try{await Ur(t.id,l),c(),await Ue(e,n)}catch(f){alert(`Error renaming: ${f.message}`)}};i.addEventListener("click",c),s.addEventListener("click",c),a.addEventListener("click",u),o.addEventListener("keydown",l=>{l.key==="Enter"&&(l.preventDefault(),u())}),r.addEventListener("keydown",l=>{l.key==="Escape"&&c()}),r.addEventListener("click",l=>{l.target===r&&c()}),o.select()}function Jr(t,e,n){const r=document.createElement("div");r.className="modal-overlay",r.innerHTML=`
    <div class="modal-dialog">
      <div class="modal-header">
        <h2>Edit Description</h2>
        <button class="modal-close">&times;</button>
      </div>
      <div class="modal-body">
        <div class="form-group">
          <label for="memimg-desc">Description</label>
          <textarea id="memimg-desc" class="form-textarea" rows="4" autofocus>${$e(t.description)}</textarea>
        </div>
      </div>
      <div class="modal-footer">
        <button class="cancel-btn">Cancel</button>
        <button class="save-btn primary-button">Save</button>
      </div>
    </div>
  `,document.body.appendChild(r);const o=r.querySelector("#memimg-desc"),i=r.querySelector(".modal-close"),s=r.querySelector(".cancel-btn"),a=r.querySelector(".save-btn"),c=()=>{r.remove()},u=async()=>{try{await Yr(t.id,o.value.trim()),c(),await Ue(e,n)}catch(l){alert(`Error updating description: ${l.message}`)}};i.addEventListener("click",c),s.addEventListener("click",c),a.addEventListener("click",u),r.addEventListener("keydown",l=>{l.key==="Escape"&&c()}),r.addEventListener("click",l=>{l.target===r&&c()}),o.focus()}function $e(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}const jt=50;function Kr(t){const n=Date.now()-t,r=Math.floor(n/1e3),o=Math.floor(r/60),i=Math.floor(o/60),s=Math.floor(i/24);return r<60?"just now":o<60?`${o} min${o>1?"s":""} ago`:i<24?`${i} hour${i>1?"s":""} ago`:`${s} day${s>1?"s":""} ago`}function Xr(t){return new Date(t).toLocaleString()}function wt(t,e=jt){return t.length<=e?t:t.substring(0,e)+"..."}function Ve(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}function Ht(t,e,n){const r=document.createElement("div");r.className="history-entry",r.dataset.entryId=t.id;const o=t.code.length>jt,i=wt(t.code);r.innerHTML=`
    <div class="history-entry-header">
      <span class="history-status">●</span>
      <span class="history-timestamp" title="${Ve(Xr(t.timestamp))}">
        ${Ve(Kr(t.timestamp))}
      </span>
      <span class="history-size">${t.characterCount} chars</span>
    </div>
    <div class="history-code ${o?"expandable":""}" data-expanded="false">
      <pre>${Ve(i)}</pre>
    </div>
    <div class="history-actions">
      <button class="history-btn load-btn" title="Load into editor">⬆ Load</button>
      <button class="history-btn copy-btn" title="Copy to clipboard">📋 Copy</button>
      ${o?'<button class="history-btn expand-btn" title="Expand/collapse">▼ Expand</button>':""}
    </div>
  `;const s=r.querySelector(".load-btn"),a=r.querySelector(".copy-btn"),c=r.querySelector(".expand-btn"),u=r.querySelector(".history-code");return s==null||s.addEventListener("click",l=>{l.stopPropagation(),e(t.code)}),a==null||a.addEventListener("click",async l=>{l.stopPropagation(),n(t.code)}),c&&o&&c.addEventListener("click",l=>{l.stopPropagation(),u.dataset.expanded==="true"?(u.querySelector("pre").textContent=wt(t.code),u.dataset.expanded="false",c.textContent="▼ Expand"):(u.querySelector("pre").textContent=t.code,u.dataset.expanded="true",c.textContent="▲ Collapse")}),r}async function Ze(t,e,n){try{const r=await He(e,100);if(t.innerHTML="",r.length===0){t.innerHTML='<div class="history-empty">No script history yet. Run a script to get started.</div>';return}for(const s of r){const a=Ht(s,n,async c=>{try{await navigator.clipboard.writeText(c);const u=t.querySelector(`[data-entry-id="${s.id}"] .copy-btn`);if(u){const l=u.textContent;u.textContent="✓ Copied",setTimeout(()=>{u.textContent=l},1e3)}}catch(u){console.error("Failed to copy:",u),alert("Failed to copy to clipboard")}});t.appendChild(a)}const o=await Ir(e),i=document.querySelector(".history-stats");if(i){const s=(o.totalSize/1048576).toFixed(2);i.textContent=`${o.count} entries, ${s} MB`}}catch(r){console.error("Failed to render script history:",r),t.innerHTML='<div class="history-error">Failed to load script history</div>'}}function Zr(t,e,n,r){let o=null;t.addEventListener("input",()=>{o&&clearTimeout(o),o=window.setTimeout(async()=>{const i=t.value.trim();try{const s=i?await Tr(n,i):await He(n,100);if(e.innerHTML="",s.length===0){e.innerHTML='<div class="history-empty">No matching scripts found.</div>';return}for(const a of s){const c=Ht(a,r,async u=>{try{await navigator.clipboard.writeText(u);const l=e.querySelector(`[data-entry-id="${a.id}"] .copy-btn`);if(l){const f=l.textContent;l.textContent="✓ Copied",setTimeout(()=>{l.textContent=f},1e3)}}catch(l){console.error("Failed to copy:",l),alert("Failed to copy to clipboard")}});e.appendChild(c)}}catch(s){console.error("Search failed:",s),e.innerHTML='<div class="history-error">Search failed</div>'}},300)})}function Qr(t,e,n){t.addEventListener("click",async()=>{if(confirm("Clear all script history? This cannot be undone."))try{await _r(e),n()}catch(r){console.error("Failed to clear history:",r),alert("Failed to clear history")}})}function eo(t,e,n){t.addEventListener("click",async()=>{try{const r=await Nr(e),o=new Blob([r],{type:"application/json"}),i=URL.createObjectURL(o),s=document.createElement("a");s.href=i;const a=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5);s.download=`${n}-script-history-${a}.json`,s.click(),URL.revokeObjectURL(i)}catch(r){console.error("Failed to export history:",r),alert("Failed to export history")}})}let U=null,le=null,R=null,B=null,O;const ne=new kn;function ct(t){window.location.hash=t}function Ut(){const t=window.location.hash.slice(1);if(!t||t==="/")return{view:"list"};const e=t.match(/^\/edit\/(.+)$/);return e?{view:"edit",memimgId:e[1]}:{view:"list"}}async function to(){const t=Ut();if(t.view==="list")U&&await Gt();else if(t.view==="edit"&&t.memimgId&&U!==t.memimgId)try{await Ye(t.memimgId)}catch(e){console.error(`Failed to open memory image from hash: ${t.memimgId}`,e),L(`Memory image not found: ${t.memimgId}`,"error"),ct("/")}}const Yt=document.getElementById("list-view"),qt=document.getElementById("explorer-view"),zt=document.getElementById("memimg-list-content");window.viewAsJson=function(t,e=!0){try{const n=Ct(t),r=JSON.parse(n);return console.log(e?JSON.stringify(r,null,2):n),r}catch{const n=JSON.stringify(t,null,e?2:0);return console.log(n),JSON.parse(n)}};function L(t,e=""){const n=document.getElementById("status");n&&(n.textContent=t,n.className="status-bar "+e,t&&e!=="error"&&setTimeout(()=>{n.textContent="",n.className="status-bar"},3e3))}function Se(){const t=R?R.isDirty():!1,e=document.getElementById("save-btn"),n=document.getElementById("discard-btn");!e||!n||(t?(e.classList.add("dirty"),n.style.display="inline-block"):(e.classList.remove("dirty"),n.style.display="none"))}function se(){B&&(Wn(B,ne,document.getElementById("tree-view"),se),br(B,ne,document.getElementById("inspector-view"),se),no(),Se())}function no(){const t=document.getElementById("back-btn"),e=document.getElementById("forward-btn");!t||!e||(t.disabled=!ne.canGoBack(),e.disabled=!ne.canGoForward())}async function ro(){if(!B){L("No memory image open","error");return}try{const t=window.ObjectType,e=window.NumberType,n=window.StringType,r=window.DateTypeInstance;if(!t)throw new Error("ObjectType not found - javascript-types library not loaded");const o=t({name:"Name",properties:{firstName:{type:n},middleName:{type:n},lastName:{type:n}}}),i=t({name:"Dept",properties:{deptno:{type:e},dname:{type:n},loc:{type:n},emps:{type:null}}}),s=t({name:"Emp",properties:{empno:{type:e},ename:{type:o},job:{type:n},mgr:{type:null},hiredate:{type:r},sal:{type:e},comm:{type:e},dept:{type:i},subordinates:{type:null}}}),a=i({deptno:10,dname:"ACCOUNTING",loc:"NEW YORK"}),c=i({deptno:20,dname:"RESEARCH",loc:"DALLAS"}),u=i({deptno:30,dname:"SALES",loc:"CHICAGO"}),l=i({deptno:40,dname:"OPERATIONS",loc:"BOSTON"}),f=s({empno:7839,ename:o({firstName:"Arthur",middleName:"Rex",lastName:"KING"}),job:"PRESIDENT",mgr:null,hiredate:new Date("1981-11-17"),sal:5e3,comm:null,dept:a,subordinates:[]}),p=s({empno:7566,ename:o({firstName:"Indiana",middleName:"Henry",lastName:"JONES"}),job:"MANAGER",mgr:f,hiredate:new Date("1981-04-02"),sal:2975,comm:null,dept:c,subordinates:[]}),w=s({empno:7698,ename:o({firstName:"William",middleName:"Arthur",lastName:"BLAKE"}),job:"MANAGER",mgr:f,hiredate:new Date("1981-05-01"),sal:2850,comm:null,dept:u,subordinates:[]}),h=s({empno:7369,ename:o({firstName:"John",middleName:"Paul",lastName:"SMITH"}),job:"CLERK",mgr:p,hiredate:new Date("1980-12-17"),sal:800,comm:null,dept:c,subordinates:[]}),E=s({empno:7499,ename:o({firstName:"Ethan",middleName:"James",lastName:"ALLEN"}),job:"SALESMAN",mgr:w,hiredate:new Date("1981-02-20"),sal:1600,comm:300,dept:u,subordinates:[]}),v=s({empno:7521,ename:o({firstName:"Christopher",middleName:"Lee",lastName:"WARD"}),job:"SALESMAN",mgr:w,hiredate:new Date("1981-02-22"),sal:1250,comm:500,dept:u,subordinates:[]});a.emps=[f],c.emps=[p,h],u.emps=[w,E,v],l.emps=[],f.subordinates=[p,w],p.subordinates=[h],w.subordinates=[E,v],h.subordinates=[],E.subordinates=[],v.subordinates=[],B.depts={accounting:a,research:c,sales:u,operations:l},B.emps={king:f,jones:p,blake:w,smith:h,allen:E,ward:v},window.types={Dept:i,Emp:s,Name:o},console.log("Types available at: window.types = { Dept, Emp, Name }"),L("Scott schema loaded (with ObjectType)","success"),Se(),await se()}catch(t){const e=t;L("Error loading Scott: "+e.message,"error"),console.error(e)}}async function oo(){if(!R){L("Transaction not initialized","error");return}if(!R.isDirty()){L("No changes to save","success");return}try{console.log("Committing transaction to IndexedDB..."),await R.save(),U&&await qr(U),Se(),L("Changes saved to IndexedDB","success"),await se()}catch(t){const e=t;L("Save error: "+e.message,"error"),console.error(e)}}async function so(){if(!R){L("Transaction not initialized","error");return}if(R.isDirty()&&confirm("Discard all unsaved changes?"))try{console.log("Rolling back transaction..."),R.discard(),Se(),L("Changes discarded","success"),await se()}catch(t){L("Discard error: "+t.message,"error"),console.error(t)}}async function ao(){if(confirm("Clear all data from memory image and IndexedDB?")){if(!O||!R){L("Not initialized","error");return}try{for(const t in B)delete B[t];await R.save(),O!=null&&O.clear&&await O.clear(),R=await et(O),B=R.root,window.root=B,ot(R.unwrap.bind(R)),ne.reset(),Se(),L("Cleared all data","success"),await se()}catch(t){const e=t;L("Clear error: "+e.message,"error"),console.error(e)}}}function Wt(t,e){const n=new Blob([e],{type:"text/plain"}),r=URL.createObjectURL(n),o=document.createElement("a");o.href=r,o.download=t,o.click(),URL.revokeObjectURL(r)}async function io(){if(!B){L("No memory image open","error");return}if(!le){L("No metadata available","error");return}if(!confirm(`📸 Export Snapshot (External Use Only)

⚠️  IMPORTANT: Snapshots CANNOT be re-imported into Filer.

Snapshots are for:
• Sharing data with external tools
• Data analysis and reporting
• Human-readable backups

To save your work for later:
✅ Use 'Export Event Log' instead (re-importable)

Continue with snapshot export?`)){L("Snapshot export cancelled","info");return}try{console.log("Exporting snapshot...");const e=Ct(B),n=JSON.parse(e),r={type:"snapshot",version:1,timestamp:Date.now(),name:le.name,description:le.description,state:n},o=JSON.stringify(r,null,2),i=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5),s=`${le.name}-snapshot-${i}.json`;Wt(s,o),L(`Exported snapshot to ${s}`,"success"),console.log(`Exported snapshot (${o.length} bytes)`)}catch(e){const n=e;L("Export error: "+n.message,"error"),console.error("Export error:",n)}}async function co(){if(!O){L("No memory image open","error");return}if(!le){L("No metadata available","error");return}try{console.log("Exporting events...");const t=await O.getAll();if(t.length===0){L("No events to export","success");return}const e=t.map(o=>JSON.stringify(o)).join(`
`),n=new Date().toISOString().replace(/[:.]/g,"-").slice(0,-5),r=`${le.name}-${n}.ndjson`;Wt(r,e),L(`Exported ${t.length} events to ${r}`,"success"),console.log(`Exported ${t.length} events`)}catch(t){const e=t;L("Export error: "+e.message,"error"),console.error("Export error:",e)}}async function lo(t){if(!O||!R){L("No memory image open","error");return}try{console.log(`Importing event log from ${t.name}...`);const e=await t.text();try{const o=JSON.parse(e);if(o&&typeof o=="object"&&o.type==="snapshot"){L("Snapshot files cannot be imported. Use 'Export Event Log' to create re-importable files.","error"),alert(`⚠️  Snapshot Import Not Supported

Snapshot files are for external consumption only and cannot be re-imported.

To save and restore your data:
• Use 'Export Event Log' (not 'Export Snapshot')
• Event logs can be imported to restore your work

Snapshots are useful for sharing data with other tools,
but only Event Logs preserve the mutation history needed for import.`);return}}catch{}const n=e.trim().split(`
`).filter(o=>o.trim());if(n.length===0){L("No events found in file","error");return}const r=n.map(o=>{try{return JSON.parse(o)}catch{throw new Error(`Invalid JSON in file: ${o.slice(0,50)}...`)}});if(console.log(`Parsed ${r.length} events`),!confirm(`Import ${r.length} events? This will replace all current data.`))return;O!=null&&O.clear&&(await O.clear(),console.log("Cleared existing event log"));for(const o of r)await O.append(o);console.log(`Replayed ${r.length} events`),R=await et(O),B=R.root,window.root=B,ot(R.unwrap.bind(R)),ne.reset(),Se(),L(`Imported ${r.length} events from ${t.name}`,"success"),await se()}catch(e){const n=e;L("Import error: "+n.message,"error"),console.error("Import error:",n)}}function uo(){document.querySelectorAll(".resize-handle").forEach(e=>{let n=0,r=0,o=0,i=null,s=null;e.addEventListener("dblclick",u=>{u.preventDefault();const l=e.dataset.direction,f=e.previousElementSibling,p=e.nextElementSibling;if(!f||!p)return;const w=l==="vertical"?f.offsetHeight+p.offsetHeight:f.offsetWidth+p.offsetWidth,h=Math.floor(w/2);l==="vertical"?(f.style.flex="none",f.style.height=`${h}px`,p.style.flex="none",p.style.height=`${h}px`):(f.style.flex="none",f.style.width=`${h}px`,p.style.flex="none",p.style.width=`${h}px`)}),e.addEventListener("mousedown",u=>{u.preventDefault();const l=e.dataset.direction;i=e.previousElementSibling,s=e.nextElementSibling,!(!i||!s)&&(n=l==="vertical"?u.clientY:u.clientX,r=l==="vertical"?i.offsetHeight:i.offsetWidth,o=l==="vertical"?s.offsetHeight:s.offsetWidth,document.addEventListener("mousemove",a),document.addEventListener("mouseup",c),document.body.style.cursor=l==="vertical"?"ns-resize":"ew-resize",document.body.style.userSelect="none")});function a(u){if(!i||!s||!e)return;const l=e.dataset.direction,p=(l==="vertical"?u.clientY:u.clientX)-n,w=r+p,h=o-p,E=50;w<E||h<E||(l==="vertical"?(i.style.flex="none",i.style.height=`${w}px`,s.style.flex="none",s.style.height=`${h}px`):(i.style.flex="none",i.style.width=`${w}px`,s.style.flex="none",s.style.width=`${h}px`))}function c(){document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",c),document.body.style.cursor="",document.body.style.userSelect=""}})}function fo(){if(!U||!le)return;const t=document.getElementById("history-list"),e=document.getElementById("history-search"),n=document.getElementById("clear-history-btn"),r=document.getElementById("export-history-btn"),o=document.getElementById("toggle-history-btn"),i=document.getElementById("close-history-btn"),s=document.getElementById("script-history-sidebar");if(!t||!e||!n||!r)return;let a=!1;const c=l=>{Dt(l);const f=document.getElementById("code-editor");f&&f.focus(),s&&s.classList.add("collapsed")},u=async()=>{if(!a&&U)try{await Ze(t,U,c),a=!0}catch(l){console.error("Failed to load script history:",l),t.innerHTML='<div class="history-error">Failed to load history</div>'}};Zr(e,t,U,c),Qr(n,U,async()=>{U&&(await Ze(t,U,c),a=!0)}),eo(r,U,le.name),o&&s&&(o.onclick=async()=>{const l=s.classList.contains("collapsed");s.classList.toggle("collapsed"),l&&await u()}),i&&s&&(i.onclick=()=>{s.classList.add("collapsed")}),t.innerHTML='<div class="history-empty">Open history panel to view scripts</div>'}async function po(){if(!U)return;const t=document.getElementById("script-history-sidebar"),e=document.getElementById("history-list");if(!t||!e||t.classList.contains("collapsed"))return;await Ze(e,U,r=>{Dt(r);const o=document.getElementById("code-editor");o&&o.focus(),t&&t.classList.add("collapsed")})}async function Qe(){qt.style.display="none",Yt.style.display="flex",await Ue(zt,Ye),document.title="Navigator - Memory Image Explorer",ct("/"),console.log("Showing list view")}async function Ye(t){U=t;try{console.log(`Opening memory image: ${t}`);const e=await jr(t);if(!e)throw new Error(`Memory image not found: ${t}`);le=e,await xr(t),console.log("Script history store ensured");const n=Wr(t);O=Rn("memimg-explorer",n),R=await et(O),B=R.root,window.root=B,ot(R.unwrap.bind(R)),ne.onNavigate=se;const r=O.append.bind(O);O.append=async function(s){await r(s),Se()},Yt.style.display="none",qt.style.display="flex";const o=document.getElementById("current-memimg-name");o&&(o.textContent=e.name),document.title=`${e.name} - Navigator`;const i=document.getElementById("code-editor");i&&(i.value=""),fo(),Br(B,R,U,se),Dr(po),L("Ready","success"),await se(),ct(`/edit/${t}`),console.log("Memory image opened successfully")}catch(e){const n=e;L("Error opening memory image: "+n.message,"error"),console.error("Open error:",n)}}async function Gt(){if(R&&R.isDirty()&&!confirm("You have unsaved changes. Close anyway?"))return;const t=document.getElementById("code-editor");t&&(t.value="");const e=document.getElementById("script-history-sidebar");if(e&&e.classList.add("collapsed"),O!=null&&O.close)try{await O.close()}catch{}U=null,le=null,R=null,B=null,O=void 0,window.root=void 0,ne.reset(),await Qe(),console.log("Memory image closed")}const Vt="memimg-theme";function Jt(){return localStorage.getItem(Vt)||"dark"}function Kt(t){localStorage.setItem(Vt,t),document.documentElement.setAttribute("data-theme",t),mo(t)}function mo(t){const e=t==="dark"?"☀️":"🌙",n=document.getElementById("theme-toggle-list"),r=document.getElementById("theme-toggle-explorer");n&&(n.textContent=e),r&&(r.textContent=e)}function bt(){const e=Jt()==="dark"?"light":"dark";Kt(e)}function go(){const t=Jt();Kt(t)}let Ae=null,re="balanced";function ho(){const t=document.getElementById("editor-panel"),e=document.getElementById("bottom-panels");if(!t||!e)return;re!=="editor-max"&&(Ae={editorHeight:t.offsetHeight,graphHeight:e.offsetHeight});const n=t.offsetHeight+e.offsetHeight;t.style.flex="none",t.style.height=`${n-50}px`,e.style.flex="none",e.style.height="50px",re="editor-max",ut()}function yo(){const t=document.getElementById("editor-panel"),e=document.getElementById("bottom-panels");if(!t||!e)return;re!=="graph-max"&&(Ae={editorHeight:t.offsetHeight,graphHeight:e.offsetHeight});const n=t.offsetHeight+e.offsetHeight;t.style.flex="none",t.style.height="50px",e.style.flex="none",e.style.height=`${n-50}px`,re="graph-max",ut()}function lt(){const t=document.getElementById("editor-panel"),e=document.getElementById("bottom-panels");if(!(!t||!e)){if(Ae&&re!=="balanced")t.style.flex="none",t.style.height=`${Ae.editorHeight}px`,e.style.flex="none",e.style.height=`${Ae.graphHeight}px`,Ae=null;else{const n=t.offsetHeight+e.offsetHeight,r=Math.floor(n/2);t.style.flex="none",t.style.height=`${r}px`,e.style.flex="none",e.style.height=`${r}px`}re="balanced",ut()}}function vt(){re==="editor-max"?lt():ho()}function St(){re==="graph-max"?lt():yo()}function ut(){const t=document.getElementById("maximize-editor-btn"),e=document.getElementById("maximize-graph-btn");t&&(t.textContent="⛶",t.title=re==="editor-max"?"Restore editor (Alt+E)":"Maximize editor (Alt+E)"),e&&(e.textContent="⛶",e.title=re==="graph-max"?"Restore graph (Alt+G)":"Maximize graph (Alt+G)")}function Eo(){const t=document.getElementById("create-memimg-btn");t&&t.addEventListener("click",()=>{$t(zt,Ye)});const e=document.getElementById("back-to-list-btn");e&&e.addEventListener("click",Gt);const n=document.getElementById("back-btn"),r=document.getElementById("forward-btn");n&&n.addEventListener("click",()=>{ne.goBack()}),r&&r.addEventListener("click",()=>{ne.goForward()}),document.addEventListener("keydown",d=>{d.altKey&&d.key==="ArrowLeft"&&(d.preventDefault(),ne.goBack()),d.altKey&&d.key==="ArrowRight"&&(d.preventDefault(),ne.goForward()),d.altKey&&d.key.toLowerCase()==="e"&&(d.preventDefault(),vt()),d.altKey&&d.key.toLowerCase()==="g"&&(d.preventDefault(),St()),d.altKey&&d.key.toLowerCase()==="b"&&(d.preventDefault(),lt())});const o=document.getElementById("load-scott-btn"),i=document.getElementById("export-snapshot-btn"),s=document.getElementById("export-events-btn"),a=document.getElementById("import-events-btn"),c=document.getElementById("save-btn"),u=document.getElementById("discard-btn"),l=document.getElementById("clear-btn");o&&o.addEventListener("click",ro),i&&i.addEventListener("click",io),s&&s.addEventListener("click",co),a&&a.addEventListener("click",()=>{const d=document.getElementById("events-file-input");d&&d.click()}),c&&c.addEventListener("click",oo),u&&u.addEventListener("click",so),l&&l.addEventListener("click",ao);const f=document.getElementById("events-file-input");f&&f.addEventListener("change",async d=>{var S;const m=d.target,y=(S=m.files)==null?void 0:S[0];y&&(await lo(y),m.value="")});const p=document.getElementById("run-btn");p&&p.addEventListener("click",async()=>{B&&R&&U&&await Mt(B,R,U,se)});const w=document.getElementById("toggle-line-numbers-btn");w&&w.addEventListener("click",Mr);const h=document.getElementById("maximize-editor-btn");h&&h.addEventListener("click",vt);const E=document.getElementById("maximize-graph-btn");E&&E.addEventListener("click",St),window.addEventListener("hashchange",to),uo();const v=document.getElementById("theme-toggle-list"),b=document.getElementById("theme-toggle-explorer");v&&v.addEventListener("click",bt),b&&b.addEventListener("click",bt),console.log("Event listeners attached")}(async()=>{try{console.log("Initializing Navigator..."),window.addEventListener("pageshow",n=>{if(n.persisted){const r=document.getElementById("code-editor");r&&(r.value="")}});const t=document.getElementById("code-editor");t&&(t.value=""),go(),Eo();const e=Ut();if(e.view==="edit"&&e.memimgId){console.log(`Loading memory image from hash: ${e.memimgId}`);try{await Ye(e.memimgId)}catch(n){console.error(`Failed to load memory image from hash: ${e.memimgId}`,n),L(`Could not load memory image: ${e.memimgId}`,"error"),await Qe()}}else await Qe();console.log("Navigator initialization complete")}catch(t){console.error("Failed to initialize:",t),L("Initialization error: "+t.message,"error")}})();</script>
  <link rel="stylesheet" crossorigin href="./navigator.css">
</head>
<body>
    <div id="app">
        <!-- List View (shown by default) -->
        <div id="list-view" class="view-container">
            <div class="app-title">Filer Navigator</div>
            <header class="list-header">
                <div class="logo">
                    <svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"
                    width="32" height="32" aria-label="Navigator">
                        <circle cx="24" cy="24" r="22" fill="#6366f1"/>
                        <line x1="24" y1="14" x2="16" y2="24" stroke="#fbbf24" stroke-width="2" stroke-linecap="round"/>
                        <line x1="24" y1="14" x2="32" y2="24" stroke="#fbbf24" stroke-width="2" stroke-linecap="round"/>
                        <line x1="16" y1="24" x2="24" y2="34" stroke="#10b981" stroke-width="2" stroke-linecap="round"/>
                        <line x1="32" y1="24" x2="24" y2="34" stroke="#10b981" stroke-width="2" stroke-linecap="round"/>
                        <line x1="16" y1="24" x2="32" y2="24" stroke="#ec4899" stroke-width="2" stroke-linecap="round"/>
                        <circle cx="24" cy="14" r="4" fill="#fef3c7"/>
                        <circle cx="16" cy="24" r="4" fill="#fde68a"/>
                        <circle cx="32" cy="24" r="4" fill="#fde68a"/>
                        <circle cx="24" cy="34" r="4" fill="#fef3c7"/>
                        <circle cx="24" cy="24" r="3" fill="#ffffff"/>
                        <text x="24" y="43" font-family="Arial, sans-serif"
                        font-size="5.5" font-weight="bold" fill="#ffffff"
                        text-anchor="middle" letter-spacing="1.5">Navigator</text>
                    </svg>
                    <h1>Navigator</h1>
                    <span class="subtitle">Memory Image Explorer</span>
                </div>
                <div class="controls">
                    <button id="theme-toggle-list" class="icon-btn" title="Toggle theme">🌙</button>
                    <button id="create-memimg-btn" class="primary-button">+ New Memory Image</button>
                </div>
            </header>
            <div id="memimg-list-content" class="list-content"></div>
        </div>

        <!-- Explorer View (hidden by default) -->
        <div id="explorer-view" class="view-container" style="display: none;">
            <!-- Script History Sidebar -->
            <div id="script-history-sidebar" class="sidebar collapsed">
                <div class="sidebar-header">
                    <h3>Script History</h3>
                    <button id="close-history-btn" class="icon-btn" title="Close history panel">✕</button>
                </div>
                <div class="sidebar-controls">
                    <input type="text" id="history-search" placeholder="Search scripts..." />
                    <button id="export-history-btn" class="icon-btn" title="Export history">📥</button>
                    <button id="clear-history-btn" class="icon-btn" title="Clear history">🗑️</button>
                </div>
                <div class="sidebar-stats">
                    <span class="history-stats"></span>
                </div>
                <div id="history-list" class="sidebar-content"></div>
            </div>

            <!-- Compact Header -->
            <header class="compact-header">
                <div class="header-left">
                    <svg viewBox="0 0 48 48" xmlns="http://www.w3.org/2000/svg"
                    width="28" height="28" aria-label="Navigator">
                        <circle cx="24" cy="24" r="22" fill="#6366f1"/>
                        <line x1="24" y1="14" x2="16" y2="24" stroke="#fbbf24" stroke-width="2" stroke-linecap="round"/>
                        <line x1="24" y1="14" x2="32" y2="24" stroke="#fbbf24" stroke-width="2" stroke-linecap="round"/>
                        <line x1="16" y1="24" x2="24" y2="34" stroke="#10b981" stroke-width="2" stroke-linecap="round"/>
                        <line x1="32" y1="24" x2="24" y2="34" stroke="#10b981" stroke-width="2" stroke-linecap="round"/>
                        <line x1="16" y1="24" x2="32" y2="24" stroke="#ec4899" stroke-width="2" stroke-linecap="round"/>
                        <circle cx="24" cy="14" r="4" fill="#fef3c7"/>
                        <circle cx="16" cy="24" r="4" fill="#fde68a"/>
                        <circle cx="32" cy="24" r="4" fill="#fde68a"/>
                        <circle cx="24" cy="34" r="4" fill="#fef3c7"/>
                        <circle cx="24" cy="24" r="3" fill="#ffffff"/>
                        <text x="24" y="43" font-family="Arial, sans-serif"
                        font-size="5.5" font-weight="bold" fill="#ffffff"
                        text-anchor="middle" letter-spacing="1.5">Navigator</text>
                    </svg>
                    <span class="app-title-inline">Filer Navigator</span>
                    <span class="title-separator">|</span>
                    <h1 id="current-memimg-name" class="memimg-name-inline">Memory Image</h1>
                </div>
                <div class="header-right">
                    <button id="back-to-list-btn" class="compact-btn" title="Back to list">← Back</button>
                    <button id="save-btn" class="compact-btn" title="Save to IndexedDB">💾 Save</button>
                    <button id="discard-btn" class="compact-btn" title="Discard unsaved changes" style="display: none;">↩️ Discard</button>
                    <button id="export-events-btn" class="compact-btn" title="✅ Export event log (NDJSON format - CAN be re-imported)">📜 Export Events</button>
                    <button id="import-events-btn" class="compact-btn" title="Import event log (NDJSON format only - snapshots cannot be imported)">📥 Import Events</button>
                    <button id="export-snapshot-btn" class="compact-btn" title="⚠️  Export current state as JSON (for external use only - CANNOT be re-imported)">📸 Snapshot</button>
                    <button id="clear-btn" class="compact-btn" title="Clear all data">🗑️ Clear</button>
                    <button id="load-scott-btn" class="compact-btn" title="Load example data">📂 Load Example</button>
                    <button id="theme-toggle-explorer" class="icon-btn compact-btn" title="Toggle theme">☀️</button>
                </div>
            </header>
            <!-- Hidden file input for import -->
            <input type="file" id="events-file-input" accept=".json,.ndjson,.txt" style="display: none">
            <div id="status" class="status-bar"></div>

            <!-- Code editor (TOP panel) -->
            <section id="editor-panel" class="panel">
                <div class="panel-header">
                    <h2>Code Editor</h2>
                    <div class="editor-controls">
                        <button id="maximize-editor-btn" class="icon-btn" title="Maximize editor (Alt+E)">⛶</button>
                        <button id="toggle-line-numbers-btn" class="icon-btn" title="Toggle line numbers">#</button>
                        <button id="toggle-history-btn" title="Show script history">📜 History</button>
                        <button id="run-btn" title="Run code (Ctrl+Enter)">▶ Run</button>
                    </div>
                </div>
                <div class="editor-wrapper">
                    <div class="line-numbers" id="line-numbers"></div>
                    <div id="code-editor" class="code-editor" spellcheck="false"></div>
                </div>
                <div id="error-panel" class="error-panel" style="display: none;"></div>
            </section>

            <!-- Vertical resize handle -->
            <div class="resize-handle resize-handle-horizontal" data-direction="vertical"></div>

            <!-- Bottom panels (Object Graph) -->
            <main id="bottom-panels">
                <!-- Tree view (left panel) -->
                <section id="tree-panel" class="panel">
                    <div class="panel-header">
                        <h2>Object Graph</h2>
                        <div class="nav-buttons">
                            <button id="maximize-graph-btn" class="icon-btn" title="Maximize graph (Alt+G)">⛶</button>
                            <button id="back-btn" title="Back (Alt+Left)" disabled>◀</button>
                            <button id="forward-btn" title="Forward (Alt+Right)" disabled>▶</button>
                        </div>
                    </div>
                    <div id="tree-view" class="panel-content"></div>
                </section>

                <!-- Horizontal resize handle -->
                <div class="resize-handle resize-handle-vertical" data-direction="horizontal"></div>

                <!-- Property inspector (right panel) -->
                <section id="inspector-panel" class="panel">
                    <div class="panel-header">
                        <h2>Properties</h2>
                        <span id="selected-path" class="path-display"></span>
                    </div>
                    <div id="inspector-view" class="panel-content"></div>
                </section>
            </main>
        </div>
    </div>

    <!-- Load main module -->
</body>
</html>
